<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script>
    var name_data;
    var writeInHead = true;
    var waitForOnload = true;

    var tryProtected = function(blockFn) {
      try {
        blockFn();
      } catch (err) {
        window.parent.postMessage(
            {type: 'no-content', error: err.message}, '*');
        window.name = '';
      }
    };

    tryProtected(function() {
      name_data = JSON.parse(window.name);
      writeInHead = name_data['writeInHead'];
      waitForOnload = name_data['waitForOnload'];
      if (!name_data || !name_data['creative']) {
        throw new Error('Missing or incorrectly formatted JSON ' +
            'input to nameframe');
      }
    });

    var render = function() {
      tryProtected(function() {
        document.open();
        document.write(name_data['creative']);
        document.close();
        delete name_data['creative'];
        window.name = JSON.stringify(name_data);
      });
    };

    if (writeInHead && waitForOnload) {
      window.onload = render;
    } else if (writeInHead) {
      render();
    }
  </script>
</head>
<body>
  <script>
    if (!writeInHead && waitForOnload) {
      window.onload = render;
    } else if (!writeInHead) {
      render();
    }
  </script>
</body>
</html>
