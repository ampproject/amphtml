/**
 * Copyright 2015 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * The entry point for AMP Runtime (v0.js) when AMP Runtime = AMP Doc.
 */
// src/polyfills.js must be the first import.
import "./polyfills";
import * as mode from "./core/mode";
import { installAutoLightboxExtension } from "./auto-lightbox";
import { startupChunk } from "./chunk";
import { TickLabel } from "./core/constants/enums";
import { installErrorReporting } from "./error-reporting";
import { fontStylesheetTimeout } from "./font-stylesheet-timeout";
import { maybeTrackImpression } from "./impression";
import { getMode } from "./mode";
import { preconnectToOrigin } from "./preconnect";
import { installPullToRefreshBlocker } from "./pull-to-refresh";
import { adoptWithMultidocDeps } from "./runtime";
import { Services } from "./service";
import { installDocService } from "./service/ampdoc-impl";
import { installAmpdocServices, installBuiltinElements, installRuntimeServices } from "./service/core-services";
import { stubElementsForDoc } from "./service/custom-element-registry";
import { installPerformanceService } from "./service/performance-impl";
import { installPlatformService } from "./service/platform-impl";
import { installStandaloneExtension } from "./standalone";
import { installStylesForDoc, makeBodyVisible, makeBodyVisibleRecovery } from "./style-installer";
import { maybeValidate } from "./validator-integration";
import { cssText as ampDocCss } from "../build/ampdoc.css";
import { cssText as ampSharedCss } from "../build/ampshared.css";

/**
 * Execute the bootstrap
 * @param {!./service/ampdoc-impl.AmpDoc} ampdoc
 * @param {!./service/performance-impl.Performance} perf
 */
function bootstrap(ampdoc, perf) {
  startupChunk(self.document, function services() {
    // Core services.
    installRuntimeServices(self);
    installAmpdocServices(ampdoc);
    // We need the core services (viewer/resources) to start instrumenting
    perf.coreServicesAvailable();
    maybeTrackImpression(self);
  });
  startupChunk(self.document, function adoptWindow() {
    adoptWithMultidocDeps(self);
  });
  startupChunk(self.document, function builtins() {
    // Builtins.
    installBuiltinElements(self);
  });
  startupChunk(self.document, function stub() {
    // Pre-stub already known elements.
    stubElementsForDoc(ampdoc);
  });
  startupChunk(self.document, function final() {
    if (!false) {
      installPullToRefreshBlocker(self);
    }

    installAutoLightboxExtension(ampdoc);
    installStandaloneExtension(ampdoc);
    maybeValidate(self);
    makeBodyVisible(self.document);
    preconnectToOrigin(self.document);
  },
  /* makes the body visible */
  true);
  startupChunk(self.document, function finalTick() {
    perf.tick(TickLabel.END_INSTALL_STYLES);
    Services.resourcesForDoc(ampdoc).ampInitComplete();
    // TODO(erwinm): move invocation of the `flush` method when we have the
    // new ticks in place to batch the ticks properly.
    perf.flush();
  });
}

// Store the originalHash as early as possible. Trying to debug:
// https://github.com/ampproject/amphtml/issues/6070
if (self.location) {
  self.location['originalHash'] = self.location.hash;
}

/** @type {!./service/ampdoc-impl.AmpDocService} */
var ampdocService;

// We must under all circumstances call makeBodyVisible.
// It is much better to have AMP tags not rendered than having
// a completely blank page.
try {
  // Should happen first.
  installErrorReporting(self);
  // Also calls makeBodyVisibleRecovery on errors.
  // Declare that this runtime will support a single root doc. Should happen
  // as early as possible.
  installDocService(self,
  /* isSingleDoc */
  true);
  ampdocService = Services.ampdocServiceFor(self);
} catch (e) {
  // In case of an error call this.
  makeBodyVisibleRecovery(self.document);
  throw e;
}

startupChunk(self.document, function initial() {
  /** @const {!./service/ampdoc-impl.AmpDoc} */
  var ampdoc = ampdocService.getAmpDoc(self.document);
  installPlatformService(self);
  installPerformanceService(self);

  /** @const {!./service/performance-impl.Performance} */
  var perf = Services.performanceFor(self);

  if (false) {
    perf.addEnabledExperiment('esm');
  }

  fontStylesheetTimeout(self);
  perf.tick(TickLabel.INSTALL_STYLES);

  if (false) {
    bootstrap(ampdoc, perf);
    return;
  }

  installStylesForDoc(ampdoc, ampDocCss + ampSharedCss, function () {
    return bootstrap(ampdoc, perf);
  },
  /* opt_isRuntimeCss */
  true,
  /* opt_ext */
  'amp-runtime');

  // TODO(kbax) Remove this IE deprecation warning on 26 August 2021.
  if (Services.platformFor(self).isIe() && self.console) {
    (console.info || console.log).call(console, 'IE Support is being deprecated, in September 2021 IE will no longer be supported. See https://github.com/ampproject/amphtml/issues/34453 for more details.');
  }
});

// Output a message to the console and add an attribute to the <html>
// tag to give some information that can be used in error reports.
// (At least by sophisticated users).
if (self.console) {
  (console.info || console.log).call(console, "Powered by AMP \u26A1 HTML \u2013 Version " + mode.version(), self.location.href);
}

// This code is eleminated in prod build through a babel transformer.
if (getMode().localDev) {
  self.document.documentElement.setAttribute('esm', false ? 1 : 0);
}

self.document.documentElement.setAttribute('amp-version', mode.version());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFtcC5qcyJdLCJuYW1lcyI6WyJtb2RlIiwiaW5zdGFsbEF1dG9MaWdodGJveEV4dGVuc2lvbiIsInN0YXJ0dXBDaHVuayIsIlRpY2tMYWJlbCIsImluc3RhbGxFcnJvclJlcG9ydGluZyIsImZvbnRTdHlsZXNoZWV0VGltZW91dCIsIm1heWJlVHJhY2tJbXByZXNzaW9uIiwiZ2V0TW9kZSIsInByZWNvbm5lY3RUb09yaWdpbiIsImluc3RhbGxQdWxsVG9SZWZyZXNoQmxvY2tlciIsImFkb3B0V2l0aE11bHRpZG9jRGVwcyIsIlNlcnZpY2VzIiwiaW5zdGFsbERvY1NlcnZpY2UiLCJpbnN0YWxsQW1wZG9jU2VydmljZXMiLCJpbnN0YWxsQnVpbHRpbkVsZW1lbnRzIiwiaW5zdGFsbFJ1bnRpbWVTZXJ2aWNlcyIsInN0dWJFbGVtZW50c0ZvckRvYyIsImluc3RhbGxQZXJmb3JtYW5jZVNlcnZpY2UiLCJpbnN0YWxsUGxhdGZvcm1TZXJ2aWNlIiwiaW5zdGFsbFN0YW5kYWxvbmVFeHRlbnNpb24iLCJpbnN0YWxsU3R5bGVzRm9yRG9jIiwibWFrZUJvZHlWaXNpYmxlIiwibWFrZUJvZHlWaXNpYmxlUmVjb3ZlcnkiLCJtYXliZVZhbGlkYXRlIiwiY3NzVGV4dCIsImFtcERvY0NzcyIsImFtcFNoYXJlZENzcyIsImJvb3RzdHJhcCIsImFtcGRvYyIsInBlcmYiLCJzZWxmIiwiZG9jdW1lbnQiLCJzZXJ2aWNlcyIsImNvcmVTZXJ2aWNlc0F2YWlsYWJsZSIsImFkb3B0V2luZG93IiwiYnVpbHRpbnMiLCJzdHViIiwiZmluYWwiLCJmaW5hbFRpY2siLCJ0aWNrIiwiRU5EX0lOU1RBTExfU1RZTEVTIiwicmVzb3VyY2VzRm9yRG9jIiwiYW1wSW5pdENvbXBsZXRlIiwiZmx1c2giLCJsb2NhdGlvbiIsImhhc2giLCJhbXBkb2NTZXJ2aWNlIiwiYW1wZG9jU2VydmljZUZvciIsImUiLCJpbml0aWFsIiwiZ2V0QW1wRG9jIiwicGVyZm9ybWFuY2VGb3IiLCJhZGRFbmFibGVkRXhwZXJpbWVudCIsIklOU1RBTExfU1RZTEVTIiwicGxhdGZvcm1Gb3IiLCJpc0llIiwiY29uc29sZSIsImluZm8iLCJsb2ciLCJjYWxsIiwidmVyc2lvbiIsImhyZWYiLCJsb2NhbERldiIsImRvY3VtZW50RWxlbWVudCIsInNldEF0dHJpYnV0ZSJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQSxPQUFPLEtBQUtBLElBQVo7QUFFQSxTQUFRQyw0QkFBUjtBQUNBLFNBQVFDLFlBQVI7QUFDQSxTQUFRQyxTQUFSO0FBQ0EsU0FBUUMscUJBQVI7QUFDQSxTQUFRQyxxQkFBUjtBQUNBLFNBQVFDLG9CQUFSO0FBQ0EsU0FBUUMsT0FBUjtBQUNBLFNBQVFDLGtCQUFSO0FBQ0EsU0FBUUMsMkJBQVI7QUFDQSxTQUFRQyxxQkFBUjtBQUNBLFNBQVFDLFFBQVI7QUFDQSxTQUFRQyxpQkFBUjtBQUNBLFNBQ0VDLHFCQURGLEVBRUVDLHNCQUZGLEVBR0VDLHNCQUhGO0FBS0EsU0FBUUMsa0JBQVI7QUFDQSxTQUFRQyx5QkFBUjtBQUNBLFNBQVFDLHNCQUFSO0FBQ0EsU0FBUUMsMEJBQVI7QUFDQSxTQUNFQyxtQkFERixFQUVFQyxlQUZGLEVBR0VDLHVCQUhGO0FBS0EsU0FBUUMsYUFBUjtBQUVBLFNBQVFDLE9BQU8sSUFBSUMsU0FBbkI7QUFDQSxTQUFRRCxPQUFPLElBQUlFLFlBQW5COztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTQyxTQUFULENBQW1CQyxNQUFuQixFQUEyQkMsSUFBM0IsRUFBaUM7QUFDL0IzQixFQUFBQSxZQUFZLENBQUM0QixJQUFJLENBQUNDLFFBQU4sRUFBZ0IsU0FBU0MsUUFBVCxHQUFvQjtBQUM5QztBQUNBakIsSUFBQUEsc0JBQXNCLENBQUNlLElBQUQsQ0FBdEI7QUFDQWpCLElBQUFBLHFCQUFx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QUFDRDs7QUFDRGxDLElBQUksQ0FBQ0MsUUFBTCxDQUFjZ0MsZUFBZCxDQUE4QkMsWUFBOUIsQ0FBMkMsYUFBM0MsRUFBMERoRSxJQUFJLENBQUM0RCxPQUFMLEVBQTFEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxNSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTLUlTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbi8qKlxuICogVGhlIGVudHJ5IHBvaW50IGZvciBBTVAgUnVudGltZSAodjAuanMpIHdoZW4gQU1QIFJ1bnRpbWUgPSBBTVAgRG9jLlxuICovXG5cbi8vIHNyYy9wb2x5ZmlsbHMuanMgbXVzdCBiZSB0aGUgZmlyc3QgaW1wb3J0LlxuaW1wb3J0ICcuL3BvbHlmaWxscyc7XG5cbmltcG9ydCAqIGFzIG1vZGUgZnJvbSAnI2NvcmUvbW9kZSc7XG5cbmltcG9ydCB7aW5zdGFsbEF1dG9MaWdodGJveEV4dGVuc2lvbn0gZnJvbSAnLi9hdXRvLWxpZ2h0Ym94JztcbmltcG9ydCB7c3RhcnR1cENodW5rfSBmcm9tICcuL2NodW5rJztcbmltcG9ydCB7VGlja0xhYmVsfSBmcm9tICcuL2NvcmUvY29uc3RhbnRzL2VudW1zJztcbmltcG9ydCB7aW5zdGFsbEVycm9yUmVwb3J0aW5nfSBmcm9tICcuL2Vycm9yLXJlcG9ydGluZyc7XG5pbXBvcnQge2ZvbnRTdHlsZXNoZWV0VGltZW91dH0gZnJvbSAnLi9mb250LXN0eWxlc2hlZXQtdGltZW91dCc7XG5pbXBvcnQge21heWJlVHJhY2tJbXByZXNzaW9ufSBmcm9tICcuL2ltcHJlc3Npb24nO1xuaW1wb3J0IHtnZXRNb2RlfSBmcm9tICcuL21vZGUnO1xuaW1wb3J0IHtwcmVjb25uZWN0VG9PcmlnaW59IGZyb20gJy4vcHJlY29ubmVjdCc7XG5pbXBvcnQge2luc3RhbGxQdWxsVG9SZWZyZXNoQmxvY2tlcn0gZnJvbSAnLi9wdWxsLXRvLXJlZnJlc2gnO1xuaW1wb3J0IHthZG9wdFdpdGhNdWx0aWRvY0RlcHN9IGZyb20gJy4vcnVudGltZSc7XG5pbXBvcnQge1NlcnZpY2VzfSBmcm9tICcuL3NlcnZpY2UnO1xuaW1wb3J0IHtpbnN0YWxsRG9jU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL2FtcGRvYy1pbXBsJztcbmltcG9ydCB7XG4gIGluc3RhbGxBbXBkb2NTZXJ2aWNlcyxcbiAgaW5zdGFsbEJ1aWx0aW5FbGVtZW50cyxcbiAgaW5zdGFsbFJ1bnRpbWVTZXJ2aWNlcyxcbn0gZnJvbSAnLi9zZXJ2aWNlL2NvcmUtc2VydmljZXMnO1xuaW1wb3J0IHtzdHViRWxlbWVudHNGb3JEb2N9IGZyb20gJy4vc2VydmljZS9jdXN0b20tZWxlbWVudC1yZWdpc3RyeSc7XG5pbXBvcnQge2luc3RhbGxQZXJmb3JtYW5jZVNlcnZpY2V9IGZyb20gJy4vc2VydmljZS9wZXJmb3JtYW5jZS1pbXBsJztcbmltcG9ydCB7aW5zdGFsbFBsYXRmb3JtU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL3BsYXRmb3JtLWltcGwnO1xuaW1wb3J0IHtpbnN0YWxsU3RhbmRhbG9uZUV4dGVuc2lvbn0gZnJvbSAnLi9zdGFuZGFsb25lJztcbmltcG9ydCB7XG4gIGluc3RhbGxTdHlsZXNGb3JEb2MsXG4gIG1ha2VCb2R5VmlzaWJsZSxcbiAgbWFrZUJvZHlWaXNpYmxlUmVjb3ZlcnksXG59IGZyb20gJy4vc3R5bGUtaW5zdGFsbGVyJztcbmltcG9ydCB7bWF5YmVWYWxpZGF0ZX0gZnJvbSAnLi92YWxpZGF0b3ItaW50ZWdyYXRpb24nO1xuXG5pbXBvcnQge2Nzc1RleHQgYXMgYW1wRG9jQ3NzfSBmcm9tICcuLi9idWlsZC9hbXBkb2MuY3NzJztcbmltcG9ydCB7Y3NzVGV4dCBhcyBhbXBTaGFyZWRDc3N9IGZyb20gJy4uL2J1aWxkL2FtcHNoYXJlZC5jc3MnO1xuXG4vKipcbiAqIEV4ZWN1dGUgdGhlIGJvb3RzdHJhcFxuICogQHBhcmFtIHshLi9zZXJ2aWNlL2FtcGRvYy1pbXBsLkFtcERvY30gYW1wZG9jXG4gKiBAcGFyYW0geyEuL3NlcnZpY2UvcGVyZm9ybWFuY2UtaW1wbC5QZXJmb3JtYW5jZX0gcGVyZlxuICovXG5mdW5jdGlvbiBib290c3RyYXAoYW1wZG9jLCBwZXJmKSB7XG4gIHN0YXJ0dXBDaHVuayhzZWxmLmRvY3VtZW50LCBmdW5jdGlvbiBzZXJ2aWNlcygpIHtcbiAgICAvLyBDb3JlIHNlcnZpY2VzLlxuICAgIGluc3RhbGxSdW50aW1lU2VydmljZXMoc2VsZik7XG4gICAgaW5zdGFsbEFtcGRvY1NlcnZpY2VzKGFtcGRvYyk7XG4gICAgLy8gV2UgbmVlZCB0aGUgY29yZSBzZXJ2aWNlcyAodmlld2VyL3Jlc291cmNlcykgdG8gc3RhcnQgaW5zdHJ1bWVudGluZ1xuICAgIHBlcmYuY29yZVNlcnZpY2VzQXZhaWxhYmxlKCk7XG4gICAgbWF5YmVUcmFja0ltcHJlc3Npb24oc2VsZik7XG4gIH0pO1xuICBzdGFydHVwQ2h1bmsoc2VsZi5kb2N1bWVudCwgZnVuY3Rpb24gYWRvcHRXaW5kb3coKSB7XG4gICAgYWRvcHRXaXRoTXVsdGlkb2NEZXBzKHNlbGYpO1xuICB9KTtcbiAgc3RhcnR1cENodW5rKHNlbGYuZG9jdW1lbnQsIGZ1bmN0aW9uIGJ1aWx0aW5zKCkge1xuICAgIC8vIEJ1aWx0aW5zLlxuICAgIGluc3RhbGxCdWlsdGluRWxlbWVudHMoc2VsZik7XG4gIH0pO1xuICBzdGFydHVwQ2h1bmsoc2VsZi5kb2N1bWVudCwgZnVuY3Rpb24gc3R1YigpIHtcbiAgICAvLyBQcmUtc3R1YiBhbHJlYWR5IGtub3duIGVsZW1lbnRzLlxuICAgIHN0dWJFbGVtZW50c0ZvckRvYyhhbXBkb2MpO1xuICB9KTtcbiAgc3RhcnR1cENodW5rKFxuICAgIHNlbGYuZG9jdW1lbnQsXG4gICAgZnVuY3Rpb24gZmluYWwoKSB7XG4gICAgICBpZiAoIUlTX1NYRykge1xuICAgICAgICBpbnN0YWxsUHVsbFRvUmVmcmVzaEJsb2NrZXIoc2VsZik7XG4gICAgICB9XG4gICAgICBpbnN0YWxsQXV0b0xpZ2h0Ym94RXh0ZW5zaW9uKGFtcGRvYyk7XG4gICAgICBpbnN0YWxsU3RhbmRhbG9uZUV4dGVuc2lvbihhbXBkb2MpO1xuICAgICAgbWF5YmVWYWxpZGF0ZShzZWxmKTtcbiAgICAgIG1ha2VCb2R5VmlzaWJsZShzZWxmLmRvY3VtZW50KTtcbiAgICAgIHByZWNvbm5lY3RUb09yaWdpbihzZWxmLmRvY3VtZW50KTtcbiAgICB9LFxuICAgIC8qIG1ha2VzIHRoZSBib2R5IHZpc2libGUgKi8gdHJ1ZVxuICApO1xuICBzdGFydHVwQ2h1bmsoc2VsZi5kb2N1bWVudCwgZnVuY3Rpb24gZmluYWxUaWNrKCkge1xuICAgIHBlcmYudGljayhUaWNrTGFiZWwuRU5EX0lOU1RBTExfU1RZTEVTKTtcbiAgICBTZXJ2aWNlcy5yZXNvdXJjZXNGb3JEb2MoYW1wZG9jKS5hbXBJbml0Q29tcGxldGUoKTtcbiAgICAvLyBUT0RPKGVyd2lubSk6IG1vdmUgaW52b2NhdGlvbiBvZiB0aGUgYGZsdXNoYCBtZXRob2Qgd2hlbiB3ZSBoYXZlIHRoZVxuICAgIC8vIG5ldyB0aWNrcyBpbiBwbGFjZSB0byBiYXRjaCB0aGUgdGlja3MgcHJvcGVybHkuXG4gICAgcGVyZi5mbHVzaCgpO1xuICB9KTtcbn1cblxuLy8gU3RvcmUgdGhlIG9yaWdpbmFsSGFzaCBhcyBlYXJseSBhcyBwb3NzaWJsZS4gVHJ5aW5nIHRvIGRlYnVnOlxuLy8gaHR0cHM6Ly9naXRodWIuY29tL2FtcHByb2plY3QvYW1waHRtbC9pc3N1ZXMvNjA3MFxuaWYgKHNlbGYubG9jYXRpb24pIHtcbiAgc2VsZi5sb2NhdGlvblsnb3JpZ2luYWxIYXNoJ10gPSBzZWxmLmxvY2F0aW9uLmhhc2g7XG59XG5cbi8qKiBAdHlwZSB7IS4vc2VydmljZS9hbXBkb2MtaW1wbC5BbXBEb2NTZXJ2aWNlfSAqL1xubGV0IGFtcGRvY1NlcnZpY2U7XG4vLyBXZSBtdXN0IHVuZGVyIGFsbCBjaXJjdW1zdGFuY2VzIGNhbGwgbWFrZUJvZHlWaXNpYmxlLlxuLy8gSXQgaXMgbXVjaCBiZXR0ZXIgdG8gaGF2ZSBBTVAgdGFncyBub3QgcmVuZGVyZWQgdGhhbiBoYXZpbmdcbi8vIGEgY29tcGxldGVseSBibGFuayBwYWdlLlxudHJ5IHtcbiAgLy8gU2hvdWxkIGhhcHBlbiBmaXJzdC5cbiAgaW5zdGFsbEVycm9yUmVwb3J0aW5nKHNlbGYpOyAvLyBBbHNvIGNhbGxzIG1ha2VCb2R5VmlzaWJsZVJlY292ZXJ5IG9uIGVycm9ycy5cblxuICAvLyBEZWNsYXJlIHRoYXQgdGhpcyBydW50aW1lIHdpbGwgc3VwcG9ydCBhIHNpbmdsZSByb290IGRvYy4gU2hvdWxkIGhhcHBlblxuICAvLyBhcyBlYXJseSBhcyBwb3NzaWJsZS5cbiAgaW5zdGFsbERvY1NlcnZpY2Uoc2VsZiwgLyogaXNTaW5nbGVEb2MgKi8gdHJ1ZSk7XG4gIGFtcGRvY1NlcnZpY2UgPSBTZXJ2aWNlcy5hbXBkb2NTZXJ2aWNlRm9yKHNlbGYpO1xufSBjYXRjaCAoZSkge1xuICAvLyBJbiBjYXNlIG9mIGFuIGVycm9yIGNhbGwgdGhpcy5cbiAgbWFrZUJvZHlWaXNpYmxlUmVjb3Zlcnkoc2VsZi5kb2N1bWVudCk7XG4gIHRocm93IGU7XG59XG5zdGFydHVwQ2h1bmsoc2VsZi5kb2N1bWVudCwgZnVuY3Rpb24gaW5pdGlhbCgpIHtcbiAgLyoqIEBjb25zdCB7IS4vc2VydmljZS9hbXBkb2MtaW1wbC5BbXBEb2N9ICovXG4gIGNvbnN0IGFtcGRvYyA9IGFtcGRvY1NlcnZpY2UuZ2V0QW1wRG9jKHNlbGYuZG9jdW1lbnQpO1xuICBpbnN0YWxsUGxhdGZvcm1TZXJ2aWNlKHNlbGYpO1xuICBpbnN0YWxsUGVyZm9ybWFuY2VTZXJ2aWNlKHNlbGYpO1xuICAvKiogQGNvbnN0IHshLi9zZXJ2aWNlL3BlcmZvcm1hbmNlLWltcGwuUGVyZm9ybWFuY2V9ICovXG4gIGNvbnN0IHBlcmYgPSBTZXJ2aWNlcy5wZXJmb3JtYW5jZUZvcihzZWxmKTtcbiAgaWYgKElTX0VTTSkge1xuICAgIHBlcmYuYWRkRW5hYmxlZEV4cGVyaW1lbnQoJ2VzbScpO1xuICB9XG4gIGZvbnRTdHlsZXNoZWV0VGltZW91dChzZWxmKTtcbiAgcGVyZi50aWNrKFRpY2tMYWJlbC5JTlNUQUxMX1NUWUxFUyk7XG4gIGlmIChJU19FU00pIHtcbiAgICBib290c3RyYXAoYW1wZG9jLCBwZXJmKTtcbiAgICByZXR1cm47XG4gIH1cblxuICBpbnN0YWxsU3R5bGVzRm9yRG9jKFxuICAgIGFtcGRvYyxcbiAgICBhbXBEb2NDc3MgKyBhbXBTaGFyZWRDc3MsXG4gICAgKCkgPT4gYm9vdHN0cmFwKGFtcGRvYywgcGVyZiksXG4gICAgLyogb3B0X2lzUnVudGltZUNzcyAqLyB0cnVlLFxuICAgIC8qIG9wdF9leHQgKi8gJ2FtcC1ydW50aW1lJ1xuICApO1xuICAvLyBUT0RPKGtiYXgpIFJlbW92ZSB0aGlzIElFIGRlcHJlY2F0aW9uIHdhcm5pbmcgb24gMjYgQXVndXN0IDIwMjEuXG4gIGlmIChTZXJ2aWNlcy5wbGF0Zm9ybUZvcihzZWxmKS5pc0llKCkgJiYgc2VsZi5jb25zb2xlKSB7XG4gICAgKGNvbnNvbGUuaW5mbyB8fCBjb25zb2xlLmxvZykuY2FsbChcbiAgICAgIGNvbnNvbGUsXG4gICAgICAnSUUgU3VwcG9ydCBpcyBiZWluZyBkZXByZWNhdGVkLCBpbiBTZXB0ZW1iZXIgMjAyMSBJRSB3aWxsIG5vIGxvbmdlciBiZSBzdXBwb3J0ZWQuIFNlZSBodHRwczovL2dpdGh1Yi5jb20vYW1wcHJvamVjdC9hbXBodG1sL2lzc3Vlcy8zNDQ1MyBmb3IgbW9yZSBkZXRhaWxzLidcbiAgICApO1xuICB9XG59KTtcblxuLy8gT3V0cHV0IGEgbWVzc2FnZSB0byB0aGUgY29uc29sZSBhbmQgYWRkIGFuIGF0dHJpYnV0ZSB0byB0aGUgPGh0bWw+XG4vLyB0YWcgdG8gZ2l2ZSBzb21lIGluZm9ybWF0aW9uIHRoYXQgY2FuIGJlIHVzZWQgaW4gZXJyb3IgcmVwb3J0cy5cbi8vIChBdCBsZWFzdCBieSBzb3BoaXN0aWNhdGVkIHVzZXJzKS5cbmlmIChzZWxmLmNvbnNvbGUpIHtcbiAgKGNvbnNvbGUuaW5mbyB8fCBjb25zb2xlLmxvZykuY2FsbChcbiAgICBjb25zb2xlLFxuICAgIGBQb3dlcmVkIGJ5IEFNUCDimqEgSFRNTCDigJMgVmVyc2lvbiAke21vZGUudmVyc2lvbigpfWAsXG4gICAgc2VsZi5sb2NhdGlvbi5ocmVmXG4gICk7XG59XG4vLyBUaGlzIGNvZGUgaXMgZWxlbWluYXRlZCBpbiBwcm9kIGJ1aWxkIHRocm91Z2ggYSBiYWJlbCB0cmFuc2Zvcm1lci5cbmlmIChnZXRNb2RlKCkubG9jYWxEZXYpIHtcbiAgc2VsZi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdlc20nLCBJU19FU00gPyAxIDogMCk7XG59XG5zZWxmLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FtcC12ZXJzaW9uJywgbW9kZS52ZXJzaW9uKCkpO1xuIl19
// /Users/mszylkowski/src/amphtml/src/amp.js