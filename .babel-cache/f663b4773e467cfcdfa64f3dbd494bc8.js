/**
 * Copyright 2018 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { devAssertElement } from "../../assert";
import { setStyles } from "../style";

/**
 * @param {!Window} win
 * @return {!Promise<boolean>}
 */
export function detectIsAutoplaySupported(win) {
  // To detect autoplay, we create a video element and call play on it, if
  // `paused` is true after `play()` call, autoplay is supported. Although
  // this is unintuitive, it works across browsers and is currently the lightest
  // way to detect autoplay without using a data source.
  var detectionElement =
  /** @type {!HTMLVideoElement} */
  win.document.createElement('video');
  // NOTE(aghassemi): We need both attributes and properties due to Chrome and
  // Safari differences when dealing with non-attached elements.
  detectionElement.setAttribute('muted', '');
  detectionElement.setAttribute('playsinline', '');
  detectionElement.setAttribute('webkit-playsinline', '');
  detectionElement.setAttribute('height', '0');
  detectionElement.setAttribute('width', '0');
  detectionElement.muted = true;
  detectionElement.playsInline = true;
  detectionElement['playsinline'] = true;
  detectionElement['webkitPlaysinline'] = true;
  setStyles(detectionElement, {
    position: 'fixed',
    top: '0',
    width: '0',
    height: '0',
    opacity: '0'
  });
  // Promise wrapped this way to catch both sync throws and async rejections.
  // More info: https://github.com/tc39/proposal-promise-try
  new Promise(function (resolve) {
    return resolve(detectionElement.play());
  }).catch(function () {// Suppress any errors, useless to report as they are expected.
  });
  return Promise.resolve(!detectionElement.paused);
}
var AUTOPLAY_SUPPORTED_WIN_PROP = '__AMP_AUTOPLAY';

/**
 * Determines autoplay support.
 *
 * Note that even if platfrom supports autoplay, users or browsers can disable
 * autoplay to save data / battery. This detects both platfrom support and
 * when autoplay has been disabled by the user.
 *
 * @param {!Window} win
 * @return {!Promise<boolean>}
 */
export function isAutoplaySupported(win) {
  if (win[AUTOPLAY_SUPPORTED_WIN_PROP] == null) {
    win[AUTOPLAY_SUPPORTED_WIN_PROP] = detectIsAutoplaySupported(win);
  }

  return win[AUTOPLAY_SUPPORTED_WIN_PROP];
}

/**
 * @param {!Window} win
 * @visibleForTesting
 */
export function resetIsAutoplaySupported(win) {
  delete win[AUTOPLAY_SUPPORTED_WIN_PROP];
}

/**
 * @param {!Element} element
 * @return {!Element}
 */
export function getInternalVideoElementFor(element) {
  return devAssertElement(element.querySelector('video, iframe'));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbImRldkFzc2VydEVsZW1lbnQiLCJzZXRTdHlsZXMiLCJkZXRlY3RJc0F1dG9wbGF5U3VwcG9ydGVkIiwid2luIiwiZGV0ZWN0aW9uRWxlbWVudCIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInNldEF0dHJpYnV0ZSIsIm11dGVkIiwicGxheXNJbmxpbmUiLCJwb3NpdGlvbiIsInRvcCIsIndpZHRoIiwiaGVpZ2h0Iiwib3BhY2l0eSIsIlByb21pc2UiLCJyZXNvbHZlIiwicGxheSIsImNhdGNoIiwicGF1c2VkIiwiQVVUT1BMQVlfU1VQUE9SVEVEX1dJTl9QUk9QIiwiaXNBdXRvcGxheVN1cHBvcnRlZCIsInJlc2V0SXNBdXRvcGxheVN1cHBvcnRlZCIsImdldEludGVybmFsVmlkZW9FbGVtZW50Rm9yIiwiZWxlbWVudCIsInF1ZXJ5U2VsZWN0b3IiXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVFBLGdCQUFSO0FBQ0EsU0FBUUMsU0FBUjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0MseUJBQVQsQ0FBbUNDLEdBQW5DLEVBQXdDO0FBQzdDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTUMsZ0JBQWdCO0FBQUc7QUFDdkJELEVBQUFBLEdBQUcsQ0FBQ0UsUUFBSixDQUFhQyxhQUFiLENBQTJCLE9BQTNCLENBREY7QUFJQTtBQUNBO0FBQ0FGLEVBQUFBLGdCQUFnQixDQUFDRyxZQUFqQixDQUE4QixPQUE5QixFQUF1QyxFQUF2QztBQUNBSCxFQUFBQSxnQkFBZ0IsQ0FBQ0csWUFBakIsQ0FBOEIsYUFBOUIsRUFBNkMsRUFBN0M7QUFDQUgsRUFBQUEsZ0JBQWdCLENBQUNHLFlBQWpCLENBQThCLG9CQUE5QixFQUFvRCxFQUFwRDtBQUNBSCxFQUFBQSxnQkFBZ0IsQ0FBQ0csWUFBakIsQ0FBOEIsUUFBOUIsRUFBd0MsR0FBeEM7QUFDQUgsRUFBQUEsZ0JBQWdCLENBQUNHLFlBQWpCLENBQThCLE9BQTlCLEVBQXVDLEdBQXZDO0FBRUFILEVBQUFBLGdCQUFnQixDQUFDSSxLQUFqQixHQUF5QixJQUF6QjtBQUNBSixFQUFBQSxnQkFBZ0IsQ0FBQ0ssV0FBakIsR0FBK0IsSUFBL0I7QUFDQUwsRUFBQUEsZ0JBQWdCLENBQUMsYUFBRCxDQUFoQixHQUFrQyxJQUFsQztBQUNBQSxFQUFBQSxnQkFBZ0IsQ0FBQyxtQkFBRCxDQUFoQixHQUF3QyxJQUF4QztBQUVBSCxFQUFBQSxTQUFTLENBQUNHLGdCQUFELEVBQW1CO0FBQzFCTSxJQUFBQSxRQUFRLEVBQUUsT0FEZ0I7QUFFMUJDLElBQUFBLEdBQUcsRUFBRSxHQUZxQjtBQUcxQkMsSUFBQUEsS0FBSyxFQUFFLEdBSG1CO0FBSTFCQyxJQUFBQSxNQUFNLEVBQUUsR0FKa0I7QUFLMUJDLElBQUFBLE9BQU8sRUFBRTtBQUxpQixHQUFuQixDQUFUO0FBUUE7QUFDQTtBQUNBLE1BQUlDLE9BQUosQ0FBWSxVQUFDQyxPQUFEO0FBQUEsV0FBYUEsT0FBTyxDQUFDWixnQkFBZ0IsQ0FBQ2EsSUFBakIsRUFBRCxDQUFwQjtBQUFBLEdBQVosRUFBMkRDLEtBQTNELENBQWlFLFlBQU0sQ0FDckU7QUFDRCxHQUZEO0FBSUEsU0FBT0gsT0FBTyxDQUFDQyxPQUFSLENBQWdCLENBQUNaLGdCQUFnQixDQUFDZSxNQUFsQyxDQUFQO0FBQ0Q7QUFFRCxJQUFNQywyQkFBMkIsR0FBRyxnQkFBcEM7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNDLG1CQUFULENBQTZCbEIsR0FBN0IsRUFBa0M7QUFDdkMsTUFBSUEsR0FBRyxDQUFDaUIsMkJBQUQsQ0FBSCxJQUFvQyxJQUF4QyxFQUE4QztBQUM1Q2pCLElBQUFBLEdBQUcsQ0FBQ2lCLDJCQUFELENBQUgsR0FBbUNsQix5QkFBeUIsQ0FBQ0MsR0FBRCxDQUE1RDtBQUNEOztBQUNELFNBQU9BLEdBQUcsQ0FBQ2lCLDJCQUFELENBQVY7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0Usd0JBQVQsQ0FBa0NuQixHQUFsQyxFQUF1QztBQUM1QyxTQUFPQSxHQUFHLENBQUNpQiwyQkFBRCxDQUFWO0FBQ0Q7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNHLDBCQUFULENBQW9DQyxPQUFwQyxFQUE2QztBQUNsRCxTQUFPeEIsZ0JBQWdCLENBQUN3QixPQUFPLENBQUNDLGFBQVIsQ0FBc0IsZUFBdEIsQ0FBRCxDQUF2QjtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxOCBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTLUlTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQge2RldkFzc2VydEVsZW1lbnR9IGZyb20gJyNjb3JlL2Fzc2VydCc7XG5pbXBvcnQge3NldFN0eWxlc30gZnJvbSAnI2NvcmUvZG9tL3N0eWxlJztcblxuLyoqXG4gKiBAcGFyYW0geyFXaW5kb3d9IHdpblxuICogQHJldHVybiB7IVByb21pc2U8Ym9vbGVhbj59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBkZXRlY3RJc0F1dG9wbGF5U3VwcG9ydGVkKHdpbikge1xuICAvLyBUbyBkZXRlY3QgYXV0b3BsYXksIHdlIGNyZWF0ZSBhIHZpZGVvIGVsZW1lbnQgYW5kIGNhbGwgcGxheSBvbiBpdCwgaWZcbiAgLy8gYHBhdXNlZGAgaXMgdHJ1ZSBhZnRlciBgcGxheSgpYCBjYWxsLCBhdXRvcGxheSBpcyBzdXBwb3J0ZWQuIEFsdGhvdWdoXG4gIC8vIHRoaXMgaXMgdW5pbnR1aXRpdmUsIGl0IHdvcmtzIGFjcm9zcyBicm93c2VycyBhbmQgaXMgY3VycmVudGx5IHRoZSBsaWdodGVzdFxuICAvLyB3YXkgdG8gZGV0ZWN0IGF1dG9wbGF5IHdpdGhvdXQgdXNpbmcgYSBkYXRhIHNvdXJjZS5cbiAgY29uc3QgZGV0ZWN0aW9uRWxlbWVudCA9IC8qKiBAdHlwZSB7IUhUTUxWaWRlb0VsZW1lbnR9ICovIChcbiAgICB3aW4uZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndmlkZW8nKVxuICApO1xuXG4gIC8vIE5PVEUoYWdoYXNzZW1pKTogV2UgbmVlZCBib3RoIGF0dHJpYnV0ZXMgYW5kIHByb3BlcnRpZXMgZHVlIHRvIENocm9tZSBhbmRcbiAgLy8gU2FmYXJpIGRpZmZlcmVuY2VzIHdoZW4gZGVhbGluZyB3aXRoIG5vbi1hdHRhY2hlZCBlbGVtZW50cy5cbiAgZGV0ZWN0aW9uRWxlbWVudC5zZXRBdHRyaWJ1dGUoJ211dGVkJywgJycpO1xuICBkZXRlY3Rpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgncGxheXNpbmxpbmUnLCAnJyk7XG4gIGRldGVjdGlvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCd3ZWJraXQtcGxheXNpbmxpbmUnLCAnJyk7XG4gIGRldGVjdGlvbkVsZW1lbnQuc2V0QXR0cmlidXRlKCdoZWlnaHQnLCAnMCcpO1xuICBkZXRlY3Rpb25FbGVtZW50LnNldEF0dHJpYnV0ZSgnd2lkdGgnLCAnMCcpO1xuXG4gIGRldGVjdGlvbkVsZW1lbnQubXV0ZWQgPSB0cnVlO1xuICBkZXRlY3Rpb25FbGVtZW50LnBsYXlzSW5saW5lID0gdHJ1ZTtcbiAgZGV0ZWN0aW9uRWxlbWVudFsncGxheXNpbmxpbmUnXSA9IHRydWU7XG4gIGRldGVjdGlvbkVsZW1lbnRbJ3dlYmtpdFBsYXlzaW5saW5lJ10gPSB0cnVlO1xuXG4gIHNldFN0eWxlcyhkZXRlY3Rpb25FbGVtZW50LCB7XG4gICAgcG9zaXRpb246ICdmaXhlZCcsXG4gICAgdG9wOiAnMCcsXG4gICAgd2lkdGg6ICcwJyxcbiAgICBoZWlnaHQ6ICcwJyxcbiAgICBvcGFjaXR5OiAnMCcsXG4gIH0pO1xuXG4gIC8vIFByb21pc2Ugd3JhcHBlZCB0aGlzIHdheSB0byBjYXRjaCBib3RoIHN5bmMgdGhyb3dzIGFuZCBhc3luYyByZWplY3Rpb25zLlxuICAvLyBNb3JlIGluZm86IGh0dHBzOi8vZ2l0aHViLmNvbS90YzM5L3Byb3Bvc2FsLXByb21pc2UtdHJ5XG4gIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiByZXNvbHZlKGRldGVjdGlvbkVsZW1lbnQucGxheSgpKSkuY2F0Y2goKCkgPT4ge1xuICAgIC8vIFN1cHByZXNzIGFueSBlcnJvcnMsIHVzZWxlc3MgdG8gcmVwb3J0IGFzIHRoZXkgYXJlIGV4cGVjdGVkLlxuICB9KTtcblxuICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCFkZXRlY3Rpb25FbGVtZW50LnBhdXNlZCk7XG59XG5cbmNvbnN0IEFVVE9QTEFZX1NVUFBPUlRFRF9XSU5fUFJPUCA9ICdfX0FNUF9BVVRPUExBWSc7XG5cbi8qKlxuICogRGV0ZXJtaW5lcyBhdXRvcGxheSBzdXBwb3J0LlxuICpcbiAqIE5vdGUgdGhhdCBldmVuIGlmIHBsYXRmcm9tIHN1cHBvcnRzIGF1dG9wbGF5LCB1c2VycyBvciBicm93c2VycyBjYW4gZGlzYWJsZVxuICogYXV0b3BsYXkgdG8gc2F2ZSBkYXRhIC8gYmF0dGVyeS4gVGhpcyBkZXRlY3RzIGJvdGggcGxhdGZyb20gc3VwcG9ydCBhbmRcbiAqIHdoZW4gYXV0b3BsYXkgaGFzIGJlZW4gZGlzYWJsZWQgYnkgdGhlIHVzZXIuXG4gKlxuICogQHBhcmFtIHshV2luZG93fSB3aW5cbiAqIEByZXR1cm4geyFQcm9taXNlPGJvb2xlYW4+fVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBdXRvcGxheVN1cHBvcnRlZCh3aW4pIHtcbiAgaWYgKHdpbltBVVRPUExBWV9TVVBQT1JURURfV0lOX1BST1BdID09IG51bGwpIHtcbiAgICB3aW5bQVVUT1BMQVlfU1VQUE9SVEVEX1dJTl9QUk9QXSA9IGRldGVjdElzQXV0b3BsYXlTdXBwb3J0ZWQod2luKTtcbiAgfVxuICByZXR1cm4gd2luW0FVVE9QTEFZX1NVUFBPUlRFRF9XSU5fUFJPUF07XG59XG5cbi8qKlxuICogQHBhcmFtIHshV2luZG93fSB3aW5cbiAqIEB2aXNpYmxlRm9yVGVzdGluZ1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVzZXRJc0F1dG9wbGF5U3VwcG9ydGVkKHdpbikge1xuICBkZWxldGUgd2luW0FVVE9QTEFZX1NVUFBPUlRFRF9XSU5fUFJPUF07XG59XG5cbi8qKlxuICogQHBhcmFtIHshRWxlbWVudH0gZWxlbWVudFxuICogQHJldHVybiB7IUVsZW1lbnR9XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRJbnRlcm5hbFZpZGVvRWxlbWVudEZvcihlbGVtZW50KSB7XG4gIHJldHVybiBkZXZBc3NlcnRFbGVtZW50KGVsZW1lbnQucXVlcnlTZWxlY3RvcigndmlkZW8sIGlmcmFtZScpKTtcbn1cbiJdfQ==
// /Users/mszylkowski/src/amphtml/src/core/dom/video/index.js