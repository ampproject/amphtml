/**
 * Copyright 2015 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * The entry point for AMP Runtime (v0.js) when AMP Runtime = AMP Doc.
 */
// src/polyfills.js must be the first import.
import "./polyfills";
import { installAutoLightboxExtension } from "./auto-lightbox";
import { startupChunk } from "./chunk";
import { TickLabel } from "./core/constants/enums";
import { installErrorReporting } from "./error-reporting";
import { fontStylesheetTimeout } from "./font-stylesheet-timeout";
import { maybeTrackImpression } from "./impression";
import { internalRuntimeVersion } from "./internal-version";
import { getMode } from "./mode";
import { preconnectToOrigin } from "./preconnect";
import { installPullToRefreshBlocker } from "./pull-to-refresh";
import { adoptWithMultidocDeps } from "./runtime";
import { Services } from "./service";
import { installDocService } from "./service/ampdoc-impl";
import { installAmpdocServices, installBuiltinElements, installRuntimeServices } from "./service/core-services";
import { stubElementsForDoc } from "./service/custom-element-registry";
import { installPerformanceService } from "./service/performance-impl";
import { installPlatformService } from "./service/platform-impl";
import { installStandaloneExtension } from "./standalone";
import { installStylesForDoc, makeBodyVisible, makeBodyVisibleRecovery } from "./style-installer";
import { maybeValidate } from "./validator-integration";
import { cssText as ampDocCss } from "../build/ampdoc.css";
import { cssText as ampSharedCss } from "../build/ampshared.css";

/**
 * Execute the bootstrap
 * @param {!./service/ampdoc-impl.AmpDoc} ampdoc
 * @param {!./service/performance-impl.Performance} perf
 */
function bootstrap(ampdoc, perf) {
  startupChunk(self.document, function services() {
    // Core services.
    installRuntimeServices(self);
    installAmpdocServices(ampdoc);
    // We need the core services (viewer/resources) to start instrumenting
    perf.coreServicesAvailable();
    maybeTrackImpression(self);
  });
  startupChunk(self.document, function adoptWindow() {
    adoptWithMultidocDeps(self);
  });
  startupChunk(self.document, function builtins() {
    // Builtins.
    installBuiltinElements(self);
  });
  startupChunk(self.document, function stub() {
    // Pre-stub already known elements.
    stubElementsForDoc(ampdoc);
  });
  startupChunk(self.document, function final() {
    if (!false) {
      installPullToRefreshBlocker(self);
    }

    installAutoLightboxExtension(ampdoc);
    installStandaloneExtension(ampdoc);
    maybeValidate(self);
    makeBodyVisible(self.document);
    preconnectToOrigin(self.document);
  },
  /* makes the body visible */
  true);
  startupChunk(self.document, function finalTick() {
    perf.tick(TickLabel.END_INSTALL_STYLES);
    Services.resourcesForDoc(ampdoc).ampInitComplete();
    // TODO(erwinm): move invocation of the `flush` method when we have the
    // new ticks in place to batch the ticks properly.
    perf.flush();
  });
}

// Store the originalHash as early as possible. Trying to debug:
// https://github.com/ampproject/amphtml/issues/6070
if (self.location) {
  self.location['originalHash'] = self.location.hash;
}

/** @type {!./service/ampdoc-impl.AmpDocService} */
var ampdocService;

// We must under all circumstances call makeBodyVisible.
// It is much better to have AMP tags not rendered than having
// a completely blank page.
try {
  // Should happen first.
  installErrorReporting(self);
  // Also calls makeBodyVisibleRecovery on errors.
  // Declare that this runtime will support a single root doc. Should happen
  // as early as possible.
  installDocService(self,
  /* isSingleDoc */
  true);
  ampdocService = Services.ampdocServiceFor(self);
} catch (e) {
  // In case of an error call this.
  makeBodyVisibleRecovery(self.document);
  throw e;
}

startupChunk(self.document, function initial() {
  /** @const {!./service/ampdoc-impl.AmpDoc} */
  var ampdoc = ampdocService.getAmpDoc(self.document);
  installPlatformService(self);
  installPerformanceService(self);

  /** @const {!./service/performance-impl.Performance} */
  var perf = Services.performanceFor(self);

  if (false) {
    perf.addEnabledExperiment('esm');
  }

  fontStylesheetTimeout(self);
  perf.tick(TickLabel.INSTALL_STYLES);

  if (false) {
    bootstrap(ampdoc, perf);
    return;
  }

  installStylesForDoc(ampdoc, ampDocCss + ampSharedCss, function () {
    return bootstrap(ampdoc, perf);
  },
  /* opt_isRuntimeCss */
  true,
  /* opt_ext */
  'amp-runtime');

  // TODO(kbax) Remove this IE deprecation warning on 26 August 2021.
  if (Services.platformFor(self).isIe() && self.console) {
    (console.info || console.log).call(console, 'IE Support is being deprecated, in September 2021 IE will no longer be supported. See https://github.com/ampproject/amphtml/issues/34453 for more details.');
  }
});

// Output a message to the console and add an attribute to the <html>
// tag to give some information that can be used in error reports.
// (At least by sophisticated users).
if (self.console) {
  (console.info || console.log).call(console, "Powered by AMP \u26A1 HTML \u2013 Version " + internalRuntimeVersion(), self.location.href);
}

// This code is eleminated in prod build through a babel transformer.
if (getMode().localDev) {
  self.document.documentElement.setAttribute('esm', false ? 1 : 0);
}

self.document.documentElement.setAttribute('amp-version', internalRuntimeVersion());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFtcC5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsQXV0b0xpZ2h0Ym94RXh0ZW5zaW9uIiwic3RhcnR1cENodW5rIiwiVGlja0xhYmVsIiwiaW5zdGFsbEVycm9yUmVwb3J0aW5nIiwiZm9udFN0eWxlc2hlZXRUaW1lb3V0IiwibWF5YmVUcmFja0ltcHJlc3Npb24iLCJpbnRlcm5hbFJ1bnRpbWVWZXJzaW9uIiwiZ2V0TW9kZSIsInByZWNvbm5lY3RUb09yaWdpbiIsImluc3RhbGxQdWxsVG9SZWZyZXNoQmxvY2tlciIsImFkb3B0V2l0aE11bHRpZG9jRGVwcyIsIlNlcnZpY2VzIiwiaW5zdGFsbERvY1NlcnZpY2UiLCJpbnN0YWxsQW1wZG9jU2VydmljZXMiLCJpbnN0YWxsQnVpbHRpbkVsZW1lbnRzIiwiaW5zdGFsbFJ1bnRpbWVTZXJ2aWNlcyIsInN0dWJFbGVtZW50c0ZvckRvYyIsImluc3RhbGxQZXJmb3JtYW5jZVNlcnZpY2UiLCJpbnN0YWxsUGxhdGZvcm1TZXJ2aWNlIiwiaW5zdGFsbFN0YW5kYWxvbmVFeHRlbnNpb24iLCJpbnN0YWxsU3R5bGVzRm9yRG9jIiwibWFrZUJvZHlWaXNpYmxlIiwibWFrZUJvZHlWaXNpYmxlUmVjb3ZlcnkiLCJtYXliZVZhbGlkYXRlIiwiY3NzVGV4dCIsImFtcERvY0NzcyIsImFtcFNoYXJlZENzcyIsImJvb3RzdHJhcCIsImFtcGRvYyIsInBlcmYiLCJzZWxmIiwiZG9jdW1lbnQiLCJzZXJ2aWNlcyIsImNvcmVTZXJ2aWNlc0F2YWlsYWJsZSIsImFkb3B0V2luZG93IiwiYnVpbHRpbnMiLCJzdHViIiwiZmluYWwiLCJmaW5hbFRpY2siLCJ0aWNrIiwiRU5EX0lOU1RBTExfU1RZTEVTIiwicmVzb3VyY2VzRm9yRG9jIiwiYW1wSW5pdENvbXBsZXRlIiwiZmx1c2giLCJsb2NhdGlvbiIsImhhc2giLCJhbXBkb2NTZXJ2aWNlIiwiYW1wZG9jU2VydmljZUZvciIsImUiLCJpbml0aWFsIiwiZ2V0QW1wRG9jIiwicGVyZm9ybWFuY2VGb3IiLCJhZGRFbmFibGVkRXhwZXJpbWVudCIsIklOU1RBTExfU1RZTEVTIiwicGxhdGZvcm1Gb3IiLCJpc0llIiwiY29uc29sZSIsImluZm8iLCJsb2ciLCJjYWxsIiwiaHJlZiIsImxvY2FsRGV2IiwiZG9jdW1lbnRFbGVtZW50Iiwic2V0QXR0cmlidXRlIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBLFNBQVFBLDRCQUFSO0FBQ0EsU0FBUUMsWUFBUjtBQUNBLFNBQVFDLFNBQVI7QUFDQSxTQUFRQyxxQkFBUjtBQUNBLFNBQVFDLHFCQUFSO0FBQ0EsU0FBUUMsb0JBQVI7QUFDQSxTQUFRQyxzQkFBUjtBQUNBLFNBQVFDLE9BQVI7QUFDQSxTQUFRQyxrQkFBUjtBQUNBLFNBQVFDLDJCQUFSO0FBQ0EsU0FBUUMscUJBQVI7QUFDQSxTQUFRQyxRQUFSO0FBQ0EsU0FBUUMsaUJBQVI7QUFDQSxTQUNFQyxxQkFERixFQUVFQyxzQkFGRixFQUdFQyxzQkFIRjtBQUtBLFNBQVFDLGtCQUFSO0FBQ0EsU0FBUUMseUJBQVI7QUFDQSxTQUFRQyxzQkFBUjtBQUNBLFNBQVFDLDBCQUFSO0FBQ0EsU0FDRUMsbUJBREYsRUFFRUMsZUFGRixFQUdFQyx1QkFIRjtBQUtBLFNBQVFDLGFBQVI7QUFFQSxTQUFRQyxPQUFPLElBQUlDLFNBQW5CO0FBQ0EsU0FBUUQsT0FBTyxJQUFJRSxZQUFuQjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsU0FBVCxDQUFtQkMsTUFBbkIsRUFBMkJDLElBQTNCLEVBQWlDO0FBQy9CNUIsRUFBQUEsWUFBWSxDQUFDNkIsSUFBSSxDQUFDQyxRQUFOLEVBQWdCLFNBQVNDLFFBQVQsR0FBb0I7QUFDOUM7QUFDQWpCLElBQUFBLHNCQUFzQixDQUFDZSxJQUFELENBQXRCO0FBQ0FqQixJQUFBQSxx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QUFDRGpDLElBQUksQ0FBQ0MsUUFBTCxDQUFjK0IsZUFBZCxDQUE4QkMsWUFBOUIsQ0FDRSxhQURGLEVBRUV6RCxzQkFBc0IsRUFGeEIiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDE1IFRoZSBBTVAgSFRNTCBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMtSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLyoqXG4gKiBUaGUgZW50cnkgcG9pbnQgZm9yIEFNUCBSdW50aW1lICh2MC5qcykgd2hlbiBBTVAgUnVudGltZSA9IEFNUCBEb2MuXG4gKi9cblxuLy8gc3JjL3BvbHlmaWxscy5qcyBtdXN0IGJlIHRoZSBmaXJzdCBpbXBvcnQuXG5pbXBvcnQgJy4vcG9seWZpbGxzJztcblxuaW1wb3J0IHtpbnN0YWxsQXV0b0xpZ2h0Ym94RXh0ZW5zaW9ufSBmcm9tICcuL2F1dG8tbGlnaHRib3gnO1xuaW1wb3J0IHtzdGFydHVwQ2h1bmt9IGZyb20gJy4vY2h1bmsnO1xuaW1wb3J0IHtUaWNrTGFiZWx9IGZyb20gJy4vY29yZS9jb25zdGFudHMvZW51bXMnO1xuaW1wb3J0IHtpbnN0YWxsRXJyb3JSZXBvcnRpbmd9IGZyb20gJy4vZXJyb3ItcmVwb3J0aW5nJztcbmltcG9ydCB7Zm9udFN0eWxlc2hlZXRUaW1lb3V0fSBmcm9tICcuL2ZvbnQtc3R5bGVzaGVldC10aW1lb3V0JztcbmltcG9ydCB7bWF5YmVUcmFja0ltcHJlc3Npb259IGZyb20gJy4vaW1wcmVzc2lvbic7XG5pbXBvcnQge2ludGVybmFsUnVudGltZVZlcnNpb259IGZyb20gJy4vaW50ZXJuYWwtdmVyc2lvbic7XG5pbXBvcnQge2dldE1vZGV9IGZyb20gJy4vbW9kZSc7XG5pbXBvcnQge3ByZWNvbm5lY3RUb09yaWdpbn0gZnJvbSAnLi9wcmVjb25uZWN0JztcbmltcG9ydCB7aW5zdGFsbFB1bGxUb1JlZnJlc2hCbG9ja2VyfSBmcm9tICcuL3B1bGwtdG8tcmVmcmVzaCc7XG5pbXBvcnQge2Fkb3B0V2l0aE11bHRpZG9jRGVwc30gZnJvbSAnLi9ydW50aW1lJztcbmltcG9ydCB7U2VydmljZXN9IGZyb20gJy4vc2VydmljZSc7XG5pbXBvcnQge2luc3RhbGxEb2NTZXJ2aWNlfSBmcm9tICcuL3NlcnZpY2UvYW1wZG9jLWltcGwnO1xuaW1wb3J0IHtcbiAgaW5zdGFsbEFtcGRvY1NlcnZpY2VzLFxuICBpbnN0YWxsQnVpbHRpbkVsZW1lbnRzLFxuICBpbnN0YWxsUnVudGltZVNlcnZpY2VzLFxufSBmcm9tICcuL3NlcnZpY2UvY29yZS1zZXJ2aWNlcyc7XG5pbXBvcnQge3N0dWJFbGVtZW50c0ZvckRvY30gZnJvbSAnLi9zZXJ2aWNlL2N1c3RvbS1lbGVtZW50LXJlZ2lzdHJ5JztcbmltcG9ydCB7aW5zdGFsbFBlcmZvcm1hbmNlU2VydmljZX0gZnJvbSAnLi9zZXJ2aWNlL3BlcmZvcm1hbmNlLWltcGwnO1xuaW1wb3J0IHtpbnN0YWxsUGxhdGZvcm1TZXJ2aWNlfSBmcm9tICcuL3NlcnZpY2UvcGxhdGZvcm0taW1wbCc7XG5pbXBvcnQge2luc3RhbGxTdGFuZGFsb25lRXh0ZW5zaW9ufSBmcm9tICcuL3N0YW5kYWxvbmUnO1xuaW1wb3J0IHtcbiAgaW5zdGFsbFN0eWxlc0ZvckRvYyxcbiAgbWFrZUJvZHlWaXNpYmxlLFxuICBtYWtlQm9keVZpc2libGVSZWNvdmVyeSxcbn0gZnJvbSAnLi9zdHlsZS1pbnN0YWxsZXInO1xuaW1wb3J0IHttYXliZVZhbGlkYXRlfSBmcm9tICcuL3ZhbGlkYXRvci1pbnRlZ3JhdGlvbic7XG5cbmltcG9ydCB7Y3NzVGV4dCBhcyBhbXBEb2NDc3N9IGZyb20gJy4uL2J1aWxkL2FtcGRvYy5jc3MnO1xuaW1wb3J0IHtjc3NUZXh0IGFzIGFtcFNoYXJlZENzc30gZnJvbSAnLi4vYnVpbGQvYW1wc2hhcmVkLmNzcyc7XG5cbi8qKlxuICogRXhlY3V0ZSB0aGUgYm9vdHN0cmFwXG4gKiBAcGFyYW0geyEuL3NlcnZpY2UvYW1wZG9jLWltcGwuQW1wRG9jfSBhbXBkb2NcbiAqIEBwYXJhbSB7IS4vc2VydmljZS9wZXJmb3JtYW5jZS1pbXBsLlBlcmZvcm1hbmNlfSBwZXJmXG4gKi9cbmZ1bmN0aW9uIGJvb3RzdHJhcChhbXBkb2MsIHBlcmYpIHtcbiAgc3RhcnR1cENodW5rKHNlbGYuZG9jdW1lbnQsIGZ1bmN0aW9uIHNlcnZpY2VzKCkge1xuICAgIC8vIENvcmUgc2VydmljZXMuXG4gICAgaW5zdGFsbFJ1bnRpbWVTZXJ2aWNlcyhzZWxmKTtcbiAgICBpbnN0YWxsQW1wZG9jU2VydmljZXMoYW1wZG9jKTtcbiAgICAvLyBXZSBuZWVkIHRoZSBjb3JlIHNlcnZpY2VzICh2aWV3ZXIvcmVzb3VyY2VzKSB0byBzdGFydCBpbnN0cnVtZW50aW5nXG4gICAgcGVyZi5jb3JlU2VydmljZXNBdmFpbGFibGUoKTtcbiAgICBtYXliZVRyYWNrSW1wcmVzc2lvbihzZWxmKTtcbiAgfSk7XG4gIHN0YXJ0dXBDaHVuayhzZWxmLmRvY3VtZW50LCBmdW5jdGlvbiBhZG9wdFdpbmRvdygpIHtcbiAgICBhZG9wdFdpdGhNdWx0aWRvY0RlcHMoc2VsZik7XG4gIH0pO1xuICBzdGFydHVwQ2h1bmsoc2VsZi5kb2N1bWVudCwgZnVuY3Rpb24gYnVpbHRpbnMoKSB7XG4gICAgLy8gQnVpbHRpbnMuXG4gICAgaW5zdGFsbEJ1aWx0aW5FbGVtZW50cyhzZWxmKTtcbiAgfSk7XG4gIHN0YXJ0dXBDaHVuayhzZWxmLmRvY3VtZW50LCBmdW5jdGlvbiBzdHViKCkge1xuICAgIC8vIFByZS1zdHViIGFscmVhZHkga25vd24gZWxlbWVudHMuXG4gICAgc3R1YkVsZW1lbnRzRm9yRG9jKGFtcGRvYyk7XG4gIH0pO1xuICBzdGFydHVwQ2h1bmsoXG4gICAgc2VsZi5kb2N1bWVudCxcbiAgICBmdW5jdGlvbiBmaW5hbCgpIHtcbiAgICAgIGlmICghSVNfU1hHKSB7XG4gICAgICAgIGluc3RhbGxQdWxsVG9SZWZyZXNoQmxvY2tlcihzZWxmKTtcbiAgICAgIH1cbiAgICAgIGluc3RhbGxBdXRvTGlnaHRib3hFeHRlbnNpb24oYW1wZG9jKTtcbiAgICAgIGluc3RhbGxTdGFuZGFsb25lRXh0ZW5zaW9uKGFtcGRvYyk7XG4gICAgICBtYXliZVZhbGlkYXRlKHNlbGYpO1xuICAgICAgbWFrZUJvZHlWaXNpYmxlKHNlbGYuZG9jdW1lbnQpO1xuICAgICAgcHJlY29ubmVjdFRvT3JpZ2luKHNlbGYuZG9jdW1lbnQpO1xuICAgIH0sXG4gICAgLyogbWFrZXMgdGhlIGJvZHkgdmlzaWJsZSAqLyB0cnVlXG4gICk7XG4gIHN0YXJ0dXBDaHVuayhzZWxmLmRvY3VtZW50LCBmdW5jdGlvbiBmaW5hbFRpY2soKSB7XG4gICAgcGVyZi50aWNrKFRpY2tMYWJlbC5FTkRfSU5TVEFMTF9TVFlMRVMpO1xuICAgIFNlcnZpY2VzLnJlc291cmNlc0ZvckRvYyhhbXBkb2MpLmFtcEluaXRDb21wbGV0ZSgpO1xuICAgIC8vIFRPRE8oZXJ3aW5tKTogbW92ZSBpbnZvY2F0aW9uIG9mIHRoZSBgZmx1c2hgIG1ldGhvZCB3aGVuIHdlIGhhdmUgdGhlXG4gICAgLy8gbmV3IHRpY2tzIGluIHBsYWNlIHRvIGJhdGNoIHRoZSB0aWNrcyBwcm9wZXJseS5cbiAgICBwZXJmLmZsdXNoKCk7XG4gIH0pO1xufVxuXG4vLyBTdG9yZSB0aGUgb3JpZ2luYWxIYXNoIGFzIGVhcmx5IGFzIHBvc3NpYmxlLiBUcnlpbmcgdG8gZGVidWc6XG4vLyBodHRwczovL2dpdGh1Yi5jb20vYW1wcHJvamVjdC9hbXBodG1sL2lzc3Vlcy82MDcwXG5pZiAoc2VsZi5sb2NhdGlvbikge1xuICBzZWxmLmxvY2F0aW9uWydvcmlnaW5hbEhhc2gnXSA9IHNlbGYubG9jYXRpb24uaGFzaDtcbn1cblxuLyoqIEB0eXBlIHshLi9zZXJ2aWNlL2FtcGRvYy1pbXBsLkFtcERvY1NlcnZpY2V9ICovXG5sZXQgYW1wZG9jU2VydmljZTtcbi8vIFdlIG11c3QgdW5kZXIgYWxsIGNpcmN1bXN0YW5jZXMgY2FsbCBtYWtlQm9keVZpc2libGUuXG4vLyBJdCBpcyBtdWNoIGJldHRlciB0byBoYXZlIEFNUCB0YWdzIG5vdCByZW5kZXJlZCB0aGFuIGhhdmluZ1xuLy8gYSBjb21wbGV0ZWx5IGJsYW5rIHBhZ2UuXG50cnkge1xuICAvLyBTaG91bGQgaGFwcGVuIGZpcnN0LlxuICBpbnN0YWxsRXJyb3JSZXBvcnRpbmcoc2VsZik7IC8vIEFsc28gY2FsbHMgbWFrZUJvZHlWaXNpYmxlUmVjb3Zlcnkgb24gZXJyb3JzLlxuXG4gIC8vIERlY2xhcmUgdGhhdCB0aGlzIHJ1bnRpbWUgd2lsbCBzdXBwb3J0IGEgc2luZ2xlIHJvb3QgZG9jLiBTaG91bGQgaGFwcGVuXG4gIC8vIGFzIGVhcmx5IGFzIHBvc3NpYmxlLlxuICBpbnN0YWxsRG9jU2VydmljZShzZWxmLCAvKiBpc1NpbmdsZURvYyAqLyB0cnVlKTtcbiAgYW1wZG9jU2VydmljZSA9IFNlcnZpY2VzLmFtcGRvY1NlcnZpY2VGb3Ioc2VsZik7XG59IGNhdGNoIChlKSB7XG4gIC8vIEluIGNhc2Ugb2YgYW4gZXJyb3IgY2FsbCB0aGlzLlxuICBtYWtlQm9keVZpc2libGVSZWNvdmVyeShzZWxmLmRvY3VtZW50KTtcbiAgdGhyb3cgZTtcbn1cbnN0YXJ0dXBDaHVuayhzZWxmLmRvY3VtZW50LCBmdW5jdGlvbiBpbml0aWFsKCkge1xuICAvKiogQGNvbnN0IHshLi9zZXJ2aWNlL2FtcGRvYy1pbXBsLkFtcERvY30gKi9cbiAgY29uc3QgYW1wZG9jID0gYW1wZG9jU2VydmljZS5nZXRBbXBEb2Moc2VsZi5kb2N1bWVudCk7XG4gIGluc3RhbGxQbGF0Zm9ybVNlcnZpY2Uoc2VsZik7XG4gIGluc3RhbGxQZXJmb3JtYW5jZVNlcnZpY2Uoc2VsZik7XG4gIC8qKiBAY29uc3QgeyEuL3NlcnZpY2UvcGVyZm9ybWFuY2UtaW1wbC5QZXJmb3JtYW5jZX0gKi9cbiAgY29uc3QgcGVyZiA9IFNlcnZpY2VzLnBlcmZvcm1hbmNlRm9yKHNlbGYpO1xuICBpZiAoSVNfRVNNKSB7XG4gICAgcGVyZi5hZGRFbmFibGVkRXhwZXJpbWVudCgnZXNtJyk7XG4gIH1cbiAgZm9udFN0eWxlc2hlZXRUaW1lb3V0KHNlbGYpO1xuICBwZXJmLnRpY2soVGlja0xhYmVsLklOU1RBTExfU1RZTEVTKTtcbiAgaWYgKElTX0VTTSkge1xuICAgIGJvb3RzdHJhcChhbXBkb2MsIHBlcmYpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGluc3RhbGxTdHlsZXNGb3JEb2MoXG4gICAgYW1wZG9jLFxuICAgIGFtcERvY0NzcyArIGFtcFNoYXJlZENzcyxcbiAgICAoKSA9PiBib290c3RyYXAoYW1wZG9jLCBwZXJmKSxcbiAgICAvKiBvcHRfaXNSdW50aW1lQ3NzICovIHRydWUsXG4gICAgLyogb3B0X2V4dCAqLyAnYW1wLXJ1bnRpbWUnXG4gICk7XG4gIC8vIFRPRE8oa2JheCkgUmVtb3ZlIHRoaXMgSUUgZGVwcmVjYXRpb24gd2FybmluZyBvbiAyNiBBdWd1c3QgMjAyMS5cbiAgaWYgKFNlcnZpY2VzLnBsYXRmb3JtRm9yKHNlbGYpLmlzSWUoKSAmJiBzZWxmLmNvbnNvbGUpIHtcbiAgICAoY29uc29sZS5pbmZvIHx8IGNvbnNvbGUubG9nKS5jYWxsKFxuICAgICAgY29uc29sZSxcbiAgICAgICdJRSBTdXBwb3J0IGlzIGJlaW5nIGRlcHJlY2F0ZWQsIGluIFNlcHRlbWJlciAyMDIxIElFIHdpbGwgbm8gbG9uZ2VyIGJlIHN1cHBvcnRlZC4gU2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hbXBwcm9qZWN0L2FtcGh0bWwvaXNzdWVzLzM0NDUzIGZvciBtb3JlIGRldGFpbHMuJ1xuICAgICk7XG4gIH1cbn0pO1xuXG4vLyBPdXRwdXQgYSBtZXNzYWdlIHRvIHRoZSBjb25zb2xlIGFuZCBhZGQgYW4gYXR0cmlidXRlIHRvIHRoZSA8aHRtbD5cbi8vIHRhZyB0byBnaXZlIHNvbWUgaW5mb3JtYXRpb24gdGhhdCBjYW4gYmUgdXNlZCBpbiBlcnJvciByZXBvcnRzLlxuLy8gKEF0IGxlYXN0IGJ5IHNvcGhpc3RpY2F0ZWQgdXNlcnMpLlxuaWYgKHNlbGYuY29uc29sZSkge1xuICAoY29uc29sZS5pbmZvIHx8IGNvbnNvbGUubG9nKS5jYWxsKFxuICAgIGNvbnNvbGUsXG4gICAgYFBvd2VyZWQgYnkgQU1QIOKaoSBIVE1MIOKAkyBWZXJzaW9uICR7aW50ZXJuYWxSdW50aW1lVmVyc2lvbigpfWAsXG4gICAgc2VsZi5sb2NhdGlvbi5ocmVmXG4gICk7XG59XG4vLyBUaGlzIGNvZGUgaXMgZWxlbWluYXRlZCBpbiBwcm9kIGJ1aWxkIHRocm91Z2ggYSBiYWJlbCB0cmFuc2Zvcm1lci5cbmlmIChnZXRNb2RlKCkubG9jYWxEZXYpIHtcbiAgc2VsZi5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2V0QXR0cmlidXRlKCdlc20nLCBJU19FU00gPyAxIDogMCk7XG59XG5zZWxmLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zZXRBdHRyaWJ1dGUoXG4gICdhbXAtdmVyc2lvbicsXG4gIGludGVybmFsUnVudGltZVZlcnNpb24oKVxuKTtcbiJdfQ==
// /Users/mszylkowski/src/amphtml/src/amp.js