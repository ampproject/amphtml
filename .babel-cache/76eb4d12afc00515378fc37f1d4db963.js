/**
 * Copyright 2015 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Services } from "./";

/**
 * Gets a Promise for the LoaderService, initiating a request to download the
 * code.
 * @param {!./ampdoc-impl.AmpDoc} ampDoc
 * @param {!Element} element
 * @return {!Promise<!../../extensions/amp-loader/0.1/amp-loader.LoaderService>}
 */
function getLoaderServicePromise(ampDoc, element) {
  return Services.extensionsFor(ampDoc.win).installExtensionForDoc(ampDoc, 'amp-loader').then(function () {
    return Services.loaderServiceForDoc(element);
  });
}

/**
 * Creates a default "loading indicator" element based on the new design.
 *
 * Please see https://github.com/ampproject/amphtml/issues/20237 for details,
 * screenshots and various states of the new loader design.
 * @param {!./ampdoc-impl.AmpDoc} ampDoc
 * @param {!AmpElement} element
 * @param {number} elementWidth
 * @param {number} elementHeight
 * @param {number=} startTime
 * @return {!Element} The loader root element.
 */
export function createLoaderElement(ampDoc, element, elementWidth, elementHeight, startTime) {
  if (startTime === void 0) {
    startTime = ampDoc.win.Date.now();
  }

  // We create the loader root element up front, since it is needed
  // synchronously. We create the actual element with animations when the
  // service is ready.
  var loaderRoot = element.ownerDocument.createElement('div');
  getLoaderServicePromise(ampDoc, element).then(function (loaderService) {
    var endTime = ampDoc.win.Date.now();
    var initDelay = endTime - startTime;
    loaderService.initializeLoader(element, loaderRoot, initDelay, elementWidth, elementHeight);
  });
  return loaderRoot;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxvYWRlci1lbGVtZW50LmpzIl0sIm5hbWVzIjpbIlNlcnZpY2VzIiwiZ2V0TG9hZGVyU2VydmljZVByb21pc2UiLCJhbXBEb2MiLCJlbGVtZW50IiwiZXh0ZW5zaW9uc0ZvciIsIndpbiIsImluc3RhbGxFeHRlbnNpb25Gb3JEb2MiLCJ0aGVuIiwibG9hZGVyU2VydmljZUZvckRvYyIsImNyZWF0ZUxvYWRlckVsZW1lbnQiLCJlbGVtZW50V2lkdGgiLCJlbGVtZW50SGVpZ2h0Iiwic3RhcnRUaW1lIiwiRGF0ZSIsIm5vdyIsImxvYWRlclJvb3QiLCJvd25lckRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImxvYWRlclNlcnZpY2UiLCJlbmRUaW1lIiwiaW5pdERlbGF5IiwiaW5pdGlhbGl6ZUxvYWRlciJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUEsU0FBUUEsUUFBUjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNBQVNDLHVCQUFULENBQWlDQyxNQUFqQyxFQUF5Q0MsT0FBekMsRUFBa0Q7QUFDaEQsU0FBT0gsUUFBUSxDQUFDSSxhQUFULENBQXVCRixNQUFNLENBQUNHLEdBQTlCLEVBQ0pDLHNCQURJLENBQ21CSixNQURuQixFQUMyQixZQUQzQixFQUVKSyxJQUZJLENBRUM7QUFBQSxXQUFNUCxRQUFRLENBQUNRLG1CQUFULENBQTZCTCxPQUE3QixDQUFOO0FBQUEsR0FGRCxDQUFQO0FBR0Q7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxTQUFTTSxtQkFBVCxDQUNMUCxNQURLLEVBRUxDLE9BRkssRUFHTE8sWUFISyxFQUlMQyxhQUpLLEVBS0xDLFNBTEssRUFNTDtBQUFBLE1BREFBLFNBQ0E7QUFEQUEsSUFBQUEsU0FDQSxHQURZVixNQUFNLENBQUNHLEdBQVAsQ0FBV1EsSUFBWCxDQUFnQkMsR0FBaEIsRUFDWjtBQUFBOztBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BQU1DLFVBQVUsR0FBR1osT0FBTyxDQUFDYSxhQUFSLENBQXNCQyxhQUF0QixDQUFvQyxLQUFwQyxDQUFuQjtBQUVBaEIsRUFBQUEsdUJBQXVCLENBQUNDLE1BQUQsRUFBU0MsT0FBVCxDQUF2QixDQUF5Q0ksSUFBekMsQ0FBOEMsVUFBQ1csYUFBRCxFQUFtQjtBQUMvRCxRQUFNQyxPQUFPLEdBQUdqQixNQUFNLENBQUNHLEdBQVAsQ0FBV1EsSUFBWCxDQUFnQkMsR0FBaEIsRUFBaEI7QUFDQSxRQUFNTSxTQUFTLEdBQUdELE9BQU8sR0FBR1AsU0FBNUI7QUFDQU0sSUFBQUEsYUFBYSxDQUFDRyxnQkFBZCxDQUNFbEIsT0FERixFQUVFWSxVQUZGLEVBR0VLLFNBSEYsRUFJRVYsWUFKRixFQUtFQyxhQUxGO0FBT0QsR0FWRDtBQVlBLFNBQU9JLFVBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IDIwMTUgVGhlIEFNUCBIVE1MIEF1dGhvcnMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4gKlxuICogTGljZW5zZWQgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlIFwiTGljZW5zZVwiKTtcbiAqIHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2Ugd2l0aCB0aGUgTGljZW5zZS5cbiAqIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLCBzb2Z0d2FyZVxuICogZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW4gXCJBUy1JU1wiIEJBU0lTLFxuICogV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4gKiBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZSBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kXG4gKiBsaW1pdGF0aW9ucyB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuXG5pbXBvcnQge1NlcnZpY2VzfSBmcm9tICcjc2VydmljZSc7XG5cbi8qKlxuICogR2V0cyBhIFByb21pc2UgZm9yIHRoZSBMb2FkZXJTZXJ2aWNlLCBpbml0aWF0aW5nIGEgcmVxdWVzdCB0byBkb3dubG9hZCB0aGVcbiAqIGNvZGUuXG4gKiBAcGFyYW0geyEuL2FtcGRvYy1pbXBsLkFtcERvY30gYW1wRG9jXG4gKiBAcGFyYW0geyFFbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJuIHshUHJvbWlzZTwhLi4vLi4vZXh0ZW5zaW9ucy9hbXAtbG9hZGVyLzAuMS9hbXAtbG9hZGVyLkxvYWRlclNlcnZpY2U+fVxuICovXG5mdW5jdGlvbiBnZXRMb2FkZXJTZXJ2aWNlUHJvbWlzZShhbXBEb2MsIGVsZW1lbnQpIHtcbiAgcmV0dXJuIFNlcnZpY2VzLmV4dGVuc2lvbnNGb3IoYW1wRG9jLndpbilcbiAgICAuaW5zdGFsbEV4dGVuc2lvbkZvckRvYyhhbXBEb2MsICdhbXAtbG9hZGVyJylcbiAgICAudGhlbigoKSA9PiBTZXJ2aWNlcy5sb2FkZXJTZXJ2aWNlRm9yRG9jKGVsZW1lbnQpKTtcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgZGVmYXVsdCBcImxvYWRpbmcgaW5kaWNhdG9yXCIgZWxlbWVudCBiYXNlZCBvbiB0aGUgbmV3IGRlc2lnbi5cbiAqXG4gKiBQbGVhc2Ugc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9hbXBwcm9qZWN0L2FtcGh0bWwvaXNzdWVzLzIwMjM3IGZvciBkZXRhaWxzLFxuICogc2NyZWVuc2hvdHMgYW5kIHZhcmlvdXMgc3RhdGVzIG9mIHRoZSBuZXcgbG9hZGVyIGRlc2lnbi5cbiAqIEBwYXJhbSB7IS4vYW1wZG9jLWltcGwuQW1wRG9jfSBhbXBEb2NcbiAqIEBwYXJhbSB7IUFtcEVsZW1lbnR9IGVsZW1lbnRcbiAqIEBwYXJhbSB7bnVtYmVyfSBlbGVtZW50V2lkdGhcbiAqIEBwYXJhbSB7bnVtYmVyfSBlbGVtZW50SGVpZ2h0XG4gKiBAcGFyYW0ge251bWJlcj19IHN0YXJ0VGltZVxuICogQHJldHVybiB7IUVsZW1lbnR9IFRoZSBsb2FkZXIgcm9vdCBlbGVtZW50LlxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTG9hZGVyRWxlbWVudChcbiAgYW1wRG9jLFxuICBlbGVtZW50LFxuICBlbGVtZW50V2lkdGgsXG4gIGVsZW1lbnRIZWlnaHQsXG4gIHN0YXJ0VGltZSA9IGFtcERvYy53aW4uRGF0ZS5ub3coKVxuKSB7XG4gIC8vIFdlIGNyZWF0ZSB0aGUgbG9hZGVyIHJvb3QgZWxlbWVudCB1cCBmcm9udCwgc2luY2UgaXQgaXMgbmVlZGVkXG4gIC8vIHN5bmNocm9ub3VzbHkuIFdlIGNyZWF0ZSB0aGUgYWN0dWFsIGVsZW1lbnQgd2l0aCBhbmltYXRpb25zIHdoZW4gdGhlXG4gIC8vIHNlcnZpY2UgaXMgcmVhZHkuXG4gIGNvbnN0IGxvYWRlclJvb3QgPSBlbGVtZW50Lm93bmVyRG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cbiAgZ2V0TG9hZGVyU2VydmljZVByb21pc2UoYW1wRG9jLCBlbGVtZW50KS50aGVuKChsb2FkZXJTZXJ2aWNlKSA9PiB7XG4gICAgY29uc3QgZW5kVGltZSA9IGFtcERvYy53aW4uRGF0ZS5ub3coKTtcbiAgICBjb25zdCBpbml0RGVsYXkgPSBlbmRUaW1lIC0gc3RhcnRUaW1lO1xuICAgIGxvYWRlclNlcnZpY2UuaW5pdGlhbGl6ZUxvYWRlcihcbiAgICAgIGVsZW1lbnQsXG4gICAgICBsb2FkZXJSb290LFxuICAgICAgaW5pdERlbGF5LFxuICAgICAgZWxlbWVudFdpZHRoLFxuICAgICAgZWxlbWVudEhlaWdodFxuICAgICk7XG4gIH0pO1xuXG4gIHJldHVybiBsb2FkZXJSb290O1xufVxuIl19
// /Users/mszylkowski/src/amphtml/src/service/loader-element.js