/**
 * Copyright 2019 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { ChunkPriority, chunk } from "./chunk";
import { isAmphtml } from "./format";
import { dev } from "./log";
import { Services } from "./service";
import { isStoryDocument } from "./utils/story";

/** @const @enum {string} */
export var AutoLightboxEvents = {
  // Triggered when the lightbox attribute is newly set on an item in order to
  // process by the renderer extension (e.g. amp-lightbox-gallery).
  NEWLY_SET: 'amp-auto-lightbox:newly-set'
};

/**
 * Installs the amp-auto-lightbox extension.
 *
 * This extension conditionally loads amp-lightbox-gallery for images and videos
 * that fulfill a set criteria on certain documents.
 *
 * Further information on spec/auto-lightbox.md and the amp-auto-lightbox extension
 * code.
 * @param {!./service/ampdoc-impl.AmpDoc} ampdoc
 */
export function installAutoLightboxExtension(ampdoc) {
  var win = ampdoc.win;

  // Only enabled on single documents tagged as <html amp> or <html âš¡>.
  if (!isAmphtml(win.document) || !ampdoc.isSingleDoc()) {
    return;
  }

  chunk(ampdoc, function () {
    isStoryDocument(ampdoc).then(function (isStory) {
      // Do not enable on amp-story documents.
      if (isStory) {
        return;
      }

      Services.extensionsFor(win).installExtensionForDoc(ampdoc, 'amp-auto-lightbox');
    });
  }, ChunkPriority.LOW);
}

/**
 * @param {!Element} element
 * @return {boolean}
 */
export function isActionableByTap(element) {
  if (element.tagName.toLowerCase() == 'a' && element.hasAttribute('href')) {
    return true;
  }

  if (element.querySelector('a[href]')) {
    return true;
  }

  var action = Services.actionServiceForDoc(element);
  var hasTapAction = action.hasResolvableAction(element, 'tap', dev().assertElement(element.parentElement));

  if (hasTapAction) {
    return true;
  }

  var actionables = element.querySelectorAll('[on]');

  for (var i = 0; i < actionables.length; i++) {
    var actionable = actionables[i];

    var _hasTapAction = action.hasResolvableAction(actionable, 'tap', dev().assertElement(actionable.parentElement));

    if (_hasTapAction) {
      return true;
    }
  }

  return false;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dG8tbGlnaHRib3guanMiXSwibmFtZXMiOlsiQ2h1bmtQcmlvcml0eSIsImNodW5rIiwiaXNBbXBodG1sIiwiZGV2IiwiU2VydmljZXMiLCJpc1N0b3J5RG9jdW1lbnQiLCJBdXRvTGlnaHRib3hFdmVudHMiLCJORVdMWV9TRVQiLCJpbnN0YWxsQXV0b0xpZ2h0Ym94RXh0ZW5zaW9uIiwiYW1wZG9jIiwid2luIiwiZG9jdW1lbnQiLCJpc1NpbmdsZURvYyIsInRoZW4iLCJpc1N0b3J5IiwiZXh0ZW5zaW9uc0ZvciIsImluc3RhbGxFeHRlbnNpb25Gb3JEb2MiLCJMT1ciLCJpc0FjdGlvbmFibGVCeVRhcCIsImVsZW1lbnQiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJoYXNBdHRyaWJ1dGUiLCJxdWVyeVNlbGVjdG9yIiwiYWN0aW9uIiwiYWN0aW9uU2VydmljZUZvckRvYyIsImhhc1RhcEFjdGlvbiIsImhhc1Jlc29sdmFibGVBY3Rpb24iLCJhc3NlcnRFbGVtZW50IiwicGFyZW50RWxlbWVudCIsImFjdGlvbmFibGVzIiwicXVlcnlTZWxlY3RvckFsbCIsImkiLCJsZW5ndGgiLCJhY3Rpb25hYmxlIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxTQUFRQSxhQUFSLEVBQXVCQyxLQUF2QjtBQUNBLFNBQVFDLFNBQVI7QUFDQSxTQUFRQyxHQUFSO0FBQ0EsU0FBUUMsUUFBUjtBQUNBLFNBQVFDLGVBQVI7O0FBRUE7QUFDQSxPQUFPLElBQU1DLGtCQUFrQixHQUFHO0FBQ2hDO0FBQ0E7QUFDQUMsRUFBQUEsU0FBUyxFQUFFO0FBSHFCLENBQTNCOztBQU1QO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxTQUFTQyw0QkFBVCxDQUFzQ0MsTUFBdEMsRUFBOEM7QUFDbkQsTUFBT0MsR0FBUCxHQUFjRCxNQUFkLENBQU9DLEdBQVA7O0FBQ0E7QUFDQSxNQUFJLENBQUNSLFNBQVMsQ0FBQ1EsR0FBRyxDQUFDQyxRQUFMLENBQVYsSUFBNEIsQ0FBQ0YsTUFBTSxDQUFDRyxXQUFQLEVBQWpDLEVBQXVEO0FBQ3JEO0FBQ0Q7O0FBQ0RYLEVBQUFBLEtBQUssQ0FDSFEsTUFERyxFQUVILFlBQU07QUFDSkosSUFBQUEsZUFBZSxDQUFDSSxNQUFELENBQWYsQ0FBd0JJLElBQXhCLENBQTZCLFVBQUNDLE9BQUQsRUFBYTtBQUN4QztBQUNBLFVBQUlBLE9BQUosRUFBYTtBQUNYO0FBQ0Q7O0FBQ0RWLE1BQUFBLFFBQVEsQ0FBQ1csYUFBVCxDQUF1QkwsR0FBdkIsRUFBNEJNLHNCQUE1QixDQUNFUCxNQURGLEVBRUUsbUJBRkY7QUFJRCxLQVREO0FBVUQsR0FiRSxFQWNIVCxhQUFhLENBQUNpQixHQWRYLENBQUw7QUFnQkQ7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNDLGlCQUFULENBQTJCQyxPQUEzQixFQUFvQztBQUN6QyxNQUFJQSxPQUFPLENBQUNDLE9BQVIsQ0FBZ0JDLFdBQWhCLE1BQWlDLEdBQWpDLElBQXdDRixPQUFPLENBQUNHLFlBQVIsQ0FBcUIsTUFBckIsQ0FBNUMsRUFBMEU7QUFDeEUsV0FBTyxJQUFQO0FBQ0Q7O0FBQ0QsTUFBSUgsT0FBTyxDQUFDSSxhQUFSLENBQXNCLFNBQXRCLENBQUosRUFBc0M7QUFDcEMsV0FBTyxJQUFQO0FBQ0Q7O0FBQ0QsTUFBTUMsTUFBTSxHQUFHcEIsUUFBUSxDQUFDcUIsbUJBQVQsQ0FBNkJOLE9BQTdCLENBQWY7QUFDQSxNQUFNTyxZQUFZLEdBQUdGLE1BQU0sQ0FBQ0csbUJBQVAsQ0FDbkJSLE9BRG1CLEVBRW5CLEtBRm1CLEVBR25CaEIsR0FBRyxHQUFHeUIsYUFBTixDQUFvQlQsT0FBTyxDQUFDVSxhQUE1QixDQUhtQixDQUFyQjs7QUFLQSxNQUFJSCxZQUFKLEVBQWtCO0FBQ2hCLFdBQU8sSUFBUDtBQUNEOztBQUNELE1BQU1JLFdBQVcsR0FBR1gsT0FBTyxDQUFDWSxnQkFBUixDQUF5QixNQUF6QixDQUFwQjs7QUFDQSxPQUFLLElBQUlDLENBQUMsR0FBRyxDQUFiLEVBQWdCQSxDQUFDLEdBQUdGLFdBQVcsQ0FBQ0csTUFBaEMsRUFBd0NELENBQUMsRUFBekMsRUFBNkM7QUFDM0MsUUFBTUUsVUFBVSxHQUFHSixXQUFXLENBQUNFLENBQUQsQ0FBOUI7O0FBQ0EsUUFBTU4sYUFBWSxHQUFHRixNQUFNLENBQUNHLG1CQUFQLENBQ25CTyxVQURtQixFQUVuQixLQUZtQixFQUduQi9CLEdBQUcsR0FBR3lCLGFBQU4sQ0FBb0JNLFVBQVUsQ0FBQ0wsYUFBL0IsQ0FIbUIsQ0FBckI7O0FBS0EsUUFBSUgsYUFBSixFQUFrQjtBQUNoQixhQUFPLElBQVA7QUFDRDtBQUNGOztBQUNELFNBQU8sS0FBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxOSBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTLUlTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7Q2h1bmtQcmlvcml0eSwgY2h1bmt9IGZyb20gJy4vY2h1bmsnO1xuaW1wb3J0IHtpc0FtcGh0bWx9IGZyb20gJy4vZm9ybWF0JztcbmltcG9ydCB7ZGV2fSBmcm9tICcuL2xvZyc7XG5pbXBvcnQge1NlcnZpY2VzfSBmcm9tICcuL3NlcnZpY2UnO1xuaW1wb3J0IHtpc1N0b3J5RG9jdW1lbnR9IGZyb20gJy4vdXRpbHMvc3RvcnknO1xuXG4vKiogQGNvbnN0IEBlbnVtIHtzdHJpbmd9ICovXG5leHBvcnQgY29uc3QgQXV0b0xpZ2h0Ym94RXZlbnRzID0ge1xuICAvLyBUcmlnZ2VyZWQgd2hlbiB0aGUgbGlnaHRib3ggYXR0cmlidXRlIGlzIG5ld2x5IHNldCBvbiBhbiBpdGVtIGluIG9yZGVyIHRvXG4gIC8vIHByb2Nlc3MgYnkgdGhlIHJlbmRlcmVyIGV4dGVuc2lvbiAoZS5nLiBhbXAtbGlnaHRib3gtZ2FsbGVyeSkuXG4gIE5FV0xZX1NFVDogJ2FtcC1hdXRvLWxpZ2h0Ym94Om5ld2x5LXNldCcsXG59O1xuXG4vKipcbiAqIEluc3RhbGxzIHRoZSBhbXAtYXV0by1saWdodGJveCBleHRlbnNpb24uXG4gKlxuICogVGhpcyBleHRlbnNpb24gY29uZGl0aW9uYWxseSBsb2FkcyBhbXAtbGlnaHRib3gtZ2FsbGVyeSBmb3IgaW1hZ2VzIGFuZCB2aWRlb3NcbiAqIHRoYXQgZnVsZmlsbCBhIHNldCBjcml0ZXJpYSBvbiBjZXJ0YWluIGRvY3VtZW50cy5cbiAqXG4gKiBGdXJ0aGVyIGluZm9ybWF0aW9uIG9uIHNwZWMvYXV0by1saWdodGJveC5tZCBhbmQgdGhlIGFtcC1hdXRvLWxpZ2h0Ym94IGV4dGVuc2lvblxuICogY29kZS5cbiAqIEBwYXJhbSB7IS4vc2VydmljZS9hbXBkb2MtaW1wbC5BbXBEb2N9IGFtcGRvY1xuICovXG5leHBvcnQgZnVuY3Rpb24gaW5zdGFsbEF1dG9MaWdodGJveEV4dGVuc2lvbihhbXBkb2MpIHtcbiAgY29uc3Qge3dpbn0gPSBhbXBkb2M7XG4gIC8vIE9ubHkgZW5hYmxlZCBvbiBzaW5nbGUgZG9jdW1lbnRzIHRhZ2dlZCBhcyA8aHRtbCBhbXA+IG9yIDxodG1sIOKaoT4uXG4gIGlmICghaXNBbXBodG1sKHdpbi5kb2N1bWVudCkgfHwgIWFtcGRvYy5pc1NpbmdsZURvYygpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNodW5rKFxuICAgIGFtcGRvYyxcbiAgICAoKSA9PiB7XG4gICAgICBpc1N0b3J5RG9jdW1lbnQoYW1wZG9jKS50aGVuKChpc1N0b3J5KSA9PiB7XG4gICAgICAgIC8vIERvIG5vdCBlbmFibGUgb24gYW1wLXN0b3J5IGRvY3VtZW50cy5cbiAgICAgICAgaWYgKGlzU3RvcnkpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgU2VydmljZXMuZXh0ZW5zaW9uc0Zvcih3aW4pLmluc3RhbGxFeHRlbnNpb25Gb3JEb2MoXG4gICAgICAgICAgYW1wZG9jLFxuICAgICAgICAgICdhbXAtYXV0by1saWdodGJveCdcbiAgICAgICAgKTtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgQ2h1bmtQcmlvcml0eS5MT1dcbiAgKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0geyFFbGVtZW50fSBlbGVtZW50XG4gKiBAcmV0dXJuIHtib29sZWFufVxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBY3Rpb25hYmxlQnlUYXAoZWxlbWVudCkge1xuICBpZiAoZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT0gJ2EnICYmIGVsZW1lbnQuaGFzQXR0cmlidXRlKCdocmVmJykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBpZiAoZWxlbWVudC5xdWVyeVNlbGVjdG9yKCdhW2hyZWZdJykpIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuICBjb25zdCBhY3Rpb24gPSBTZXJ2aWNlcy5hY3Rpb25TZXJ2aWNlRm9yRG9jKGVsZW1lbnQpO1xuICBjb25zdCBoYXNUYXBBY3Rpb24gPSBhY3Rpb24uaGFzUmVzb2x2YWJsZUFjdGlvbihcbiAgICBlbGVtZW50LFxuICAgICd0YXAnLFxuICAgIGRldigpLmFzc2VydEVsZW1lbnQoZWxlbWVudC5wYXJlbnRFbGVtZW50KVxuICApO1xuICBpZiAoaGFzVGFwQWN0aW9uKSB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cbiAgY29uc3QgYWN0aW9uYWJsZXMgPSBlbGVtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJ1tvbl0nKTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBhY3Rpb25hYmxlcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IGFjdGlvbmFibGUgPSBhY3Rpb25hYmxlc1tpXTtcbiAgICBjb25zdCBoYXNUYXBBY3Rpb24gPSBhY3Rpb24uaGFzUmVzb2x2YWJsZUFjdGlvbihcbiAgICAgIGFjdGlvbmFibGUsXG4gICAgICAndGFwJyxcbiAgICAgIGRldigpLmFzc2VydEVsZW1lbnQoYWN0aW9uYWJsZS5wYXJlbnRFbGVtZW50KVxuICAgICk7XG4gICAgaWYgKGhhc1RhcEFjdGlvbikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG4gIHJldHVybiBmYWxzZTtcbn1cbiJdfQ==
// /Users/mszylkowski/src/amphtml/src/auto-lightbox.js