/**
 * Copyright 2017 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Possible versions of Shadow DOM spec
 * @enum {string}
 */
export var ShadowDomVersion = {
  NONE: 'none',
  V0: 'v0',
  V1: 'v1'
};

/**
 * @type {!ShadowDomVersion|undefined}
 * @visibleForTesting
 */
var shadowDomSupportedVersion;

/**
 * @type {boolean|undefined}
 * @visibleForTesting
 */
var shadowCssSupported;

/**
 * @param {!ShadowDomVersion|undefined} val
 * @visibleForTesting
 */
export function setShadowDomSupportedVersionForTesting(val) {
  shadowDomSupportedVersion = val;
}

/**
 * @param {boolean|undefined} val
 * @visibleForTesting
 */
export function setShadowCssSupportedForTesting(val) {
  shadowCssSupported = val;
}

/**
 * Returns `true` if the Shadow DOM is supported.
 * @return {boolean}
 */
export function isShadowDomSupported() {
  return getShadowDomSupportedVersion() != ShadowDomVersion.NONE;
}

/**
 * Returns `true` if Shadow CSS encapsulation is supported.
 * @return {boolean}
 */
export function isShadowCssSupported() {
  if (shadowCssSupported === undefined) {
    shadowCssSupported = isShadowDomSupported() && (isNative(Element.prototype.attachShadow) || isNative(Element.prototype.createShadowRoot));
  }

  return shadowCssSupported;
}

/**
 * Returns `true` if the passed function is native to the browser, and is not
 * polyfilled
 * @param {Function|undefined} func A function that is attatched to a JS
 * object.
 * @return {boolean}
 */
function isNative(func) {
  return !!func && func.toString().indexOf('[native code]') != -1;
}

/**
 * Returns the supported version of Shadow DOM spec.
 * @param {typeof Element=} opt_elementClass optional for testing
 * @return {!ShadowDomVersion}
 */
export function getShadowDomSupportedVersion(opt_elementClass) {
  if (shadowDomSupportedVersion === undefined) {
    shadowDomSupportedVersion = getShadowDomVersion(opt_elementClass || Element);
  }

  return shadowDomSupportedVersion;
}

/**
 * Returns shadow dom version.
 *
 * @param {!typeof Element} element
 * @return {!ShadowDomVersion}
 */
function getShadowDomVersion(element) {
  if (!!element.prototype.attachShadow) {
    return ShadowDomVersion.V1;
  } else if (!!element.prototype.createShadowRoot) {
    return ShadowDomVersion.V0;
  }

  return ShadowDomVersion.NONE;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYi1jb21wb25lbnRzLmpzIl0sIm5hbWVzIjpbIlNoYWRvd0RvbVZlcnNpb24iLCJOT05FIiwiVjAiLCJWMSIsInNoYWRvd0RvbVN1cHBvcnRlZFZlcnNpb24iLCJzaGFkb3dDc3NTdXBwb3J0ZWQiLCJzZXRTaGFkb3dEb21TdXBwb3J0ZWRWZXJzaW9uRm9yVGVzdGluZyIsInZhbCIsInNldFNoYWRvd0Nzc1N1cHBvcnRlZEZvclRlc3RpbmciLCJpc1NoYWRvd0RvbVN1cHBvcnRlZCIsImdldFNoYWRvd0RvbVN1cHBvcnRlZFZlcnNpb24iLCJpc1NoYWRvd0Nzc1N1cHBvcnRlZCIsInVuZGVmaW5lZCIsImlzTmF0aXZlIiwiRWxlbWVudCIsInByb3RvdHlwZSIsImF0dGFjaFNoYWRvdyIsImNyZWF0ZVNoYWRvd1Jvb3QiLCJmdW5jIiwidG9TdHJpbmciLCJpbmRleE9mIiwib3B0X2VsZW1lbnRDbGFzcyIsImdldFNoYWRvd0RvbVZlcnNpb24iLCJlbGVtZW50Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLElBQU1BLGdCQUFnQixHQUFHO0FBQzlCQyxFQUFBQSxJQUFJLEVBQUUsTUFEd0I7QUFFOUJDLEVBQUFBLEVBQUUsRUFBRSxJQUYwQjtBQUc5QkMsRUFBQUEsRUFBRSxFQUFFO0FBSDBCLENBQXpCOztBQU1QO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSUMseUJBQUo7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJQyxrQkFBSjs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0Msc0NBQVQsQ0FBZ0RDLEdBQWhELEVBQXFEO0FBQzFESCxFQUFBQSx5QkFBeUIsR0FBR0csR0FBNUI7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0MsK0JBQVQsQ0FBeUNELEdBQXpDLEVBQThDO0FBQ25ERixFQUFBQSxrQkFBa0IsR0FBR0UsR0FBckI7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU0Usb0JBQVQsR0FBZ0M7QUFDckMsU0FBT0MsNEJBQTRCLE1BQU1WLGdCQUFnQixDQUFDQyxJQUExRDtBQUNEOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsT0FBTyxTQUFTVSxvQkFBVCxHQUFnQztBQUNyQyxNQUFJTixrQkFBa0IsS0FBS08sU0FBM0IsRUFBc0M7QUFDcENQLElBQUFBLGtCQUFrQixHQUNoQkksb0JBQW9CLE9BQ25CSSxRQUFRLENBQUNDLE9BQU8sQ0FBQ0MsU0FBUixDQUFrQkMsWUFBbkIsQ0FBUixJQUNDSCxRQUFRLENBQUNDLE9BQU8sQ0FBQ0MsU0FBUixDQUFrQkUsZ0JBQW5CLENBRlUsQ0FEdEI7QUFJRDs7QUFDRCxTQUFPWixrQkFBUDtBQUNEOztBQUVEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU1EsUUFBVCxDQUFrQkssSUFBbEIsRUFBd0I7QUFDdEIsU0FBTyxDQUFDLENBQUNBLElBQUYsSUFBVUEsSUFBSSxDQUFDQyxRQUFMLEdBQWdCQyxPQUFoQixDQUF3QixlQUF4QixLQUE0QyxDQUFDLENBQTlEO0FBQ0Q7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBU1YsNEJBQVQsQ0FBc0NXLGdCQUF0QyxFQUF3RDtBQUM3RCxNQUFJakIseUJBQXlCLEtBQUtRLFNBQWxDLEVBQTZDO0FBQzNDUixJQUFBQSx5QkFBeUIsR0FBR2tCLG1CQUFtQixDQUM3Q0QsZ0JBQWdCLElBQUlQLE9BRHlCLENBQS9DO0FBR0Q7O0FBQ0QsU0FBT1YseUJBQVA7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxTQUFTa0IsbUJBQVQsQ0FBNkJDLE9BQTdCLEVBQXNDO0FBQ3BDLE1BQUksQ0FBQyxDQUFDQSxPQUFPLENBQUNSLFNBQVIsQ0FBa0JDLFlBQXhCLEVBQXNDO0FBQ3BDLFdBQU9oQixnQkFBZ0IsQ0FBQ0csRUFBeEI7QUFDRCxHQUZELE1BRU8sSUFBSSxDQUFDLENBQUNvQixPQUFPLENBQUNSLFNBQVIsQ0FBa0JFLGdCQUF4QixFQUEwQztBQUMvQyxXQUFPakIsZ0JBQWdCLENBQUNFLEVBQXhCO0FBQ0Q7O0FBQ0QsU0FBT0YsZ0JBQWdCLENBQUNDLElBQXhCO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAyMDE3IFRoZSBBTVAgSFRNTCBBdXRob3JzLiBBbGwgUmlnaHRzIFJlc2VydmVkLlxuICpcbiAqIExpY2Vuc2VkIHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZSBcIkxpY2Vuc2VcIik7XG4gKiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4gKiBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgICAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZywgc29mdHdhcmVcbiAqIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMtSVNcIiBCQVNJUyxcbiAqIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWSBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLlxuICogU2VlIHRoZSBMaWNlbnNlIGZvciB0aGUgc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZFxuICogbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cblxuLyoqXG4gKiBQb3NzaWJsZSB2ZXJzaW9ucyBvZiBTaGFkb3cgRE9NIHNwZWNcbiAqIEBlbnVtIHtzdHJpbmd9XG4gKi9cbmV4cG9ydCBjb25zdCBTaGFkb3dEb21WZXJzaW9uID0ge1xuICBOT05FOiAnbm9uZScsXG4gIFYwOiAndjAnLFxuICBWMTogJ3YxJyxcbn07XG5cbi8qKlxuICogQHR5cGUgeyFTaGFkb3dEb21WZXJzaW9ufHVuZGVmaW5lZH1cbiAqIEB2aXNpYmxlRm9yVGVzdGluZ1xuICovXG5sZXQgc2hhZG93RG9tU3VwcG9ydGVkVmVyc2lvbjtcblxuLyoqXG4gKiBAdHlwZSB7Ym9vbGVhbnx1bmRlZmluZWR9XG4gKiBAdmlzaWJsZUZvclRlc3RpbmdcbiAqL1xubGV0IHNoYWRvd0Nzc1N1cHBvcnRlZDtcblxuLyoqXG4gKiBAcGFyYW0geyFTaGFkb3dEb21WZXJzaW9ufHVuZGVmaW5lZH0gdmFsXG4gKiBAdmlzaWJsZUZvclRlc3RpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHNldFNoYWRvd0RvbVN1cHBvcnRlZFZlcnNpb25Gb3JUZXN0aW5nKHZhbCkge1xuICBzaGFkb3dEb21TdXBwb3J0ZWRWZXJzaW9uID0gdmFsO1xufVxuXG4vKipcbiAqIEBwYXJhbSB7Ym9vbGVhbnx1bmRlZmluZWR9IHZhbFxuICogQHZpc2libGVGb3JUZXN0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzZXRTaGFkb3dDc3NTdXBwb3J0ZWRGb3JUZXN0aW5nKHZhbCkge1xuICBzaGFkb3dDc3NTdXBwb3J0ZWQgPSB2YWw7XG59XG5cbi8qKlxuICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIFNoYWRvdyBET00gaXMgc3VwcG9ydGVkLlxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU2hhZG93RG9tU3VwcG9ydGVkKCkge1xuICByZXR1cm4gZ2V0U2hhZG93RG9tU3VwcG9ydGVkVmVyc2lvbigpICE9IFNoYWRvd0RvbVZlcnNpb24uTk9ORTtcbn1cblxuLyoqXG4gKiBSZXR1cm5zIGB0cnVlYCBpZiBTaGFkb3cgQ1NTIGVuY2Fwc3VsYXRpb24gaXMgc3VwcG9ydGVkLlxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzU2hhZG93Q3NzU3VwcG9ydGVkKCkge1xuICBpZiAoc2hhZG93Q3NzU3VwcG9ydGVkID09PSB1bmRlZmluZWQpIHtcbiAgICBzaGFkb3dDc3NTdXBwb3J0ZWQgPVxuICAgICAgaXNTaGFkb3dEb21TdXBwb3J0ZWQoKSAmJlxuICAgICAgKGlzTmF0aXZlKEVsZW1lbnQucHJvdG90eXBlLmF0dGFjaFNoYWRvdykgfHxcbiAgICAgICAgaXNOYXRpdmUoRWxlbWVudC5wcm90b3R5cGUuY3JlYXRlU2hhZG93Um9vdCkpO1xuICB9XG4gIHJldHVybiBzaGFkb3dDc3NTdXBwb3J0ZWQ7XG59XG5cbi8qKlxuICogUmV0dXJucyBgdHJ1ZWAgaWYgdGhlIHBhc3NlZCBmdW5jdGlvbiBpcyBuYXRpdmUgdG8gdGhlIGJyb3dzZXIsIGFuZCBpcyBub3RcbiAqIHBvbHlmaWxsZWRcbiAqIEBwYXJhbSB7RnVuY3Rpb258dW5kZWZpbmVkfSBmdW5jIEEgZnVuY3Rpb24gdGhhdCBpcyBhdHRhdGNoZWQgdG8gYSBKU1xuICogb2JqZWN0LlxuICogQHJldHVybiB7Ym9vbGVhbn1cbiAqL1xuZnVuY3Rpb24gaXNOYXRpdmUoZnVuYykge1xuICByZXR1cm4gISFmdW5jICYmIGZ1bmMudG9TdHJpbmcoKS5pbmRleE9mKCdbbmF0aXZlIGNvZGVdJykgIT0gLTE7XG59XG5cbi8qKlxuICogUmV0dXJucyB0aGUgc3VwcG9ydGVkIHZlcnNpb24gb2YgU2hhZG93IERPTSBzcGVjLlxuICogQHBhcmFtIHt0eXBlb2YgRWxlbWVudD19IG9wdF9lbGVtZW50Q2xhc3Mgb3B0aW9uYWwgZm9yIHRlc3RpbmdcbiAqIEByZXR1cm4geyFTaGFkb3dEb21WZXJzaW9ufVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U2hhZG93RG9tU3VwcG9ydGVkVmVyc2lvbihvcHRfZWxlbWVudENsYXNzKSB7XG4gIGlmIChzaGFkb3dEb21TdXBwb3J0ZWRWZXJzaW9uID09PSB1bmRlZmluZWQpIHtcbiAgICBzaGFkb3dEb21TdXBwb3J0ZWRWZXJzaW9uID0gZ2V0U2hhZG93RG9tVmVyc2lvbihcbiAgICAgIG9wdF9lbGVtZW50Q2xhc3MgfHwgRWxlbWVudFxuICAgICk7XG4gIH1cbiAgcmV0dXJuIHNoYWRvd0RvbVN1cHBvcnRlZFZlcnNpb247XG59XG5cbi8qKlxuICogUmV0dXJucyBzaGFkb3cgZG9tIHZlcnNpb24uXG4gKlxuICogQHBhcmFtIHshdHlwZW9mIEVsZW1lbnR9IGVsZW1lbnRcbiAqIEByZXR1cm4geyFTaGFkb3dEb21WZXJzaW9ufVxuICovXG5mdW5jdGlvbiBnZXRTaGFkb3dEb21WZXJzaW9uKGVsZW1lbnQpIHtcbiAgaWYgKCEhZWxlbWVudC5wcm90b3R5cGUuYXR0YWNoU2hhZG93KSB7XG4gICAgcmV0dXJuIFNoYWRvd0RvbVZlcnNpb24uVjE7XG4gIH0gZWxzZSBpZiAoISFlbGVtZW50LnByb3RvdHlwZS5jcmVhdGVTaGFkb3dSb290KSB7XG4gICAgcmV0dXJuIFNoYWRvd0RvbVZlcnNpb24uVjA7XG4gIH1cbiAgcmV0dXJuIFNoYWRvd0RvbVZlcnNpb24uTk9ORTtcbn1cbiJdfQ==
// /Users/mszylkowski/src/amphtml/src/core/dom/web-components.js