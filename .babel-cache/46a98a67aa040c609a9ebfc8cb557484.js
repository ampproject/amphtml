/**
 * Copyright 2017 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { internalListenImplementation } from "./core/dom/event-helper-listen";
import { dict } from "./core/types/object";
import { tryParseJson } from "./core/types/object/json";
import { dev, devAssert } from "./log";

/** @const */
var AMP_MESSAGE_PREFIX = 'amp-';
export var CONSTANTS = {
  responseTypeSuffix: '-result',
  messageIdFieldName: 'messageId',
  payloadFieldName: 'payload',
  contentFieldName: 'content'
};

/** @enum {string} */
export var MessageType = {
  // For amp-ad
  SEND_EMBED_STATE: 'send-embed-state',
  EMBED_STATE: 'embed-state',
  SEND_EMBED_CONTEXT: 'send-embed-context',
  EMBED_CONTEXT: 'embed-context',
  SEND_INTERSECTIONS: 'send-intersections',
  INTERSECTION: 'intersection',
  EMBED_SIZE: 'embed-size',
  EMBED_SIZE_CHANGED: 'embed-size-changed',
  EMBED_SIZE_DENIED: 'embed-size-denied',
  NO_CONTENT: 'no-content',
  GET_HTML: 'get-html',
  GET_CONSENT_STATE: 'get-consent-state',
  SIGNAL_INTERACTIVE: 'signal-interactive',
  // For the frame to be placed in full overlay mode for lightboxes
  FULL_OVERLAY_FRAME: 'full-overlay-frame',
  FULL_OVERLAY_FRAME_RESPONSE: 'full-overlay-frame-response',
  CANCEL_FULL_OVERLAY_FRAME: 'cancel-full-overlay-frame',
  CANCEL_FULL_OVERLAY_FRAME_RESPONSE: 'cancel-full-overlay-frame-response',
  // For amp-inabox
  SEND_POSITIONS: 'send-positions',
  POSITION: 'position',
  // For amp-analytics' iframe-transport
  SEND_IFRAME_TRANSPORT_EVENTS: 'send-iframe-transport-events',
  IFRAME_TRANSPORT_EVENTS: 'iframe-transport-events',
  IFRAME_TRANSPORT_RESPONSE: 'iframe-transport-response',
  // For user-error-in-iframe
  USER_ERROR_IN_IFRAME: 'user-error-in-iframe',
  // For amp-iframe
  SEND_CONSENT_DATA: 'send-consent-data',
  CONSENT_DATA: 'consent-data'
};

/**
 * Listens for the specified event on the element.
 * @param {!EventTarget} element
 * @param {string} eventType
 * @param {function(!Event)} listener
 * @param {Object=} opt_evtListenerOpts
 * @return {!UnlistenDef}
 */
export function listen(element, eventType, listener, opt_evtListenerOpts) {
  return internalListenImplementation(element, eventType, listener, opt_evtListenerOpts);
}

/**
 * Serialize an AMP post message. Output looks like:
 * 'amp-011481323099490{"type":"position","sentinel":"12345","foo":"bar"}'
 * @param {string} type
 * @param {string} sentinel
 * @param {JsonObject=} data
 * @param {?string=} rtvVersion
 * @return {string}
 */
export function serializeMessage(type, sentinel, data, rtvVersion) {
  if (data === void 0) {
    data = dict();
  }

  if (rtvVersion === void 0) {
    rtvVersion = null;
  }

  // TODO: consider wrap the data in a "data" field. { type, sentinal, data }
  var message = data;
  message['type'] = type;
  message['sentinel'] = sentinel;
  return AMP_MESSAGE_PREFIX + (rtvVersion || '') + JSON.stringify(message);
}

/**
 * Deserialize an AMP post message.
 * Returns null if it's not valid AMP message format.
 *
 * @param {*} message
 * @return {?JsonObject|undefined}
 */
export function deserializeMessage(message) {
  if (!isAmpMessage(message)) {
    return null;
  }

  var startPos = message.indexOf('{');
  devAssert(startPos != -1, 'JSON missing in %s', message);
  return tryParseJson(message.substr(startPos), function (e) {
    return dev().error('MESSAGING', 'Failed to parse message: ' + message, e);
  });
}

/**
 *  Returns true if message looks like it is an AMP postMessage
 *  @param {*} message
 *  @return {boolean}
 */
export function isAmpMessage(message) {
  return typeof message == 'string' && message.indexOf(AMP_MESSAGE_PREFIX) == 0 && message.indexOf('{') != -1;
}

/** @typedef {{creativeId: string, message: string}} */
export var IframeTransportEvent;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjNwLWZyYW1lLW1lc3NhZ2luZy5qcyJdLCJuYW1lcyI6WyJpbnRlcm5hbExpc3RlbkltcGxlbWVudGF0aW9uIiwiZGljdCIsInRyeVBhcnNlSnNvbiIsImRldiIsImRldkFzc2VydCIsIkFNUF9NRVNTQUdFX1BSRUZJWCIsIkNPTlNUQU5UUyIsInJlc3BvbnNlVHlwZVN1ZmZpeCIsIm1lc3NhZ2VJZEZpZWxkTmFtZSIsInBheWxvYWRGaWVsZE5hbWUiLCJjb250ZW50RmllbGROYW1lIiwiTWVzc2FnZVR5cGUiLCJTRU5EX0VNQkVEX1NUQVRFIiwiRU1CRURfU1RBVEUiLCJTRU5EX0VNQkVEX0NPTlRFWFQiLCJFTUJFRF9DT05URVhUIiwiU0VORF9JTlRFUlNFQ1RJT05TIiwiSU5URVJTRUNUSU9OIiwiRU1CRURfU0laRSIsIkVNQkVEX1NJWkVfQ0hBTkdFRCIsIkVNQkVEX1NJWkVfREVOSUVEIiwiTk9fQ09OVEVOVCIsIkdFVF9IVE1MIiwiR0VUX0NPTlNFTlRfU1RBVEUiLCJTSUdOQUxfSU5URVJBQ1RJVkUiLCJGVUxMX09WRVJMQVlfRlJBTUUiLCJGVUxMX09WRVJMQVlfRlJBTUVfUkVTUE9OU0UiLCJDQU5DRUxfRlVMTF9PVkVSTEFZX0ZSQU1FIiwiQ0FOQ0VMX0ZVTExfT1ZFUkxBWV9GUkFNRV9SRVNQT05TRSIsIlNFTkRfUE9TSVRJT05TIiwiUE9TSVRJT04iLCJTRU5EX0lGUkFNRV9UUkFOU1BPUlRfRVZFTlRTIiwiSUZSQU1FX1RSQU5TUE9SVF9FVkVOVFMiLCJJRlJBTUVfVFJBTlNQT1JUX1JFU1BPTlNFIiwiVVNFUl9FUlJPUl9JTl9JRlJBTUUiLCJTRU5EX0NPTlNFTlRfREFUQSIsIkNPTlNFTlRfREFUQSIsImxpc3RlbiIsImVsZW1lbnQiLCJldmVudFR5cGUiLCJsaXN0ZW5lciIsIm9wdF9ldnRMaXN0ZW5lck9wdHMiLCJzZXJpYWxpemVNZXNzYWdlIiwidHlwZSIsInNlbnRpbmVsIiwiZGF0YSIsInJ0dlZlcnNpb24iLCJtZXNzYWdlIiwiSlNPTiIsInN0cmluZ2lmeSIsImRlc2VyaWFsaXplTWVzc2FnZSIsImlzQW1wTWVzc2FnZSIsInN0YXJ0UG9zIiwiaW5kZXhPZiIsInN1YnN0ciIsImUiLCJlcnJvciIsIklmcmFtZVRyYW5zcG9ydEV2ZW50Il0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxTQUFRQSw0QkFBUjtBQUNBLFNBQVFDLElBQVI7QUFDQSxTQUFRQyxZQUFSO0FBQ0EsU0FBUUMsR0FBUixFQUFhQyxTQUFiOztBQUVBO0FBQ0EsSUFBTUMsa0JBQWtCLEdBQUcsTUFBM0I7QUFDQSxPQUFPLElBQU1DLFNBQVMsR0FBRztBQUN2QkMsRUFBQUEsa0JBQWtCLEVBQUUsU0FERztBQUV2QkMsRUFBQUEsa0JBQWtCLEVBQUUsV0FGRztBQUd2QkMsRUFBQUEsZ0JBQWdCLEVBQUUsU0FISztBQUl2QkMsRUFBQUEsZ0JBQWdCLEVBQUU7QUFKSyxDQUFsQjs7QUFPUDtBQUNBLE9BQU8sSUFBTUMsV0FBVyxHQUFHO0FBQ3pCO0FBQ0FDLEVBQUFBLGdCQUFnQixFQUFFLGtCQUZPO0FBR3pCQyxFQUFBQSxXQUFXLEVBQUUsYUFIWTtBQUl6QkMsRUFBQUEsa0JBQWtCLEVBQUUsb0JBSks7QUFLekJDLEVBQUFBLGFBQWEsRUFBRSxlQUxVO0FBTXpCQyxFQUFBQSxrQkFBa0IsRUFBRSxvQkFOSztBQU96QkMsRUFBQUEsWUFBWSxFQUFFLGNBUFc7QUFRekJDLEVBQUFBLFVBQVUsRUFBRSxZQVJhO0FBU3pCQyxFQUFBQSxrQkFBa0IsRUFBRSxvQkFUSztBQVV6QkMsRUFBQUEsaUJBQWlCLEVBQUUsbUJBVk07QUFXekJDLEVBQUFBLFVBQVUsRUFBRSxZQVhhO0FBWXpCQyxFQUFBQSxRQUFRLEVBQUUsVUFaZTtBQWF6QkMsRUFBQUEsaUJBQWlCLEVBQUUsbUJBYk07QUFjekJDLEVBQUFBLGtCQUFrQixFQUFFLG9CQWRLO0FBZ0J6QjtB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aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTLUlTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7aW50ZXJuYWxMaXN0ZW5JbXBsZW1lbnRhdGlvbn0gZnJvbSAnLi9jb3JlL2RvbS9ldmVudC1oZWxwZXItbGlzdGVuJztcbmltcG9ydCB7ZGljdH0gZnJvbSAnLi9jb3JlL3R5cGVzL29iamVjdCc7XG5pbXBvcnQge3RyeVBhcnNlSnNvbn0gZnJvbSAnLi9jb3JlL3R5cGVzL29iamVjdC9qc29uJztcbmltcG9ydCB7ZGV2LCBkZXZBc3NlcnR9IGZyb20gJy4vbG9nJztcblxuLyoqIEBjb25zdCAqL1xuY29uc3QgQU1QX01FU1NBR0VfUFJFRklYID0gJ2FtcC0nO1xuZXhwb3J0IGNvbnN0IENPTlNUQU5UUyA9IHtcbiAgcmVzcG9uc2VUeXBlU3VmZml4OiAnLXJlc3VsdCcsXG4gIG1lc3NhZ2VJZEZpZWxkTmFtZTogJ21lc3NhZ2VJZCcsXG4gIHBheWxvYWRGaWVsZE5hbWU6ICdwYXlsb2FkJyxcbiAgY29udGVudEZpZWxkTmFtZTogJ2NvbnRlbnQnLFxufTtcblxuLyoqIEBlbnVtIHtzdHJpbmd9ICovXG5leHBvcnQgY29uc3QgTWVzc2FnZVR5cGUgPSB7XG4gIC8vIEZvciBhbXAtYWRcbiAgU0VORF9FTUJFRF9TVEFURTogJ3NlbmQtZW1iZWQtc3RhdGUnLFxuICBFTUJFRF9TVEFURTogJ2VtYmVkLXN0YXRlJyxcbiAgU0VORF9FTUJFRF9DT05URVhUOiAnc2VuZC1lbWJlZC1jb250ZXh0JyxcbiAgRU1CRURfQ09OVEVYVDogJ2VtYmVkLWNvbnRleHQnLFxuICBTRU5EX0lOVEVSU0VDVElPTlM6ICdzZW5kLWludGVyc2VjdGlvbnMnLFxuICBJTlRFUlNFQ1RJT046ICdpbnRlcnNlY3Rpb24nLFxuICBFTUJFRF9TSVpFOiAnZW1iZWQtc2l6ZScsXG4gIEVNQkVEX1NJWkVfQ0hBTkdFRDogJ2VtYmVkLXNpemUtY2hhbmdlZCcsXG4gIEVNQkVEX1NJWkVfREVOSUVEOiAnZW1iZWQtc2l6ZS1kZW5pZWQnLFxuICBOT19DT05URU5UOiAnbm8tY29udGVudCcsXG4gIEdFVF9IVE1MOiAnZ2V0LWh0bWwnLFxuICBHRVRfQ09OU0VOVF9TVEFURTogJ2dldC1jb25zZW50LXN0YXRlJyxcbiAgU0lHTkFMX0lOVEVSQUNUSVZFOiAnc2lnbmFsLWludGVyYWN0aXZlJyxcblxuICAvLyBGb3IgdGhlIGZyYW1lIHRvIGJlIHBsYWNlZCBpbiBmdWxsIG92ZXJsYXkgbW9kZSBmb3IgbGlnaHRib3hlc1xuICBGVUxMX09WRVJMQVlfRlJBTUU6ICdmdWxsLW92ZXJsYXktZnJhbWUnLFxuICBGVUxMX09WRVJMQVlfRlJBTUVfUkVTUE9OU0U6ICdmdWxsLW92ZXJsYXktZnJhbWUtcmVzcG9uc2UnLFxuICBDQU5DRUxfRlVMTF9PVkVSTEFZX0ZSQU1FOiAnY2FuY2VsLWZ1bGwtb3ZlcmxheS1mcmFtZScsXG4gIENBTkNFTF9GVUxMX09WRVJMQVlfRlJBTUVfUkVTUE9OU0U6ICdjYW5jZWwtZnVsbC1vdmVybGF5LWZyYW1lLXJlc3BvbnNlJyxcblxuICAvLyBGb3IgYW1wLWluYWJveFxuICBTRU5EX1BPU0lUSU9OUzogJ3NlbmQtcG9zaXRpb25zJyxcbiAgUE9TSVRJT046ICdwb3NpdGlvbicsXG5cbiAgLy8gRm9yIGFtcC1hbmFseXRpY3MnIGlmcmFtZS10cmFuc3BvcnRcbiAgU0VORF9JRlJBTUVfVFJBTlNQT1JUX0VWRU5UUzogJ3NlbmQtaWZyYW1lLXRyYW5zcG9ydC1ldmVudHMnLFxuICBJRlJBTUVfVFJBTlNQT1JUX0VWRU5UUzogJ2lmcmFtZS10cmFuc3BvcnQtZXZlbnRzJyxcbiAgSUZSQU1FX1RSQU5TUE9SVF9SRVNQT05TRTogJ2lmcmFtZS10cmFuc3BvcnQtcmVzcG9uc2UnLFxuXG4gIC8vIEZvciB1c2VyLWVycm9yLWluLWlmcmFtZVxuICBVU0VSX0VSUk9SX0lOX0lGUkFNRTogJ3VzZXItZXJyb3ItaW4taWZyYW1lJyxcblxuICAvLyBGb3IgYW1wLWlmcmFtZVxuICBTRU5EX0NPTlNFTlRfREFUQTogJ3NlbmQtY29uc2VudC1kYXRhJyxcbiAgQ09OU0VOVF9EQVRBOiAnY29uc2VudC1kYXRhJyxcbn07XG5cbi8qKlxuICogTGlzdGVucyBmb3IgdGhlIHNwZWNpZmllZCBldmVudCBvbiB0aGUgZWxlbWVudC5cbiAqIEBwYXJhbSB7IUV2ZW50VGFyZ2V0fSBlbGVtZW50XG4gKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlXG4gKiBAcGFyYW0ge2Z1bmN0aW9uKCFFdmVudCl9IGxpc3RlbmVyXG4gKiBAcGFyYW0ge09iamVjdD19IG9wdF9ldnRMaXN0ZW5lck9wdHNcbiAqIEByZXR1cm4geyFVbmxpc3RlbkRlZn1cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGxpc3RlbihlbGVtZW50LCBldmVudFR5cGUsIGxpc3RlbmVyLCBvcHRfZXZ0TGlzdGVuZXJPcHRzKSB7XG4gIHJldHVybiBpbnRlcm5hbExpc3RlbkltcGxlbWVudGF0aW9uKFxuICAgIGVsZW1lbnQsXG4gICAgZXZlbnRUeXBlLFxuICAgIGxpc3RlbmVyLFxuICAgIG9wdF9ldnRMaXN0ZW5lck9wdHNcbiAgKTtcbn1cblxuLyoqXG4gKiBTZXJpYWxpemUgYW4gQU1QIHBvc3QgbWVzc2FnZS4gT3V0cHV0IGxvb2tzIGxpa2U6XG4gKiAnYW1wLTAxMTQ4MTMyMzA5OTQ5MHtcInR5cGVcIjpcInBvc2l0aW9uXCIsXCJzZW50aW5lbFwiOlwiMTIzNDVcIixcImZvb1wiOlwiYmFyXCJ9J1xuICogQHBhcmFtIHtzdHJpbmd9IHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBzZW50aW5lbFxuICogQHBhcmFtIHtKc29uT2JqZWN0PX0gZGF0YVxuICogQHBhcmFtIHs/c3RyaW5nPX0gcnR2VmVyc2lvblxuICogQHJldHVybiB7c3RyaW5nfVxuICovXG5leHBvcnQgZnVuY3Rpb24gc2VyaWFsaXplTWVzc2FnZShcbiAgdHlwZSxcbiAgc2VudGluZWwsXG4gIGRhdGEgPSBkaWN0KCksXG4gIHJ0dlZlcnNpb24gPSBudWxsXG4pIHtcbiAgLy8gVE9ETzogY29uc2lkZXIgd3JhcCB0aGUgZGF0YSBpbiBhIFwiZGF0YVwiIGZpZWxkLiB7IHR5cGUsIHNlbnRpbmFsLCBkYXRhIH1cbiAgY29uc3QgbWVzc2FnZSA9IGRhdGE7XG4gIG1lc3NhZ2VbJ3R5cGUnXSA9IHR5cGU7XG4gIG1lc3NhZ2VbJ3NlbnRpbmVsJ10gPSBzZW50aW5lbDtcbiAgcmV0dXJuIEFNUF9NRVNTQUdFX1BSRUZJWCArIChydHZWZXJzaW9uIHx8ICcnKSArIEpTT04uc3RyaW5naWZ5KG1lc3NhZ2UpO1xufVxuXG4vKipcbiAqIERlc2VyaWFsaXplIGFuIEFNUCBwb3N0IG1lc3NhZ2UuXG4gKiBSZXR1cm5zIG51bGwgaWYgaXQncyBub3QgdmFsaWQgQU1QIG1lc3NhZ2UgZm9ybWF0LlxuICpcbiAqIEBwYXJhbSB7Kn0gbWVzc2FnZVxuICogQHJldHVybiB7P0pzb25PYmplY3R8dW5kZWZpbmVkfVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVzZXJpYWxpemVNZXNzYWdlKG1lc3NhZ2UpIHtcbiAgaWYgKCFpc0FtcE1lc3NhZ2UobWVzc2FnZSkpIHtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxuICBjb25zdCBzdGFydFBvcyA9IG1lc3NhZ2UuaW5kZXhPZigneycpO1xuICBkZXZBc3NlcnQoc3RhcnRQb3MgIT0gLTEsICdKU09OIG1pc3NpbmcgaW4gJXMnLCBtZXNzYWdlKTtcbiAgcmV0dXJuIHRyeVBhcnNlSnNvbihtZXNzYWdlLnN1YnN0cihzdGFydFBvcyksIChlKSA9PlxuICAgIGRldigpLmVycm9yKCdNRVNTQUdJTkcnLCAnRmFpbGVkIHRvIHBhcnNlIG1lc3NhZ2U6ICcgKyBtZXNzYWdlLCBlKVxuICApO1xufVxuXG4vKipcbiAqICBSZXR1cm5zIHRydWUgaWYgbWVzc2FnZSBsb29rcyBsaWtlIGl0IGlzIGFuIEFNUCBwb3N0TWVzc2FnZVxuICogIEBwYXJhbSB7Kn0gbWVzc2FnZVxuICogIEByZXR1cm4ge2Jvb2xlYW59XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBpc0FtcE1lc3NhZ2UobWVzc2FnZSkge1xuICByZXR1cm4gKFxuICAgIHR5cGVvZiBtZXNzYWdlID09ICdzdHJpbmcnICYmXG4gICAgbWVzc2FnZS5pbmRleE9mKEFNUF9NRVNTQUdFX1BSRUZJWCkgPT0gMCAmJlxuICAgIG1lc3NhZ2UuaW5kZXhPZigneycpICE9IC0xXG4gICk7XG59XG5cbi8qKiBAdHlwZWRlZiB7e2NyZWF0aXZlSWQ6IHN0cmluZywgbWVzc2FnZTogc3RyaW5nfX0gKi9cbmV4cG9ydCBsZXQgSWZyYW1lVHJhbnNwb3J0RXZlbnQ7XG4vLyBBbiBldmVudCwgYW5kIHRoZSB0cmFuc3BvcnQgSUQgb2YgdGhlIGFtcC1hbmFseXRpY3MgdGFncyB0aGF0XG4vLyBnZW5lcmF0ZWQgaXQuIEZvciBpbnN0YW5jZSBpZiB0aGUgY3JlYXRpdmUgd2l0aCB0cmFuc3BvcnRcbi8vIElEIDIgc2VuZHMgXCJoaVwiLCB0aGVuIGFuIElmcmFtZVRyYW5zcG9ydEV2ZW50IHdvdWxkIGxvb2sgbGlrZTpcbi8vIHsgY3JlYXRpdmVJZDogXCIyXCIsIG1lc3NhZ2U6IFwiaGlcIiB9XG4vLyBJZiB0aGUgY3JlYXRpdmUgd2l0aCB0cmFuc3BvcnQgSUQgMiBzZW50IHRoYXQsIGFuZCBhbHNvIHNlbnQgXCJoZWxsb1wiLFxuLy8gYW5kIHRoZSBjcmVhdGl2ZSB3aXRoIHRyYW5zcG9ydCBJRCAzIHNlbmRzIFwiZ29vZGJ5ZVwiIHRoZW4gYW4gKmFycmF5KiBvZiAzXG4vLyBBbXBBbmFseXRpY3NJZnJhbWVUcmFuc3BvcnRFdmVudCB3b3VsZCBiZSBzZW50IHRvIHRoZSAzcCBmcmFtZSBsaWtlIHNvOlxuLy8gW1xuLy8gICB7IGNyZWF0aXZlSWQ6IFwiMlwiLCBtZXNzYWdlOiBcImhpXCIgfSwgLy8gQW4gQW1wQW5hbHl0aWNzSWZyYW1lVHJhbnNwb3J0RXZlbnRcbi8vICAgeyBjcmVhdGl2ZUlkOiBcIjJcIiwgbWVzc2FnZTogXCJoZWxsb1wiIH0sIC8vIEFub3RoZXJcbi8vICAgeyBjcmVhdGl2ZUlkOiBcIjNcIiwgbWVzc2FnZTogXCJnb29kYnllXCIgfSAvLyBBbmQgYW5vdGhlclxuLy8gXVxuIl19
// /Users/mszylkowski/src/amphtml/src/3p-frame-messaging.js