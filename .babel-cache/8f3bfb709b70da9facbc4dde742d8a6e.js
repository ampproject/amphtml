/**
 * Copyright 2017 The AMP HTML Authors. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS-IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
import { Services } from "./";
import { extensionScriptsInNode } from "./extension-script";
import { createCustomElementClass, stubbedElements } from "../custom-element";
import { ElementStub } from "../element-stub";
import { reportError } from "../error-reporting";
import { userAssert } from "../log";

/** @type {!WeakMap<!./service/ampdoc-impl.AmpDoc, boolean>} */
var docInitializedMap = new WeakMap();

/**
 * @param {!Window} win
 * @return {!Object<string, typeof ../base-element.BaseElement>}
 */
function getExtendedElements(win) {
  if (!win.__AMP_EXTENDED_ELEMENTS) {
    win.__AMP_EXTENDED_ELEMENTS = {};
  }

  return win.__AMP_EXTENDED_ELEMENTS;
}

/**
 * Registers an element. Upgrades it if has previously been stubbed.
 * @param {!Window} win
 * @param {string} name
 * @param {typeof ../base-element.BaseElement} toClass
 */
export function upgradeOrRegisterElement(win, name, toClass) {
  var waitPromise = waitReadyForUpgrade(win, toClass);

  if (waitPromise) {
    waitPromise.then(function () {
      return upgradeOrRegisterElementReady(win, name, toClass);
    });
  } else {
    upgradeOrRegisterElementReady(win, name, toClass);
  }
}

/**
 * Registers an element. Upgrades it if has previously been stubbed.
 * @param {!Window} win
 * @param {string} name
 * @param {typeof ../base-element.BaseElement} toClass
 */
function upgradeOrRegisterElementReady(win, name, toClass) {
  var knownElements = getExtendedElements(win);

  if (!knownElements[name]) {
    registerElement(win, name, toClass);
    return;
  }

  if (knownElements[name] == toClass) {
    // Already registered this instance.
    return;
  }

  userAssert(knownElements[name] == ElementStub, '%s is already registered. The script tag for ' + '%s is likely included twice in the page.', name, name);
  knownElements[name] = toClass;

  for (var i = 0; i < stubbedElements.length; i++) {
    var element = stubbedElements[i];

    // There are 3 possible states here:
    // 1. We never made the stub because the extended impl. loaded first.
    //    In that case the element won't be in the array.
    // 2. We made a stub but the browser didn't attach it yet. In
    //    that case we don't need to upgrade but simply switch to the new
    //    implementation.
    // 3. A stub was attached. We upgrade which means we replay the
    //    implementation.
    if (element.tagName.toLowerCase() == name && element.ownerDocument.defaultView == win) {
      tryUpgradeElement(element, toClass);
      // Remove element from array.
      stubbedElements.splice(i--, 1);
    }
  }
}

/**
 * This method should not be inlined to prevent TryCatch deoptimization.
 * @param {Element} element
 * @param {typeof ../base-element.BaseElement} toClass
 * @private
 */
function tryUpgradeElement(element, toClass) {
  try {
    element.upgrade(toClass);
  } catch (e) {
    reportError(e, element);
  }
}

/**
 * Ensures that the element is ready for upgrade. Either returns immediately
 * with `undefined` indicating that no waiting is necessary, or returns a
 * promise that will resolve when the upgrade can proceed.
 *
 * @param {!Window} win
 * @param {typeof ../base-element.BaseElement} elementClass
 * @return {!Promise|undefind}
 */
function waitReadyForUpgrade(win, elementClass) {
  // Make sure the polyfill is installed for Shadow DOM if element needs it.
  if (elementClass.requiresShadowDom() && !win.Element.prototype.attachShadow) {
    var extensions = Services.extensionsFor(win);
    return extensions.importUnwrapped(win, 'amp-shadow-dom-polyfill');
  }
}

/**
 * Stub extended elements missing an implementation. It can be called multiple
 * times and on partial document in order to start stubbing as early as
 * possible.
 * @param {!./ampdoc-impl.AmpDoc} ampdoc
 */
export function stubElementsForDoc(ampdoc) {
  var extensions = extensionScriptsInNode(ampdoc.getHeadNode());
  extensions.forEach(function (_ref) {
    var extensionId = _ref.extensionId,
        extensionVersion = _ref.extensionVersion;
    ampdoc.declareExtension(extensionId, extensionVersion);
    stubElementIfNotKnown(ampdoc.win, extensionId);
  });

  if (ampdoc.isBodyAvailable()) {
    ampdoc.setExtensionsKnown();
  }
}

/**
 * Stub element if not yet known.
 * @param {!Window} win
 * @param {string} name
 */
export function stubElementIfNotKnown(win, name) {
  var knownElements = getExtendedElements(win);

  if (!knownElements[name]) {
    registerElement(win, name, ElementStub);
  }
}

/**
 * Copies the specified element to child window (friendly iframe). This way
 * all implementations of the AMP elements are shared between all friendly
 * frames.
 * @param {!Window} parentWin
 * @param {!Window} childWin
 * @param {string} name
 */
export function copyElementToChildWindow(parentWin, childWin, name) {
  var toClass = getExtendedElements(parentWin)[name];
  registerElement(childWin, name, toClass || ElementStub);
}

/**
 * Registers a new custom element with its implementation class.
 * @param {!Window} win The window in which to register the elements.
 * @param {string} name Name of the custom element
 * @param {typeof ../base-element.BaseElement} implementationClass
 */
export function registerElement(win, name, implementationClass) {
  var knownElements = getExtendedElements(win);
  knownElements[name] = implementationClass;
  var klass = createCustomElementClass(win, elementConnectedCallback);
  win['customElements'].define(name, klass);
}

/**
 * @param {!./ampdoc-impl.AmpDoc} ampdoc
 * @param {!AmpElement} element
 * @param {?(typeof BaseElement)} implementationClass
 * @visibleForTesting
 */
export function elementConnectedCallback(ampdoc, element, implementationClass) {
  // Make sure that the ampdoc has already been stubbed.
  if (!docInitializedMap.has(ampdoc)) {
    docInitializedMap.set(ampdoc, true);
    stubElementsForDoc(ampdoc);
  }

  // Load the pre-stubbed legacy extension if needed.
  var extensionId = element.localName;

  if (!implementationClass && !ampdoc.declaresExtension(extensionId)) {
    Services.extensionsFor(ampdoc.win).installExtensionForDoc(ampdoc, extensionId, // The legacy auto-extensions are always 0.1.
    '0.1');
  }
}

/**
 * In order to provide better error messages we only allow to retrieve
 * services from other elements if those elements are loaded in the page.
 * This makes it possible to mark an element as loaded in a test.
 * @param {!Window} win
 * @param {string} elementName Name of an extended custom element.
 * @visibleForTesting
 */
export function markElementScheduledForTesting(win, elementName) {
  var knownElements = getExtendedElements(win);

  if (!knownElements[elementName]) {
    knownElements[elementName] = ElementStub;
  }
}

/**
 * Resets our scheduled elements.
 * @param {!Window} win
 * @param {string} elementName Name of an extended custom element.
 * @visibleForTesting
 */
export function resetScheduledElementForTesting(win, elementName) {
  if (win.__AMP_EXTENDED_ELEMENTS) {
    delete win.__AMP_EXTENDED_ELEMENTS[elementName];
  }
}

/**
 * Returns a currently registered element class.
 * @param {!Window} win
 * @param {string} elementName Name of an extended custom element.
 * @return {?function()}
 * @visibleForTesting
 */
export function getElementClassForTesting(win, elementName) {
  var knownElements = win.__AMP_EXTENDED_ELEMENTS;
  return knownElements && knownElements[elementName] || null;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImN1c3RvbS1lbGVtZW50LXJlZ2lzdHJ5LmpzIl0sIm5hbWVzIjpbIlNlcnZpY2VzIiwiZXh0ZW5zaW9uU2NyaXB0c0luTm9kZSIsImNyZWF0ZUN1c3RvbUVsZW1lbnRDbGFzcyIsInN0dWJiZWRFbGVtZW50cyIsIkVsZW1lbnRTdHViIiwicmVwb3J0RXJyb3IiLCJ1c2VyQXNzZXJ0IiwiZG9jSW5pdGlhbGl6ZWRNYXAiLCJXZWFrTWFwIiwiZ2V0RXh0ZW5kZWRFbGVtZW50cyIsIndpbiIsIl9fQU1QX0VYVEVOREVEX0VMRU1FTlRTIiwidXBncmFkZU9yUmVnaXN0ZXJFbGVtZW50IiwibmFtZSIsInRvQ2xhc3MiLCJ3YWl0UHJvbWlzZSIsIndhaXRSZWFkeUZvclVwZ3JhZGUiLCJ0aGVuIiwidXBncmFkZU9yUmVnaXN0ZXJFbGVtZW50UmVhZHkiLCJrbm93bkVsZW1lbnRzIiwicmVnaXN0ZXJFbGVtZW50IiwiaSIsImxlbmd0aCIsImVsZW1lbnQiLCJ0YWdOYW1lIiwidG9Mb3dlckNhc2UiLCJvd25lckRvY3VtZW50IiwiZGVmYXVsdFZpZXciLCJ0cnlVcGdyYWRlRWxlbWVudCIsInNwbGljZSIsInVwZ3JhZGUiLCJlIiwiZWxlbWVudENsYXNzIiwicmVxdWlyZXNTaGFkb3dEb20iLCJFbGVtZW50IiwicHJvdG90eXBlIiwiYXR0YWNoU2hhZG93IiwiZXh0ZW5zaW9ucyIsImV4dGVuc2lvbnNGb3IiLCJpbXBvcnRVbndyYXBwZWQiLCJzdHViRWxlbWVudHNGb3JEb2MiLCJhbXBkb2MiLCJnZXRIZWFkTm9kZSIsImZvckVhY2giLCJleHRlbnNpb25JZCIsImV4dGVuc2lvblZlcnNpb24iLCJkZWNsYXJlRXh0ZW5zaW9uIiwic3R1YkVsZW1lbnRJZk5vdEtub3duIiwiaXNCb2R5QXZhaWxhYmxlIiwic2V0RXh0ZW5zaW9uc0tub3duIiwiY29weUVsZW1lbnRUb0NoaWxkV2luZG93IiwicGFyZW50V2luIiwiY2hpbGRXaW4iLCJpbXBsZW1lbnRhdGlvbkNsYXNzIiwia2xhc3MiLCJlbGVtZW50Q29ubmVjdGVkQ2FsbGJhY2siLCJkZWZpbmUiLCJoYXMiLCJzZXQiLCJsb2NhbE5hbWUiLCJkZWNsYXJlc0V4dGVuc2lvbiIsImluc3RhbGxFeHRlbnNpb25Gb3JEb2MiLCJtYXJrRWxlbWVudFNjaGVkdWxlZEZvclRlc3RpbmciLCJlbGVtZW50TmFtZSIsInJlc2V0U2NoZWR1bGVkRWxlbWVudEZvclRlc3RpbmciLCJnZXRFbGVtZW50Q2xhc3NGb3JUZXN0aW5nIl0sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxTQUFRQSxRQUFSO0FBRUEsU0FBUUMsc0JBQVI7QUFFQSxTQUFRQyx3QkFBUixFQUFrQ0MsZUFBbEM7QUFDQSxTQUFRQyxXQUFSO0FBQ0EsU0FBUUMsV0FBUjtBQUNBLFNBQVFDLFVBQVI7O0FBRUE7QUFDQSxJQUFNQyxpQkFBaUIsR0FBRyxJQUFJQyxPQUFKLEVBQTFCOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0FBU0MsbUJBQVQsQ0FBNkJDLEdBQTdCLEVBQWtDO0FBQ2hDLE1BQUksQ0FBQ0EsR0FBRyxDQUFDQyx1QkFBVCxFQUFrQztBQUNoQ0QsSUFBQUEsR0FBRyxDQUFDQyx1QkFBSixHQUE4QixFQUE5QjtBQUNEOztBQUNELFNBQU9ELEdBQUcsQ0FBQ0MsdUJBQVg7QUFDRDs7QUFFRDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNDLHdCQUFULENBQWtDRixHQUFsQyxFQUF1Q0csSUFBdkMsRUFBNkNDLE9BQTdDLEVBQXNEO0FBQzNELE1BQU1DLFdBQVcsR0FBR0MsbUJBQW1CLENBQUNOLEdBQUQsRUFBTUksT0FBTixDQUF2Qzs7QUFDQSxNQUFJQyxXQUFKLEVBQWlCO0FBQ2ZBLElBQUFBLFdBQVcsQ0FBQ0UsSUFBWixDQUFpQjtBQUFBLGFBQU1DLDZCQUE2QixDQUFDUixHQUFELEVBQU1HLElBQU4s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O0FBQ0E7QUFDQTtBQUNBLE9BQU8sU0FBUzRELCtCQUFULENBQXlDdEQsR0FBekMsRUFBOENxRCxXQUE5QyxFQUEyRDtBQUNoRSxNQUFJckQsR0FBRyxDQUFDQyx1QkFBUixFQUFpQztBQUMvQixXQUFPRCxHQUFHLENBQUNDLHVCQUFKLENBQTRCb0QsV0FBNUIsQ0FBUDtBQUNEO0FBQ0Y7O0FBRUQ7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxPQUFPLFNBQVNFLHlCQUFULENBQW1DdkQsR0FBbkMsRUFBd0NxRCxXQUF4QyxFQUFxRDtBQUMxRCxNQUFNNUMsYUFBYSxHQUFHVCxHQUFHLENBQUNDLHVCQUExQjtBQUNBLFNBQVFRLGFBQWEsSUFBSUEsYUFBYSxDQUFDNEMsV0FBRCxDQUEvQixJQUFpRCxJQUF4RDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgMjAxNyBUaGUgQU1QIEhUTUwgQXV0aG9ycy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuICogeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZSB3aXRoIHRoZSBMaWNlbnNlLlxuICogWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICAgICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4gKiBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhbiBcIkFTLUlTXCIgQkFTSVMsXG4gKiBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTlkgS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC5cbiAqIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbiAqIGxpbWl0YXRpb25zIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5cbmltcG9ydCB7U2VydmljZXN9IGZyb20gJyNzZXJ2aWNlJztcblxuaW1wb3J0IHtleHRlbnNpb25TY3JpcHRzSW5Ob2RlfSBmcm9tICcuL2V4dGVuc2lvbi1zY3JpcHQnO1xuXG5pbXBvcnQge2NyZWF0ZUN1c3RvbUVsZW1lbnRDbGFzcywgc3R1YmJlZEVsZW1lbnRzfSBmcm9tICcuLi9jdXN0b20tZWxlbWVudCc7XG5pbXBvcnQge0VsZW1lbnRTdHVifSBmcm9tICcuLi9lbGVtZW50LXN0dWInO1xuaW1wb3J0IHtyZXBvcnRFcnJvcn0gZnJvbSAnLi4vZXJyb3ItcmVwb3J0aW5nJztcbmltcG9ydCB7dXNlckFzc2VydH0gZnJvbSAnLi4vbG9nJztcblxuLyoqIEB0eXBlIHshV2Vha01hcDwhLi9zZXJ2aWNlL2FtcGRvYy1pbXBsLkFtcERvYywgYm9vbGVhbj59ICovXG5jb25zdCBkb2NJbml0aWFsaXplZE1hcCA9IG5ldyBXZWFrTWFwKCk7XG5cbi8qKlxuICogQHBhcmFtIHshV2luZG93fSB3aW5cbiAqIEByZXR1cm4geyFPYmplY3Q8c3RyaW5nLCB0eXBlb2YgLi4vYmFzZS1lbGVtZW50LkJhc2VFbGVtZW50Pn1cbiAqL1xuZnVuY3Rpb24gZ2V0RXh0ZW5kZWRFbGVtZW50cyh3aW4pIHtcbiAgaWYgKCF3aW4uX19BTVBfRVhURU5ERURfRUxFTUVOVFMpIHtcbiAgICB3aW4uX19BTVBfRVhURU5ERURfRUxFTUVOVFMgPSB7fTtcbiAgfVxuICByZXR1cm4gd2luLl9fQU1QX0VYVEVOREVEX0VMRU1FTlRTO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhbiBlbGVtZW50LiBVcGdyYWRlcyBpdCBpZiBoYXMgcHJldmlvdXNseSBiZWVuIHN0dWJiZWQuXG4gKiBAcGFyYW0geyFXaW5kb3d9IHdpblxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqIEBwYXJhbSB7dHlwZW9mIC4uL2Jhc2UtZWxlbWVudC5CYXNlRWxlbWVudH0gdG9DbGFzc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdXBncmFkZU9yUmVnaXN0ZXJFbGVtZW50KHdpbiwgbmFtZSwgdG9DbGFzcykge1xuICBjb25zdCB3YWl0UHJvbWlzZSA9IHdhaXRSZWFkeUZvclVwZ3JhZGUod2luLCB0b0NsYXNzKTtcbiAgaWYgKHdhaXRQcm9taXNlKSB7XG4gICAgd2FpdFByb21pc2UudGhlbigoKSA9PiB1cGdyYWRlT3JSZWdpc3RlckVsZW1lbnRSZWFkeSh3aW4sIG5hbWUsIHRvQ2xhc3MpKTtcbiAgfSBlbHNlIHtcbiAgICB1cGdyYWRlT3JSZWdpc3RlckVsZW1lbnRSZWFkeSh3aW4sIG5hbWUsIHRvQ2xhc3MpO1xuICB9XG59XG5cbi8qKlxuICogUmVnaXN0ZXJzIGFuIGVsZW1lbnQuIFVwZ3JhZGVzIGl0IGlmIGhhcyBwcmV2aW91c2x5IGJlZW4gc3R1YmJlZC5cbiAqIEBwYXJhbSB7IVdpbmRvd30gd2luXG4gKiBAcGFyYW0ge3N0cmluZ30gbmFtZVxuICogQHBhcmFtIHt0eXBlb2YgLi4vYmFzZS1lbGVtZW50LkJhc2VFbGVtZW50fSB0b0NsYXNzXG4gKi9cbmZ1bmN0aW9uIHVwZ3JhZGVPclJlZ2lzdGVyRWxlbWVudFJlYWR5KHdpbiwgbmFtZSwgdG9DbGFzcykge1xuICBjb25zdCBrbm93bkVsZW1lbnRzID0gZ2V0RXh0ZW5kZWRFbGVtZW50cyh3aW4pO1xuICBpZiAoIWtub3duRWxlbWVudHNbbmFtZV0pIHtcbiAgICByZWdpc3RlckVsZW1lbnQod2luLCBuYW1lLCB0b0NsYXNzKTtcbiAgICByZXR1cm47XG4gIH1cbiAgaWYgKGtub3duRWxlbWVudHNbbmFtZV0gPT0gdG9DbGFzcykge1xuICAgIC8vIEFscmVhZHkgcmVnaXN0ZXJlZCB0aGlzIGluc3RhbmNlLlxuICAgIHJldHVybjtcbiAgfVxuICB1c2VyQXNzZXJ0KFxuICAgIGtub3duRWxlbWVudHNbbmFtZV0gPT0gRWxlbWVudFN0dWIsXG4gICAgJyVzIGlzIGFscmVhZHkgcmVnaXN0ZXJlZC4gVGhlIHNjcmlwdCB0YWcgZm9yICcgK1xuICAgICAgJyVzIGlzIGxpa2VseSBpbmNsdWRlZCB0d2ljZSBpbiB0aGUgcGFnZS4nLFxuICAgIG5hbWUsXG4gICAgbmFtZVxuICApO1xuICBrbm93bkVsZW1lbnRzW25hbWVdID0gdG9DbGFzcztcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdHViYmVkRWxlbWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBlbGVtZW50ID0gc3R1YmJlZEVsZW1lbnRzW2ldO1xuICAgIC8vIFRoZXJlIGFyZSAzIHBvc3NpYmxlIHN0YXRlcyBoZXJlOlxuICAgIC8vIDEuIFdlIG5ldmVyIG1hZGUgdGhlIHN0dWIgYmVjYXVzZSB0aGUgZXh0ZW5kZWQgaW1wbC4gbG9hZGVkIGZpcnN0LlxuICAgIC8vICAgIEluIHRoYXQgY2FzZSB0aGUgZWxlbWVudCB3b24ndCBiZSBpbiB0aGUgYXJyYXkuXG4gICAgLy8gMi4gV2UgbWFkZSBhIHN0dWIgYnV0IHRoZSBicm93c2VyIGRpZG4ndCBhdHRhY2ggaXQgeWV0LiBJblxuICAgIC8vICAgIHRoYXQgY2FzZSB3ZSBkb24ndCBuZWVkIHRvIHVwZ3JhZGUgYnV0IHNpbXBseSBzd2l0Y2ggdG8gdGhlIG5ld1xuICAgIC8vICAgIGltcGxlbWVudGF0aW9uLlxuICAgIC8vIDMuIEEgc3R1YiB3YXMgYXR0YWNoZWQuIFdlIHVwZ3JhZGUgd2hpY2ggbWVhbnMgd2UgcmVwbGF5IHRoZVxuICAgIC8vICAgIGltcGxlbWVudGF0aW9uLlxuICAgIGlmIChcbiAgICAgIGVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpID09IG5hbWUgJiZcbiAgICAgIGVsZW1lbnQub3duZXJEb2N1bWVudC5kZWZhdWx0VmlldyA9PSB3aW5cbiAgICApIHtcbiAgICAgIHRyeVVwZ3JhZGVFbGVtZW50KGVsZW1lbnQsIHRvQ2xhc3MpO1xuICAgICAgLy8gUmVtb3ZlIGVsZW1lbnQgZnJvbSBhcnJheS5cbiAgICAgIHN0dWJiZWRFbGVtZW50cy5zcGxpY2UoaS0tLCAxKTtcbiAgICB9XG4gIH1cbn1cblxuLyoqXG4gKiBUaGlzIG1ldGhvZCBzaG91bGQgbm90IGJlIGlubGluZWQgdG8gcHJldmVudCBUcnlDYXRjaCBkZW9wdGltaXphdGlvbi5cbiAqIEBwYXJhbSB7RWxlbWVudH0gZWxlbWVudFxuICogQHBhcmFtIHt0eXBlb2YgLi4vYmFzZS1lbGVtZW50LkJhc2VFbGVtZW50fSB0b0NsYXNzXG4gKiBAcHJpdmF0ZVxuICovXG5mdW5jdGlvbiB0cnlVcGdyYWRlRWxlbWVudChlbGVtZW50LCB0b0NsYXNzKSB7XG4gIHRyeSB7XG4gICAgZWxlbWVudC51cGdyYWRlKHRvQ2xhc3MpO1xuICB9IGNhdGNoIChlKSB7XG4gICAgcmVwb3J0RXJyb3IoZSwgZWxlbWVudCk7XG4gIH1cbn1cblxuLyoqXG4gKiBFbnN1cmVzIHRoYXQgdGhlIGVsZW1lbnQgaXMgcmVhZHkgZm9yIHVwZ3JhZGUuIEVpdGhlciByZXR1cm5zIGltbWVkaWF0ZWx5XG4gKiB3aXRoIGB1bmRlZmluZWRgIGluZGljYXRpbmcgdGhhdCBubyB3YWl0aW5nIGlzIG5lY2Vzc2FyeSwgb3IgcmV0dXJucyBhXG4gKiBwcm9taXNlIHRoYXQgd2lsbCByZXNvbHZlIHdoZW4gdGhlIHVwZ3JhZGUgY2FuIHByb2NlZWQuXG4gKlxuICogQHBhcmFtIHshV2luZG93fSB3aW5cbiAqIEBwYXJhbSB7dHlwZW9mIC4uL2Jhc2UtZWxlbWVudC5CYXNlRWxlbWVudH0gZWxlbWVudENsYXNzXG4gKiBAcmV0dXJuIHshUHJvbWlzZXx1bmRlZmluZH1cbiAqL1xuZnVuY3Rpb24gd2FpdFJlYWR5Rm9yVXBncmFkZSh3aW4sIGVsZW1lbnRDbGFzcykge1xuICAvLyBNYWtlIHN1cmUgdGhlIHBvbHlmaWxsIGlzIGluc3RhbGxlZCBmb3IgU2hhZG93IERPTSBpZiBlbGVtZW50IG5lZWRzIGl0LlxuICBpZiAoZWxlbWVudENsYXNzLnJlcXVpcmVzU2hhZG93RG9tKCkgJiYgIXdpbi5FbGVtZW50LnByb3RvdHlwZS5hdHRhY2hTaGFkb3cpIHtcbiAgICBjb25zdCBleHRlbnNpb25zID0gU2VydmljZXMuZXh0ZW5zaW9uc0Zvcih3aW4pO1xuICAgIHJldHVybiBleHRlbnNpb25zLmltcG9ydFVud3JhcHBlZCh3aW4sICdhbXAtc2hhZG93LWRvbS1wb2x5ZmlsbCcpO1xuICB9XG59XG5cbi8qKlxuICogU3R1YiBleHRlbmRlZCBlbGVtZW50cyBtaXNzaW5nIGFuIGltcGxlbWVudGF0aW9uLiBJdCBjYW4gYmUgY2FsbGVkIG11bHRpcGxlXG4gKiB0aW1lcyBhbmQgb24gcGFydGlhbCBkb2N1bWVudCBpbiBvcmRlciB0byBzdGFydCBzdHViYmluZyBhcyBlYXJseSBhc1xuICogcG9zc2libGUuXG4gKiBAcGFyYW0geyEuL2FtcGRvYy1pbXBsLkFtcERvY30gYW1wZG9jXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBzdHViRWxlbWVudHNGb3JEb2MoYW1wZG9jKSB7XG4gIGNvbnN0IGV4dGVuc2lvbnMgPSBleHRlbnNpb25TY3JpcHRzSW5Ob2RlKGFtcGRvYy5nZXRIZWFkTm9kZSgpKTtcbiAgZXh0ZW5zaW9ucy5mb3JFYWNoKCh7ZXh0ZW5zaW9uSWQsIGV4dGVuc2lvblZlcnNpb259KSA9PiB7XG4gICAgYW1wZG9jLmRlY2xhcmVFeHRlbnNpb24oZXh0ZW5zaW9uSWQsIGV4dGVuc2lvblZlcnNpb24pO1xuICAgIHN0dWJFbGVtZW50SWZOb3RLbm93bihhbXBkb2Mud2luLCBleHRlbnNpb25JZCk7XG4gIH0pO1xuICBpZiAoYW1wZG9jLmlzQm9keUF2YWlsYWJsZSgpKSB7XG4gICAgYW1wZG9jLnNldEV4dGVuc2lvbnNLbm93bigpO1xuICB9XG59XG5cbi8qKlxuICogU3R1YiBlbGVtZW50IGlmIG5vdCB5ZXQga25vd24uXG4gKiBAcGFyYW0geyFXaW5kb3d9IHdpblxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHN0dWJFbGVtZW50SWZOb3RLbm93bih3aW4sIG5hbWUpIHtcbiAgY29uc3Qga25vd25FbGVtZW50cyA9IGdldEV4dGVuZGVkRWxlbWVudHMod2luKTtcbiAgaWYgKCFrbm93bkVsZW1lbnRzW25hbWVdKSB7XG4gICAgcmVnaXN0ZXJFbGVtZW50KHdpbiwgbmFtZSwgRWxlbWVudFN0dWIpO1xuICB9XG59XG5cbi8qKlxuICogQ29waWVzIHRoZSBzcGVjaWZpZWQgZWxlbWVudCB0byBjaGlsZCB3aW5kb3cgKGZyaWVuZGx5IGlmcmFtZSkuIFRoaXMgd2F5XG4gKiBhbGwgaW1wbGVtZW50YXRpb25zIG9mIHRoZSBBTVAgZWxlbWVudHMgYXJlIHNoYXJlZCBiZXR3ZWVuIGFsbCBmcmllbmRseVxuICogZnJhbWVzLlxuICogQHBhcmFtIHshV2luZG93fSBwYXJlbnRXaW5cbiAqIEBwYXJhbSB7IVdpbmRvd30gY2hpbGRXaW5cbiAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjb3B5RWxlbWVudFRvQ2hpbGRXaW5kb3cocGFyZW50V2luLCBjaGlsZFdpbiwgbmFtZSkge1xuICBjb25zdCB0b0NsYXNzID0gZ2V0RXh0ZW5kZWRFbGVtZW50cyhwYXJlbnRXaW4pW25hbWVdO1xuICByZWdpc3RlckVsZW1lbnQoY2hpbGRXaW4sIG5hbWUsIHRvQ2xhc3MgfHwgRWxlbWVudFN0dWIpO1xufVxuXG4vKipcbiAqIFJlZ2lzdGVycyBhIG5ldyBjdXN0b20gZWxlbWVudCB3aXRoIGl0cyBpbXBsZW1lbnRhdGlvbiBjbGFzcy5cbiAqIEBwYXJhbSB7IVdpbmRvd30gd2luIFRoZSB3aW5kb3cgaW4gd2hpY2ggdG8gcmVnaXN0ZXIgdGhlIGVsZW1lbnRzLlxuICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgTmFtZSBvZiB0aGUgY3VzdG9tIGVsZW1lbnRcbiAqIEBwYXJhbSB7dHlwZW9mIC4uL2Jhc2UtZWxlbWVudC5CYXNlRWxlbWVudH0gaW1wbGVtZW50YXRpb25DbGFzc1xuICovXG5leHBvcnQgZnVuY3Rpb24gcmVnaXN0ZXJFbGVtZW50KHdpbiwgbmFtZSwgaW1wbGVtZW50YXRpb25DbGFzcykge1xuICBjb25zdCBrbm93bkVsZW1lbnRzID0gZ2V0RXh0ZW5kZWRFbGVtZW50cyh3aW4pO1xuICBrbm93bkVsZW1lbnRzW25hbWVdID0gaW1wbGVtZW50YXRpb25DbGFzcztcbiAgY29uc3Qga2xhc3MgPSBjcmVhdGVDdXN0b21FbGVtZW50Q2xhc3Mod2luLCBlbGVtZW50Q29ubmVjdGVkQ2FsbGJhY2spO1xuICB3aW5bJ2N1c3RvbUVsZW1lbnRzJ10uZGVmaW5lKG5hbWUsIGtsYXNzKTtcbn1cblxuLyoqXG4gKiBAcGFyYW0geyEuL2FtcGRvYy1pbXBsLkFtcERvY30gYW1wZG9jXG4gKiBAcGFyYW0geyFBbXBFbGVtZW50fSBlbGVtZW50XG4gKiBAcGFyYW0gez8odHlwZW9mIEJhc2VFbGVtZW50KX0gaW1wbGVtZW50YXRpb25DbGFzc1xuICogQHZpc2libGVGb3JUZXN0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBlbGVtZW50Q29ubmVjdGVkQ2FsbGJhY2soYW1wZG9jLCBlbGVtZW50LCBpbXBsZW1lbnRhdGlvbkNsYXNzKSB7XG4gIC8vIE1ha2Ugc3VyZSB0aGF0IHRoZSBhbXBkb2MgaGFzIGFscmVhZHkgYmVlbiBzdHViYmVkLlxuICBpZiAoIWRvY0luaXRpYWxpemVkTWFwLmhhcyhhbXBkb2MpKSB7XG4gICAgZG9jSW5pdGlhbGl6ZWRNYXAuc2V0KGFtcGRvYywgdHJ1ZSk7XG4gICAgc3R1YkVsZW1lbnRzRm9yRG9jKGFtcGRvYyk7XG4gIH1cblxuICAvLyBMb2FkIHRoZSBwcmUtc3R1YmJlZCBsZWdhY3kgZXh0ZW5zaW9uIGlmIG5lZWRlZC5cbiAgY29uc3QgZXh0ZW5zaW9uSWQgPSBlbGVtZW50LmxvY2FsTmFtZTtcbiAgaWYgKCFpbXBsZW1lbnRhdGlvbkNsYXNzICYmICFhbXBkb2MuZGVjbGFyZXNFeHRlbnNpb24oZXh0ZW5zaW9uSWQpKSB7XG4gICAgU2VydmljZXMuZXh0ZW5zaW9uc0ZvcihhbXBkb2Mud2luKS5pbnN0YWxsRXh0ZW5zaW9uRm9yRG9jKFxuICAgICAgYW1wZG9jLFxuICAgICAgZXh0ZW5zaW9uSWQsXG4gICAgICAvLyBUaGUgbGVnYWN5IGF1dG8tZXh0ZW5zaW9ucyBhcmUgYWx3YXlzIDAuMS5cbiAgICAgICcwLjEnXG4gICAgKTtcbiAgfVxufVxuXG4vKipcbiAqIEluIG9yZGVyIHRvIHByb3ZpZGUgYmV0dGVyIGVycm9yIG1lc3NhZ2VzIHdlIG9ubHkgYWxsb3cgdG8gcmV0cmlldmVcbiAqIHNlcnZpY2VzIGZyb20gb3RoZXIgZWxlbWVudHMgaWYgdGhvc2UgZWxlbWVudHMgYXJlIGxvYWRlZCBpbiB0aGUgcGFnZS5cbiAqIFRoaXMgbWFrZXMgaXQgcG9zc2libGUgdG8gbWFyayBhbiBlbGVtZW50IGFzIGxvYWRlZCBpbiBhIHRlc3QuXG4gKiBAcGFyYW0geyFXaW5kb3d9IHdpblxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnROYW1lIE5hbWUgb2YgYW4gZXh0ZW5kZWQgY3VzdG9tIGVsZW1lbnQuXG4gKiBAdmlzaWJsZUZvclRlc3RpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG1hcmtFbGVtZW50U2NoZWR1bGVkRm9yVGVzdGluZyh3aW4sIGVsZW1lbnROYW1lKSB7XG4gIGNvbnN0IGtub3duRWxlbWVudHMgPSBnZXRFeHRlbmRlZEVsZW1lbnRzKHdpbik7XG4gIGlmICgha25vd25FbGVtZW50c1tlbGVtZW50TmFtZV0pIHtcbiAgICBrbm93bkVsZW1lbnRzW2VsZW1lbnROYW1lXSA9IEVsZW1lbnRTdHViO1xuICB9XG59XG5cbi8qKlxuICogUmVzZXRzIG91ciBzY2hlZHVsZWQgZWxlbWVudHMuXG4gKiBAcGFyYW0geyFXaW5kb3d9IHdpblxuICogQHBhcmFtIHtzdHJpbmd9IGVsZW1lbnROYW1lIE5hbWUgb2YgYW4gZXh0ZW5kZWQgY3VzdG9tIGVsZW1lbnQuXG4gKiBAdmlzaWJsZUZvclRlc3RpbmdcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0U2NoZWR1bGVkRWxlbWVudEZvclRlc3Rpbmcod2luLCBlbGVtZW50TmFtZSkge1xuICBpZiAod2luLl9fQU1QX0VYVEVOREVEX0VMRU1FTlRTKSB7XG4gICAgZGVsZXRlIHdpbi5fX0FNUF9FWFRFTkRFRF9FTEVNRU5UU1tlbGVtZW50TmFtZV07XG4gIH1cbn1cblxuLyoqXG4gKiBSZXR1cm5zIGEgY3VycmVudGx5IHJlZ2lzdGVyZWQgZWxlbWVudCBjbGFzcy5cbiAqIEBwYXJhbSB7IVdpbmRvd30gd2luXG4gKiBAcGFyYW0ge3N0cmluZ30gZWxlbWVudE5hbWUgTmFtZSBvZiBhbiBleHRlbmRlZCBjdXN0b20gZWxlbWVudC5cbiAqIEByZXR1cm4gez9mdW5jdGlvbigpfVxuICogQHZpc2libGVGb3JUZXN0aW5nXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRFbGVtZW50Q2xhc3NGb3JUZXN0aW5nKHdpbiwgZWxlbWVudE5hbWUpIHtcbiAgY29uc3Qga25vd25FbGVtZW50cyA9IHdpbi5fX0FNUF9FWFRFTkRFRF9FTEVNRU5UUztcbiAgcmV0dXJuIChrbm93bkVsZW1lbnRzICYmIGtub3duRWxlbWVudHNbZWxlbWVudE5hbWVdKSB8fCBudWxsO1xufVxuIl19
// /Users/mszylkowski/src/amphtml/src/service/custom-element-registry.js