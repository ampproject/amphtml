import {waitForBodyOpenPromise} from '#core/dom';
import {setStyle} from '#core/dom/style';
import * as mode from '#core/mode';

import {isExperimentOn, toggleExperiment} from '#experiments';

import {shouldLoadPolyfill as shouldLoadInObPolyfill} from '#polyfills/stubs/intersection-observer-stub';
import {shouldLoadPolyfill as shouldLoadResObPolyfill} from '#polyfills/stubs/resize-observer-stub';

import {Services} from '#service';
import {
  installAmpdocServices,
  installRuntimeServices,
} from '#service/core-services';
import {stubElementsForDoc} from '#service/custom-element-registry';
import {
  installExtensionsService,
  stubLegacyElements,
} from '#service/extensions-impl';

import {
  dev,
  initLogConstructor,
  overrideLogLevel,
  setReportError,
} from '#utils/log';

import {BaseElement} from './base-element';
import {startupChunk} from './chunk';
import * as urls from './config/urls';
import {reportErrorForWin} from './error-reporting';
import {getMode} from './mode';
import {MultidocManager} from './multidoc-manager';
import {hasRenderDelayingServices} from './render-delaying-services';

import {cssText as ampDocCss} from '../build/ampdoc.css';
import {cssText as ampSharedCss} from '../build/ampshared.css';

initLogConstructor();
setReportError(reportErrorForWin.bind(null, self));

/** @const @private {string} */
const TAG = 'runtime';

/**
 * @typedef {{
 *  url: (string|undefined),
 *  title: (string|undefined),
 *  canonicalUrl: (string|undefined),
 *  head: (Element|undefined),
 *  ampdoc: (!./service/ampdoc-impl.AmpDoc | undefined),
 *  setVisibilityState: (function(!VisibilityState_Enum)|undefined),
 *  postMessage: (function()|undefined),
 *  onMessage: (function()|undefined),
 *  close: (function()|undefined),
 *  getState: (function()|undefined),
 *  setState: (function()|undefined),
 *  toggleRuntime: (function()|undefined),
 *  resources: (!./service/resources-interface.ResourcesInterface | undefined)
 * }}
 */
export let ShadowDoc;

/**
 * Applies the runtime to a given global scope for a single-doc mode. Multi
 * frame support is currently incomplete.
 * @param {!Window} global Global scope to adopt.
 * @param {function(!Window, !./service/extensions-impl.Extensions):!Promise} callback
 * @return {!Promise}
 */
function adoptShared(global, callback) {
  // Tests can adopt the same window twice. sigh.
  if (global.__AMP_TAG) {
    return Promise.resolve();
  }
  global.__AMP_TAG = true;
  // If there is already a global AMP object we assume it is an array
  // of functions
  /** @const {!Array<function(!Object)|!ExtensionPayload>} */
  const preregisteredExtensions = global.AMP || [];

  installExtensionsService(global);
  /** @const {!./service/extensions-impl.Extensions} */
  const extensions = Services.extensionsFor(global);
  installRuntimeServices(global);
  stubLegacyElements(global);

  global.AMP = {
    win: global,
    // Might not be available in tests.
    '_': global.AMP ? global.AMP['_'] : undefined,
  };

  // `AMP.extension()` function is only installed in a non-minified mode.
  // This function is meant to play the same role for development and testing
  // as `AMP.push()` in production.
  if (!mode.isMinified()) {
    /**
     * @param {string} unusedName
     * @param {string} unusedVersion
     * @param {function(!Object)} installer
     * @const
     */
    global.AMP.extension = function (unusedName, unusedVersion, installer) {
      installer(global.AMP);
    };
  }

  /**
   * @const {{
   *   urls: {
   *     thirdParty: string,
   *     thirdPartyFrameHost: string,
   *     thirdPartyFrameRegex: !RegExp,
   *     cdn: string,
   *     cdnProxyRegex: !RegExp,
   *     localhostRegex: !RegExp,
   *     errorReporting: string,
   *     betaErrorReporting: string,
   *     localDev: boolean,
   *     trustedViewerHosts: !Array<!RegExp>,
   *     geoApi: ?string,
   *   }
   * }}
   */
  global.AMP.config = {
    urls: {
      thirdParty: urls.thirdParty,
      thirdPartyFrameHost: urls.thirdPartyFrameHost,
      thirdPartyFrameRegex: urls.thirdPartyFrameRegex,
      cdn: urls.cdn,
      cdnProxyRegex: urls.cdnProxyRegex,
      localhostRegex: urls.localhostRegex,
      errorReporting: urls.errorReporting,
      betaErrorReporting: urls.betaErrorReporting,
      localDev: urls.localDev,
      trustedViewerHosts: urls.trustedViewerHosts,
      geoApi: urls.geoApi,
    },
  };

  global.AMP.BaseElement = BaseElement;

  global.customLineItems = ["-1","5069762556","5069765013","5069951908","5070227006","5069952130","5069952361","5069952406","5069952874","5069771715","5069772135","5069764497","5069764521","5070228932","5070229667","5069946127","5069768109","5069765235","5069946193","5069772888","5069946214","5069776491","5069776743","5069946664","5069946685","5069777259","5069956303","5069943778","5070220301","5070220454","5069957719","5069758005","5069958217","5070234956","5069765460","5069758014","5069767803","5069958904","5070220547","5069776041","5069765667","5069947081","5069778876","5069947171","5069778915","5069947153","5069947426","5069758023","5069779389","5069947624","5069765907","5069766123","5069766141","5070220967","5069766192","5070221012","5070221273","5069766477","5069763354","5069948629","5069948779","5069782539","5070222167","5069948824","5070221693","5070222443","5069961982","5069767194","5070223610","5070222944","5070223814","5069767644","5069767665","5070240137","5069949304","5070224048","5070224114","5070224297","5070224795","5070224864","5069961073","5070224537","5069768592","5069768787","5070224603","5069950516","5069950729","5069950051","5069950972","5069963173","5069950207","5069769732","5069769267","5070225815","5070226466","5069951683","5321139547","5636163753","5321138584","5636163756","5321510876","5636163759","5321139550","5636163762","5321139553","5636163765","5320271931","5636163768","5321138587","5637690206","5321139556","5636163771","5321502419","5636163774","5321139559","5636163777","5321139562","5636163780","5321138611","5636163975","5321531675","5636163978","5321531678","5637218314","5321531681","5636163981","5321138614","5636163984","5321531684","5637218317","5321137876","5636163987","5321531687","5636163990","5321138617","5637204631","5321531690","5636163993","5321531693","5636163996","5321138620","5636140254","5321531696","5636163999","5321531699","5636164002","5321531702","5637218320","5321138623","5636164005","5321137879","5636164008","5321531705","5637204634","5321531708","5636164011","5321138626","5636164014","5321139574","5637220720","5321531750","5637220723","5321531753","5637220726","5321139577","5637220729","5321531756","5637220732","5321531759","5637220735","5321137888","5637220738","5321139580","5637220741","5321531882","5637220744","5321531885","5637220747","5321531888","5637220750","5321139583","5637220753","5321531891","5637220756","5321531894","5637220759","5321139586","5637220762","5321531897","5637220765","5321531900","5637220768","5321139589","5637220771","5321531903","5637220774","5321137891","5637220777","5321531948","5637220966","5321531951","5637220969","5321139730","5637220972","5321531954","5637220975","5321531957","5637220978","5321139733","5637220981","5321531960","5637220984","5321137900","5637220987","5321531963","5637220990","5321139736","5637220993","5321531966","5637220996","5321531969","5637220999","5321531972","5637221002","5321139739","5637221005","5321531975","5637221008","5321137903","5637221011","5321531978","5637221014","5321139742","5637221017","5321531981","5637221020","5321531984","5637221023","5321139763","5637221215","5321532152","5637221218","5321532155","5637221221","5321139766","5637221224","5321532158","5637691562","5321137915","5637691565","5321139838","5637691568","5321139961","5637691571","5321139769","5637691574","5321139964","5637691577","5321139967","5637691580","5321139772","5637691583","5321139970","5637691586","5321139973","5637690212","5321137918","5637691589","5321139976","5637691592","5321139775","5637691595","5321139979","5637691598","5321139982","5637691601","5321139985","5637691604","5321139799","5637691679","5321140027","5637691802","5321140030","5637691805","5321139802","5637691808","5321140033","5637691811","5321138047","5637691814","5321140036","5637691817","5321139805","5637691820","5321140039","5637691823","5321140042","5637691826","5321139808","5637691829","5321140045","5637691832","5321140048","5637691835","5321139811","5637691838","5321138050","5637691841","5321140051","5637691844","5321140054","5637691847","5321139817","5637691850","5321140057","5637691853","5321140060","5637691856","5321140225","5636164761","5321138059","5636158215","5321140228","5636164764","5321532164","5636164767","5321140231","5636164770","5321140234","5636164776","5321140237","5636164779","5321532167","5637690230","5321140240","5636164782","5321140243","5636164785","5321532170","5636164788","5321140246","5636164791","5321138062","5636164797","5321140249","5636164920","5321140252","5636164923","5321532173","5636164926","5321140255","5636164929","5321140258","5636164932","5321140261","5636164935","5321532176","5636164938","5321532197","5636165172","5321140303","5636165175","5321140306","5636165178","5321532200","5636165181","5321140309","5636165184","5321140312","5636165187","5321532203","5636165190","5321140315","5636165196","5321140318","5636165199","5321138074","5636165202","5321532206","5636165205","5321140441","5636165208","5321140444","5636165211","5321532209","5636165214","5321140447","5636165217","5321140450","5636165220","5321532212","5636165223","5321140453","5637690236","5321138077","5636165226","5321140456","5636165229","5321532701","5636158239","5321532236","5637692288","5321532704","5637692291","5321532707","5636158242","5321532239","5637692294","5321532710","5637692297","5321532713","5636158245","5321532362","5637692300","5321532716","5637692303","5321138089","5636158248","5321532719","5637692306","5321532365","5637692309","5321532842","5636158251","5321532845","5637692312","5321532368","5637692315","5321532848","5636158254","5321532851","5637692318","5321532371","5637692321","5321532857","5636158257","5321138092","5637692324","5321532920","5637692549","5321532923","5637692552","5320296417","5637692555","5321532926","5637692558","5321532404","5637692561","5321532929","5637692564","5321532932","5637692567","5321532407","5637692570","5321532935","5636158260","5321532938","5637692573","5320296420","5637692576","5321532941","5637692579","5321532410","5637692582","5321532944","5637692585","5321532947","5637692588","5321532413","5637692591","5321532950","5637692594","5321532953","5637692597","5320296423","5636162073","5321533436","5637222901","5321533439","5637222904","5320296843","5637222907","5320297800","5637222910","5321533562","5637222913","5321533565","5637222916","5320297803","5636158443","5321533568","5637222919","5320296846","5637222922","5321533571","5637222925","5320297806","5637222928","5321533574","5637222931","5321533577","5637222934","5320297809","5637222937","5321533580","5637222940","5320296849","5637222943","5321533583","5637222946","5320297827","5636162139","5321533619","5637223156","5321533622","5637223159","5321532956","5637692600","5321532434","5637221404","5321533121","5637221407","5320296435","5637221410","5321533124","5637221413","5321532437","5637221416","5321533127","5637221419","5321533130","5637221422","5321532440","5636162079","5321533133","5637221425","5321533136","5637221428","5321532443","5637221431","5320296438","5637221434","5321533139","5637221437","5321533142","5637221440","5321533145","5636158263","5321532446","5637221443","5321533148","5637221446","5321533151","5637221449","5321532449","5637221452","5321533154","5637221455","5321511008","5636158266","5320296447","5637221656","5321533322","5636162085","5321511011","5637221659","5321533325","5637221662","5321532467","5637221665","5321511014","5637221668","5321533328","5637221671","5321533331","5637221674","5320271946","5637221677","5321532473","5637221680","5321533334","5637221683","5321511017","5637221686","5321533337","5637221689","5320296450","5637221692","5321511020","5637221695","5321533343","5637221698","5321532476","5637221701","5321511023","5637221704","5321533346","5637221707","5320296459","5637692786","5321141185","5636162091","5321141188","5637692789","5321532614","5637692792","5321141191","5636158272","5321141194","5637692795","5321532617","5637692798","5321141197","5637692801","5321141200","5637692804","5320296462","5637692807","5321141203","5637692810","5321532620","5637692813","5321141206","5637692816","5321141209","5637692819","5321532623","5637692822","5321141212","5637692825","5321141215","5637692828","5321141218","5637692831","5321532626","5637692834","5320296465","5637692837","5321532662","5637693035","5320296600","5637693041","5321141419","5637693044","5321141422","5637693047","5321141425","5637693050","5321532665","5636158275","5321141428","5637693053","5321141431","5637693056","5321532668","5637693059","5320296603","5637693062","5321141434","5637693065","5321141437","5637693068","5321141440","5637693071","5321532671","5637693074","5321141443","5637693077","5321141446","5637693080","5321532674","5637693083","5320296606","5636162097","5321141449","5637693086","5321141452","5637693089","5321141491","5637693284","5321532692","5637693287","5321141494","5637693290","5321141497","5637693293","5321141500","5637693296","5321532695","5637693299","5320296618","5637221887","5321141503","5637221890","5321141506","5637221893","5321532698","5637221896","5321141509","5637221899","5321141512","5637221902","5320297347","5637221905","5321141515","5637221908","5320296621","5637221911","5321141518","5637221914","5321141641","5636162103","5320297350","5637221917","5321141644","5637221920","5320297830","5637223162","5321533625","5637223165","5320296864","5637223168","5321533628","5637223171","5321533631","5637223174","5320297833","5637223177","5321533634","5636158449","5320296867","5637223180","5321533637","5637223183","5320297836","5637223186","5321141647","5637221923","5320296633","5637222124","5320297908","5637222127","5320297383","5636162109","5320297911","5637222130","5320297914","5636158284","5320297386","5637222133","5320297917","5637222136","5320298040","5637222139","5320296636","5637222142","5320297392","5637222145","5320298043","5637222148","5320298046","5637222151","5320297395","5637222154","5320298049","5637222157","5320298052","5637222160","5320296639","5637222163","5320297398","5637222166","5320298055","5637222169","5320298058","5637222172","5321533640","5637223189","5321533643","5637223192","5320297839","5637223195","5321533646","5637223198","5320296870","5637223321","5321533649","5637223324","5320297401","5637222175","5320298094","5637222391","5320297422","5637222394","5320298097","5637222397","5320298100","5637222400","5320297425","5637222403","5320298103","5637222406","5320296654","5637222409","5320298106","5637222412","5320297428","5637222415","5320298109","5637222418","5320298112","5637222421","5320298115","5637222424","5320297431","5636165277","5320298118","5636165400","5320298121","5636165406","5320297434","5636165409","5320296657","5636165412","5320298124","5636165415","5320298127","5636165418","5320297437","5636158293","5320298286","5636165505","5320298289","5636165508","5320297578","5636165511","5320296669","5636165514","5320298292","5636165517","5320298295","5636165640","5320298298","5636165643","5320297581","5636165646","5320298301","5636158299","5320296672","5636165649","5320298304","5636165652","5320297584","5636165655","5320298307","5636165658","5320298310","5636165661","5320298313","5636165664","5320297587","5636165667","5320296675","5636165670","5320298316","5636165673","5320298319","5636165676","5320297590","5636165679","5320298355","5636165751","5320298358","5636165754","5320297611","5636165757","5320298361","5636165880","5320298364","5636165883","5320296687","5636165886","5320297614","5636165889","5320298367","5636165892","5320298370","5636165895","5320297617","5636165898","5320298373","5636165901","5320298376","5636165904","5320296690","5636165907","5320298379","5636158305","5320297620","5636165910","5320298382","5636165913","5320298385","5636165916","5320297623","5636165919","5320298388","5636165922","5320296693","5636165925","5320298544","5637222625","5321533361","5637222628","5320297644","5637222631","5321533364","5637222634","5321533367","5637222637","5321533370","5637222640","5320297647","5637222643","5320296708","5636158317","5321533373","5637222646","5321533376","5637222649","5320297650","5637222652","5321533379","5637222655","5321533382","5637222658","5320297653","5637222661","5321533385","5637222667","5320296711","5636162130","5321533388","5637222670","5320297656","5637222673","5321533391","5637222676","5321533394","5637222679","5321533430","5636162136","5321533433","5637222895","5320297677","5637222898","5138710722","5138906527","5138906533","5138710740","5138711007","5138710743","5138711010","5138710746","5138906536","5138710749","5138711013","5138710752","5138711016","5138906539","5138710755","5138711019","5138710992","5138710758","5138711022","5138710761","5138906542","5138710764","5138711025","5138710767","5138711028","5138710770","5138906545","5138711031","5138710773","5138710725","5138710995","5138710728","5138906530","5138710998","5138710731","5138710734","5138711001","5138710737","5138711004","5138712930","5138889979","5138908048","5138713137","5139412955","5138712933","5138908051","5138705478","5138712936","5138713140","5138889982","5138908054","5138712939","5139412958","5138713143","5138908057","5139426176","5138712942","5138908060","5138889985","5138713146","5138712945","5139426179","5138908063","5138712948","5139412961","5138713149","5138908066","5138889988","5138908696","5138908069","5139426182","5138713152","5138908699","5139412964","5138908072","5138908702","5138889991","5138713155","5138908075","5139426185","5138908705","5138908078","5139412967","5138713158","5138908708","5138889994","5138908201","5138713161","5139426188","5138908711","5138908204","5138889997","5138908714","5138713164","5139412970","5138908207","5138908717","5139426191","5138712900","5138712393","5138705463","5138712903","5138713116","5139412943","5138712396","5138712906","5138889967","5138713119","5138712399","5138705466","5138712909","5138712402","5139412946","5138713122","5138712912","5138889970","5138712405","5138712915","5138705469","5138713125","5138712408","5138889973","5138712918","5138713128","5139412949","5138908036","5138712921","5138705472","5138908039","5138712924","5138889976","5138713131","5138908042","5139412952","5138712927","5138713134","5138705475","5138908045","5138719431","5139432407","5138914279","5138912809","5138720064","5138914282","5138719434","5138913586","5138914285","5138912812","5138720067","5138719437","5138914288","5139432410","5138719560","5138912815","5138913589","5138914291","5138719563","5138720070","5138914294","5138912818","5139432413","5138719566","5138914297","5138913592","5138912821","5138914300","5138720073","5138719569","5138914303","5139432416","5138719572","5138912824","5138913595","5138914306","5138719575","5138720076","5139432419","5138913598","5138914309","5138720079","5138912827","5139432422","5138719578","5138913721","5138720082","5138914312","5139432425","5138912830","5138720085","5138913724","5139432428","5138719581","5138720088","5138914315","5138913727","5138914318","5139432431","5138720091","5138719584","5138913730","5138912833","5139432434","5138720094","5138913733","5138914444","5139432437","5138719587","5138720097","5138912836","5138913736","5139432440","5138914447","5138720100","5138719590","5138913739","5138720103","5139432443","5138914450","5138913742","5138912839","5138720106","5138719593","5139432446","5138913745","5138914453","5138720109","5138719596","5139432449","5138913748","5138720112","5138914456","5139432452","5138912842","5138720115","5138914459","5138913751","5139432455","5138721501","5138721504","5139433835","5138916139","5138720385","5138721507","5138721510","5139433838","5138915206","5138721513","5138721516","5139433841","5138721519","5138916142","5138721522","5139433844","5138721525","5138721528","5138915458","5138720388","5139433847","5138721531","5138721534","5138915209","5139433850","5138721537","5138721540","5138721543","5138916145","5139433853","5138721546","5138721549","5139433856","5138915212","5138721552","5138720391","5138721555","5139433859","5138915461","5138721558","5138721561","5139433862","5138721564","5138916148","5138721567","5139433865","5138721570","5138721573","5138915215","5139433868","5138720394","5138721576","5138721579","5138916151","5139433871","5138721582","5138721585","5139433874","5138915218","5138721588","5138721591","5138721594","5139433877","5138915464","5138721597","5138720520","5138721720","5139433880","5138916154","5138721723","5138721726","5139433883","5138721729","5138915224","5138721732","5139433886","5138721735","5138721738","5138916157","5139433892","5138721741","5138720523","5138721744","5138915467","5139433895","5138721747","5138721750","5139433898","5138915230","5138721753","5138721756","5139433901","5138721759","5138916163","5138721762","5138720526","5138721765","5139433904","5138915233","5138721768","5138721345","5138916667","5138722950","5139434783","5139436043","5138916670","5138722551","5138722953","5138723751","5138721348","5138916673","5138916676","5139434786","5138723754","5138722956","5138722554","5138916679","5138723757","5138916706","5138722959","5138916682","5138722557","5138916685","5138723880","5139434789","5138722962","5138916688","5138916709","5138723883","5138722965","5138722680","5138916691","5138723886","5138916712","5138722968","5138916694","5139434792","5138916697","5138723889","5138722683","5138722971","5138916700","5138916715","5138723892","5138722974","5139434795","5138916703","5138723895","5138722686","5138917366","5138722977","5138916718","5138917369","5138723898","5138722689","5138722980","5138917372","5139434798","5138723901","5138722983","5138916841","5138917375","5138723904","5138722692","5138917378","5138722986","5138916844","5138917381","5138723907","5139434801","5138722989","5138917384","5138722695","5138723910","5138917387","5138916847","5138722992","5138723913","5139434804","5138917390","5138722995","5138722698","5138917393","5138723916","5138916850","5138722998","5138917396","5138722701","5138723919","5138917399","5139434807","5138723001","5138917402","5138916853","5138723922","5138723004","5138722704","5138917405","5138723925","5138916856","5138919031","5139436739","5138919574","5138919034","5138919037","5138723517","5139436742","5138918041","5139436481","5138919040","5138919556","5139436715","5138918872","5138723505","5138917906","5138918875","5139436469","5139436718","5138918878","5138919559","5139436721","5138919001","5138723508","5138917909","5138919004","5138919562","5139436724","5138919007","5139436472","5138919010","5139436727","5138919565","5138917912","5138919013","5138723511","5138919016","5139436730","5139436475","5138919019","5138917915","5138919568","5139436733","5138919022","5138723514","5138919025","5139436736","5138919571","5138919028","5138917918","5139436478","5138922445","5139438458","5139439835","5138726580","5138920768","5139438461","5138922448","5139439838","5138920771","5138921923","5139438464","5139439841","5138726583","5138920774","5139439844","5138922451","5139438467","5138920777","5138922454","5139439847","5139438470","5138726586","5139439850","5138920780","5138922457","5139438473","5139439853","5138726589","5138920783","5139438476","5138921926","5139439856","5139438479","5138922460","5138920786","5139439859","5138726592","5139438602","5138920789","5138922463","5139439862","5139438605","5138922466","5139439865","5138920792","5138726595","5139438608","5139439868","5138921929","5138920795","5139439871","5711307552","5711301765","5465655738","5635814073","5637270458","5637270461","5637317918","5635814076","5637270464","5635814079","5637270467","5635814082","5637270470","5635805505","5637270473","5635814085","5637270476","5637270479","5637317921","5635814088","5636791894","5635814091","5637270602","5635814094","5637270605","5635814097","5637270608","5635814100","5637270611","5637270614","5637317924","5635814103","5637270617","5635814106","5637270620","5635814109","5637270623","5635814112","5637270626","5635760607","5637317927","5635814115","5637270629","5635814118","5636797087","5635814121","5636797090","5635814124","5636797093","5636797096","5637317930","5635814127","5636797099","5635814130","5636797102","5635814133","5636797105","5635814136","5636797108","5635760610","5635814139","5636797111","5637317933","5635814142","5636797114","5635814145","5636797117","5635814148","5636797120","5635814151","5636797123","5636797126","5637317936","5635814154","5636797129","5635814157","5636797132","5635760613","5635814280","5635814283","5636797135","5636797138","5637317939","5635814286","5636797141","5635814289","5636797144","5635814292","5636797147","5635814295","5636797150","5635814298","5636797153","5636797156","5637317942","5635814301","5636797159","5635760616","5635814304","5635814307","5636797162","5635814310","5636797165","5636789020","5637317945","5635814313","5636797168","5635814316","5636797171","5635814319","5636797174","5635814322","5636797177","5636797180","5637317948","5635814325","5636797183","5635814328","5636797186","5635760619","5635814331","5635814334","5636797189","5635814337","5636797192","5636797195","5637317951","5635814340","5636797198","5635814343","5636797321","5635814346","5636797324","5635814349","5636797327","5636797330","5637317954","5635760622","5635814352","5635814355","5636797333","5635814358","5636797336","5635814361","5636797339","5636797342","5637317957","5635814364","5636797345","5635814367","5636797348","5635814370","5636797351","5635805508","5636797354","5635814373","5636797357","5635760625","5637317960","5635814376","5636797360","5635814379","5636797363","5635814382","5636797366","5635814385","5636797369","5635814388","5636797372","5636797375","5637317963","5635814391","5636797378","5635814394","5636797381","5635814397","5636797384","5635760631","5635814520","5636797387","5637317966","5635814523","5636797390","5635814526","5636797393","5635814529","5636797396","5635814532","5636797399","5636797402","5637317969","5635814535","5636797405","5635814538","5636797408","5635814541","5636797411","5635760634","5635814544","5635814547","5636797414","5636797417","5637319562","5635814550","5636797420","5635814553","5636797423","5635814556","5636797426","5635814559","5636797429","5636797435","5637319565","5635814562","5636789023","5635814565","5636797438","5635760637","5635814568","5635814571","5636797561","5636797564","5637319568","5635814574","5636797567","5635814577","5636797570","5635814580","5636797573","5635814583","5636797576","5635814586","5636797579","5636797582","5637319571","5635814589","5636797585","5635760760","5635814592","5635814595","5636797588","5635814598","5636797591","5636797594","5637319574","5635814601","5636797597","5635814604","5636797600","5636797603","5637320102","5636797606","5637320105","5636797609","5637319577","5636797612","5637320108","5635760763","5637320111","5636797615","5637320114","5636797618","5637320117","5636797621","5637320120","5636797624","5637319580","5636797627","5637320123","5636797630","5637320126","5636797633","5637320129","5636797636","5637320132","5636797639","5637319583","5635760766","5637320135","5636797642","5637320138","5636797645","5637320141","5636797648","5637320144","5636797651","5637319586","5636797654","5637320147","5636797657","5637320150","5635805511","5636797660","5636797663","5637320153","5635760769","5637320156","5636797666","5637320159","5636797669","5637319589","5636797672","5637320282","5636797675","5637320285","5636797678","5637320288","5636797801","5637320291","5636797804","5637319592","5636797807","5637320294","5636797810","5637320297","5635760772","5637320300","5636797813","5637320303","5636797816","5637319595","5636797819","5637320306","5636789026","5637320309","5636797822","5637320312","5636797825","5637320315","5636797828","5637320318","5636797831","5637319598","5636797834","5637320321","5636797837","5637320324","5635760775","5637320327","5636797840","5637320330","5636797843","5637319601","5636797846","5637320333","5636797849","5637320336","5636797852","5637320339","5636797855","5637320342","5636797858","5637319604","5636797861","5637320345","5636797864","5637320348","5635760778","5637320351","5636797867","5637320354","5636797870","5637319607","5636797873","5637320357","5636797876","5637320360","5636797879","5637320363","5636797882","5637320366","5636797885","5637320369","5636797888","5637319610","5635760781","5637320372","5636797891","5637320375","5636797894","5637320378","5635761807","5637320381","5635761810","5637319613","5635761813","5637320384","5635761816","5637320387","5635761819","5637320390","5635761822","5637320393","5635761825","5637319616","5635760784","5637320396","5635761828","5637320399","5635761831","5637320522","5635786209","5636139315","5635786212","5637670988","5635786215","5636139318","5635786218","5637670991","5635786221","5636139321","5635786224","5637670994","5635786227","5636139324","5635786230","5637670997","5635786233","5637671000","5635786236","5636139327","5635786239","5637671003","5635786242","5636139330","5637282227","5637671006","5635786245","5636139333","5635786248","5637671009","5635786251","5636139336","5635786254","5637671012","5635786257","5637671015","5635786260","5636139339","5635786263","5637671018","5635786266","5636139342","5635786269","5637671021","5635786272","5636139345","5635786275","5637671024","5635786278","5636139348","5635786281","5637671027","5635786284","5637671030","5636139351","5637282230","5635786287","5637671033","5635786290","5636139354","5635786293","5637671036","5635786296","5636139357","5635786299","5637671039","5635786302","5636139480","5635786305","5635786308","5637671165","5635786311","5636139483","5635786314","5637669737","5635786317","5637671168","5635786440","5636139486","5635786443","5637671171","5635786446","5636139489","5637282233","5637671174","5635786449","5636139492","5635786452","5637671177","5635786455","5635786458","5636139495","5635786461","5637671183","5635786464","5636139498","5635786467","5637671186","5635786470","5636139501","5635786473","5637671189","5635786476","5636139504","5635786479","5637671192","5635786482","5637671195","5635786485","5636139507","5635786488","5637671198","5636139510","5637282236","5635786491","5637671201","5635786494","5636139513","5635786497","5637671204","5635786500","5635786503","5637671207","5635786506","5637671210","5635786509","5636139519","5635786512","5635786515","5636139522","5635786521","5637671216","5635786524","5636139525","5635786527","5637671219","5635786530","5636139528","5635786533","5637671222","5637282239","5637671225","5635786536","5636139531","5635786539","5637671228","5635786542","5635786545","5637671231","5635786548","5637671432","5635786551","5637671234","5635786554","5637671435","5635786557","5637671237","5635786680","5637669740","5635786683","5637671240","5635786686","5637671438","5635786689","5637671243","5635786692","5637671441","5635786695","5637671246","5637282362","5637671444","5635786698","5635786701","5637671447","5635786704","5637671252","5635786707","5637671255","5635786710","5637671450","5635786713","5635786716","5637671453","5635786719","5635786722","5637671456","5635786725","5635786728","5637671459","5635786731","5637671267","5637212803","5637294365","5636153709","5637294368","5636153712","5637294371","5637212806","5637294374","5637294377","5637685334","5636153715","5637294380","5635792077","5637212809","5636153718","5637294383","5636153721","5637294386","5637212812","5637294389","5637294392","5637685337","5636153724","5637294395","5637212815","5637294398","5636153727","5637294401","5636153730","5637294404","5637212818","5637294407","5637294410","5637685340","5636153733","5637294413","5636140209","5637294416","5636153736","5637294419","5635792200","5636153739","5637212821","5637294422","5637294425","5637685343","5636153742","5637294428","5637212824","5637294431","5636153745","5637294434","5636153748","5637294440","5637213757","5637294443","5636153751","5637294446","5637294449","5637213760","5637294452","5636153754","5637294455","5636153757","5637294458","5637213763","5637294461","5635792203","5637294464","5637685349","5637213766","5637294467","5637294470","5636153886","5637294473","5637213769","5637294476","5636153889","5637294479","5637294602","5637685352","5637213772","5637294605","5637294608","5636153895","5637294611","5637213775","5637294614","5636153898","5637294617","5635792206","5636153901","5637213778","5637294620","5637294623","5637685355","5635761834","5635761837","5637638879","5635761960","5635761963","5637639002","5635761966","5635760787","5637639005","5635761969","5635761972","5637639008","5635761975","5635761978","5637639011","5635761981","5635761984","5637639014","5636789029","5635761987","5637639017","5635760790","5635761990","5637639020","5635761993","5635761996","5637639023","5635761999","5635762002","5637639026","5635762005","5635762008","5637639029","5635760793","5635762011","5637639032","5635762014","5635762017","5637639035","5635762020","5635762023","5637639038","5635762026","5635762029","5637639041","5635762032","5635760796","5637639044","5635762035","5635762038","5637639047","5635762041","5635762044","5637639050","5635762047","5635762050","5637639053","5635762053","5635760799","5637639056","5635762056","5635762059","5637639059","5635762062","5635762065","5637639062","5635762068","5635762071","5637639065","5635762074","5635760802","5637639068","5635762077","5635762200","5637639071","5635762203","5635762206","5637639074","5635762209","5636789032","5637639077","5635762212","5635762215","5637639080","5635760805","5635762218","5637639083","5635762221","5635762224","5637639086","5635762227","5635762230","5636103576","5635762233","5635762236","5637639089","5635760808","5635762239","5637639092","5635762242","5635762245","5637639095","5635762248","5635762251","5637639098","5635762254","5635762257","5637639101","5635760811","5635762260","5637639104","5635762263","5635762266","5637639107","5635762272","5635762275","5637639110","5635762278","5635762281","5637639113","5635760814","5635762284","5637639116","5635762287","5635762290","5637639119","5635762293","5635762296","5637639242","5635762299","5635762302","5637639245","5635760817","5635762305","5637639248","5635762308","5635762311","5637639251","5635762314","5635762317","5637639254","5636789035","5635762440","5637639257","5635762443","5635760820","5637639260","5635762446","5635762449","5636153904","5637294626","5637639263","5636804380","5637639266","5636804383","5637639269","5636804386","5637639272","5636804389","5637639275","5636804392","5637639278","5636804395","5637639281","5636804398","5637639284","5636804521","5637639287","5636804524","5637639290","5636804527","5637639293","5636804530","5637639296","5636804533","5637639299","5636108607","5636804536","5636108610","5636804539","5636108613","5636804542","5636108616","5636804545","5636108619","5636804548","5636108622","5636804551","5636108625","5636804554","5636108628","5637274502","5636108631","5637274505","5637274508","5637628043","5636108634","5636801173","5636108637","5637274511","5636108760","5637274514","5636108763","5637274517","5636108766","5637274520","5636108769","5637274523","5636108772","5637274526","5636108775","5637274529","5636108778","5637274532","5636108781","5637274535","5636108784","5637274538","5636108787","5637274541","5636108790","5637274544","5636108793","5637274547","5636108796","5637274550","5636103579","5637274553","5636108799","5637274556","5636108802","5637274559","5636108805","5637274682","5636108808","5637274685","5636108811","5637274688","5636108814","5637274691","5636108817","5637274694","5636108820","5636801176","5636108823","5637274697","5636108826","5637274700","5636108829","5637274703","5636108832","5637274706","5636108835","5637274709","5636108838","5637274712","5636108841","5637274715","5636108844","5637274718","5636108847","5637274721","5636108850","5637274724","5636108853","5637274727","5636108856","5637274730","5636108859","5637274733","5636108862","5637274736","5636108865","5637274739","5636108868","5637274742","5636108871","5637274745","5636108874","5637274748","5636108877","5637274751","5636109000","5637274754","5636109003","5637274757","5636109006","5637274760","5636109009","5636801179","5636109012","5637274763","5636109015","5637274766","5636109018","5637274769","5636109021","5637274772","5636109024","5637274775","5636109027","5637274778","5636109033","5637274781","5636109036","5637274784","5636109039","5637274787","5636109042","5637274790","5636109045","5637274793","5636109048","5637274796","5636109051","5637274799","5636109054","5637274922","5636109057","5637274925","5636109060","5637274928","5636109063","5637274931","5636109066","5637274934","5636109069","5637274937","5636109072","5637274940","5636109078","5637274943","5636109081","5637274946","5636109084","5637274949","5636109087","5636801182","5636103582","5637274952","5636109090","5637274955","5636109093","5637274958","5636109096","5637274961","5636109099","5637274964","5636109102","5637274967","5636109105","5637274970","5636809126","5637183823","5636809129","5637183826","5636809132","5637183829","5636809135","5637182842","5636809138","5637183832","5636809141","5637183835","5636809144","5637183838","5636809147","5637183961","5636809150","5637183964","5636809153","5637182845","5636809159","5637183967","5636809162","5637183970","5636809165","5637183973","5636809168","5637183976","5635774743","5637183979","5636809171","5637182848","5636809174","5637183982","5636809177","5637183985","5636809180","5637183988","5636809183","5637183991","5636809186","5637183994","5636809189","5637182851","5636809192","5637183997","5636809195","5637184000","5636809198","5637184003","5636809321","5637184006","5636809324","5637184009","5636809327","5637182854","5636809330","5637184012","5635774746","5637184015","5636809333","5637184018","5636809336","5637184021","5636809339","5637184024","5636809342","5637182857","5636127807","5636809345","5636127810","5636809348","5636127813","5636809351","5635775277","5636127816","5635775400","5636127819","5635775403","5637182860","5635775406","5636127822","5635775409","5636127825","5635775412","5636127828","5635775415","5636127831","5635774749","5636127834","5635775418","5637182863","5635775421","5636127837","5635775424","5636127960","5635775427","5636127963","5635775430","5636127966","5635775433","5636127969","5635775436","5637182866","5635775439","5636127972","5635775442","5636127975","5635775445","5636127978","5635775448","5636127981","5635775451","5636127984","5635775454","5637182869","5635775457","5636127987","5635774752","5636127990","5635775460","5636127993","5635775463","5636127996","5635775466","5636127999","5635775469","5637182872","5635775472","5636128002","5635775475","5636128005","5635775478","5636128008","5635775481","5636128011","5635775484","5636128014","5635775487","5637182875","5635775490","5636128017","5635775493","5636128020","5635775496","5636128023","5635775499","5636128026","5635775502","5636128029","5635774755","5637182878","5635775505","5636128032","5635775508","5636128035","5635775511","5636128038","5635775514","5636128041","5635775517","5636128044","5635775640","5637183001","5635775643","5636128047","5635775646","5636128050","5635775649","5636128053","5635775652","5636128056","5635775655","5636128059","5635775658","5636128062","5635775661","5637183004","5635775664","5636128065","5635774758","5636128068","5635775667","5636128071","5635775670","5636128074","5635775673","5636128077","5635775676","5637183007","5635775679","5636128200","5635775685","5636128203","5635775688","5636128206","5635775691","5636128209","5635775694","5636128212","5635775697","5637183010","5635775700","5636128215","5635775703","5636128218","5635775706","5636128221","5635775709","5637178477","5635774761","5636128224","5635775712","5636128227","5635775715","5637183013","5635775718","5636128230","5635775721","5636128233","5635775724","5636128236","5635775727","5636128239","5635775730","5636128242","5635775733","5637183016","5635775736","5636128245","5635775739","5636128248","5635775742","5636128251","5635775745","5636128254","5635775748","5636128257","5635775751","5637183019","5635774764","5636128260","5635775754","5636128263","5635775757","5636128266","5635775880","5636128269","5635775883","5635775886","5637183022","5635775889","5636128275","5635775892","5636128278","5635775895","5636128281","5635775898","5636128284","5635775901","5635775904","5637183025","5635775907","5636128290","5635775910","5637670955","5635775913","5635774767","5636139291","5635775916","5635775919","5637670958","5635772364","5636139294","5635775922","5635775925","5637670961","5635775928","5635775931","5636139297","5635775934","5637670964","5636809357","5636809360","5636139300","5636809363","5636809366","5637670967","5636809369","5637670970","5636809372","5636809375","5636139303","5636809378","5636809384","5637670973","5635774770","5636139306","5636809387","5636809390","5637669734","5636809393","5636809396","5637670976","5636809399","5636139309","5636809402","5636809405","5637670979","5636809408","5636139312","5636809411","5636809414","5637670982","5636809417","5636809420","5637670985","5636809423","4635031805","5181615821","4635181650","401560812","401561052","401561292","401564892","401565612","401566812","401567052","401567292","401561532","401561772","401569212","401570172","401570892","401562012","401572812","401573532","401562252","401562492","401578332","401562732","401580732","401580972","401562972","401563452","401588652","401563692","401563932","401589852","401564172","401635932","401637852","401640972","401645532","401646252","401648892","401652012","401734572","401736492","401707692","401709132","401718492","401143692","401143932","401144172","401147292","401147532","401147772","401148012","401148492","401148732","401148972","401149212","401149452","401149692","401149932","401150652","401144412","401144652","401150892","401151132","401151612","401152812","401153052","401153292","401153532","401154252","401144892","401155212","401156172","401156412","401145372","401159292","401160252","401145612","401162412","401162892","401163852","401145852","401146092","401166492","401146332","401170092","401171292","401172252","401146572","401146812","401147052","401226732","401227212","401229132","401230092","401237292","401238012","401241372","401241612","401247372","401287692","401295132","401298972","401310492","401312412","312096612","312095172","4552925030","4703502445","4703502658","312096492","4703971662","4704029276","312096732","4703505487","4704025652","4710669259","4710648175","4711237415","4710658450","4711239020","4711222535","4711189194","4710698107","4710698113","4710695020","4711189320","4710698110","4512998334","4512993567","4512364714","4512969995","4570545015","5660047349","5529413026","5320471626","5537612829","5070219530","5070227018","5070227033","5069770998","5070227243","5070227255","5069952175","5069771403","5069952673","5069771466","5069771472","5069771490","5069771646","5069771931","5069961340","5070228872","5069772387","5070228884","5069952955","5070228905","5069953087","5070229409","5070229562","5070229880","5070229097","5070230048","5070230099","5069773134","5069773173","5069773329","5069773407","5070229145","5069773578","5069773632","5069773659","5070230564","5069773809","5069772918","5069774565","5069954131","5069954791","5069776074","5069955307","5069776293","5069955556","5069776509","5069776536","5069776548","5069776689","5069776710","5069758284","5069956057","5069777037","5069777184","5069777214","5069953375","5069777460","5069956453","5069777679","5069777715","5069777898","5069777940","5069778138","5069778186","5069956516","5069956696","5069956744","5070233249","5070233279","5070233417","5070233426","5070233897","5069767671","5070234224","5070233687","5069957896","5069957932","5069957218","5069958142","5069957401","5069778204","5069775765","5070235148","5069775837","5069764002","5069958688","5069958877","5069776014","5070235433","5069959147","5069778867","5070236330","5070236354","5069947327","5069947369","5070235643","5070236552","5069779092","5069779434","5069779329","5069779605","5069779827","5069780292","5070237113","5070237263","5069763342","5069780568","5069780592","5069780628","5069781255","5070221171","5069766237","5070237326","5069781315","5069781345","5070221231","5070237512","5069960068","5070238016","5069766648","5070237740","5069766717","5070238727","5069767842","5070238925","5070238289","5069766945","5069767089","5069960572","5069960812","5069948794","5069782737","5069782779","5069782998","5069949010","5069962939","5070222413","5070222692","5069783268","5070222704","5070223331","5069767170","5069767356","5070238508","5070239486","5070240389","5069949061","5070223880","5070223094","5069950285","5070224837","5070223169","5070225098","5070225257","5070224369","5070225296","5069768334","5070224399","5069949772","5070219725","5069768613","5069950537","5070225347","5069950945","5069769540","5070219779","5070220064","5069769585","5069769777","5069769822","5069769249","5069961247","5069769312","5069770014","5069770035","5069961256","5069770065","5070226508","5069764965","5069770230","5070226208","5070226226","5070226247","5069951443","5069770269","5069770278","5069951503","5069951698","5069770725","5069784444","5069951737","5069951749","5069770782","5795316404","5795316410","5743740637","5710673210","5796391194","5797731598","5797735834","5793539225","5798985277","5798985280","5798985313","5798985316","5798985319","5798985322","5798985325","5798985328","5797621887","5798985331","5798985334","5798985337","5798985340","5798985343","5798985346","5798985283","5798985349","5798985352","5798981959","5798985355","5798985358","5798985481","5798985484","5798985487","5798985490","5798985493","5798985496","5798985499","5798985502","5798985505","5798981956","5798985508","5798985511","5798985514","5798985517","5798985520","5798985523","5798985526","5798985529","5798985532","5798985535","5798985538","5799644369","5799644372","5798985286","5798985289","5798981962","5799644375","5799644378","5799644381","5799644384","5799644387","5799644390","5799644396","5799644399","5799644522","5799644525","5799644528","5799644531","5799644534","5798985292","5799644537","5799644540","5799644543","5799644546","5799644549","5799644552","5799644555","5799644558","5799644561","5799644564","5798981965","5799644567","5799644570","5798985295","5799644573","5799644576","5799644579","5799644582","5799644585","5799644588","5799644591","5799644594","5799644597","5799644600","5799644603","5799644606","5799644609","5799644612","5798985298","5798985301","5799644615","5799644618","5799644621","5799644624","5799644627","5798985304","5798985307","5798985310","5797632402","5797632405","5797632408","5797632411","5797632414","5797632417","5797630260","5797632420","5797632423","5798988412","5797632426","5797632429","5797632432","5797632435","5797632438","5797632441","5797632444","5797632447","5797632450","5797632453","5797632456","5797632459","5797632462","5797632465","5797632468","5797632471","5797632474","5797632477","5797632600","5797632603","5797630263","5797632606","5797632609","5797632612","5797632615","5797632618","5797632621","5797632624","5797632627","5797632630","5797632633","5797632636","5797632639","5797632642","5797632645","5797632648","5797632651","5797632654","5797632657","5797632660","5797632663","5797632666","5797630266","5799651836","5799651839","5799651962","5799651965","5799651968","5799651971","5799651974","5799651977","5798988415","5799651980","5799651983","5797632183","5797632186","5797632189","5797632192","5797632195","5797632198","5797632201","5797632204","5797632207","5797632210","5797632213","5797632216","5797632219","5797632222","5797632225","5797632228","5797632231","5797630257","5797632234","5797632237","5797632360","5797632363","5797632366","5797632369","5797632372","5797632375","5797632378","5797632381","5797632384","5797632387","5797632390","5797632393","5797632396","5797632399","5797635792","5797635795","5797635798","5797635801","5797635804","5799652541","5797635807","5797635810","5798991724","5797635813","5797635816","5797635819","5797635822","5797635825","5797635828","5797635831","5797635834","5797635837","5797635960","5799652547","5797635963","5797635966","5797635969","5797635972","5797635975","5797635978","5799652550","5797635981","5797635984","5798991727","5797635987","5797635990","5797635993","5797635996","5799652553","5797635999","5797636002","5797636005","5797636008","5797636011","5797636014","5799652556","5797636017","5797636020","5797636023","5797636029","5797636032","5799652559","5797636035","5798991730","5797636038","5797636041","5797636044","5797636047","5797636050","5799652685","5797636056","5797636059","5797636062","5797636065","5799652688","5797636074","5797636200","5797636206","5797636209","5797636212","5797636215","5797636218","5797636224","5799652694","5797636227","5797636233","5797636236","5797636239","5797636242","5799652697","5797636245","5797636248","5797636251","5797636257","5797636260","5799652700","5797636266","5797636269","5797636272","5799007651","5799007654","5799007660","5799007663","5799007666","5799007669","5799663041","5799007675","5798998447","5799665426","5799665429","5799665432","5799665435","5799665438","5799663044","5799665441","5799665444","5799665447","5799665450","5799665453","5799665456","5798998450","5799665459","5799665462","5799665465","5799665468","5799665477","5799665480","5799665486","5799665489","5799665492","5798998453","5799663050","5799665495","5799665498","5799665513","5799665516","5799665519","5799663053","5799665642","5799665660","5799665663","5799665669","5799665672","5799665675","5799665678","5799665681","5799665684","5798998459","5799665687","5799665693","5799665696","5799665702","5799665708","5799665714","5799663062","5799665723","5799665729","5799665735","5799665747","5799663065","5799665759","5799665885","5797643514","5799667187","5799667190","5799667193","5799667196","5799667199","5799667322","5799667325","5799667328","5799667334","5799667337","5799667340","5799667343","5799667346","5799667352","5799667355","5799667358","5799667364","5799667367","5799667376","5799667379","5799667385","5799667388","5799667397","5799667400","5799667406","5799667415","5799667418","5799667430","5799667433","5799667436","5799667439","5799667562","5799667565","5799667571","5799667574","5799667580","5799667583","5799667592","5799667595","5799667601","5799667604","5799667607","5799667613","5799666662","5799670706","5799665417","5799670709","5799670712","5799670715","5799670718","5799670721","5799670724","5799670727","5799670730","5799670733","5799670736","5799670739","5799670742","5799670745","5799666665","5799670748","5799670751","5799670754","5799670757","5799670760","5799670763","5799670766","5799670769","5799670772","5799670775","5799670778","5799665420","5799670781","5799670784","5799666668","5799670787","5799670790","5799670793","5799670796","5799670799","5799670922","5799670925","5799670928","5799670931","5799670934","5799670937","5799670940","5799670943","5799670946","5799666671","5799670949","5799670952","5799670955","5799670958","5799670961","5799670964","5799670967","5799665423","5799670970","5799670973","5799670976","5799670979","5799670982","5799670985","5799670988","5799666674","5799670991","5799670994","5799670997","5799671000","5799671003","5799671006","5799671009","5799671012","5799671015","5799671018","5799671021","5799671024","5799671027","5799671030","5799671033","5799671036","5799009001","5799671039","5799671162","5799671165","5799671168","5799671171","5799671174","5799671177","5799671180","5799671183","5799671186","5799671189","5799666680","5799671192","5799671195","5799671198","5799671201","5799671204","5799671207","5799671210","5799676022","5799676028","5799676040","5799676049","5799676052","5799676064","5799676070","5799676076","5799674825","5799675722","5799675728","5799675734","5799675740","5799675746","5799675758","5799675767","5799675770","5799675779","5799675785","5799675791","5799675797","5799675803","5799675809","5799674798","5799675821","5799009322","5799675833","5799675839","5799675965","5799675971","5799675977","5799675986","5799675989","5799675998","5799676010","5799676016","5797663662","5797663665","5466578815","5465655756","5465655735","5588904404","5466680103","5466680115","5789781803","5789210305","5789209111","5789774129","5789768858","5789170510","5789779361","5787734394","5787857673","5787860283","5745391668","5746583269","5745391800","5746583404","5746583407","5745391803","5747186096","5746583410","5745391806","5746583413","5747186099","5745391809","5746583416","5746583419","5747186102","5745391812","5745391671","5746583422","5745391815","5746583425","5747186105","5746583428","5745391818","5747186108","5746583431","5745391821","5745392790","5747186111","5745391824","5745392793","5746583272","5745392796","5745391827","5747186114","5745392799","5745391830","5745392802","5747186117","5745391833","5745392805","5745392808","5747186120","5745391836","5745392811","5745391839","5747186087","5746583275","5745392814","5747186123","5745392817","5745391842","5745392130","5745392820","5745391845","5745392823","5745392133","5745391848","5745392826","5745392829","5745391851","5745391674","5745392136","5745392832","5745391854","5745392835","5745392139","5745391857","5745392838","5745392841","5745392142","5745391860","5745392844","5745391863","5745392145","5745392847","5747186090","5745391866","5745392850","5745392148","5745392853","5745391869","5745392856","5745392151","5745391872","5745392859","5745392862","5745391875","5745392154","5745392865","5746583278","5745391677","5745391878","5745392868","5745391881","5745392871","5745392874","5746583401","5747186093","5745396705","5747189024","5747188298","5745396708","5747189027","5747188304","5745396717","5747189036","5747188307","5747189039","5745396843","5747189162","5745396846","5745396849","5745396852","5747188316","5747189174","5745396861","5747189180","5747188448","5745396873","5747189192","5747188454","5745396879","5747189201","5747188457","5745396882","5747189204","5747188460","5745396885","5747189207","5745396888","5747188463","5747189210","5745396891","5747189213","5747188466","5747189216","5747188469","5747188271","5747188988","5745396669","5747188274","5747188991","5745396672","5747188994","5745396675","5747188277","5747188997","5745396678","5747188280","5747189000","5745396681","5745396684","5747188283","5745396687","5747188286","5745396690","5747189012","5747189015","5745396696","5747188292","5747189018","5745396699","5745396702","5747188295","5745397344","5745397911","5745397914","5745397347","5745398043","5745398136","5745397356","5745398058","5745398064","5745397368","5745398280","5745398289","5745397374","5745398088","5745398091","5745398319","5745398328","5745398109","5745397401","5745398334","5745398115","5745397410","5745398352","5746590904","5746590913","5747189954","5746590154","5746590925","5746590931","5746590934","5746590937","5746590940","5747189975","5746590952","5746590955","5746591090","5746590160","5747189993","5746591102","5746591108","5746591111","5747190128","5746591141","5746591147","5746591150","5747190146","5747190875","5745399975","5747190893","5747190896","5745399981","5745399993","5746590427","5747190944","5746593511","5746593517","5746592548","5746593562","5745401997","5747193335","5745402432","5747193302","5745403668","5633291188","5637671162","5637671180","5636139516","5637671213","5636139534","5637671249","5637671258","5637671261","5637671264","5637685346","5636153880","5636153883","5636153892","5636128272","5636128287","401564412","401564652","401565132","401565372","401565852","401566092","401566332","401566572","401567532","401567772","401568012","401568252","401568492","401568732","401568972","401569452","401569692","401569932","401570412","401570652","401571132","401571372","401571612","401571852","401572092","401572332","401572572","401573052","401573292","401573772","401574012","401574252","401574492","401574732","401574972","401575212","401575452","401575692","401575932","401576172","401576412","401576652","401576892","401577132","401577372","401577612","401577852","401578092","401578572","401578812","401579052","401579292","401579532","401579772","401580012","401580252","401580492","401581212","401581452","401581692","401581932","401582172","401563212","401582412","401582652","401582892","401583132","401583372","401583612","401583852","401584092","401584332","401584572","401584812","401585052","401585292","401585532","401585772","401586012","401586252","401586492","401586732","401586972","401587212","401587452","401587692","401587932","401588172","401588412","401588892","401589132","401589372","401589612","401590092","401590332","401590572","401590812","401591052","401591292","401591532","401591772","401592012","401592252","401592492","401592732","401592972","401593212","401593452","401593692","401593932","401594172","401594412","401594652","401594892","401595132","401595372","401595612","401595852","401596092","401596332","401636172","401636412","401636652","401636892","401637132","401637372","401637612","401638332","401638812","401639052","401639292","401639532","401639772","401640012","401640492","401640732","401641212","401641452","401641692","401641932","401642172","401642412","401642652","401642892","401643852","401644332","401646012","401646492","401646732","401646972","401647212","401647452","401647692","401647932","401648172","401648412","401648652","401649132","401649612","401650092","401650332","401650572","401651052","401651532","401652252","401652972","401653212","401653452","401653692","401653932","401654172","401654412","401655132","401655612","401656092","401656332","401656572","401656812","401657052","401657292","401657532","401657772","401658972","401659212","401659692","401660412","401661372","401662572","401662812","401663532","401664012","401664252","401664492","401664732","401664972","401665212","401665692","401665932","401666172","401666412","401666892","401667612","401668332","401668812","401669532","401670732","401670972","401671212","401671452","401671692","401734332","401735052","401735292","401706972","401707212","401707452","401707932","401708172","401708412","401708652","401708892","401709372","401709612","401709852","401710332","401710812","401711052","401711292","401711772","401712012","401712252","401712492","401712732","401712972","401713212","401713452","401714412","401714652","401714892","401715132","401715612","401716812","401717292","401717532","401717772","401718012","401718972","401719212","401719452","401719692","401720412","401720652","401721612","401722092","401722812","401723052","401723292","401723532","401724732","401725692","401728092","401729772","401730492","401730732","401730972","401731212","401731692","401732172","401732652","401732892","401733132","401733372","401148252","401150172","401150412","401151372","401151852","401152092","401152332","401152572","401153772","401154012","401154492","401154732","401154972","401155452","401155692","401155932","401156652","401156892","401157132","401157372","401157612","401157852","401145132","401158092","401158332","401158572","401158812","401159052","401159532","401159772","401160012","401160492","401160732","401160972","401161212","401161452","401161692","401161932","401162172","401162652","401163132","401163372","401163612","401164092","401164332","401164572","401164812","401165052","401165292","401165532","401165772","401166012","401166252","401166732","401166972","401167212","401167452","401167692","401167932","401168172","401168412","401168652","401168892","401169132","401169372","401169612","401169852","401170332","401170572","401170812","401171052","401171532","401172012","401172492","401172732","401172972","401173212","401173452","401173692","401173932","401174172","401174412","401174652","401174892","401175132","401175372","401175612","401175852","401176092","401176332","401176572","401176812","401177052","401177292","401219772","401220012","401220492","401220732","401220972","401221212","401221452","401221692","401221932","401222172","401222412","401222652","401222892","401223132","401223372","401223612","401223852","401224092","401224332","401224572","401224812","401225052","401225292","401225532","401225772","401226012","401226252","401226492","401226972","401227452","401227692","401227932","401228172","401228412","401228652","401228892","401229372","401229612","401229852","401230332","401230572","401230812","401231052","401231292","401231532","401231772","401232012","401232252","401232492","401232732","401232972","401233212","401233452","401233692","401233932","401234172","401234412","401234652","401234892","401235132","401235372","401235612","401235852","401236092","401236332","401236812","401237052","401237532","401238252","401238492","401238732","401238972","401239212","401239452","401239692","401239932","401240412","401240652","401240892","401241132","401241852","401242332","401242812","401243052","401243292","401243772","401244012","401244252","401244492","401244732","401244972","401245452","401245692","401245932","401246172","401246412","401246652","401247132","401247612","401247852","401248092","401248332","401248572","401248812","401249052","401249772","401250012","401250252","401250732","401250972","401251452","401251932","401252172","401252412","401252892","401253612","401253852","401254572","401254812","401255292","401255772","401217612","401217852","401218092","401218332","401218572","401218812","401219052","401219292","401219532","401314332","401314812","401315052","401315532","401286492","401286732","401286972","401287212","401287452","401287932","401288172","401288412","401288652","401289132","401289372","401289612","401289852","401290092","401290332","401290572","401290812","401291292","401291532","401291772","401292252","401292492","401292732","401292972","401293212","401293452","401293692","401293932","401294172","401294412","401294652","401294892","401295372","401295852","401296332","401296572","401296812","401297292","401298012","401298732","401299212","401301372","401301612","401303292","401303772","401304012","401304732","401304972","401305212","401305932","401306172","401306412","401306652","401306892","401307132","401307372","401308812","401310252","401310972","401311212","401311452","401311692","401312172","401312652","5070230327","5069776791","5069959834","5069963434","5069770536","5978895003","5978895000","5978894877","5978894556","5978894610","5978894607","5965279196","5715218629","5970790948","5799651986","5799652544","5797636026","5797636053","5797636068","5797636071","5797636077","5797636203","5799652691","5798991733","5797636221","5797636230","5797636263","5798991736","5797636278","5799007657","5799007672","5799007678","5799663047","5799665471","5799665474","5799665483","5799665501","5799665504","5799665507","5799665510","5799665645","5799665648","5798998456","5799665651","5799665654","5799665657","5799665666","5799663056","5799665690","5799663059","5799665699","5799665705","5799665711","5799665717","5799665720","5798998462","5799665726","5799665732","5799665738","5799665741","5799665744","5799665750","5799665753","5799665756","5798998465","5799665882","5799667184","5799665171","5799667331","5799667349","5799667361","5799667370","5799667373","5799667382","5799667391","5799667394","5799667403","5797643517","5799667409","5799667412","5799667421","5799667424","5799667568","5799667577","5799667586","5799667589","5799667598","5799667610","5799667616","5799666677","5799674813","5799676019","5799676025","5799676031","5799676034","5799674816","5799676037","5799676043","5799676046","5799674819","5799676055","5799009325","5799676058","5799676061","5799676067","5799674822","5799676073","5799676079","5799676202","5799676205","5799676208","5799675725","5799675731","5799675737","5799674783","5799675743","5799675749","5799675752","5799674786","5799675755","5799675761","5799675764","5799674789","5799675773","5799675776","5799675782","5799674792","5799675788","5799675794","5799675800","5799674795","5799675806","5799675812","5799675815","5799675818","5799675824","5799675827","5799675830","5799674801","5799675836","5799675962","5799675968","5799674804","5799675974","5799675980","5799675983","5799674807","5799675992","5799675995","5799676001","5799674810","5799676004","5799676007","5799676013","5797663155","5797663158","5797663161","5797663164","5797663167","5797662441","5797663170","5797663173","5797663176","5797663179","5797663182","5797662444","5797663185","5799023758","5797663188","5797663191","5797663194","5797663197","5797662447","5797663320","5797663323","5797663326","5797663599","5797662450","5797663602","5797663605","5797663608","5797663611","5797663614","5797662453","5797663617","5797663620","5797663623","5799023881","5797663626","5797663629","5797662456","5797663632","5797663635","5797663638","5797663641","5797663644","5797662459","5797663647","5797663650","5797663653","5797663656","5797663659","5797662462","5466680100","5745392157","5745396711","5747188301","5747189030","5745396714","5747189033","5745396840","5747188310","5747189165","5747188313","5747189168","5747189171","5745396855","5747188319","5745396858","5747189177","5747188442","5745396864","5747189183","5745396867","5747189186","5745396870","5747189189","5747188451","5745396876","5747189198","5745396894","5745396897","5747189003","5747189006","5747189009","5745396693","5747188289","5747189021","5745397908","5746589425","5746589428","5746589431","5745397917","5745398130","5745397350","5745398040","5745398133","5745397353","5745398139","5745398046","5745398142","5745398049","5745398145","5745397359","5745398052","5745398148","5745398055","5745397362","5745398151","5745398154","5745397365","5745398061","5745398157","5745398283","5745398067","5745397371","5745398286","5745398070","5745398073","5745398292","5745398076","5745397377","5745398295","5745398079","5745398298","5745397380","5745398082","5745398301","5745398085","5745397383","5745398304","5745398307","5745397386","5745398310","5745398313","5745397389","5745398094","5745398316","5745398097","5745397392","5745398100","5745398322","5745397395","5745398103","5745398325","5745398106","5745397398","5745398331","5745398112","5745397404","5745398337","5745398340","5745398118","5745397407","5745398343","5745398121","5745398346","5745398124","5745398349","5745398127","5745397413","5746589434","5745398355","5745397416","5746590907","5747189951","5746590910","5746590916","5747189957","5746590919","5746590922","5747189960","5746590928","5747189963","5747189966","5747189969","5746590943","5747189972","5746590946","5746590157","5746590949","5747189978","5746590958","5747189981","5746591081","5747189984","5746591084","5746591087","5747189987","5746591093","5747189990","5746591096","5746591099","5747189996","5746591105","5747189999","5747190122","5746591114","5746591117","5747190125","5746591120","5746591123","5746591126","5746590163","5747190131","5746591129","5746591132","5747190134","5746591135","5746591138","5747190137","5747190140","5746591144","5747190143","5746591153","5746591156","5745399966","5747190878","5745399969","5747190881","5747190884","5745399972","5746590421","5747190887","5747190890","5745399978","5747190899","5746590424","5745399984","5747190902","5745399987","5747190905","5747190908","5745399990","5747190911","5747190914","5745399996","5747190917","5747190920","5745399999","5747190923","5745400002","5747190926","5745400005","5747190929","5746590430","5747190932","5745400008","5747190935","5745400011","5747190938","5745400014","5747190941","5746590433","5745400017","5747190947","5745400020","5747190950","5745400023","5747190953","5747190956","5745400026","5747190959","5746590436","5745400029","5747191082","5745400032","5747191085","5747191088","5745400035","5747191091","5745400038","5746590439","5747191094","5745400041","5747191097","5747191100","5745400044","5747191103","5745400047","5747191106","5746590442","5747191109","5746592530","5746593061","5746593514","5745386832","5746593064","5746592533","5746593067","5746593520","5746593070","5746593523","5746593073","5746592536","5747172392","5746593526","5746593529","5746593076","5746593532","5746593079","5746592539","5746593535","5746593082","5746593538","5747183468","5746593541","5746593085","5746592542","5746593544","5746593088","5746593547","5746593091","5746592545","5746593550","5747172395","5746593094","5746593553","5746593556","5746593097","5746593559","5746593100","5746593103","5745386835","5746593565","5746592551","5746593106","5746593568","5746593571","5746593109","5746592554","5746593574","5746593112","5747183471","5746593577","5746593115","5746593580","5746592557","5746593583","5746593118","5746593586","5746593241","5746592560","5747172398","5746593589","5746593244","5746593592","5746593247","5746593595","5746592563","5746593598","5746593250","5746593721","5747172401","5746593253","5746593724","5746592566","5746593256","5746593727","5746593259","5746593730","5746592569","5746593733","5747183474","5746593262","5746593736","5746593265","5746593739","5746592572","5746593268","5746593742","5746593745","5746593271","5747172404","5746592575","5746593748","5746593274","5746593751","5746593277","5745401961","5745402363","5745401964","5747191847","5745402366","5745402369","5745401967","5745402372","5747191850","5745401970","5745402375","5745401973","5745402378","5747191853","5745401976","5745402381","5745402384","5745401979","5747193056","5745402387","5745401982","5745402390","5747193059","5745401985","5745402393","5745401988","5745402396","5747193062","5745401991","5745402399","5745402402","5745401994","5747193065","5745402405","5745402408","5747193068","5747193326","5745402411","5747193329","5745402414","5747193071","5745402417","5747193332","5745402420","5747193074","5745402423","5747193338","5745402426","5747193077","5747193341","5745402429","5747193344","5747193080","5745402435","5747193347","5745402438","5747193083","5747193350","5745402441","5747193353","5745402444","5747193086","5745402447","5747193356","5745402450","5747193359","5747193089","5745402453","5747193482","5745402456","5747193092","5747193485","5745402459","5745402462","5747193488","5747193095","5745402465","5747194553","5747194556","5745402708","5747194559","5745402711","5747193299","5747194682","5745402714","5747194685","5745402717","5747194688","5745402840","5747194691","5747194694","5745402843","5747194697","5745402846","5747194700","5745402849","5747194703","5747193305","5745402852","5747194706","5745402855","5747194709","5745402858","5747194712","5747194715","5745402861","5747193308","5747194718","5745402864","5747194721","5745402867","5747194724","5745402870","5747194727","5747193311","5745402873","5747194730","5747194733","5745402876","5747194736","5745402879","5747194739","5747193314","5745402882","5747194742","5745402885","5747194745","5745402888","5745402696","5747194544","5745402699","5747194547","5747193296","5745402702","5747194550","5745402705","5746596439","5747195915","5745403635","5746596442","5747195918","5746596445","5745403638","5747195921","5746596448","5745403641","5747195924","5746596451","5745403644","5747195927","5746596454","5745403647","5746596457","5747195930","5746596460","5745403650","5747195933","5746596463","5747195936","5745403653","5746596466","5747195939","5745403656","5746596469","5747195942","5746596472","5745403659","5747195945","5746596475","5745403662","5746596478","5747195948","5745403665","5746596601","5747195951","5746596604","4669293782","5873842932","5873840295","401644572","401171772","401253132","401316012","401299452","401300892","401310012","401312892"]

  /**
   * Registers an extended element and installs its styles.
   * @param {string} name
   * @param {typeof BaseElement} implementationClass
   * @param {?string|undefined} css
   */
  global.AMP.registerElement = extensions.addElement.bind(extensions);

  /**
   * Registers an extended template.
   * @param {string} name
   * @param {typeof ./base-template.BaseTemplate} implementationClass
   */
  global.AMP.registerTemplate = extensions.addTemplate.bind(extensions);

  /**
   * Registers an ampdoc service.
   * @param {string} name
   * @param {function(new:Object, !./service/ampdoc-impl.AmpDoc)} implementationClass
   */
  global.AMP.registerServiceForDoc = extensions.addService.bind(extensions);

  // Experiments.
  /**
   * @param {string} experimentId
   * @return {boolean}
   */
  global.AMP.isExperimentOn = isExperimentOn.bind(null, global);

  /**
   * @param {string} experimentId
   * @param {boolean=} opt_on
   * @return {boolean}
   */
  global.AMP.toggleExperiment = toggleExperiment.bind(null, global);

  /**
   * @param {import('#utils/log').LogLevel_Enum} level
   */
  global.AMP.setLogLevel = overrideLogLevel.bind(null);

  /**
   * Sets the function to forward tick events to.
   * @param {function(string,?string=,number=)} unusedFn
   * @param {function()=} opt_flush
   * @deprecated
   */
  global.AMP.setTickFunction = (unusedFn, opt_flush) => {};

  // Run specific setup for a single-doc or shadow-doc mode.
  const iniPromise = callback(global, extensions);

  /**
   * @param {function(!Object,!Object)|!ExtensionPayload} fnOrStruct
   */
  function installExtension(fnOrStruct) {
    const register = () => {
      iniPromise.then(() => {
        if (typeof fnOrStruct == 'function') {
          fnOrStruct(global.AMP, global.AMP._);
        } else {
          extensions.registerExtension(
            fnOrStruct.n,
            fnOrStruct.ev,
            fnOrStruct.l,
            fnOrStruct.f,
            global.AMP
          );
        }
      });
    };

    startRegisterOrChunk(global, fnOrStruct, register);
  }

  // Handle high priority extensions now, and if necessary issue
  // requests for new extensions (used for experimental version
  // locking).
  for (let i = 0; i < preregisteredExtensions.length; i++) {
    const fnOrStruct = preregisteredExtensions[i];
    if (maybeLoadCorrectVersion(global, fnOrStruct)) {
      preregisteredExtensions.splice(i--, 1);
    } else if (typeof fnOrStruct == 'function' || fnOrStruct.p == 'high') {
      try {
        installExtension(fnOrStruct);
      } catch (e) {
        // Throw errors outside of loop in its own micro task to
        // avoid on error stopping other extensions from loading.
        dev().error(TAG, 'Extension failed: ', e, fnOrStruct.n);
      }
      // We handled the entry. Remove from set for future execution.
      preregisteredExtensions.splice(i--, 1);
    }
  }

  maybePumpEarlyFrame(global, () => {
    /**
     * Registers a new custom element.
     * @param {function(!Object, !Object)|!ExtensionPayload} fnOrStruct
     */
    global.AMP.push = function (fnOrStruct) {
      if (maybeLoadCorrectVersion(global, fnOrStruct)) {
        return;
      }
      installExtension(fnOrStruct);
    };
    // Execute asynchronously scheduled elements.
    for (let i = 0; i < preregisteredExtensions.length; i++) {
      const fnOrStruct = preregisteredExtensions[i];
      if (maybeLoadCorrectVersion(global, fnOrStruct)) {
        continue;
      }
      try {
        installExtension(fnOrStruct);
      } catch (e) {
        // Throw errors outside of loop in its own micro task to
        // avoid on error stopping other extensions from loading.
        dev().error(TAG, 'Extension failed: ', e, fnOrStruct.n);
      }
    }
    // Make sure we empty the array of preregistered extensions.
    // Technically this is only needed for testing, as everything should
    // go out of scope here, but just making sure.
    preregisteredExtensions.length = 0;
  });
  // If the closure passed to maybePumpEarlyFrame didn't execute
  // immediately we need to keep pushing onto preregisteredExtensions
  if (!global.AMP.push) {
    global.AMP.push =
      /** @type {function((ExtensionPayload|function(!Object, !Object): ?))} */ (
        preregisteredExtensions.push.bind(preregisteredExtensions)
      );
  }

  // For iOS we need to set `cursor:pointer` to ensure that click events are
  // delivered.
  if (Services.platformFor(global).isIos()) {
    setStyle(global.document.documentElement, 'cursor', 'pointer');
  }

  // Some deferred polyfills.
  const extensionsFor = Services.extensionsFor(global);
  if (shouldLoadResObPolyfill(global)) {
    extensionsFor.preloadExtension('amp-resize-observer-polyfill');
  }
  if (shouldLoadInObPolyfill(global)) {
    extensionsFor.preloadExtension('amp-intersection-observer-polyfill');
  }

  return iniPromise;
}

/**
 * @param {!Window} global Global scope to adopt.
 * @param {function(!Object, !Object)|!ExtensionPayload} fnOrStruct
 * @param {function()} register
 */
function startRegisterOrChunk(global, fnOrStruct, register) {
  if (typeof fnOrStruct == 'function' || fnOrStruct.p == 'high') {
    // "High priority" extensions do not go through chunking.
    // This should be used for extensions that need to run early.
    // One example would be viewer communication that is required
    // to transition document from pre-render to visible (which
    // affects chunking itself).
    // We consider functions as high priority, because
    // - if in doubt, that is a better default
    // - the only actual  user is a viewer integration that should
    //   be high priority.
    Promise.resolve().then(register);
  } else {
    register.displayName = fnOrStruct.n;
    startupChunk(global.document, register);
  }
}

/**
 * Applies the runtime to a given global scope for a single-doc mode.
 * Multi frame support is currently incomplete.
 * @param {!Window} global Global scope to adopt.
 * @return {!Promise}
 */
export function adopt(global) {
  return adoptShared(global, (global) => {
    // Shared runtimes variables between both multi-doc and single-doc pages
    adoptServicesAndResources(global);

    return waitForBodyOpenPromise(global.document).then(() => {
      // Ensure that all declared extensions are marked and stubbed.
      stubElementsForDoc(global.AMP.ampdoc);
    });
  });
}

/**
 * Applies the runtime to a given global scope for a single-doc mode.
 * Multi frame support is currently incomplete.
 * @param {!Window} global Global scope to adopt.
 * @return {!Promise}
 */
export function adoptWithMultidocDeps(global) {
  return adoptShared(global, (global) => {
    // Shared runtimes variables between both multi-doc and single-doc pages
    adoptServicesAndResources(global);

    // Dependencies to the MultiDocManager
    adoptMultiDocDeps(global);

    return waitForBodyOpenPromise(global.document).then(() => {
      // Ensure that all declared extensions are marked and stubbed.
      stubElementsForDoc(global.AMP.ampdoc);
    });
  });
}

/**
 * Adopt shared runtimes variables between both multi-doc and single-doc pages
 * @param {!Window} global Global scope to adopt.
 */
function adoptServicesAndResources(global) {
  const {documentElement} = global.document;

  const ampdocService = Services.ampdocServiceFor(global);
  const ampdoc = ampdocService.getSingleDoc();
  global.AMP.ampdoc = ampdoc;

  const viewer = Services.viewerForDoc(documentElement);
  global.AMP.viewer = viewer;

  if (getMode().development) {
    global.AMP.toggleRuntime = viewer.toggleRuntime.bind(viewer);
    global.AMP.resources = Services.resourcesForDoc(documentElement);
  }

  const viewport = Services.viewportForDoc(documentElement);
  global.AMP.viewport = {};
  global.AMP.viewport.getScrollLeft = viewport.getScrollLeft.bind(viewport);
  global.AMP.viewport.getScrollWidth = viewport.getScrollWidth.bind(viewport);
  global.AMP.viewport.getWidth = viewport.getWidth.bind(viewport);
}

/**
 * Adopt MultiDocManager dependencies
 * @param {!Window} global Global scope to adopt.
 */
function adoptMultiDocDeps(global) {
  global.AMP.installAmpdocServices = installAmpdocServices.bind(null);
  if (mode.isEsm()) {
    const style = global.document.querySelector('style[amp-runtime]');
    global.AMP.combinedCss = style ? style.textContent : '';
  } else {
    global.AMP.combinedCss = ampDocCss + ampSharedCss;
  }
}

/**
 * Applies the runtime to a given global scope for shadow mode.
 * @param {!Window} global Global scope to adopt.
 * @return {!Promise}
 */
export function adoptShadowMode(global) {
  return adoptShared(global, (global, extensions) => {
    // shadow mode already adopted
    if (global.AMP.attachShadowDoc) {
      return Promise.resolve();
    }

    // Dependencies to the MultiDocManager
    adoptMultiDocDeps(global);

    const manager = new MultidocManager(
      global,
      Services.ampdocServiceFor(global),
      extensions,
      Services.timerFor(global)
    );

    /**
     * Registers a shadow root document via a fully fetched document.
     * @param {!Element} hostElement
     * @param {!Document} doc
     * @param {string} url
     * @param {!Object<string, string>=} opt_initParams
     * @return {!Object}
     */
    global.AMP.attachShadowDoc = manager.attachShadowDoc.bind(manager);

    /**
     * Registers a shadow root document via a stream.
     * @param {!Element} hostElement
     * @param {string} url
     * @param {!Object<string, string>=} opt_initParams
     * @return {!Object}
     */
    global.AMP.attachShadowDocAsStream =
      manager.attachShadowDocAsStream.bind(manager);

    return waitForBodyOpenPromise(global.document);
  });
}

/**
 * For a given extension, checks that its version is the same
 * as the version of the main AMP binary.
 * If yes, returns false and does nothing else.
 * If they are different, returns false, and initiates a load
 * of the respective extension via a versioned URL.
 *
 * @param {!Window} win
 * @param {function(!Object, !Object)|!ExtensionPayload} fnOrStruct
 * @return {boolean}
 */
function maybeLoadCorrectVersion(win, fnOrStruct) {
  if (getMode().localDev && isExperimentOn(win, 'disable-version-locking')) {
    return false;
  }
  if (typeof fnOrStruct == 'function') {
    return false;
  }

  if (mode.isEsm()) {
    // If we're in a module runtime, trying to execute a nomodule extension
    // simply remove the nomodule extension so that it is not executed.
    if (!fnOrStruct.m) {
      return true;
    }
  } else {
    // If we're in a nomodule runtime, trying to execute a module extension
    // simply remove the module extension so that it is not executed.
    if (fnOrStruct.m) {
      return true;
    }
  }

  const {v} = fnOrStruct;
  // This is non-obvious, but we only care about the release version,
  // not about the full rtv version, because these only differ
  // in the config that is fully determined by the primary binary.
  if (mode.version() == v) {
    return false;
  }
  Services.extensionsFor(win).reloadExtension(
    fnOrStruct.n,
    fnOrStruct.ev,
    fnOrStruct.l
  );
  return true;
}

/**
 * If it makes sense, let the browser paint the current frame before
 * executing the callback.
 * @param {!Window} win
 * @param {function()} cb Callback that should run after a frame was
 *     pumped.
 */
function maybePumpEarlyFrame(win, cb) {
  // There is definitely nothing to draw yet, so we might as well
  // proceed.
  if (!win.document.body) {
    cb();
    return;
  }
  if (hasRenderDelayingServices(win)) {
    cb();
    return;
  }
  Services.timerFor(win).delay(cb, 1);
}
