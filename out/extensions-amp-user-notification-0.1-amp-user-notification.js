(self._S=self._S||[]).push((function(){(self.AMP=self.AMP||[]).push(function(){var Zh="notificationUIManager",$h=function(){this.pb=0;this.ug=Promise.resolve();this.sg=function(){};this.tg=function(){}};$h.prototype.onQueueEmpty=function(a){this.sg=a;0==this.pb&&a()};$h.prototype.onQueueNotEmpty=function(a){this.tg=a;0<this.pb&&a()};$h.prototype.registerUI=function(a){var b=this;0==this.pb&&this.tg();this.pb++;var c=this.ug.then(function(){return a().then(function(){b.pb--;0==b.pb&&b.sg()})});return this.ug=c};var ai="amp-user-notification{position:fixed!important;bottom:0;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,0.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/";var bi={},ci="amp-user-notification",di="userNotificationManager",ui=function(a){a=AMP.BaseElement.call(this,a)||this;a.df=null;a.Cb=null;var b=new C;a.Af=b.promise;a.Bf=b.resolve;a.zb=null;a.De=!1;a.cc=null;a.Qe="";a.Re=null;a.Sg=null;return a};n(ui,AMP.BaseElement);ui.prototype.isAlwaysFixed=function(){return!0};
ui.prototype.buildCallback=function(){var a=this,b=this.getAmpDoc();this.Sg=If(b);this.Re=Hf(b);this.Cb=z().assert(this.element.id,"amp-user-notification should have an id.");this.Qe="amp-user-notification:"+this.Cb;(this.cc=this.element.getAttribute("data-show-if-href"))&&Ag(this.cc,this.element);(this.zb=this.element.getAttribute("data-dismiss-href"))&&Ag(this.zb,this.element);var c=this.element.getAttribute("role");c||this.element.setAttribute("role","alert");var d=this.element.getAttribute("data-persist-dismissal");
this.De="false"!=d&&"no"!=d;this.registerAction("dismiss",function(){return a.dismiss(!1)});this.registerAction("optoutOfCid",function(){return vi(a)});var e=Nd(b,di);e.then(function(b){b.registerUserNotification(a.Cb,a)})};var wi=function(a,b){var c=a.cc;return a.Sg.expandUrlAsync(c).then(function(c){return xg(c,{elementId:a.Cb,ampUserId:b})})};
ui.prototype.Gh=function(a){var b=this;this.df=a;return wi(this,a).then(function(a){var c={credentials:"include",requireAmpResponseSourceOrigin:!1};return Rf(b.win).fetchJson(a,c).then(function(a){return a.json()})})};var yi=function(a){var b=a.element.getAttribute("enctype")||"application/json;charset=utf-8";Rf(a.win).fetchJson(a.zb,xi(a,b,a.Cb,a.df))},xi=function(a,b,c,d){return{method:"POST",credentials:"include",requireAmpResponseSourceOrigin:!1,body:I({elementId:c,ampUserId:d}),headers:{"Content-Type":b}}};
ui.prototype.ci=function(a){z().assert("boolean"==typeof a.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',a.showNotification,typeof a.showNotification);a.showNotification||this.Bf();return Promise.resolve(a.showNotification)};
var vi=function(a){return zi(a).then(function(a){return a.optOut()}).then(function(){return a.dismiss(!1)},function(b){y().error(ci,"Failed to opt out of Cid",b);a.dismiss(!0)})},Ai=function(a){return zi(a).then(function(b){return b.get({scope:ci,createCookieIfNotPresent:!0},Promise.resolve(),a.Af)})},zi=function(a){return rf(a.element)};ui.prototype.shouldShow=function(){var a=this;return this.isDismissed().then(function(b){return b?!1:a.cc?Bi(a):!0})};var Bi=function(a){return Ai(a).then(a.Gh.bind(a)).then(a.ci.bind(a))};
ui.prototype.show=function(){M(this.element,"display","");this.element.classList.add("amp-active");this.getViewport().addToFixedLayer(this.element);return this.Af};ui.prototype.isDismissed=function(){var a=this;return this.De?this.Re.then(function(b){return b.get(a.Qe)}).then(function(a){return!!a},function(a){y().error(ci,"Failed to read storage",a);return!1}):Promise.resolve(!1)};ui.prototype.activate=function(){this.dismiss(!1)};
ui.prototype.dismiss=function(a){var b=this;this.element.classList.remove("amp-active");this.element.classList.add("amp-hidden");this.Bf();this.getViewport().removeFromFixedLayer(this.element);this.De&&!a&&this.Re.then(function(a){a.set(b.Qe,!0)});this.zb&&yi(this)};var Ci=function(a){this.ampdoc=a;this.zg=Object.create(null);this.Jd=Object.create(null);this.b=L(this.ampdoc);this.Cf=this.ampdoc.whenReady();this.dg=Promise.all([this.b.whenFirstVisible(),this.Cf]);this.ai=Nd(this.ampdoc,Zh)};
Ci.prototype.get=function(a){var b=this;this.dg.then(function(){null==b.ampdoc.getElementById(a)&&z().warn(ci,"Did not find amp-user-notification element "+a+".")});return Di(this,a).promise};Ci.prototype.getNotification=function(a){var b=this;return this.Cf.then(function(){return b.zg[a]})};
Ci.prototype.registerUserNotification=function(a,b){var c=this;this.zg[a]=b;var d=Di(this,a);return this.dg.then(function(){return b.shouldShow()}).then(function(a){if(a)return c.ai.then(function(a){return a.registerUI(b.show.bind(b))})}).then(d.resolve.bind(this,b)).catch(x.bind(null,"Notification service failed amp-user-notification",a))};var Di=function(a,b){if(a.Jd[b])return a.Jd[b];var c=new C;return a.Jd[b]={promise:c.promise,resolve:c.resolve}};function Ei(a){E(a,di,Ci)}
(function(a){a.registerServiceForDoc(di,Ci);a.registerServiceForDoc(Zh,$h);a.registerElement(ci,ui,ai)})(self.AMP);bi.AmpUserNotification=ui;bi.UserNotificationManager=Ci;bi.Vi=Ei;(self._S=self._S||[])["//extensions/amp-user-notification/0.1/amp-user-notification.js"]=bi;})}));
//# sourceMappingURL=extensions-amp-user-notification-0.1-amp-user-notification.js.map

