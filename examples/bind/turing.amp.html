<!doctype html>
<html âš¡>
<head>
  <meta charset="utf-8">
  <title>amp-bind: Turing machine</title>
  <link rel="canonical" href="amps.html">
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
  <link href="https://fonts.googleapis.com/css?family=Questrial" rel="stylesheet" type="text/css">
  <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
  <script async src="https://cdn.ampproject.org/v0.js"></script>
  <script async custom-element="amp-bind" src="https://cdn.ampproject.org/v0/amp-bind-0.1.js"></script>

  <style amp-custom>
    .advance {
      background-color: green;
    }
    .return {
      background-color: red;
    }
    button {
      border: solid 1px black;
    }
    span {
      padding: 5px;
      border: solid 1px gray;
    }
  </style>
</head>

<body>
  <button onclick="AMP.toggleExperiment('amp-bind');window.location.href=window.location.href;">Toggle &lt;amp-bind&gt; experiment</button>

  <h2>Turing machine: 8-bit counter</h2>

  <p>This is a simple binary counter implemented as a Turing machine in amp-bind.</p>

  <h3>Tape</h3>
  <p>
    <span [class]="T.head == 8 ? T.state : ''" [text]="T.cells[8]">0</span>
    <span [class]="T.head == 7 ? T.state : ''" [text]="T.cells[7]">0</span>
    <span [class]="T.head == 6 ? T.state : ''" [text]="T.cells[6]">0</span>
    <span [class]="T.head == 5 ? T.state : ''" [text]="T.cells[5]">0</span>
    <span [class]="T.head == 4 ? T.state : ''" [text]="T.cells[4]">0</span>
    <span [class]="T.head == 3 ? T.state : ''" [text]="T.cells[3]">0</span>
    <span [class]="T.head == 2 ? T.state : ''" [text]="T.cells[2]">0</span>
    <span [class]="T.head == 1 ? T.state : ''" [text]="T.cells[1]">0</span>
    <span [class]="T.head == 0 ? T.state : ''" class="advance">*</span>
  </p>

  <h3 [text]="'Count: ' + (count || 0)">Count: 0</h3>

  <!--
  Notes:
  1. Duplication of intermediary variables is a pain. Can we set them with multiple AMP.setState() actions?
  2. Mutation of non-primitives is a pain. Can we make that easier? Custom function?
  3. Overwriting nested objects due to Object.assign() is annoying. Can we merge instead?
  4. No support for escaping quotes in strings.
  -->

  <!--
  Sample code for (1):

  <button on="tap:
  AMP.setState({
    'currCell': T.instructions[T.state][ T.cells[T.head] ],
  }),
  AMP.setState({
    'T': {
      'head':  currCell.move == 'L' ? T.head + 1 : T.head - 1,
      'state': currCell.state,
      'cells': currCell.write == null
          ? T.cells
          : T.cells.slice(0, T.head).concat(
              [ currCell.write ]).concat(
                  T.cells.slice(T.head + 1
              )
          ),
      'instructions': T.instructions
    }
  })">Step</button>
  -->

  <button on="tap:
  AMP.setState({
    'T': {
      'head':  T.instructions[T.state][ T.cells[T.head] ].move == 'L' ? T.head + 1 : T.head - 1,
      'state': T.instructions[T.state][ T.cells[T.head] ].state,
      'cells': T.instructions[T.state][ T.cells[T.head] ].write == null
          ? T.cells
          : T.cells.slice(0, T.head).concat(
              [ T.instructions[T.state][ T.cells[T.head] ].write ]).concat(
                  T.cells.slice(T.head + 1
              )
          ),
      'instructions': T.instructions
    },
    'count': T.state == 'return'
        ? T.cells[1] + 2*T.cells[2] + 4*T.cells[3] + 8*T.cells[4] + 16*T.cells[5] + 32*T.cells[6] + 64*T.cells[7] + 128*T.cells[8]
        : count
  })">Step</button>

  <!--
  Turing machine representation contains:
  - A tape (`cells`) containing symbols 0, 1, or -1
  - A head that reads/writes the tape at its current position and can move left/right
  - A state register (`state`) whose value is either 'advance' or 'return'
  - An instruction for each (state, symbol) tuple that guides the head's actions
  -->
  <amp-state id="T">
    <script type="application/json">
      {
        "head": 0,
        "state": "advance",
        "cells": [-1, 0, 0, 0, 0, 0, 0, 0, 0],
        "instructions": {
          "advance": {
            "0": {
              "move": "R",
              "write": 1,
              "state": "return"
            },
            "1": {
              "move": "L",
              "write": 0,
              "state": "advance"
            },
            "-1": {
              "move": "L",
              "write": null,
              "state": "advance"
            }
          },
          "return": {
            "0": {
              "move": "R",
              "write": null,
              "state": "return"
            },
            "1": {
              "move": "R",
              "write": null,
              "state": "return"
            },
            "-1": {
              "move": "L",
              "write": null,
              "state": "advance"
            }
          }
        }
      }
    </script>
  </amp-state>
</body>
</html>
