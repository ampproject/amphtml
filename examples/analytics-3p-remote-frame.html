<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Requests Frame</title>
    <script>
      /**
       * To receive analytics events in a third-party frame, you must
       * implement this method, with this signature. Within that method, you
       * must create a function which processes the analytics events, and
       * pass that function to the registerAmpAnalyticsEventListener() method
       * of the object which is passed as a parameter to
       * onNewAmpAnalyticsInstance().
       * @param ampAnalytics  Call registerAmpAnalyticsEventListener() on this,
       * passing your function which will receive the analytics events.
       */
      window.onNewAmpAnalyticsInstance = ampAnalytics => {
        ampAnalytics.registerAmpAnalytics3pEventsListener(
          arrayOfEventStrings => {
            arrayOfEventStrings.forEach(evt => {
              // Now, do something meaningful with the AMP Analytics event
              console.log("Received an event: " + evt.request +
                " from: " + evt.senderId + ", and my extra data is: " +
                ampAnalytics.getExtraData(evt.senderId));
            });
            ampAnalytics.sendMessageToCreative('received');
          });
        ampAnalytics.registerAmpAnalytics3pExtraDataListener(
          // The following function is optional:
          (senderId, extraData) => {
            console.log("Received extra setup data: " + extraData +
              " from: " + senderId);
          });
      };

      // Load the script specified in the iframeâ€™s name attribute:
      script = document.createElement('script');
      script.src = JSON.parse(window.name).scriptSrc;
      document.head.appendChild(script);
      // The script will be loaded, and will call onNewAmpAnalyticsInstance()
    </script>
  </head>
  <!-- The frame will not be visible, so there is no need for a body tag. -->
</html>
