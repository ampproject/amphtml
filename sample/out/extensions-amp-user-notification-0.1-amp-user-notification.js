(self.AMP=self.AMP||[]).push({n:"extensions-amp-user-notification-0.1-amp-user-notification.js", v:"erwin", f:(function(){function $AmpUserNotification$$module$extensions$amp_user_notification$0_1$amp_user_notification$$($$jscomp$super$this$jscomp$85_element$jscomp$443$$){$$jscomp$super$this$jscomp$85_element$jscomp$443$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$85_element$jscomp$443$$)||this;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$ampUserId_$=null;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$elementId_$=null;var $deferred$jscomp$48$$=new $Deferred$$module$src$utils$promise$$;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$dialogPromise_$=
$deferred$jscomp$48$$.promise;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$dialogResolve_$=$deferred$jscomp$48$$.resolve;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$dismissHref_$=null;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$persistDismissal_$=!1;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$showIfHref_$=null;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$storageKey_$="";$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$storagePromise_$=null;$$jscomp$super$this$jscomp$85_element$jscomp$443$$.$urlReplacements_$=
null;return $$jscomp$super$this$jscomp$85_element$jscomp$443$$}$$jscomp$inherits$$($AmpUserNotification$$module$extensions$amp_user_notification$0_1$amp_user_notification$$,AMP.BaseElement);$JSCompiler_prototypeAlias$$=$AmpUserNotification$$module$extensions$amp_user_notification$0_1$amp_user_notification$$.prototype;$JSCompiler_prototypeAlias$$.isAlwaysFixed=function(){return!0};
$JSCompiler_prototypeAlias$$.buildCallback=function(){var $$jscomp$this$jscomp$796$$=this,$ampdoc$jscomp$173$$=this.getAmpDoc();this.$urlReplacements_$=$Services$$module$src$services$urlReplacementsForDoc$$($ampdoc$jscomp$173$$);this.$storagePromise_$=$Services$$module$src$services$storageForDoc$$($ampdoc$jscomp$173$$);this.$elementId_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.id,"amp-user-notification should have an id.");this.$storageKey_$="amp-user-notification:"+
this.$elementId_$;(this.$showIfHref_$=this.element.getAttribute("data-show-if-href"))&&$assertHttpsUrl$$module$src$url$$(this.$showIfHref_$,this.element);(this.$dismissHref_$=this.element.getAttribute("data-dismiss-href"))&&$assertHttpsUrl$$module$src$url$$(this.$dismissHref_$,this.element);var $roleAttribute$$=this.element.getAttribute("role");$roleAttribute$$||this.element.setAttribute("role","alert");var $persistDismissal$$=this.element.getAttribute("data-persist-dismissal");this.$persistDismissal_$=
"false"!=$persistDismissal$$&&"no"!=$persistDismissal$$;this.registerAction("dismiss",function(){return $$jscomp$this$jscomp$796$$.dismiss(!1)});this.registerAction("optoutOfCid",function(){return $JSCompiler_StaticMethods_optoutOfCid_$$($$jscomp$this$jscomp$796$$)});var $userNotificationManagerPromise$$=$getServicePromiseForDoc$$module$src$service$$($ampdoc$jscomp$173$$,"userNotificationManager");$userNotificationManagerPromise$$.then(function($ampdoc$jscomp$173$$){$ampdoc$jscomp$173$$.I($$jscomp$this$jscomp$796$$.$elementId_$,
$$jscomp$this$jscomp$796$$)})};
function $JSCompiler_StaticMethods_buildGetHref_$$($JSCompiler_StaticMethods_buildGetHref_$self$$,$ampUserId$$){var $showIfHref$$=$JSCompiler_StaticMethods_buildGetHref_$self$$.$showIfHref_$;return $JSCompiler_StaticMethods_buildGetHref_$self$$.$urlReplacements_$.expandUrlAsync($showIfHref$$).then(function($showIfHref$$){return $addParamsToUrl$$module$src$url$$($showIfHref$$,{elementId:$JSCompiler_StaticMethods_buildGetHref_$self$$.$elementId_$,ampUserId:$ampUserId$$})})}
$JSCompiler_prototypeAlias$$.$getShowEndpoint_$=function($ampUserId$jscomp$1$$){var $$jscomp$this$jscomp$798$$=this;this.$ampUserId_$=$ampUserId$jscomp$1$$;return $JSCompiler_StaticMethods_buildGetHref_$$(this,$ampUserId$jscomp$1$$).then(function($ampUserId$jscomp$1$$){var $href$jscomp$12$$={credentials:"include",requireAmpResponseSourceOrigin:!1};return $Services$$module$src$services$xhrFor$$($$jscomp$this$jscomp$798$$.win).fetchJson($ampUserId$jscomp$1$$,$href$jscomp$12$$).then(function($ampUserId$jscomp$1$$){return $ampUserId$jscomp$1$$.json()})})};
function $JSCompiler_StaticMethods_postDismissEnpoint_$$($JSCompiler_StaticMethods_postDismissEnpoint_$self$$){var $enctype$$=$JSCompiler_StaticMethods_postDismissEnpoint_$self$$.element.getAttribute("enctype")||"application/json;charset=utf-8";$Services$$module$src$services$xhrFor$$($JSCompiler_StaticMethods_postDismissEnpoint_$self$$.win).fetchJson($JSCompiler_StaticMethods_postDismissEnpoint_$self$$.$dismissHref_$,{method:"POST",credentials:"include",requireAmpResponseSourceOrigin:!1,body:$dict$$module$src$utils$object$$({elementId:$JSCompiler_StaticMethods_postDismissEnpoint_$self$$.$elementId_$,
ampUserId:$JSCompiler_StaticMethods_postDismissEnpoint_$self$$.$ampUserId_$}),headers:{"Content-Type":$enctype$$}})}
$JSCompiler_prototypeAlias$$.$onGetShowEndpointSuccess_$=function($data$jscomp$129$$){$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$("boolean"==typeof $data$jscomp$129$$.showNotification,'`showNotification` should be a boolean. Got "%s" which is of type %s.',$data$jscomp$129$$.showNotification,typeof $data$jscomp$129$$.showNotification);$data$jscomp$129$$.showNotification||this.$dialogResolve_$();return Promise.resolve($data$jscomp$129$$.showNotification)};
function $JSCompiler_StaticMethods_optoutOfCid_$$($JSCompiler_StaticMethods_optoutOfCid_$self$$){return $Services$$module$src$services$cidForDoc$$($JSCompiler_StaticMethods_optoutOfCid_$self$$.element).then(function($JSCompiler_StaticMethods_optoutOfCid_$self$$){return $JSCompiler_StaticMethods_optoutOfCid_$self$$.optOut()}).then(function(){return $JSCompiler_StaticMethods_optoutOfCid_$self$$.dismiss(!1)},function($reason$jscomp$35$$){$dev$$module$src$log$$().error("amp-user-notification","Failed to opt out of Cid",
$reason$jscomp$35$$);$JSCompiler_StaticMethods_optoutOfCid_$self$$.dismiss(!0)})}function $JSCompiler_StaticMethods_getAsyncCid_$$($JSCompiler_StaticMethods_getAsyncCid_$self$$){return $Services$$module$src$services$cidForDoc$$($JSCompiler_StaticMethods_getAsyncCid_$self$$.element).then(function($cid$jscomp$9$$){return $cid$jscomp$9$$.get({scope:"amp-user-notification",createCookieIfNotPresent:!0},Promise.resolve(),$JSCompiler_StaticMethods_getAsyncCid_$self$$.$dialogPromise_$)})}
$JSCompiler_prototypeAlias$$.shouldShow=function(){var $$jscomp$this$jscomp$801$$=this;return this.isDismissed().then(function($dismissed$$){return $dismissed$$?!1:$$jscomp$this$jscomp$801$$.$showIfHref_$?$JSCompiler_StaticMethods_getAsyncCid_$$($$jscomp$this$jscomp$801$$).then($$jscomp$this$jscomp$801$$.$getShowEndpoint_$.bind($$jscomp$this$jscomp$801$$)).then($$jscomp$this$jscomp$801$$.$onGetShowEndpointSuccess_$.bind($$jscomp$this$jscomp$801$$)):!0})};
$JSCompiler_prototypeAlias$$.show=function(){$setStyle$$module$src$style$$(this.element,"display","");this.element.classList.add("amp-active");this.getViewport().addToFixedLayer(this.element);return this.$dialogPromise_$};
$JSCompiler_prototypeAlias$$.isDismissed=function(){var $$jscomp$this$jscomp$802$$=this;return this.$persistDismissal_$?this.$storagePromise_$.then(function($storage$jscomp$8$$){return $storage$jscomp$8$$.get($$jscomp$this$jscomp$802$$.$storageKey_$)}).then(function($$jscomp$this$jscomp$802$$){return!!$$jscomp$this$jscomp$802$$},function($$jscomp$this$jscomp$802$$){$dev$$module$src$log$$().error("amp-user-notification","Failed to read storage",$$jscomp$this$jscomp$802$$);return!1}):Promise.resolve(!1)};
$JSCompiler_prototypeAlias$$.activate=function(){this.dismiss(!1)};
$JSCompiler_prototypeAlias$$.dismiss=function($forceNoPersist$$){var $$jscomp$this$jscomp$803$$=this;this.element.classList.remove("amp-active");this.element.classList.add("amp-hidden");this.$dialogResolve_$();this.getViewport().removeFromFixedLayer(this.element);this.$persistDismissal_$&&!$forceNoPersist$$&&this.$storagePromise_$.then(function($forceNoPersist$$){$forceNoPersist$$.set($$jscomp$this$jscomp$803$$.$storageKey_$,!0)});this.$dismissHref_$&&$JSCompiler_StaticMethods_postDismissEnpoint_$$(this)};
function $UserNotificationManager$$module$extensions$amp_user_notification$0_1$amp_user_notification$$($ampdoc$jscomp$174$$){this.ampdoc=$ampdoc$jscomp$174$$;this.F=Object.create(null);this.B=Object.create(null);this.$viewer_$=$Services$$module$src$services$viewerForDoc$$(this.ampdoc);this.C=this.ampdoc.whenReady();this.D=Promise.all([this.$viewer_$.whenFirstVisible(),this.C]);this.H=$getServicePromiseForDoc$$module$src$service$$(this.ampdoc,"notificationUIManager")}
$UserNotificationManager$$module$extensions$amp_user_notification$0_1$amp_user_notification$$.prototype.get=function($id$jscomp$89$$){var $$jscomp$this$jscomp$804$$=this;this.D.then(function(){$$jscomp$this$jscomp$804$$.ampdoc.getElementById($id$jscomp$89$$)||$user$$module$src$log$$().warn("amp-user-notification","Did not find amp-user-notification element "+$id$jscomp$89$$+".")});return $JSCompiler_StaticMethods_getOrCreateDeferById_$$(this,$id$jscomp$89$$).promise};
$UserNotificationManager$$module$extensions$amp_user_notification$0_1$amp_user_notification$$.prototype.G=function($id$jscomp$90$$){var $$jscomp$this$jscomp$805$$=this;return this.C.then(function(){return $$jscomp$this$jscomp$805$$.F[$id$jscomp$90$$]})};
$UserNotificationManager$$module$extensions$amp_user_notification$0_1$amp_user_notification$$.prototype.I=function($id$jscomp$91$$,$userNotification$jscomp$1$$){var $$jscomp$this$jscomp$806$$=this;this.F[$id$jscomp$91$$]=$userNotification$jscomp$1$$;var $deferred$jscomp$49$$=$JSCompiler_StaticMethods_getOrCreateDeferById_$$(this,$id$jscomp$91$$);return this.D.then(function(){return $userNotification$jscomp$1$$.shouldShow()}).then(function($id$jscomp$91$$){if($id$jscomp$91$$)return $$jscomp$this$jscomp$806$$.H.then(function($id$jscomp$91$$){return $id$jscomp$91$$.registerUI($userNotification$jscomp$1$$.show.bind($userNotification$jscomp$1$$))})}).then($deferred$jscomp$49$$.resolve.bind(this,
$userNotification$jscomp$1$$)).catch($rethrowAsync$$module$src$log$$.bind(null,"Notification service failed amp-user-notification",$id$jscomp$91$$))};
function $JSCompiler_StaticMethods_getOrCreateDeferById_$$($JSCompiler_StaticMethods_getOrCreateDeferById_$self$$,$id$jscomp$92$$){if($JSCompiler_StaticMethods_getOrCreateDeferById_$self$$.B[$id$jscomp$92$$])return $JSCompiler_StaticMethods_getOrCreateDeferById_$self$$.B[$id$jscomp$92$$];var $$jscomp$destructuring$var366$$=new $Deferred$$module$src$utils$promise$$;return $JSCompiler_StaticMethods_getOrCreateDeferById_$self$$.B[$id$jscomp$92$$]={promise:$$jscomp$destructuring$var366$$.promise,resolve:$$jscomp$destructuring$var366$$.resolve}}
(function($AMP$jscomp$89$$){$AMP$jscomp$89$$.registerServiceForDoc("userNotificationManager",$UserNotificationManager$$module$extensions$amp_user_notification$0_1$amp_user_notification$$);$AMP$jscomp$89$$.registerServiceForDoc("notificationUIManager",$NotificationUiManager$$module$src$service$notification_ui_manager$$);$AMP$jscomp$89$$.registerElement("amp-user-notification",$AmpUserNotification$$module$extensions$amp_user_notification$0_1$amp_user_notification$$,"amp-user-notification{position:fixed!important;bottom:0;left:0;overflow:hidden!important;visibility:hidden;background:hsla(0,0%,100%,0.7);z-index:1000;width:100%}amp-user-notification.amp-active{visibility:visible}amp-user-notification.amp-hidden{visibility:hidden}\n/*# sourceURL=/extensions/amp-user-notification/0.1/amp-user-notification.css*/")})(self.AMP);})});
//# sourceMappingURL=extensions-amp-user-notification-0.1-amp-user-notification.js.map

