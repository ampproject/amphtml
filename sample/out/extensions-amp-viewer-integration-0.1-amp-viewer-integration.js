(self.AMP=self.AMP||[]).push({n:"extensions-amp-viewer-integration-0.1-amp-viewer-integration.js", v:"erwin", f:(function(){function $parseMessage$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($message$jscomp$57$$){if("string"!=typeof $message$jscomp$57$$)return $message$jscomp$57$$;if("{"!=$message$jscomp$57$$.charAt(0))return null;try{return $parseJson$$module$src$json$$($message$jscomp$57$$)}catch($e$jscomp$282$$){return null}}
function $WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($win$jscomp$359$$,$origin$jscomp$31$$,$target$jscomp$151$$){this.win=$win$jscomp$359$$;this.$origin_$=$origin$jscomp$31$$;this.$target_$=$target$jscomp$151$$}
$WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$.prototype.addEventListener=function($eventType$jscomp$53$$,$handler$jscomp$54$$){var $$jscomp$this$jscomp$817$$=this;this.win.addEventListener("message",function($eventType$jscomp$53$$){$eventType$jscomp$53$$.origin==$$jscomp$this$jscomp$817$$.$origin_$&&$eventType$jscomp$53$$.source==$$jscomp$this$jscomp$817$$.$target_$&&"__AMPHTML__"==$eventType$jscomp$53$$.data.app&&$handler$jscomp$54$$($eventType$jscomp$53$$)})};
$WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$.prototype.postMessage=function($data$jscomp$130$$){this.$target_$.postMessage($data$jscomp$130$$,this.$origin_$)};$WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$.prototype.start=function(){};
function $Messaging$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($win$jscomp$360$$,$port$jscomp$4$$,$opt_isWebview$$){this.win=$win$jscomp$360$$;this.B=$port$jscomp$4$$;this.G=!!$opt_isWebview$$;this.H=0;this.D={};this.C={};this.F=null;this.B.addEventListener("message",this.$handleMessage_$.bind(this));this.B.start()}$JSCompiler_prototypeAlias$$=$Messaging$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$.prototype;
$JSCompiler_prototypeAlias$$.registerHandler=function($messageName$jscomp$2$$,$requestHandler$$){this.C[$messageName$jscomp$2$$]=$requestHandler$$};$JSCompiler_prototypeAlias$$.unregisterHandler=function($messageName$jscomp$3$$){delete this.C[$messageName$jscomp$3$$]};$JSCompiler_prototypeAlias$$.setDefaultHandler=function($requestHandler$jscomp$1$$){this.F=$requestHandler$jscomp$1$$};
$JSCompiler_prototypeAlias$$.$handleMessage_$=function($event$jscomp$163_message$jscomp$58$$){if($event$jscomp$163_message$jscomp$58$$=$parseMessage$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($event$jscomp$163_message$jscomp$58$$.data))if("q"==$event$jscomp$163_message$jscomp$58$$.type)$JSCompiler_StaticMethods_handleRequest_$$(this,$event$jscomp$163_message$jscomp$58$$);else if("s"==$event$jscomp$163_message$jscomp$58$$.type){var $JSCompiler_requestId$jscomp$inline_2509$$=
$event$jscomp$163_message$jscomp$58$$.requestid,$JSCompiler_pending$jscomp$inline_2510$$=this.D[$JSCompiler_requestId$jscomp$inline_2509$$];$JSCompiler_pending$jscomp$inline_2510$$&&(delete this.D[$JSCompiler_requestId$jscomp$inline_2509$$],$event$jscomp$163_message$jscomp$58$$.error?($JSCompiler_StaticMethods_logError_$$(this,"amp-viewer-messaging: handleResponse_ error: ",$event$jscomp$163_message$jscomp$58$$.error),$JSCompiler_pending$jscomp$inline_2510$$.reject(Error("Request "+$event$jscomp$163_message$jscomp$58$$.name+
" failed: "+$event$jscomp$163_message$jscomp$58$$.error))):$JSCompiler_pending$jscomp$inline_2510$$.resolve($event$jscomp$163_message$jscomp$58$$.data))}};
$JSCompiler_prototypeAlias$$.sendRequest=function($messageName$jscomp$4$$,$messageData$$,$awaitResponse$jscomp$2$$){var $$jscomp$this$jscomp$818$$=this,$requestId$$=++this.H,$promise$jscomp$39$$=void 0;$awaitResponse$jscomp$2$$&&($promise$jscomp$39$$=new Promise(function($messageName$jscomp$4$$,$messageData$$){$$jscomp$this$jscomp$818$$.D[$requestId$$]={resolve:$messageName$jscomp$4$$,reject:$messageData$$}}));this.$sendMessage_$({app:"__AMPHTML__",requestid:$requestId$$,type:"q",name:$messageName$jscomp$4$$,
data:$messageData$$,rsvp:$awaitResponse$jscomp$2$$});return $promise$jscomp$39$$};
function $JSCompiler_StaticMethods_sendResponseError_$$($JSCompiler_StaticMethods_sendResponseError_$self$$,$requestId$jscomp$2$$,$messageName$jscomp$6$$,$reason$jscomp$37$$){var $errString$$=$JSCompiler_StaticMethods_errorToString_$$($reason$jscomp$37$$);$JSCompiler_StaticMethods_logError_$$($JSCompiler_StaticMethods_sendResponseError_$self$$,"amp-viewer-messaging: sendResponseError_, Message name: "+$messageName$jscomp$6$$,$errString$$);$JSCompiler_StaticMethods_sendResponseError_$self$$.$sendMessage_$({app:"__AMPHTML__",
requestid:$requestId$jscomp$2$$,type:"s",name:$messageName$jscomp$6$$,data:null,error:$errString$$})}$JSCompiler_prototypeAlias$$.$sendMessage_$=function($message$jscomp$59$$){this.B.postMessage(this.G?JSON.stringify($message$jscomp$59$$):$message$jscomp$59$$)};
function $JSCompiler_StaticMethods_handleRequest_$$($JSCompiler_StaticMethods_handleRequest_$self$$,$message$jscomp$60$$){var $error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$=$JSCompiler_StaticMethods_handleRequest_$self$$.C[$message$jscomp$60$$.name];$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$||($error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$=$JSCompiler_StaticMethods_handleRequest_$self$$.F);if(!$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$)throw $error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$=
Error("Cannot handle request because handshake is not yet confirmed!"),$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$.args=$message$jscomp$60$$.name,$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$;$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$=$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$($message$jscomp$60$$.name,$message$jscomp$60$$.data,!!$message$jscomp$60$$.rsvp);if($message$jscomp$60$$.rsvp){var $requestId$jscomp$3$$=$message$jscomp$60$$.requestid;if(!$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$)throw $JSCompiler_StaticMethods_sendResponseError_$$($JSCompiler_StaticMethods_handleRequest_$self$$,
$requestId$jscomp$3$$,$message$jscomp$60$$.name,Error("no response")),Error("expected response but none given: "+$message$jscomp$60$$.name);$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$.then(function($error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$){$JSCompiler_StaticMethods_handleRequest_$self$$.$sendMessage_$({app:"__AMPHTML__",requestid:$requestId$jscomp$3$$,type:"s",name:$message$jscomp$60$$.name,data:$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$})},function($error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$){$JSCompiler_StaticMethods_sendResponseError_$$($JSCompiler_StaticMethods_handleRequest_$self$$,
$requestId$jscomp$3$$,$message$jscomp$60$$.name,$error$jscomp$80_handler$jscomp$55_promise$jscomp$40$$)})}}function $JSCompiler_StaticMethods_logError_$$($JSCompiler_StaticMethods_logError_$self$$,$state$jscomp$84$$,$opt_data$jscomp$6$$){var $stateStr$$="amp-messaging-error-logger: "+$state$jscomp$84$$,$dataStr$$=" data: "+$JSCompiler_StaticMethods_errorToString_$$($opt_data$jscomp$6$$),$stateStr$$=$stateStr$$+$dataStr$$;$JSCompiler_StaticMethods_logError_$self$$.win.viewerState=$stateStr$$}
function $JSCompiler_StaticMethods_errorToString_$$($err$jscomp$46$$){return $err$jscomp$46$$?$err$jscomp$46$$.message?$err$jscomp$46$$.message:String($err$jscomp$46$$):"unknown error"};function $AmpViewerIntegrationVariableService$$module$extensions$amp_viewer_integration$0_1$variable_service$$($ampdoc$jscomp$179$$){var $$jscomp$this$jscomp$820$$=this;this.$ampdoc_$=$ampdoc$jscomp$179$$;this.B={ancestorOrigin:function(){var $ampdoc$jscomp$179$$=$$jscomp$this$jscomp$820$$.$ampdoc_$.win.location.ancestorOrigins;return $ampdoc$jscomp$179$$?$ampdoc$jscomp$179$$[0]:""},fragmentParam:function($ampdoc$jscomp$179$$,$defaultValue$jscomp$7$$){$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($ampdoc$jscomp$179$$,
"The first argument to FRAGMENT_PARAM, the fragment string param is required");$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$("string"==typeof $ampdoc$jscomp$179$$,"param should be a string");var $param$jscomp$20$$=$parseQueryString_$$module$src$url_parse_query_string$$($$jscomp$this$jscomp$820$$.$ampdoc_$.win.location.B);return void 0===$param$jscomp$20$$[$ampdoc$jscomp$179$$]?$defaultValue$jscomp$7$$:$param$jscomp$20$$[$ampdoc$jscomp$179$$]}}}
$AmpViewerIntegrationVariableService$$module$extensions$amp_viewer_integration$0_1$variable_service$$.prototype.get=function(){return this.B};var $EVENT_PROPERTIES$$module$extensions$amp_viewer_integration$0_1$touch_handler$$="altKey charCode ctrlKey detail eventPhase keyCode layerX layerY metaKey pageX pageY returnValue shiftKey timeStamp type which".split(" "),$TOUCH_PROPERTIES$$module$extensions$amp_viewer_integration$0_1$touch_handler$$="clientX clientY force identifier pageX pageY radiusX radiusY screenX screenY".split(" ");
function $TouchHandler$$module$extensions$amp_viewer_integration$0_1$touch_handler$$($win$jscomp$361$$,$messaging$$){this.win=$win$jscomp$361$$;this.D=$messaging$$;this.B=!1;this.C=[];$messaging$$.registerHandler("scrollLock",this.F.bind(this));$JSCompiler_StaticMethods_listenForTouchEvents_$$(this)}
function $JSCompiler_StaticMethods_listenForTouchEvents_$$($JSCompiler_StaticMethods_listenForTouchEvents_$self$$){var $handleEvent$$=$JSCompiler_StaticMethods_listenForTouchEvents_$self$$.$handleEvent_$.bind($JSCompiler_StaticMethods_listenForTouchEvents_$self$$),$doc$jscomp$104$$=$JSCompiler_StaticMethods_listenForTouchEvents_$self$$.win.document,$options$jscomp$26$$={capture:!1,passive:!$JSCompiler_StaticMethods_listenForTouchEvents_$self$$.B};$JSCompiler_StaticMethods_listenForTouchEvents_$self$$.C.push($internalListenImplementation$$module$src$event_helper_listen$$($doc$jscomp$104$$,
"touchstart",$handleEvent$$,$options$jscomp$26$$),$internalListenImplementation$$module$src$event_helper_listen$$($doc$jscomp$104$$,"touchend",$handleEvent$$,$options$jscomp$26$$),$internalListenImplementation$$module$src$event_helper_listen$$($doc$jscomp$104$$,"touchmove",$handleEvent$$,$options$jscomp$26$$))}
$TouchHandler$$module$extensions$amp_viewer_integration$0_1$touch_handler$$.prototype.$unlisten_$=function(){this.C.forEach(function($unlisten$jscomp$21$$){return $unlisten$jscomp$21$$()});this.C.length=0};
$TouchHandler$$module$extensions$amp_viewer_integration$0_1$touch_handler$$.prototype.$handleEvent_$=function($e$jscomp$284$$){switch($e$jscomp$284$$.type){case "touchstart":case "touchend":case "touchmove":if($e$jscomp$284$$&&$e$jscomp$284$$.type){var $JSCompiler_copiedEvent$jscomp$inline_3120$$=$JSCompiler_StaticMethods_copyProperties_$$($e$jscomp$284$$,$EVENT_PROPERTIES$$module$extensions$amp_viewer_integration$0_1$touch_handler$$);$e$jscomp$284$$.touches&&($JSCompiler_copiedEvent$jscomp$inline_3120$$.touches=
$JSCompiler_StaticMethods_copyTouches_$$($e$jscomp$284$$.touches));$e$jscomp$284$$.changedTouches&&($JSCompiler_copiedEvent$jscomp$inline_3120$$.changedTouches=$JSCompiler_StaticMethods_copyTouches_$$($e$jscomp$284$$.changedTouches));this.D.sendRequest($e$jscomp$284$$.type,$JSCompiler_copiedEvent$jscomp$inline_3120$$,!1)}this.B&&$e$jscomp$284$$.preventDefault()}};
function $JSCompiler_StaticMethods_copyTouches_$$($touchList$$){for(var $copiedTouches$$=[],$i$185$$=0;$i$185$$<$touchList$$.length;$i$185$$++)$copiedTouches$$.push($JSCompiler_StaticMethods_copyProperties_$$($touchList$$[$i$185$$],$TOUCH_PROPERTIES$$module$extensions$amp_viewer_integration$0_1$touch_handler$$));return $copiedTouches$$}
function $JSCompiler_StaticMethods_copyProperties_$$($o$jscomp$23$$,$properties$jscomp$2$$){for(var $copy$jscomp$3$$={},$i$186$$=0;$i$186$$<$properties$jscomp$2$$.length;$i$186$$++){var $p$jscomp$35$$=$properties$jscomp$2$$[$i$186$$];void 0!==$o$jscomp$23$$[$p$jscomp$35$$]&&($copy$jscomp$3$$[$p$jscomp$35$$]=$o$jscomp$23$$[$p$jscomp$35$$])}return $copy$jscomp$3$$}
$TouchHandler$$module$extensions$amp_viewer_integration$0_1$touch_handler$$.prototype.F=function($type$jscomp$168$$,$payload$jscomp$21$$,$awaitResponse$jscomp$3$$){this.B=!!$payload$jscomp$21$$;this.$unlisten_$();$JSCompiler_StaticMethods_listenForTouchEvents_$$(this);return $awaitResponse$jscomp$3$$?Promise.resolve({}):void 0};function $AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration$$($win$jscomp$362$$){var $$jscomp$this$jscomp$821$$=this;this.win=$win$jscomp$362$$;this.C=this.B=!1;this.$variableService_$=new $AmpViewerIntegrationVariableService$$module$extensions$amp_viewer_integration$0_1$variable_service$$($getAmpdoc$$module$src$service$$(this.win.document));$registerServiceBuilder$$module$src$service$$(this.win,"viewer-integration-variable",function(){return $$jscomp$this$jscomp$821$$.$variableService_$.get()})}
$AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration$$.prototype.init=function(){var $$jscomp$this$jscomp$822$$=this,$viewer$jscomp$48$$=$Services$$module$src$services$viewerForDoc$$(this.win.document);this.B="1"==$viewer$jscomp$48$$.getParam("webview");this.C=$viewer$jscomp$48$$.hasCapability("handshakepoll");var $origin$jscomp$32$$=$viewer$jscomp$48$$.getParam("origin")||"";if(!this.B&&!$origin$jscomp$32$$)return Promise.resolve();var $ampdoc$jscomp$180$$=$getAmpdoc$$module$src$service$$(this.win.document);
if(this.B||this.C){var $port$jscomp$5_source$jscomp$47$$=$isIframed$$module$src$dom$$(this.win)?this.win.parent:null;return $JSCompiler_StaticMethods_webviewPreHandshakePromise_$$(this,$port$jscomp$5_source$jscomp$47$$,$origin$jscomp$32$$).then(function($port$jscomp$5_source$jscomp$47$$){return $JSCompiler_StaticMethods_openChannelAndStart_$$($$jscomp$this$jscomp$822$$,$viewer$jscomp$48$$,$ampdoc$jscomp$180$$,$origin$jscomp$32$$,new $Messaging$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($$jscomp$this$jscomp$822$$.win,
$port$jscomp$5_source$jscomp$47$$,$$jscomp$this$jscomp$822$$.B))})}$port$jscomp$5_source$jscomp$47$$=new $WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$(this.win,$origin$jscomp$32$$,this.win.parent);return $JSCompiler_StaticMethods_openChannelAndStart_$$(this,$viewer$jscomp$48$$,$ampdoc$jscomp$180$$,$origin$jscomp$32$$,new $Messaging$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$(this.win,$port$jscomp$5_source$jscomp$47$$,this.B))};
function $JSCompiler_StaticMethods_webviewPreHandshakePromise_$$($JSCompiler_StaticMethods_webviewPreHandshakePromise_$self$$,$source$jscomp$48$$,$origin$jscomp$33$$){return new Promise(function($resolve$jscomp$65$$){var $unlisten$jscomp$22$$=$listen$$module$src$event_helper$$($JSCompiler_StaticMethods_webviewPreHandshakePromise_$self$$.win,"message",function($e$jscomp$287_port$jscomp$6$$){var $data$jscomp$132$$=$parseMessage$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($e$jscomp$287_port$jscomp$6$$.data);
if($data$jscomp$132$$&&$e$jscomp$287_port$jscomp$6$$.origin===$origin$jscomp$33$$&&$e$jscomp$287_port$jscomp$6$$.source===$source$jscomp$48$$&&"__AMPHTML__"==$data$jscomp$132$$.app&&"handshake-poll"==$data$jscomp$132$$.name){if($JSCompiler_StaticMethods_webviewPreHandshakePromise_$self$$.B&&(!$e$jscomp$287_port$jscomp$6$$.ports||!$e$jscomp$287_port$jscomp$6$$.ports.length))throw Error("Did not receive communication port from the Viewer!");$e$jscomp$287_port$jscomp$6$$=$e$jscomp$287_port$jscomp$6$$.ports&&
0<$e$jscomp$287_port$jscomp$6$$.ports.length?$e$jscomp$287_port$jscomp$6$$.ports[0]:new $WindowPortEmulator$$module$extensions$amp_viewer_integration$0_1$messaging$messaging$$($JSCompiler_StaticMethods_webviewPreHandshakePromise_$self$$.win,$origin$jscomp$33$$,$JSCompiler_StaticMethods_webviewPreHandshakePromise_$self$$.win.parent);$resolve$jscomp$65$$($e$jscomp$287_port$jscomp$6$$);$unlisten$jscomp$22$$()}})})}
function $JSCompiler_StaticMethods_openChannelAndStart_$$($JSCompiler_StaticMethods_openChannelAndStart_$self$$,$viewer$jscomp$49$$,$ampdoc$jscomp$181$$,$origin$jscomp$34$$,$messaging$jscomp$1$$){var $ampdocUrl$$=$ampdoc$jscomp$181$$.getUrl(),$srcUrl$$=$getSourceUrl$$module$src$url$$($ampdocUrl$$);return $messaging$jscomp$1$$.sendRequest("channelOpen",$dict$$module$src$utils$object$$({url:$ampdocUrl$$,sourceUrl:$srcUrl$$}),!0).then(function(){$JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$$($JSCompiler_StaticMethods_openChannelAndStart_$self$$,
$messaging$jscomp$1$$,$viewer$jscomp$49$$,$origin$jscomp$34$$)})}
function $JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$$($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$,$messaging$jscomp$2$$,$viewer$jscomp$50$$,$origin$jscomp$35$$){$messaging$jscomp$2$$.setDefaultHandler(function($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$,$messaging$jscomp$2$$,
$origin$jscomp$35$$){return $viewer$jscomp$50$$.receiveMessage($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$,$messaging$jscomp$2$$,$origin$jscomp$35$$)});$viewer$jscomp$50$$.setMessageDeliverer($messaging$jscomp$2$$.sendRequest.bind($messaging$jscomp$2$$),$origin$jscomp$35$$);$listenOnce$$module$src$event_helper$$($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$.win,
"unload",$JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$.D.bind($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$,$messaging$jscomp$2$$));$viewer$jscomp$50$$.hasCapability("swipe")&&new $TouchHandler$$module$extensions$amp_viewer_integration$0_1$touch_handler$$($JSCompiler_StaticMethods_AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration_prototype$setup_$self$$.win,
$messaging$jscomp$2$$)}$AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration$$.prototype.D=function($messaging$jscomp$3$$){return $messaging$jscomp$3$$.sendRequest("unloaded",{},!0)};(function($AMP$jscomp$92$$){(new $AmpViewerIntegration$$module$extensions$amp_viewer_integration$0_1$amp_viewer_integration$$($AMP$jscomp$92$$.win)).init()})(self.AMP);})});
//# sourceMappingURL=extensions-amp-viewer-integration-0.1-amp-viewer-integration.js.map

