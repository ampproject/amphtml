(self.AMP=self.AMP||[]).push({n:"extensions-amp-access-laterpay-0.1-amp-access-laterpay.js", v:"erwin", f:(function(){var $CONFIG_URLS$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$live$$={eu:"https://connector.laterpay.net",us:"https://connector.uselaterpay.com"},$CONFIG_URLS$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$sandbox$$={eu:"https://connector.sandbox.laterpaytest.net",us:"https://connector.sandbox.uselaterpaytest.com"},$DEFAULT_MESSAGES$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$={premiumContentTitle:"Buy only this article",payLaterButton:"Buy Now, Pay Later",payNowButton:"Buy Now",
defaultButton:"Buy Now",alreadyPurchasedLink:"I already bought this",sandbox:"Site in test mode. No payment required."};
function $LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$($accessService$jscomp$3$$,$accessSource$$){this.ampdoc=$accessService$jscomp$3$$.ampdoc;this.G=$accessSource$$;this.$viewport_$=$Services$$module$src$services$viewportForDoc$$(this.ampdoc);this.B=this.G.getAdapterConfig();this.I=this.J=this.D=null;this.P=[];this.K=!0;this.O=this.H=this.C=null;this.R=this.B.locale||"en";this.F=Object.assign({},$DEFAULT_MESSAGES$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$,
this.B.localeMessages||{});this.M=$JSCompiler_StaticMethods_getConfigUrl_$$(this)+"/api/v1/public/amp?article_url=CANONICAL_URL&amp_reader_id=READER_ID&return_url=RETURN_URL";var $articleId$$=this.B.articleId;$articleId$$&&(this.M+="&article_id="+encodeURIComponent($articleId$$));this.$timer_$=$Services$$module$src$services$timerFor$$(this.ampdoc.win);this.$vsync_$=$Services$$module$src$services$vsyncFor$$(this.ampdoc.win);this.$xhr_$=$Services$$module$src$services$xhrFor$$(this.ampdoc.win);$installStylesForDoc$$module$src$style_installer$$(this.ampdoc,
".amp-access-laterpay{position:relative}@media (min-width:420px){.amp-access-laterpay{width:420px}}.amp-access-laterpay ul{width:100%;padding:0;margin:0 0 40px}.amp-access-laterpay li{list-style:none;margin-bottom:20px}.amp-access-laterpay label,.amp-access-laterpay li{display:-webkit-box;display:-ms-flexbox;display:flex}.amp-access-laterpay label{padding-right:10px}.amp-access-laterpay input{width:20px}.amp-access-laterpay-container{padding:16px 24px 16px 16px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:12px;box-shadow:0 0 10px -1px rgba(0,0,0,0.25)}.amp-access-laterpay-sandbox{width:112%;padding:15px 10px;background-color:#f2902a;color:#fff;font-weight:700;text-align:center}.amp-access-laterpay-badge{text-align:center;color:#999}.amp-access-laterpay-badge a{color:#8db444}.amp-access-laterpay-header{font-size:1.2em;margin-bottom:40px}.amp-access-laterpay-metadata{width:92%}.amp-access-laterpay-title{font-size:1.1em;margin:0;padding:0}.amp-access-laterpay-description{font-size:0.9em;margin:0;padding:0}.amp-access-laterpay-price-container{margin-top:0;margin-left:auto}.amp-access-laterpay-price{font-size:1.5em}.amp-access-laterpay-currency{font-size:0.7em}.amp-access-laterpay-purchase-button{font-size:1.1em;padding:0.5em 0.8em;background-color:#8db444;border-radius:4px;border:0;color:#fff;width:70%}.amp-access-laterpay-already-purchased-link-container{font-size:0.9em}\n/*# sourceURL=/extensions/amp-access-laterpay/0.1/amp-access-laterpay.css*/",
function(){},!1,"amp-access-laterpay")}
function $JSCompiler_StaticMethods_getConfigUrl_$$($JSCompiler_StaticMethods_getConfigUrl_$self$$){var $region$$=$JSCompiler_StaticMethods_getConfigUrl_$self$$.B.region||"eu";return $getMode$$module$src$mode$$().development&&$JSCompiler_StaticMethods_getConfigUrl_$self$$.B.configUrl?$JSCompiler_StaticMethods_getConfigUrl_$self$$.B.configUrl:$JSCompiler_StaticMethods_getConfigUrl_$self$$.B.sandbox?$CONFIG_URLS$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$sandbox$$[$region$$]:$CONFIG_URLS$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$live$$[$region$$]}
$LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$.prototype.authorize=function(){var $$jscomp$this$jscomp$211$$=this;return $JSCompiler_StaticMethods_getPurchaseConfig_$$(this).then(function($response$jscomp$17$$){if(204===$response$jscomp$17$$.status)throw $user$$module$src$log$$().createError("No merchant domains have been matched for this article, or no paid content configurations are setup.");$$jscomp$this$jscomp$211$$.B.scrollToTopAfterAuth&&$$jscomp$this$jscomp$211$$.$vsync_$.mutate(function(){return $JSCompiler_StaticMethods_Viewport$$module$src$service$viewport$viewport_impl_prototype$setScrollTop$$($$jscomp$this$jscomp$211$$.$viewport_$,
0)});$JSCompiler_StaticMethods_emptyContainer_$$($$jscomp$this$jscomp$211$$);return{access:$response$jscomp$17$$.access}},function($err$jscomp$32$$){if(!$err$jscomp$32$$||!$err$jscomp$32$$.response)throw $err$jscomp$32$$;var $response$jscomp$18$$=$err$jscomp$32$$.response;if(402!==$response$jscomp$18$$.status)throw $err$jscomp$32$$;return $response$jscomp$18$$.json().catch(function(){}).then(function($err$jscomp$32$$){$$jscomp$this$jscomp$211$$.D=$err$jscomp$32$$;$JSCompiler_StaticMethods_emptyContainer_$$($$jscomp$this$jscomp$211$$).then($$jscomp$this$jscomp$211$$.U.bind($$jscomp$this$jscomp$211$$));
return{access:!1}})})};
function $JSCompiler_StaticMethods_getPurchaseConfig_$$($JSCompiler_StaticMethods_getPurchaseConfig_$self$$){var $url$jscomp$102$$=$JSCompiler_StaticMethods_getPurchaseConfig_$self$$.M+"&article_title="+encodeURIComponent($JSCompiler_StaticMethods_getArticleTitle_$$($JSCompiler_StaticMethods_getPurchaseConfig_$self$$));return $JSCompiler_StaticMethods_getPurchaseConfig_$self$$.G.buildUrl($url$jscomp$102$$,!1).then(function($url$jscomp$102$$){return $JSCompiler_StaticMethods_getPurchaseConfig_$self$$.G.$AccessSource$$module$extensions$amp_access$0_1$amp_access_source_prototype$getLoginUrl$($url$jscomp$102$$)}).then(function($url$jscomp$102$$){$dev$$module$src$log$$().$Log$$module$src$log_prototype$info$("amp-access-laterpay","Authorization URL: ",
$url$jscomp$102$$);return $JSCompiler_StaticMethods_getPurchaseConfig_$self$$.$timer_$.timeoutPromise(3E3,$JSCompiler_StaticMethods_getPurchaseConfig_$self$$.$xhr_$.fetchJson($url$jscomp$102$$,{credentials:"include"})).then(function($JSCompiler_StaticMethods_getPurchaseConfig_$self$$){return $JSCompiler_StaticMethods_getPurchaseConfig_$self$$.json()})})}
function $JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createElement_$self$$,$name$jscomp$153$$){return $JSCompiler_StaticMethods_createElement_$self$$.ampdoc.win.document.createElement($name$jscomp$153$$)}
function $JSCompiler_StaticMethods_getArticleTitle_$$($JSCompiler_StaticMethods_getArticleTitle_$self$$){var $title$jscomp$13$$=$JSCompiler_StaticMethods_getArticleTitle_$self$$.ampdoc.getRootNode().querySelector($JSCompiler_StaticMethods_getArticleTitle_$self$$.B.articleTitleSelector);$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($title$jscomp$13$$,"No article title element found with selector %s",$JSCompiler_StaticMethods_getArticleTitle_$self$$.B.articleTitleSelector);return $title$jscomp$13$$.textContent.trim()}
function $JSCompiler_StaticMethods_getContainer_$$($JSCompiler_StaticMethods_getContainer_$self$$){var $dialogContainer$$=$JSCompiler_StaticMethods_getContainer_$self$$.ampdoc.getElementById("amp-access-laterpay-dialog");return $user$$module$src$log$$().assertElement($dialogContainer$$,"No element found with id amp-access-laterpay-dialog")}
function $JSCompiler_StaticMethods_emptyContainer_$$($JSCompiler_StaticMethods_emptyContainer_$self$$){if($JSCompiler_StaticMethods_emptyContainer_$self$$.K)return Promise.resolve();for(var $unlistener$jscomp$2$$;$unlistener$jscomp$2$$=$JSCompiler_StaticMethods_emptyContainer_$self$$.P.shift();)$unlistener$jscomp$2$$();$JSCompiler_StaticMethods_emptyContainer_$self$$.J&&($JSCompiler_StaticMethods_emptyContainer_$self$$.J(),$JSCompiler_StaticMethods_emptyContainer_$self$$.J=null);$JSCompiler_StaticMethods_emptyContainer_$self$$.I&&
($JSCompiler_StaticMethods_emptyContainer_$self$$.I(),$JSCompiler_StaticMethods_emptyContainer_$self$$.I=null);return $JSCompiler_StaticMethods_emptyContainer_$self$$.$vsync_$.mutatePromise(function(){$JSCompiler_StaticMethods_emptyContainer_$self$$.K=!0;$JSCompiler_StaticMethods_emptyContainer_$self$$.C=null;$removeChildren$$module$src$dom$$($JSCompiler_StaticMethods_getContainer_$$($JSCompiler_StaticMethods_emptyContainer_$self$$))})}
$LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$.prototype.U=function(){var $$jscomp$this$jscomp$214$$=this,$dialogContainer$jscomp$1$$=$JSCompiler_StaticMethods_getContainer_$$(this);this.C=$JSCompiler_StaticMethods_createElement_$$(this,"div");this.C.className="amp-access-laterpay-container";this.B.sandbox&&$JSCompiler_StaticMethods_renderTextBlock_$$(this,"sandbox");$JSCompiler_StaticMethods_renderTextBlock_$$(this,"header");var $listContainer$$=$JSCompiler_StaticMethods_createElement_$$(this,
"ul");this.D.premiumcontent.title=this.F.premiumContentTitle;this.D.premiumcontent.description=$JSCompiler_StaticMethods_getArticleTitle_$$(this);$listContainer$$.appendChild($JSCompiler_StaticMethods_createPurchaseOption_$$(this,this.D.premiumcontent));this.D.timepasses.forEach(function($dialogContainer$jscomp$1$$){$listContainer$$.appendChild($JSCompiler_StaticMethods_createPurchaseOption_$$($$jscomp$this$jscomp$214$$,$dialogContainer$jscomp$1$$))});this.D.subscriptions.forEach(function($dialogContainer$jscomp$1$$){$listContainer$$.appendChild($JSCompiler_StaticMethods_createPurchaseOption_$$($$jscomp$this$jscomp$214$$,
$dialogContainer$jscomp$1$$))});var $purchaseButton$$=$JSCompiler_StaticMethods_createElement_$$(this,"button");$purchaseButton$$.className="amp-access-laterpay-purchase-button";$purchaseButton$$.textContent=this.F.defaultButton;this.O=$purchaseButton$$;this.J=$listen$$module$src$event_helper$$($purchaseButton$$,"click",function($dialogContainer$jscomp$1$$){var $listContainer$$=$$jscomp$this$jscomp$214$$.H.dataset.purchaseType;$JSCompiler_StaticMethods_handlePurchase_$$($$jscomp$this$jscomp$214$$,
$dialogContainer$jscomp$1$$,$$jscomp$this$jscomp$214$$.H.value,$listContainer$$)});this.C.appendChild($listContainer$$);this.C.appendChild($purchaseButton$$);this.C.appendChild($JSCompiler_StaticMethods_createAlreadyPurchasedLink_$$(this,this.D.apl));$JSCompiler_StaticMethods_renderTextBlock_$$(this,"footer");$dialogContainer$jscomp$1$$.appendChild(this.C);$dialogContainer$jscomp$1$$.appendChild($JSCompiler_StaticMethods_createLaterpayBadge_$$(this));this.K=!1;$JSCompiler_StaticMethods_preselectFirstOption_$$(this,
$listContainer$$.firstElementChild)};function $JSCompiler_StaticMethods_preselectFirstOption_$$($JSCompiler_StaticMethods_preselectFirstOption_$self$$,$firstOption$$){var $firstInput$$=$firstOption$$.querySelector('input[type="radio"]');$firstInput$$.checked=!0;$JSCompiler_StaticMethods_selectPurchaseOption_$$($JSCompiler_StaticMethods_preselectFirstOption_$self$$,$firstInput$$)}
function $JSCompiler_StaticMethods_renderTextBlock_$$($JSCompiler_StaticMethods_renderTextBlock_$self$$,$area$$){if($JSCompiler_StaticMethods_renderTextBlock_$self$$.F[$area$$]){var $el$jscomp$23$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_renderTextBlock_$self$$,"p");$el$jscomp$23$$.className="amp-access-laterpay-"+$area$$;$el$jscomp$23$$.textContent=$JSCompiler_StaticMethods_renderTextBlock_$self$$.F[$area$$];$JSCompiler_StaticMethods_renderTextBlock_$self$$.C.appendChild($el$jscomp$23$$)}}
function $JSCompiler_StaticMethods_createLaterpayBadge_$$($JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$){var $a$jscomp$10$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$,"a");$a$jscomp$10$$.href="https://laterpay.net";$a$jscomp$10$$.target="_blank";$a$jscomp$10$$.textContent="LaterPay";$JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$,
"p");$JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$.className="amp-access-laterpay-badge";$JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$.textContent="Powered by ";$JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$.appendChild($a$jscomp$10$$);return $JSCompiler_StaticMethods_createLaterpayBadge_$self_el$jscomp$24$$}
function $JSCompiler_StaticMethods_createPurchaseOption_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,$option$jscomp$2$$){var $li$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,"li"),$control$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,"label");$control$$.for=$option$jscomp$2$$.title;$control$$.appendChild($JSCompiler_StaticMethods_createRadioControl_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,
$option$jscomp$2$$));var $metadataContainer$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,"div");$metadataContainer$$.className="amp-access-laterpay-metadata";var $description$jscomp$4_title$jscomp$14$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,"span");$description$jscomp$4_title$jscomp$14$$.className="amp-access-laterpay-title";$description$jscomp$4_title$jscomp$14$$.textContent=$option$jscomp$2$$.title;
$metadataContainer$$.appendChild($description$jscomp$4_title$jscomp$14$$);$description$jscomp$4_title$jscomp$14$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,"p");$description$jscomp$4_title$jscomp$14$$.className="amp-access-laterpay-description";$description$jscomp$4_title$jscomp$14$$.textContent=$option$jscomp$2$$.description;$metadataContainer$$.appendChild($description$jscomp$4_title$jscomp$14$$);$control$$.appendChild($metadataContainer$$);
$li$$.appendChild($control$$);$li$$.appendChild($JSCompiler_StaticMethods_createPrice_$$($JSCompiler_StaticMethods_createPurchaseOption_$self$$,$option$jscomp$2$$.price));return $li$$}
function $JSCompiler_StaticMethods_createRadioControl_$$($JSCompiler_StaticMethods_createRadioControl_$self$$,$option$jscomp$3_purchaseType$jscomp$1$$){var $radio$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createRadioControl_$self$$,"input");$radio$$.name="purchaseOption";$radio$$.type="radio";$radio$$.id=$option$jscomp$3_purchaseType$jscomp$1$$.title;$radio$$.value=$option$jscomp$3_purchaseType$jscomp$1$$.purchase_url;$option$jscomp$3_purchaseType$jscomp$1$$="ppu"===$option$jscomp$3_purchaseType$jscomp$1$$.purchase_type?
"payLater":"payNow";var $purchaseActionLabel$$=$JSCompiler_StaticMethods_createRadioControl_$self$$.F[$option$jscomp$3_purchaseType$jscomp$1$$+"Button"];$radio$$.setAttribute("data-purchase-action-label",$purchaseActionLabel$$);$radio$$.setAttribute("data-purchase-type",$option$jscomp$3_purchaseType$jscomp$1$$);$JSCompiler_StaticMethods_createRadioControl_$self$$.P.push($listen$$module$src$event_helper$$($radio$$,"change",$JSCompiler_StaticMethods_createRadioControl_$self$$.S.bind($JSCompiler_StaticMethods_createRadioControl_$self$$)));
return $radio$$}
function $JSCompiler_StaticMethods_createPrice_$$($JSCompiler_StaticMethods_createPrice_$self$$,$price$$){var $currency$$=Object.keys($price$$)[0],$formattedPrice$$=($price$$[$currency$$]/100).toLocaleString($JSCompiler_StaticMethods_createPrice_$self$$.R,{style:"decimal",minimumFractionDigits:0}),$valueEl$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPrice_$self$$,"span");$valueEl$$.className="amp-access-laterpay-price";$valueEl$$.textContent=$formattedPrice$$;var $currencyEl$$=
$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPrice_$self$$,"sup");$currencyEl$$.className="amp-access-laterpay-currency";$currencyEl$$.textContent=$currency$$;var $priceEl$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createPrice_$self$$,"p");$priceEl$$.className="amp-access-laterpay-price-container";$priceEl$$.appendChild($valueEl$$);$priceEl$$.appendChild($currencyEl$$);return $priceEl$$}
function $JSCompiler_StaticMethods_createAlreadyPurchasedLink_$$($JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$,$href$jscomp$4$$){var $p$jscomp$17$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$,"p");$p$jscomp$17$$.className="amp-access-laterpay-already-purchased-link-container";var $a$jscomp$11$$=$JSCompiler_StaticMethods_createElement_$$($JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$,"a");$a$jscomp$11$$.href=$href$jscomp$4$$;
$a$jscomp$11$$.textContent=$JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$.F.alreadyPurchasedLink;$JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$.I=$listen$$module$src$event_helper$$($a$jscomp$11$$,"click",function($p$jscomp$17$$){$JSCompiler_StaticMethods_handlePurchase_$$($JSCompiler_StaticMethods_createAlreadyPurchasedLink_$self$$,$p$jscomp$17$$,$href$jscomp$4$$,"alreadyPurchased")});$p$jscomp$17$$.appendChild($a$jscomp$11$$);return $p$jscomp$17$$}
$LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$.prototype.S=function($ev$jscomp$2$$){$ev$jscomp$2$$.preventDefault();$JSCompiler_StaticMethods_selectPurchaseOption_$$(this,$ev$jscomp$2$$.target)};
function $JSCompiler_StaticMethods_selectPurchaseOption_$$($JSCompiler_StaticMethods_selectPurchaseOption_$self$$,$target$jscomp$100$$){var $selectedOptionClassname$$="amp-access-laterpay-selected",$prevPurchaseOption$$=$JSCompiler_StaticMethods_selectPurchaseOption_$self$$.H,$purchaseActionLabel$jscomp$1$$=$target$jscomp$100$$.dataset.purchaseActionLabel;$prevPurchaseOption$$&&$prevPurchaseOption$$.classList.contains($selectedOptionClassname$$)&&$prevPurchaseOption$$.classList.remove($selectedOptionClassname$$);
$JSCompiler_StaticMethods_selectPurchaseOption_$self$$.H=$target$jscomp$100$$;$JSCompiler_StaticMethods_selectPurchaseOption_$self$$.H.classList.add($selectedOptionClassname$$);$JSCompiler_StaticMethods_selectPurchaseOption_$self$$.O.textContent=$purchaseActionLabel$jscomp$1$$}
function $JSCompiler_StaticMethods_handlePurchase_$$($JSCompiler_StaticMethods_handlePurchase_$self$$,$ev$jscomp$3$$,$purchaseUrl$$,$purchaseType$jscomp$2$$){$ev$jscomp$3$$.preventDefault();$JSCompiler_StaticMethods_handlePurchase_$self$$.G.buildUrl($purchaseUrl$$,!1).then(function($ev$jscomp$3$$){$JSCompiler_StaticMethods_handlePurchase_$self$$.G.loginWithUrl($ev$jscomp$3$$,$purchaseType$jscomp$2$$)})}$LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$.prototype.pingback=function(){return Promise.resolve()};(function($AMP$jscomp$3$$){$AMP$jscomp$3$$.registerServiceForDoc("laterpay",function($AMP$jscomp$3$$){return $getElementServiceForDoc$$module$src$element_service$$($AMP$jscomp$3$$,"access","amp-access").then(function($AMP$jscomp$3$$){var $ampdoc$jscomp$91$$=$AMP$jscomp$3$$.getVendorSource("laterpay"),$accessService$jscomp$4$$=new $LaterpayVendor$$module$extensions$amp_access_laterpay$0_1$laterpay_impl$$($AMP$jscomp$3$$,$ampdoc$jscomp$91$$),$adapter$$=$ampdoc$jscomp$91$$.getAdapter();$adapter$$.registerVendor($accessService$jscomp$4$$);
return $accessService$jscomp$4$$})})})(self.AMP);})});
//# sourceMappingURL=extensions-amp-access-laterpay-0.1-amp-access-laterpay.js.map

