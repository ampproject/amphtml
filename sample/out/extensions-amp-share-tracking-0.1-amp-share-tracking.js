(self.AMP=self.AMP||[]).push({n:"extensions-amp-share-tracking-0.1-amp-share-tracking.js", v:"erwin", f:(function(){$HistoryBindingNatural_$$module$src$service$history_impl$$.prototype.$HistoryBindingInterface$$module$src$service$history_impl_prototype$updateFragment$=$JSCompiler_unstubMethod$$(5,function($fragment$jscomp$3$$){this.win.history.replaceState&&this.win.history.replaceState({},"","#"+$fragment$jscomp$3$$);return Promise.resolve()});
$HistoryBindingVirtual_$$module$src$service$history_impl$$.prototype.$HistoryBindingInterface$$module$src$service$history_impl_prototype$updateFragment$=$JSCompiler_unstubMethod$$(4,function($fragment$jscomp$4$$){return this.$viewer_$.hasCapability("fragment")?this.$viewer_$.sendMessageAwaitResponse("replaceHistory",$dict$$module$src$utils$object$$({fragment:$fragment$jscomp$4$$}),!0):Promise.resolve()});
$HistoryBindingNatural_$$module$src$service$history_impl$$.prototype.$HistoryBindingInterface$$module$src$service$history_impl_prototype$getFragment$=$JSCompiler_unstubMethod$$(3,function(){var $hash$jscomp$2$$=this.win.location.hash,$hash$jscomp$2$$=$hash$jscomp$2$$.substr(1);return Promise.resolve($hash$jscomp$2$$)});
$HistoryBindingVirtual_$$module$src$service$history_impl$$.prototype.$HistoryBindingInterface$$module$src$service$history_impl_prototype$getFragment$=$JSCompiler_unstubMethod$$(2,function(){return this.$viewer_$.hasCapability("fragment")?this.$viewer_$.sendMessageAwaitResponse("getFragment",void 0,!0).then(function($data$jscomp$60_hash$jscomp$3$$){if(!$data$jscomp$60_hash$jscomp$3$$)return"";"#"==$data$jscomp$60_hash$jscomp$3$$[0]&&($data$jscomp$60_hash$jscomp$3$$=$data$jscomp$60_hash$jscomp$3$$.substr(1));
return $data$jscomp$60_hash$jscomp$3$$}):Promise.resolve("")});
function $AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$($$jscomp$super$this$jscomp$71_element$jscomp$404$$){$$jscomp$super$this$jscomp$71_element$jscomp$404$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$71_element$jscomp$404$$)||this;$$jscomp$super$this$jscomp$71_element$jscomp$404$$.$vendorHref_$="";$$jscomp$super$this$jscomp$71_element$jscomp$404$$.$originalViewerFragment_$="";return $$jscomp$super$this$jscomp$71_element$jscomp$404$$}
$$jscomp$inherits$$($AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$,AMP.BaseElement);$AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$.prototype.$isExperimentOn_$=function(){return $isExperimentOn$$module$src$experiments$$(this.win,"amp-share-tracking")};
$AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$.prototype.isLayoutSupported=function($layout$jscomp$75$$){return"nodisplay"==$layout$jscomp$75$$||"container"==$layout$jscomp$75$$};
$AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$.prototype.buildCallback=function(){var $$jscomp$this$jscomp$641$$=this;this.$isExperimentOn_$()||($registerServiceBuilder$$module$src$service$$(this.win,"share-tracking",function(){return Promise.reject($user$$module$src$log$$().createError("amp-share-tracking disabled"))}),$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(!1,"amp-share-tracking experiment is disabled"));this.$vendorHref_$=this.element.getAttribute("data-href");
var $shareTrackingFragments$$=Promise.all([$JSCompiler_StaticMethods_getIncomingFragment_$$(this),$JSCompiler_StaticMethods_getOutgoingFragment_$$(this)]).then(function($shareTrackingFragments$$){var $JSCompiler_StaticMethods_History$$module$src$service$history_impl_prototype$updateFragment$self$jscomp$inline_2174_JSCompiler_fragmentResidual$jscomp$inline_2171_JSCompiler_incomingFragment$jscomp$inline_2169_results$jscomp$19$$=$shareTrackingFragments$$[0],$outgoingFragment$$=$shareTrackingFragments$$[1];
if($outgoingFragment$$&&""!=$outgoingFragment$$){$shareTrackingFragments$$=($shareTrackingFragments$$=$JSCompiler_StaticMethods_History$$module$src$service$history_impl_prototype$updateFragment$self$jscomp$inline_2174_JSCompiler_fragmentResidual$jscomp$inline_2171_JSCompiler_incomingFragment$jscomp$inline_2169_results$jscomp$19$$)?$$jscomp$this$jscomp$641$$.$originalViewerFragment_$.substr($shareTrackingFragments$$.length+1):$$jscomp$this$jscomp$641$$.$originalViewerFragment_$;var $JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$=
"."+$outgoingFragment$$;$shareTrackingFragments$$&&("&"!=$shareTrackingFragments$$[0]&&($JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$+="&"),$JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$+=$shareTrackingFragments$$);$shareTrackingFragments$$=$$jscomp$this$jscomp$641$$.$getHistory_$();"#"==$JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$[0]&&($JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$=
$JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$.substr(1));$shareTrackingFragments$$.B.$HistoryBindingInterface$$module$src$service$history_impl_prototype$updateFragment$($JSCompiler_fragment$jscomp$inline_2175_JSCompiler_result$jscomp$inline_2172_newFragment$jscomp$3$$)}return{incomingFragment:$JSCompiler_StaticMethods_History$$module$src$service$history_impl_prototype$updateFragment$self$jscomp$inline_2174_JSCompiler_fragmentResidual$jscomp$inline_2171_JSCompiler_incomingFragment$jscomp$inline_2169_results$jscomp$19$$,
outgoingFragment:$outgoingFragment$$}});$registerServiceBuilder$$module$src$service$$(this.win,"share-tracking",function(){return $shareTrackingFragments$$})};
function $JSCompiler_StaticMethods_getIncomingFragment_$$($JSCompiler_StaticMethods_getIncomingFragment_$self$$){return $JSCompiler_StaticMethods_getOriginalViewerFragment_$$($JSCompiler_StaticMethods_getIncomingFragment_$self$$).then(function($JSCompiler_StaticMethods_getIncomingFragment_$self$$){return($JSCompiler_StaticMethods_getIncomingFragment_$self$$=$JSCompiler_StaticMethods_getIncomingFragment_$self$$.match(/^\.([^&]*)/))?$JSCompiler_StaticMethods_getIncomingFragment_$self$$[1]:""})}
function $JSCompiler_StaticMethods_getOriginalViewerFragment_$$($JSCompiler_StaticMethods_getOriginalViewerFragment_$self$$){return $JSCompiler_StaticMethods_getOriginalViewerFragment_$self$$.$getHistory_$().B.$HistoryBindingInterface$$module$src$service$history_impl_prototype$getFragment$().then(function($fragment$jscomp$9$$){return $JSCompiler_StaticMethods_getOriginalViewerFragment_$self$$.$originalViewerFragment_$=$fragment$jscomp$9$$})}
function $JSCompiler_StaticMethods_getOutgoingFragment_$$($JSCompiler_StaticMethods_getOutgoingFragment_$self$$){return $JSCompiler_StaticMethods_getOutgoingFragment_$self$$.$vendorHref_$?$JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$$($JSCompiler_StaticMethods_getOutgoingFragment_$self$$,$JSCompiler_StaticMethods_getOutgoingFragment_$self$$.$vendorHref_$):$tryResolve$$module$src$utils$promise$$(function(){var $JSCompiler_bytes$jscomp$inline_2178$$=$getCryptoRandomBytesArray$$module$src$utils$bytes$$($JSCompiler_StaticMethods_getOutgoingFragment_$self$$.win,
6);if(!$JSCompiler_bytes$jscomp$inline_2178$$)for(var $JSCompiler_bytes$jscomp$inline_2178$$=new Uint8Array(6),$JSCompiler_random$jscomp$inline_2179$$=Math.random(),$i$171$jscomp$inline_2180$$=0;6>$i$171$jscomp$inline_2180$$;$i$171$jscomp$inline_2180$$++)$JSCompiler_random$jscomp$inline_2179$$*=256,$JSCompiler_bytes$jscomp$inline_2178$$[$i$171$jscomp$inline_2180$$]=Math.floor($JSCompiler_random$jscomp$inline_2179$$),$JSCompiler_random$jscomp$inline_2179$$-=$JSCompiler_bytes$jscomp$inline_2178$$[$i$171$jscomp$inline_2180$$];
return $base64UrlEncodeFromBytes$$module$src$utils$base64$$($JSCompiler_bytes$jscomp$inline_2178$$)})}
function $JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$$($JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$,$vendorUrl$$){var $postReq$$={method:"POST",credentials:"include",body:{}};return $Services$$module$src$services$xhrFor$$($JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$.win).fetchJson($vendorUrl$$,$postReq$$).then(function($JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$){return $JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$.json()}).then(function($postReq$$){if($postReq$$.fragment)return $postReq$$.fragment;$JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$.user().error("amp-share-tracking",
"The response from ["+$vendorUrl$$+"] does not have a fragment value.");return""},function($vendorUrl$$){$JSCompiler_StaticMethods_getOutgoingFragmentFromVendor_$self$$.user().error("amp-share-tracking","The request to share-tracking endpoint failed:",$vendorUrl$$);return""})}$AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$.prototype.$getHistory_$=function(){return $Services$$module$src$services$historyForDoc$$(this.getAmpDoc())};
(function($AMP$jscomp$78$$){$AMP$jscomp$78$$.registerElement("amp-share-tracking",$AmpShareTracking$$module$extensions$amp_share_tracking$0_1$amp_share_tracking$$)})(self.AMP);})});
//# sourceMappingURL=extensions-amp-share-tracking-0.1-amp-share-tracking.js.map

