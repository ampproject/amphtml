(self.AMP=self.AMP||[]).push({n:"extensions-amp-web-push-0.1-amp-web-push.js", v:"erwin", f:(function(){var $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$={HELPER_FRAME_URL:"helper-iframe-url",PERMISSION_DIALOG_URL:"permission-dialog-url",SERVICE_WORKER_URL:"service-worker-url"};function $WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$($element$jscomp$465$$){return AMP.BaseElement.call(this,$element$jscomp$465$$)||this}$$jscomp$inherits$$($WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$,AMP.BaseElement);
$JSCompiler_prototypeAlias$$=$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$.prototype;
$JSCompiler_prototypeAlias$$.validate=function(){if("amp-web-push"!==this.element.getAttribute("id"))throw $user$$module$src$log$$().createError("<amp-web-push> must have an id attribute with value 'amp-web-push'.");if(1<this.getAmpDoc().getRootNode().querySelectorAll("#"+$cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push")).length)throw $user$$module$src$log$$().createError("Only one <amp-web-push> element may exist on a page.");var $config$jscomp$53$$={"helper-iframe-url":null,
"permission-dialog-url":null,"service-worker-url":null},$attribute$jscomp$6$$;for($attribute$jscomp$6$$ in $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$){var $value$jscomp$174$$=$WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$[$attribute$jscomp$6$$];$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute($value$jscomp$174$$),"The "+$value$jscomp$174$$+" attribute is required for <amp-web-push>");
$config$jscomp$53$$[$value$jscomp$174$$]=this.element.getAttribute($value$jscomp$174$$)}if(!$JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$($config$jscomp$53$$["helper-iframe-url"]))throw $user$$module$src$log$$().createError("<amp-web-push> must have a valid helper-iframe-url attribute. It should begin with the https:// protocol and point to the provided lightweight template page provided for AMP messaging.");if(!$JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$($config$jscomp$53$$["permission-dialog-url"]))throw $user$$module$src$log$$().createError("<amp-web-push> must have a valid permission-dialog-url attribute. It should begin with the https:// protocol and point to the provided template page for showing the permission prompt.");
if("https:"!==$parseUrlDeprecated$$module$src$url$$($config$jscomp$53$$["service-worker-url"]).protocol)throw $user$$module$src$log$$().createError("<amp-web-push> must have a valid service-worker-url attribute. It should begin with the https:// protocol and point to the service worker JavaScript file to be installed.");if($parseUrlDeprecated$$module$src$url$$($config$jscomp$53$$["service-worker-url"]).origin!==$parseUrlDeprecated$$module$src$url$$($config$jscomp$53$$["permission-dialog-url"]).origin||
$parseUrlDeprecated$$module$src$url$$($config$jscomp$53$$["permission-dialog-url"]).origin!==$parseUrlDeprecated$$module$src$url$$($config$jscomp$53$$["helper-iframe-url"]).origin)throw $user$$module$src$log$$().createError("<amp-web-push> URL attributes service-worker-url, permission-dialog-url, and helper-iframe-url must all share the same origin.");};
$JSCompiler_prototypeAlias$$.parseConfig=function(){var $config$jscomp$54$$={},$attribute$jscomp$7$$;for($attribute$jscomp$7$$ in $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$){var $value$jscomp$175$$=$WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$[$attribute$jscomp$7$$];$config$jscomp$54$$[$value$jscomp$175$$]=this.element.getAttribute($value$jscomp$175$$)}return $config$jscomp$54$$};
$JSCompiler_prototypeAlias$$.buildCallback=function(){this.validate();var $config$jscomp$55$$=this.parseConfig(),$webPushService$$=$getServiceForDoc$$module$src$service$$(this.getAmpDoc(),"amp-web-push-service");$webPushService$$.start($config$jscomp$55$$).catch(function(){});this.registerAction("subscribe",this.$onSubscribe_$.bind(this));this.registerAction("unsubscribe",this.$onUnsubscribe_$.bind(this))};
$JSCompiler_prototypeAlias$$.$onSubscribe_$=function($invocation$jscomp$41$$){var $widget$jscomp$1$$=$invocation$jscomp$41$$.event.target;$widget$jscomp$1$$.disabled=!0;$getServiceForDoc$$module$src$service$$(this.getAmpDoc(),"amp-web-push-service").subscribe(function(){$widget$jscomp$1$$.disabled=!1}).then(function(){$widget$jscomp$1$$.disabled=!1})};
$JSCompiler_prototypeAlias$$.$onUnsubscribe_$=function($invocation$jscomp$42$$){var $widget$jscomp$3$$=$invocation$jscomp$42$$.event.target;$widget$jscomp$3$$.disabled=!0;$getServiceForDoc$$module$src$service$$(this.getAmpDoc(),"amp-web-push-service").unsubscribe().then(function(){$widget$jscomp$3$$.disabled=!1})};
function $JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$($url$jscomp$173$$){try{var $parsedUrl$jscomp$3$$=$parseUrlDeprecated$$module$src$url$$($url$jscomp$173$$),$isNotRootUrl$$=1<$parsedUrl$jscomp$3$$.pathname.length,$isSecureUrl$$="https:"===$parsedUrl$jscomp$3$$.protocol;return $isSecureUrl$$&&$isNotRootUrl$$}catch($e$jscomp$290$$){return!1}};function $WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$($element$jscomp$466$$){return AMP.BaseElement.call(this,$element$jscomp$466$$)||this}$$jscomp$inherits$$($WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$,AMP.BaseElement);$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$.prototype.isLayoutSupported=function($layout$jscomp$89$$){return"fixed"==$layout$jscomp$89$$};
$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$.prototype.buildCallback=function(){this.element.classList.add("amp-invisible")};function $IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$($ampdoc$jscomp$182$$,$url$jscomp$174$$){this.$ampdoc_$=$ampdoc$jscomp$182$$;this.$url_$=$url$jscomp$174$$;this.B=null;this.$loadPromise_$=new Promise(function(){})}
$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$.prototype.load=function(){var $$jscomp$this$jscomp$836$$=this;return this.$ampdoc_$.whenReady().then(function(){$$jscomp$this$jscomp$836$$.B=$$jscomp$this$jscomp$836$$.$ampdoc_$.win.document.createElement("iframe");$setStyle$$module$src$style$$($$jscomp$this$jscomp$836$$.B,"display","none");$$jscomp$this$jscomp$836$$.B.sandbox="allow-same-origin allow-scripts";$$jscomp$this$jscomp$836$$.B.src=$$jscomp$this$jscomp$836$$.$url_$;$$jscomp$this$jscomp$836$$.$ampdoc_$.getBody().appendChild($$jscomp$this$jscomp$836$$.B);
$$jscomp$this$jscomp$836$$.$loadPromise_$=$loadPromise$$module$src$event_helper$$($$jscomp$this$jscomp$836$$.B);return $$jscomp$this$jscomp$836$$.whenReady()})};$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$.prototype.C=function(){return this.B};$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$.prototype.whenReady=function(){return this.$loadPromise_$};function $WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$($options$jscomp$27$$){$options$jscomp$27$$||($options$jscomp$27$$={debug:!1,windowContext:window});this.D={};this.C={};this.F=this.K=this.M=!1;this.G=this.H=this.I=this.B=this.$channel_$=null;this.J=$options$jscomp$27$$.windowContext||window}$JSCompiler_prototypeAlias$$=$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.prototype;
$JSCompiler_prototypeAlias$$.listen=function($allowedOrigins$$){var $$jscomp$this$jscomp$837$$=this;return(new Promise(function($resolve$jscomp$67$$,$reject$jscomp$26$$){$$jscomp$this$jscomp$837$$.F?$reject$jscomp$26$$(Error("Already connected.")):$$jscomp$this$jscomp$837$$.M?$reject$jscomp$26$$(Error("Already listening for connections.")):Array.isArray($allowedOrigins$$)?($$jscomp$this$jscomp$837$$.I=$$jscomp$this$jscomp$837$$.$onListenConnectionMessageReceived_$.bind($$jscomp$this$jscomp$837$$,
$allowedOrigins$$,$resolve$jscomp$67$$,$reject$jscomp$26$$),$$jscomp$this$jscomp$837$$.J.addEventListener("message",$$jscomp$this$jscomp$837$$.I)):$reject$jscomp$26$$(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",$allowedOrigins$$))})).then(function(){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$($$jscomp$this$jscomp$837$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.CONNECT_HANDSHAKE,
null);$$jscomp$this$jscomp$837$$.F=!0})};
$JSCompiler_prototypeAlias$$.$onListenConnectionMessageReceived_$=function($JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$,$resolvePromise$$,$rejectPromise$$,$messageChannelEvent$$){var $message$jscomp$62$$=$messageChannelEvent$$.data,$$jscomp$destructuring$var388_JSCompiler_normalizedOrigin$jscomp$inline_2585$$=$messageChannelEvent$$,$messagePorts$$=$$jscomp$destructuring$var388_JSCompiler_normalizedOrigin$jscomp$inline_2585$$.ports;a:{for(var $$jscomp$destructuring$var388_JSCompiler_normalizedOrigin$jscomp$inline_2585$$=$parseUrlDeprecated$$module$src$url$$($$jscomp$destructuring$var388_JSCompiler_normalizedOrigin$jscomp$inline_2585$$.origin).origin,
$i$187$jscomp$inline_2586$$=0;$i$187$jscomp$inline_2586$$<$JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$.length;$i$187$jscomp$inline_2586$$++)if($parseUrlDeprecated$$module$src$url$$($JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$[$i$187$jscomp$inline_2586$$]).origin===$$jscomp$destructuring$var388_JSCompiler_normalizedOrigin$jscomp$inline_2585$$){$JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$=!0;break a}$JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$=
!1}$JSCompiler_inline_result$jscomp$544_allowedOrigins$jscomp$2$$&&$message$jscomp$62$$&&$message$jscomp$62$$.topic===$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.CONNECT_HANDSHAKE&&(this.J.removeEventListener("message",this.I),this.B=$messagePorts$$[0],this.G=this.$onChannelMessageReceived_$.bind(this),this.B.addEventListener("message",this.G,!1),this.B.start(),$resolvePromise$$())};
$JSCompiler_prototypeAlias$$.connect=function($remoteWindowContext$$,$expectedRemoteOrigin$$){var $$jscomp$this$jscomp$838$$=this;return new Promise(function($resolve$jscomp$68$$,$reject$jscomp$27$$){$remoteWindowContext$$||$reject$jscomp$27$$(Error("Provide a valid Window context to connect to."));$expectedRemoteOrigin$$||$reject$jscomp$27$$(Error("Provide an expected origin for the remote Window or provide the wildcard *."));$$jscomp$this$jscomp$838$$.F?$reject$jscomp$27$$(Error("Already connected.")):
$$jscomp$this$jscomp$838$$.K?$reject$jscomp$27$$(Error("Already connecting.")):($$jscomp$this$jscomp$838$$.$channel_$=new MessageChannel,$$jscomp$this$jscomp$838$$.B=$$jscomp$this$jscomp$838$$.$channel_$.port1,$$jscomp$this$jscomp$838$$.H=$$jscomp$this$jscomp$838$$.$onConnectConnectionMessageReceived_$.bind($$jscomp$this$jscomp$838$$,$$jscomp$this$jscomp$838$$.B,$expectedRemoteOrigin$$,$resolve$jscomp$68$$),$$jscomp$this$jscomp$838$$.B.addEventListener("message",$$jscomp$this$jscomp$838$$.H),$$jscomp$this$jscomp$838$$.B.start(),
$remoteWindowContext$$.postMessage({topic:$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.CONNECT_HANDSHAKE},"*"===$expectedRemoteOrigin$$?"*":$parseUrlDeprecated$$module$src$url$$($expectedRemoteOrigin$$).origin,[$$jscomp$this$jscomp$838$$.$channel_$.port2]))})};
$JSCompiler_prototypeAlias$$.$onConnectConnectionMessageReceived_$=function($messagePort$$,$expectedRemoteOrigin$jscomp$1$$,$resolvePromise$jscomp$1$$){this.F=!0;$messagePort$$.removeEventListener("message",this.H);this.G=this.$onChannelMessageReceived_$.bind(this);$messagePort$$.addEventListener("message",this.G,!1);$resolvePromise$jscomp$1$$()};
$JSCompiler_prototypeAlias$$.$onChannelMessageReceived_$=function($event$jscomp$166_message$jscomp$63$$){$event$jscomp$166_message$jscomp$63$$=$event$jscomp$166_message$jscomp$63$$.data;if(this.D[$event$jscomp$166_message$jscomp$63$$.id]&&$event$jscomp$166_message$jscomp$63$$.isReply){var $existingMessage$$=this.D[$event$jscomp$166_message$jscomp$63$$.id];delete this.D[$event$jscomp$166_message$jscomp$63$$.id];var $promiseResolver$$=$existingMessage$$.promiseResolver;$existingMessage$$.message=$event$jscomp$166_message$jscomp$63$$.data;
$promiseResolver$$([$event$jscomp$166_message$jscomp$63$$.data,this.$sendReply_$.bind(this,$event$jscomp$166_message$jscomp$63$$.id,$existingMessage$$.topic)])}else{var $listeners$jscomp$1$$=this.C[$event$jscomp$166_message$jscomp$63$$.topic];if($listeners$jscomp$1$$)for(var $i$188$$=0;$i$188$$<$listeners$jscomp$1$$.length;$i$188$$++)(0,$listeners$jscomp$1$$[$i$188$$])($event$jscomp$166_message$jscomp$63$$.data,this.$sendReply_$.bind(this,$event$jscomp$166_message$jscomp$63$$.id,$event$jscomp$166_message$jscomp$63$$.topic))}};
function $JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$$($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$,$callback$jscomp$134$$){var $topic$$=$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.NOTIFICATION_PERMISSION_STATE;$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.C[$topic$$]?
$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.C[$topic$$].push($callback$jscomp$134$$):$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.C[$topic$$]=[$callback$jscomp$134$$]}
$JSCompiler_prototypeAlias$$.off=function($topic$jscomp$1$$,$callback$jscomp$135$$){if($callback$jscomp$135$$){var $callbackIndex$$=this.C[$topic$jscomp$1$$].indexOf($callback$jscomp$135$$);-1!==$callbackIndex$$&&this.C[$topic$jscomp$1$$].splice($callbackIndex$$,1)}else this.C[$topic$jscomp$1$$]&&delete this.C[$topic$jscomp$1$$]};
$JSCompiler_prototypeAlias$$.$sendReply_$=function($id$jscomp$93$$,$topic$jscomp$2$$,$data$jscomp$135$$){var $$jscomp$this$jscomp$839$$=this,$payload$jscomp$23$$={id:$id$jscomp$93$$,topic:$topic$jscomp$2$$,data:$data$jscomp$135$$,isReply:!0};this.B.postMessage($payload$jscomp$23$$);return new Promise(function($id$jscomp$93$$){$$jscomp$this$jscomp$839$$.D[$payload$jscomp$23$$.id]={message:$data$jscomp$135$$,topic:$topic$jscomp$2$$,promiseResolver:$id$jscomp$93$$}})};
function $JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$,$topic$jscomp$3$$,$data$jscomp$136$$){var $payload$jscomp$24$$={id:crypto.getRandomValues(new Uint8Array(10)).join(""),topic:$topic$jscomp$3$$,data:$data$jscomp$136$$};$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$.B.postMessage($payload$jscomp$24$$);
return new Promise(function($resolve$jscomp$70$$){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$.D[$payload$jscomp$24$$.id]={message:$data$jscomp$136$$,topic:$topic$jscomp$3$$,promiseResolver:$resolve$jscomp$70$$}})}
$$jscomp$global$$.Object.defineProperties($WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$,{B:{configurable:!0,enumerable:!0,get:function(){return{CONNECT_HANDSHAKE:"topic-connect-handshake",NOTIFICATION_PERMISSION_STATE:"topic-notification-permission-state",SERVICE_WORKER_STATE:"topic-service-worker-state",SERVICE_WORKER_REGISTRATION:"topic-service-worker-registration",SERVICE_WORKER_QUERY:"topic-service-worker-query",STORAGE_GET:"topic-storage-get"}}}});function $WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$($ampdoc$jscomp$183$$){this.ampdoc=$ampdoc$jscomp$183$$;$installStylesForDoc$$module$src$style_installer$$($ampdoc$jscomp$183$$,"amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/",function(){},!1,"amp-web-push");this.$config_$={"helper-iframe-url":null,"permission-dialog-url":null,"service-worker-url":null,debug:null};this.C=$getMode$$module$src$mode$$().development;
this.F=this.$iframe_$=null;this.D=new $WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$({debug:this.C});this.B=null}$JSCompiler_prototypeAlias$$=$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.prototype;
$JSCompiler_prototypeAlias$$.start=function($configJson$jscomp$16_iframeLoadPromise$jscomp$3$$){var $$jscomp$this$jscomp$841$$=this;if(!this.environmentSupportsWebPush())return $user$$module$src$log$$().warn("amp-web-push","Web push is not supported."),Promise.reject("Web push is not supported");this.initializeConfig($configJson$jscomp$16_iframeLoadPromise$jscomp$3$$);$configJson$jscomp$16_iframeLoadPromise$jscomp$3$$=this.installHelperFrame();$configJson$jscomp$16_iframeLoadPromise$jscomp$3$$.then(function(){return $$jscomp$this$jscomp$841$$.D.connect($$jscomp$this$jscomp$841$$.$iframe_$.C().contentWindow,
$parseUrlDeprecated$$module$src$url$$($$jscomp$this$jscomp$841$$.$config_$["helper-iframe-url"]).origin)}).then(function(){if($$jscomp$this$jscomp$841$$.isContinuingSubscriptionFromRedirect())$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$$($$jscomp$this$jscomp$841$$);else return $$jscomp$this$jscomp$841$$.updateWidgetVisibilities()});return $configJson$jscomp$16_iframeLoadPromise$jscomp$3$$};
$JSCompiler_prototypeAlias$$.initializeConfig=function($configJson$jscomp$17$$){this.$config_$=$configJson$jscomp$17$$};
$JSCompiler_prototypeAlias$$.installHelperFrame=function(){var $helperUrlHasQueryParams$$=-1!==this.$config_$["helper-iframe-url"].indexOf("?"),$helperUrlQueryParamPrefix$$=$helperUrlHasQueryParams$$?"&":"?",$finalIframeUrl$$=""+this.$config_$["helper-iframe-url"]+$helperUrlQueryParamPrefix$$+("parentOrigin="+this.ampdoc.win.location.origin);this.$iframe_$=new $IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$(this.ampdoc,$finalIframeUrl$$);return this.$iframe_$.load()};
$JSCompiler_prototypeAlias$$.isContinuingSubscriptionFromRedirect=function(){return-1!==(this.ampdoc.win.fa||this.ampdoc.win.location).search.indexOf($WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.B)};
$JSCompiler_prototypeAlias$$.removePermissionPopupUrlFragmentFromUrl=function($url$jscomp$175$$){var $urlWithoutFragment$$=$url$jscomp$175$$.replace("?"+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.B,"");return $urlWithoutFragment$$=$urlWithoutFragment$$.replace("&"+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.B,"")};
function $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_queryHelperFrame_$self$$,$messageTopic$$,$message$jscomp$64$$){return $JSCompiler_StaticMethods_queryHelperFrame_$self$$.$iframe_$.whenReady().then(function(){return $JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$($JSCompiler_StaticMethods_queryHelperFrame_$self$$.D,$messageTopic$$,$message$jscomp$64$$)}).then(function($JSCompiler_StaticMethods_queryHelperFrame_$self$$){var $result$jscomp$49$$=
$JSCompiler_StaticMethods_queryHelperFrame_$self$$[0];if($result$jscomp$49$$.success)return $result$jscomp$49$$.result;throw Error("AMP page helper iframe query topic "+$messageTopic$$+" "+("and message "+$message$jscomp$64$$+" failed with: "+$result$jscomp$49$$.error));})}
function $JSCompiler_StaticMethods_queryServiceWorker_$$($JSCompiler_StaticMethods_queryServiceWorker_$self$$,$messageTopic$jscomp$1$$){return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_queryServiceWorker_$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.SERVICE_WORKER_QUERY,{topic:$messageTopic$jscomp$1$$,payload:null})}
$JSCompiler_prototypeAlias$$.queryNotificationPermission=function(){return $JSCompiler_StaticMethods_queryHelperFrame_$$(this,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.NOTIFICATION_PERMISSION_STATE,null)};
$JSCompiler_prototypeAlias$$.registerServiceWorker=function(){return $JSCompiler_StaticMethods_queryHelperFrame_$$(this,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.SERVICE_WORKER_REGISTRATION,{workerUrl:this.$config_$["service-worker-url"],registrationOptions:this.$config_$.serviceWorkerRegistrationOptions||{scope:"/"}})};$JSCompiler_prototypeAlias$$.querySubscriptionStateRemotely=function(){return $JSCompiler_StaticMethods_queryServiceWorker_$$(this,"amp-web-push-subscription-state")};
$JSCompiler_prototypeAlias$$.subscribeForPushRemotely=function(){return $JSCompiler_StaticMethods_queryServiceWorker_$$(this,"amp-web-push-subscribe")};$JSCompiler_prototypeAlias$$.unsubscribeFromPushRemotely=function(){return $JSCompiler_StaticMethods_queryServiceWorker_$$(this,"amp-web-push-unsubscribe")};
$JSCompiler_prototypeAlias$$.isServiceWorkerActivated=function(){var $$jscomp$this$jscomp$843$$=this,$self$jscomp$13$$=this;return $JSCompiler_StaticMethods_queryHelperFrame_$$(this,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.SERVICE_WORKER_STATE,null).then(function($serviceWorkerState$$){var $isControllingFrame$$=!0===$serviceWorkerState$$.isControllingFrame,$serviceWorkerHasCorrectUrl$$=$$jscomp$this$jscomp$843$$.isUrlSimilarForQueryParams($serviceWorkerState$$.url,
$self$jscomp$13$$.$config_$["service-worker-url"]),$serviceWorkerActivated$$="activated"===$serviceWorkerState$$.state;return $isControllingFrame$$&&$serviceWorkerHasCorrectUrl$$&&$serviceWorkerActivated$$})};
$JSCompiler_prototypeAlias$$.isUrlSimilarForQueryParams=function($originalUrlString$$,$urlToTestString$$){var $originalUrl$$=$parseUrlDeprecated$$module$src$url$$($originalUrlString$$),$originalUrlQueryParams$$=$parseQueryString_$$module$src$url_parse_query_string$$($originalUrl$$.search),$urlToTest$$=$parseUrlDeprecated$$module$src$url$$($urlToTestString$$),$urlToTestQueryParams$$=$parseQueryString_$$module$src$url_parse_query_string$$($urlToTest$$.search),$originalKey$$;for($originalKey$$ in $originalUrlQueryParams$$)if($urlToTestQueryParams$$[$originalKey$$]!==
$originalUrlQueryParams$$[$originalKey$$])return!1;return $originalUrl$$.origin===$urlToTest$$.origin&&$originalUrl$$.pathname===$urlToTest$$.pathname};
$JSCompiler_prototypeAlias$$.setWidgetVisibilities=function($widgetCategoryName$$,$isVisible$jscomp$1$$){for(var $widgetDomElements$$=this.ampdoc.getRootNode().querySelectorAll($cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push-widget")+"[visibility="+$cssEscape$$module$third_party$css_escape$css_escape$$($widgetCategoryName$$)+"]"),$invisibilityCssClassName$$="amp-invisible",$i$189$$=0;$i$189$$<$widgetDomElements$$.length;$i$189$$++){var $widgetDomElement$$=$widgetDomElements$$[$i$189$$];
$isVisible$jscomp$1$$?$widgetDomElement$$.classList.remove($invisibilityCssClassName$$):$widgetDomElement$$.classList.add($invisibilityCssClassName$$)}};function $JSCompiler_StaticMethods_storeLastKnownPermission_$$($JSCompiler_StaticMethods_storeLastKnownPermission_$self$$){return $JSCompiler_StaticMethods_storeLastKnownPermission_$self$$.queryNotificationPermission().then(function($permission$jscomp$2$$){$JSCompiler_StaticMethods_storeLastKnownPermission_$self$$.F=$permission$jscomp$2$$})}
$JSCompiler_prototypeAlias$$.updateWidgetVisibilities=function(){var $$jscomp$this$jscomp$845$$=this;return $JSCompiler_StaticMethods_storeLastKnownPermission_$$(this).then(function(){return $JSCompiler_StaticMethods_queryHelperFrame_$$($$jscomp$this$jscomp$845$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.NOTIFICATION_PERMISSION_STATE,{isQueryTopicSupported:$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.STORAGE_GET})}).then(function($response$jscomp$44$$){return!0===
$response$jscomp$44$$?$JSCompiler_StaticMethods_queryHelperFrame_$$($$jscomp$this$jscomp$845$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.B.STORAGE_GET,{key:"amp-web-push-notification-permission"}):Promise.resolve("default")}).then(function($canonicalNotificationPermission$$){if("denied"===$canonicalNotificationPermission$$)0<$$jscomp$this$jscomp$845$$.ampdoc.getRootNode().querySelectorAll($cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push-widget")+"[visibility="+
$cssEscape$$module$third_party$css_escape$css_escape$$("blocked")+"]").length?($$jscomp$this$jscomp$845$$.setWidgetVisibilities("unsubscribed",!1),$$jscomp$this$jscomp$845$$.setWidgetVisibilities("subscribed",!1),$$jscomp$this$jscomp$845$$.setWidgetVisibilities("blocked",!0)):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($$jscomp$this$jscomp$845$$);else return $$jscomp$this$jscomp$845$$.isServiceWorkerActivated().then(function($canonicalNotificationPermission$$){$canonicalNotificationPermission$$?
$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$$($$jscomp$this$jscomp$845$$):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($$jscomp$this$jscomp$845$$)})})};
function $JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$){$Services$$module$src$services$timerFor$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.ampdoc.win).timeoutPromise(5E3,$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.querySubscriptionStateRemotely().then(function($reply$$){switch("boolean"===typeof $reply$$?1:void 0){case $WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.C:var $isSubscribed$$=
$reply$$;$isSubscribed$$?($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.setWidgetVisibilities("unsubscribed",!1),$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.setWidgetVisibilities("subscribed",!0),$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.setWidgetVisibilities("blocked",!1)):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$);
break;default:throw $user$$module$src$log$$().createError("The controlling service worker replied to amp-web-push with an unexpected value.");}}),"The controlling service worker does not support amp-web-push.")}
function $JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$){$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$.setWidgetVisibilities("unsubscribed",!0);$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$.setWidgetVisibilities("subscribed",!1);$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$.setWidgetVisibilities("blocked",!1)}
$JSCompiler_prototypeAlias$$.subscribe=function($onPopupClosed$$){var $$jscomp$this$jscomp$847$$=this,$promises$jscomp$20$$=[];$promises$jscomp$20$$.push(this.registerServiceWorker());$promises$jscomp$20$$.push(new Promise(function($promises$jscomp$20$$){switch($$jscomp$this$jscomp$847$$.F){case "granted":return $JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($$jscomp$this$jscomp$847$$).then(function(){$promises$jscomp$20$$()});default:var $resolve$jscomp$71$$=$$jscomp$this$jscomp$847$$.openPopupOrRedirect();
$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$$($$jscomp$this$jscomp$847$$,$resolve$jscomp$71$$,$onPopupClosed$$);$$jscomp$this$jscomp$847$$.B=new $WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$({debug:$$jscomp$this$jscomp$847$$.C});$$jscomp$this$jscomp$847$$.B.listen([$$jscomp$this$jscomp$847$$.$config_$["permission-dialog-url"]]);$$jscomp$this$jscomp$847$$.onPermissionDialogInteracted().then(function($onPopupClosed$$){return $$jscomp$this$jscomp$847$$.handlePermissionDialogInteraction($onPopupClosed$$)}).then(function(){$promises$jscomp$20$$()})}}));
return Promise.all($promises$jscomp$20$$)};
function $JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$$($JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$,$permissionDialogWindow$jscomp$1$$,$onPopupClosed$jscomp$1$$){if($permissionDialogWindow$jscomp$1$$&&!$permissionDialogWindow$jscomp$1$$.closed)var $interval$jscomp$9$$=$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$.ampdoc.win.setInterval(function(){$permissionDialogWindow$jscomp$1$$.closed&&($onPopupClosed$jscomp$1$$(),$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$.ampdoc.win.clearInterval($interval$jscomp$9$$))},
500)}
$JSCompiler_prototypeAlias$$.handlePermissionDialogInteraction=function($reply$jscomp$1_result$jscomp$51$$){var $permission$jscomp$3$$=$reply$jscomp$1_result$jscomp$51$$[0];$reply$jscomp$1_result$jscomp$51$$=$reply$jscomp$1_result$jscomp$51$$[1];switch($permission$jscomp$3$$){case "denied":case "default":return $reply$jscomp$1_result$jscomp$51$$({closeFrame:!0}),this.updateWidgetVisibilities();case "granted":$reply$jscomp$1_result$jscomp$51$$({closeFrame:!0});$JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$(this);break;
default:throw Error("Unexpected permission value:",$permission$jscomp$3$$);}};function $JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$){return $JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$.subscribeForPushRemotely().then(function(){return $JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$.updateWidgetVisibilities()})}
$JSCompiler_prototypeAlias$$.unsubscribe=function(){var $$jscomp$this$jscomp$850$$=this;return this.unsubscribeFromPushRemotely().then(function(){return $$jscomp$this$jscomp$850$$.updateWidgetVisibilities()})};
$JSCompiler_prototypeAlias$$.onPermissionDialogInteracted=function(){var $$jscomp$this$jscomp$851$$=this;return new Promise(function($resolve$jscomp$72$$){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$$($$jscomp$this$jscomp$851$$.B,function($$jscomp$this$jscomp$851$$,$replyToFrame$$){$resolve$jscomp$72$$([$$jscomp$this$jscomp$851$$,$replyToFrame$$])})})};
$JSCompiler_prototypeAlias$$.openPopupOrRedirect=function(){var $pageUrlHasQueryParams$$=-1!==this.ampdoc.win.location.href.indexOf("?"),$pageUrlQueryParamPrefix$$=$pageUrlHasQueryParams$$?"&":"?",$returningPopupUrl$$=this.ampdoc.win.location.href+$pageUrlQueryParamPrefix$$+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.B,$permissionDialogUrlHasQueryParams$$=-1!==this.$config_$["permission-dialog-url"].indexOf("?"),$permissionDialogUrlQueryParamPrefix$$=$permissionDialogUrlHasQueryParams$$?
"&":"?",$openingPopupUrl$$=this.$config_$["permission-dialog-url"]+$permissionDialogUrlQueryParamPrefix$$+("return="+encodeURIComponent($returningPopupUrl$$)),$JSCompiler_w$jscomp$inline_2599$$=Math.floor(Math.min(700,.9*screen.width)),$JSCompiler_h$jscomp$inline_2600$$=Math.floor(Math.min(450,.9*screen.height));return $openWindowDialog$$module$src$dom$$(this.ampdoc.win,$openingPopupUrl$$,"_blank","height="+$JSCompiler_h$jscomp$inline_2600$$+",width="+$JSCompiler_w$jscomp$inline_2599$$+",left="+Math.floor((screen.width-
$JSCompiler_w$jscomp$inline_2599$$)/2)+",top="+Math.floor((screen.height-$JSCompiler_h$jscomp$inline_2600$$)/2)+",resizable=yes,scrollbars=yes")};
function $JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$){$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.ampdoc.win.history.replaceState(null,"",$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.removePermissionPopupUrlFragmentFromUrl($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.ampdoc.win.location.href));$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.queryNotificationPermission().then(function($permission$jscomp$4$$){switch($permission$jscomp$4$$){case "denied":case "default":return $JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.updateWidgetVisibilities();
case "granted":$JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$);break;default:throw Error("Unexpected permission value",$permission$jscomp$4$$);}})}
$JSCompiler_prototypeAlias$$.environmentSupportsWebPush=function(){return!!this.ampdoc.win.Notification&&!!this.ampdoc.win.navigator.serviceWorker&&!!this.ampdoc.win.PushManager&&("https:"===this.ampdoc.win.location.protocol||"localhost"===this.ampdoc.win.location.hostname||"127.0.0.1"===this.ampdoc.win.location.hostname||$getMode$$module$src$mode$$().development||!1)};
$$jscomp$global$$.Object.defineProperties($WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$,{B:{configurable:!0,enumerable:!0,get:function(){return"amp-web-push-subscribing=yes"}},C:{configurable:!0,enumerable:!0,get:function(){return 1}}});(function($AMP$jscomp$97$$){$AMP$jscomp$97$$.registerServiceForDoc("amp-web-push-service",$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$);$AMP$jscomp$97$$.registerElement("amp-web-push",$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$);$AMP$jscomp$97$$.registerElement("amp-web-push-widget",$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$,"amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/")})(self.AMP);})});
//# sourceMappingURL=extensions-amp-web-push-0.1-amp-web-push.js.map

