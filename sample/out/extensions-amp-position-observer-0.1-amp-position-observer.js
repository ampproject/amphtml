(self.AMP=self.AMP||[]).push({n:"extensions-amp-position-observer-0.1-amp-position-observer.js", v:"erwin", f:(function(){function $AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$($$jscomp$super$this$jscomp$67_element$jscomp$397$$){$$jscomp$super$this$jscomp$67_element$jscomp$397$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$67_element$jscomp$397$$)||this;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$action_$=null;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$isVisible_$=!1;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$positionObserver_$=null;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$topRatio_$=
0;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$bottomRatio_$=0;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$topMarginExpr_$="0";$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$bottomMarginExpr_$="0";$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$resolvedTopMargin_$=0;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$resolvedBottomMargin_$=0;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$viewportRect_$=null;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$targetId_$=
null;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$initialViewportHeight_$=null;$$jscomp$super$this$jscomp$67_element$jscomp$397$$.$scrollProgress_$=0;return $$jscomp$super$this$jscomp$67_element$jscomp$397$$}$$jscomp$inherits$$($AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$,AMP.BaseElement);$AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$.prototype.buildCallback=function(){$Services$$module$src$services$viewerForDoc$$(this.getAmpDoc()).whenFirstVisible().then(this.$init_$.bind(this))};
$AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$.prototype.$init_$=function(){var $$jscomp$this$jscomp$635$$=this;$JSCompiler_StaticMethods_parseAttributes_$$(this);this.$action_$=$Services$$module$src$services$actionServiceForDoc$$(this.element);this.$positionObserver_$||($installPositionObserverServiceForDoc$$module$src$service$position_observer$position_observer_impl$$(this.getAmpDoc()),this.$positionObserver_$=$getServiceForDoc$$module$src$service$$(this.getAmpDoc(),
"position-observer"));this.getAmpDoc().whenReady().then(function(){var $JSCompiler_scene$jscomp$inline_2137$$;$$jscomp$this$jscomp$635$$.$targetId_$?$JSCompiler_scene$jscomp$inline_2137$$=$user$$module$src$log$$().assertElement($$jscomp$this$jscomp$635$$.getAmpDoc().getElementById($$jscomp$this$jscomp$635$$.$targetId_$),"No element found with id:"+$$jscomp$this$jscomp$635$$.$targetId_$):$JSCompiler_scene$jscomp$inline_2137$$=$$jscomp$this$jscomp$635$$.element.parentNode;$$jscomp$this$jscomp$635$$.getAmpDoc().getBody()==
$JSCompiler_scene$jscomp$inline_2137$$&&($JSCompiler_scene$jscomp$inline_2137$$=$$jscomp$this$jscomp$635$$.win.document.documentElement);var $scene$$=$JSCompiler_scene$jscomp$inline_2137$$;$$jscomp$this$jscomp$635$$.$positionObserver_$.observe($scene$$,1,$$jscomp$this$jscomp$635$$.$positionChanged_$.bind($$jscomp$this$jscomp$635$$))})};
function $JSCompiler_StaticMethods_triggerScroll_$$($JSCompiler_StaticMethods_triggerScroll_$self$$){var $event$jscomp$134$$=$createCustomEvent$$module$src$event_helper$$($JSCompiler_StaticMethods_triggerScroll_$self$$.win,"amp-position-observer.scroll",{percent:$JSCompiler_StaticMethods_triggerScroll_$self$$.$scrollProgress_$});$JSCompiler_StaticMethods_triggerScroll_$self$$.$action_$.trigger($JSCompiler_StaticMethods_triggerScroll_$self$$.element,"scroll",$event$jscomp$134$$,1)}
$AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$.prototype.$positionChanged_$=function($JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$){var $JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$=this.$isVisible_$,$prevViewportHeight$$=this.$viewportRect_$&&this.$viewportRect_$.height;this.$initialViewportHeight_$||(this.$initialViewportHeight_$=$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.height);
var $JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$=this.$initialViewportHeight_$-$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.height,$JSCompiler_resizeOffset$jscomp$inline_2142$$=0;150>Math.abs($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$)?$JSCompiler_resizeOffset$jscomp$inline_2142$$=$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$:
this.$initialViewportHeight_$=null;$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect=$layoutRectLtwh$$module$src$layout_rect$$($JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.left,$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.top,$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.width,$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.height+$JSCompiler_resizeOffset$jscomp$inline_2142$$);this.$viewportRect_$=
$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect;$prevViewportHeight$$!=$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect.height&&(this.$resolvedTopMargin_$=$JSCompiler_StaticMethods_validateAndResolveMargin_$$(this,this.$topMarginExpr_$),this.$resolvedBottomMargin_$=$JSCompiler_StaticMethods_validateAndResolveMargin_$$(this,this.$bottomMarginExpr_$));var $JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$=
$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.viewportRect,$adjViewportRect$$=$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$=$layoutRectLtwh$$module$src$layout_rect$$($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.left,$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.top+this.$resolvedTopMargin_$,
$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.width,$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.height-this.$resolvedBottomMargin_$-this.$resolvedTopMargin_$),$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$=$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.positionRect,$relPos$$;$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$?
($relPos$$=$layoutRectsRelativePos$$module$src$layout_rect$$($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$,$adjViewportRect$$),this.$updateVisibility_$($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$,$adjViewportRect$$,$relPos$$)):(this.$isVisible_$=!1,$relPos$$=$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$.relativePos);$JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$&&
!this.$isVisible_$&&(this.$scrollProgress_$="bottom"==$relPos$$?0:1,$JSCompiler_StaticMethods_triggerScroll_$$(this),$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$=$createCustomEvent$$module$src$event_helper$$(this.win,"amp-position-observer.exit",{}),this.$action_$.trigger(this.element,"exit",$JSCompiler_event$jscomp$inline_2150_entry$jscomp$35$$,1));!$JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$&&this.$isVisible_$&&($JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$=
$createCustomEvent$$module$src$event_helper$$(this.win,"amp-position-observer.enter",{}),this.$action_$.trigger(this.element,"enter",$JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$,1));this.$isVisible_$&&($JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$=$adjViewportRect$$,$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$&&
(this.$scrollProgress_$=Math.abs($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.top-this.$resolvedTopMargin_$-($JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$.height-$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.height*this.$bottomRatio_$))/($JSCompiler_adjustedViewportRect$jscomp$inline_2157_JSCompiler_event$jscomp$inline_2153_wasVisible$jscomp$1$$.height+
$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.height-($JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.height*this.$bottomRatio_$+$JSCompiler_rect$jscomp$inline_2147_JSCompiler_viewportHeightChangeDelta$jscomp$inline_2141_positionRect$jscomp$1$$.height*this.$topRatio_$))),$JSCompiler_StaticMethods_triggerScroll_$$(this))};
$AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$.prototype.$updateVisibility_$=function($positionRect$jscomp$2$$,$adjustedViewportRect$$,$relativePos$$){if("inside"==$relativePos$$)this.$isVisible_$=!0;else{var $ratioToUse$$="top"==$relativePos$$?this.$topRatio_$:this.$bottomRatio_$,$offset$jscomp$23$$=$positionRect$jscomp$2$$.height*$ratioToUse$$;this.$isVisible_$="bottom"==$relativePos$$?$positionRect$jscomp$2$$.top<=$adjustedViewportRect$$.bottom-$offset$jscomp$23$$:
$positionRect$jscomp$2$$.bottom>=$adjustedViewportRect$$.top+$offset$jscomp$23$$}};
function $JSCompiler_StaticMethods_parseAttributes_$$($JSCompiler_StaticMethods_parseAttributes_$self$$){var $ratios$$=$JSCompiler_StaticMethods_parseAttributes_$self$$.element.getAttribute("intersection-ratios");if($ratios$$){var $topBottom$$=$ratios$$.trim().split(" ");$JSCompiler_StaticMethods_parseAttributes_$self$$.$topRatio_$=$JSCompiler_StaticMethods_validateAndResolveRatio_$$($topBottom$$[0]);$JSCompiler_StaticMethods_parseAttributes_$self$$.$bottomRatio_$=$JSCompiler_StaticMethods_parseAttributes_$self$$.$topRatio_$;
$topBottom$$[1]&&($JSCompiler_StaticMethods_parseAttributes_$self$$.$bottomRatio_$=$JSCompiler_StaticMethods_validateAndResolveRatio_$$($topBottom$$[1]))}var $margins$jscomp$3_topBottom$169$$=$JSCompiler_StaticMethods_parseAttributes_$self$$.element.getAttribute("viewport-margins");$margins$jscomp$3_topBottom$169$$&&($margins$jscomp$3_topBottom$169$$=$margins$jscomp$3_topBottom$169$$.trim().split(" "),$JSCompiler_StaticMethods_parseAttributes_$self$$.$topMarginExpr_$=$margins$jscomp$3_topBottom$169$$[0],
$JSCompiler_StaticMethods_parseAttributes_$self$$.$bottomMarginExpr_$=$JSCompiler_StaticMethods_parseAttributes_$self$$.$topMarginExpr_$,$margins$jscomp$3_topBottom$169$$[1]&&($JSCompiler_StaticMethods_parseAttributes_$self$$.$bottomMarginExpr_$=$margins$jscomp$3_topBottom$169$$[1]));$JSCompiler_StaticMethods_parseAttributes_$self$$.$targetId_$=$JSCompiler_StaticMethods_parseAttributes_$self$$.element.getAttribute("target")}
function $JSCompiler_StaticMethods_validateAndResolveMargin_$$($JSCompiler_StaticMethods_validateAndResolveMargin_$self$$,$val$jscomp$32$$){$val$jscomp$32$$=$assertLength$$module$src$layout$$($parseLength$$module$src$layout$$($val$jscomp$32$$));var $unit$$=$getLengthUnits$$module$src$layout$$($val$jscomp$32$$),$num$jscomp$20$$=$getLengthNumeral$$module$src$layout$$($val$jscomp$32$$);if(!$num$jscomp$20$$)return 0;$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$("px"==$unit$$||"vh"==
$unit$$,"Only pixel or vh are valid as units for exclusion margins: "+$val$jscomp$32$$);"vh"==$unit$$&&($num$jscomp$20$$=$num$jscomp$20$$/100*$JSCompiler_StaticMethods_validateAndResolveMargin_$self$$.$viewportRect_$.height);return $num$jscomp$20$$}
function $JSCompiler_StaticMethods_validateAndResolveRatio_$$($val$jscomp$33$$){var $num$jscomp$21$$=parseFloat($val$jscomp$33$$);$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(0<=$num$jscomp$21$$&&1>=$num$jscomp$21$$,"Ratios must be a decimal between 0 and 1: "+$val$jscomp$33$$);return $num$jscomp$21$$}(function($AMP$jscomp$73$$){$AMP$jscomp$73$$.registerElement("amp-position-observer",$AmpVisibilityObserver$$module$extensions$amp_position_observer$0_1$amp_position_observer$$)})(self.AMP);})});
//# sourceMappingURL=extensions-amp-position-observer-0.1-amp-position-observer.js.map

