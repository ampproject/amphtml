(self.AMP=self.AMP||[]).push({n:"extensions-amp-lightbox-0.1-amp-lightbox.js", v:"erwin", f:(function(){function $AmpLightbox$$module$extensions$amp_lightbox$0_1$amp_lightbox$$($element$jscomp$377$$){var $$jscomp$super$this$jscomp$58$$;$$jscomp$super$this$jscomp$58$$=AMP.BaseElement.call(this,$element$jscomp$377$$)||this;$$jscomp$super$this$jscomp$58$$.$size_$=null;$$jscomp$super$this$jscomp$58$$.$container_$=null;$$jscomp$super$this$jscomp$58$$.$action_$=null;$$jscomp$super$this$jscomp$58$$.$componentDescendants_$=null;$$jscomp$super$this$jscomp$58$$.$historyId_$=-1;$$jscomp$super$this$jscomp$58$$.$active_$=
!1;$$jscomp$super$this$jscomp$58$$.$boundCloseOnEscape_$=null;$$jscomp$super$this$jscomp$58$$.$isScrollable_$=!1;$$jscomp$super$this$jscomp$58$$.$pos_$=0;$$jscomp$super$this$jscomp$58$$.$oldPos_$=0;$$jscomp$super$this$jscomp$58$$.$scrollTimerId_$=null;$$jscomp$super$this$jscomp$58$$.$boundReschedule_$=$debounce$$module$src$utils$rate_limit$$($$jscomp$super$this$jscomp$58$$.win,function(){var $element$jscomp$377$$=$$jscomp$super$this$jscomp$58$$.$container_$;$$jscomp$super$this$jscomp$58$$.scheduleLayout($element$jscomp$377$$);
$$jscomp$super$this$jscomp$58$$.scheduleResume($element$jscomp$377$$)},500);return $$jscomp$super$this$jscomp$58$$}$$jscomp$inherits$$($AmpLightbox$$module$extensions$amp_lightbox$0_1$amp_lightbox$$,AMP.BaseElement);$JSCompiler_prototypeAlias$$=$AmpLightbox$$module$extensions$amp_lightbox$0_1$amp_lightbox$$.prototype;
$JSCompiler_prototypeAlias$$.buildCallback=function(){this.element.classList.add("i-amphtml-overlay");this.$action_$=$Services$$module$src$services$actionServiceForDoc$$(this.element);this.getAmpDoc().win!=this.win&&$setTransparentBody$$module$extensions$amp_lightbox$0_1$amp_lightbox$$(this.getAmpDoc().win,this.win.document.body);this.registerAction("open",this.activate.bind(this));this.registerAction("close",this.close.bind(this))};
function $JSCompiler_StaticMethods_takeOwnershipOfDescendants_$$($JSCompiler_StaticMethods_takeOwnershipOfDescendants_$self$$){$JSCompiler_StaticMethods_getComponentDescendants_$$($JSCompiler_StaticMethods_takeOwnershipOfDescendants_$self$$,!0).forEach(function($child$jscomp$23$$){$JSCompiler_StaticMethods_takeOwnershipOfDescendants_$self$$.setAsOwner($child$jscomp$23$$)})}
function $JSCompiler_StaticMethods_getComponentDescendants_$$($JSCompiler_StaticMethods_getComponentDescendants_$self$$,$opt_refresh$$){if(!$JSCompiler_StaticMethods_getComponentDescendants_$self$$.$componentDescendants_$||$opt_refresh$$)$JSCompiler_StaticMethods_getComponentDescendants_$self$$.$componentDescendants_$=$toArray$$module$src$types$$($JSCompiler_StaticMethods_getComponentDescendants_$self$$.element.getElementsByClassName("i-amphtml-element"));return $JSCompiler_StaticMethods_getComponentDescendants_$self$$.$componentDescendants_$}
$JSCompiler_prototypeAlias$$.$initialize_$=function(){var $$jscomp$this$jscomp$595$$=this;if(!this.$container_$){this.$isScrollable_$=this.element.hasAttribute("scrollable");var $children$jscomp$13$$=this.getRealChildren();this.$container_$=this.element.ownerDocument.createElement("div");this.$isScrollable_$||this.applyFillContent(this.$container_$);this.element.appendChild(this.$container_$);$children$jscomp$13$$.forEach(function($children$jscomp$13$$){$$jscomp$this$jscomp$595$$.$container_$.appendChild($children$jscomp$13$$)});
this.$isScrollable_$&&($JSCompiler_StaticMethods_takeOwnershipOfDescendants_$$(this),this.element.addEventListener("amp:dom-update",function(){$JSCompiler_StaticMethods_takeOwnershipOfDescendants_$$($$jscomp$this$jscomp$595$$);$JSCompiler_StaticMethods_updateChildrenInViewport_$$($$jscomp$this$jscomp$595$$,$$jscomp$this$jscomp$595$$.$pos_$,$$jscomp$this$jscomp$595$$.$pos_$)}),this.element.addEventListener("scroll",this.$scrollHandler_$.bind(this)));if(!this.$isScrollable_$)$Gestures$$module$src$gesture$get$$(this.element).onGesture($SwipeXYRecognizer$$module$src$gesture_recognizers$$,
function(){})}};$JSCompiler_prototypeAlias$$.layoutCallback=function(){return Promise.resolve()};$JSCompiler_prototypeAlias$$.activate=function(){var $$jscomp$this$jscomp$596$$=this;this.$active_$||(this.$initialize_$(),this.$boundCloseOnEscape_$=this.$closeOnEscape_$.bind(this),this.win.document.documentElement.addEventListener("keydown",this.$boundCloseOnEscape_$),this.getViewport().enterLightboxMode(this.element).then(function(){return $JSCompiler_StaticMethods_finalizeOpen_$$($$jscomp$this$jscomp$596$$)}))};
function $JSCompiler_StaticMethods_handleAutofocus_$$($JSCompiler_StaticMethods_handleAutofocus_$self$$){var $autofocusElement$$=$JSCompiler_StaticMethods_handleAutofocus_$self$$.$container_$.querySelector("[autofocus]");$autofocusElement$$&&$tryFocus$$module$src$dom$$($autofocusElement$$)}
function $JSCompiler_StaticMethods_finalizeOpen_$$($JSCompiler_StaticMethods_finalizeOpen_$self$$){$JSCompiler_StaticMethods_finalizeOpen_$self$$.$isScrollable_$&&$setStyle$$module$src$style$$($JSCompiler_StaticMethods_finalizeOpen_$self$$.element,"webkitOverflowScrolling","touch");$setStyles$$module$src$style$$($JSCompiler_StaticMethods_finalizeOpen_$self$$.element,{display:"",opacity:0,transition:"opacity 0.1s ease-in"});$JSCompiler_StaticMethods_handleAutofocus_$$($JSCompiler_StaticMethods_finalizeOpen_$self$$);
$JSCompiler_StaticMethods_finalizeOpen_$self$$.mutateElement(function(){$setStyle$$module$src$style$$($JSCompiler_StaticMethods_finalizeOpen_$self$$.element,"opacity","")});var $container$jscomp$13$$=$JSCompiler_StaticMethods_finalizeOpen_$self$$.$container_$;$JSCompiler_StaticMethods_finalizeOpen_$self$$.$isScrollable_$?($JSCompiler_StaticMethods_finalizeOpen_$self$$.$scrollHandler_$(),$JSCompiler_StaticMethods_updateChildrenInViewport_$$($JSCompiler_StaticMethods_finalizeOpen_$self$$,$JSCompiler_StaticMethods_finalizeOpen_$self$$.$pos_$,
$JSCompiler_StaticMethods_finalizeOpen_$self$$.$pos_$)):$JSCompiler_StaticMethods_finalizeOpen_$self$$.updateInViewport($container$jscomp$13$$,!0);$JSCompiler_StaticMethods_finalizeOpen_$self$$.element.addEventListener("transitionend",$JSCompiler_StaticMethods_finalizeOpen_$self$$.$boundReschedule_$);$JSCompiler_StaticMethods_finalizeOpen_$self$$.element.addEventListener("animationend",$JSCompiler_StaticMethods_finalizeOpen_$self$$.$boundReschedule_$);$JSCompiler_StaticMethods_finalizeOpen_$self$$.scheduleLayout($container$jscomp$13$$);
$JSCompiler_StaticMethods_finalizeOpen_$self$$.scheduleResume($container$jscomp$13$$);$JSCompiler_StaticMethods_finalizeOpen_$self$$.$triggerEvent_$("lightboxOpen");$JSCompiler_StaticMethods_finalizeOpen_$self$$.$getHistory_$().push($JSCompiler_StaticMethods_finalizeOpen_$self$$.close.bind($JSCompiler_StaticMethods_finalizeOpen_$self$$)).then(function($container$jscomp$13$$){$JSCompiler_StaticMethods_finalizeOpen_$self$$.$historyId_$=$container$jscomp$13$$});$JSCompiler_StaticMethods_finalizeOpen_$self$$.$active_$=
!0}$JSCompiler_prototypeAlias$$.$closeOnEscape_$=function($event$jscomp$118$$){27==$event$jscomp$118$$.keyCode&&this.close()};
$JSCompiler_prototypeAlias$$.close=function(){var $$jscomp$this$jscomp$598$$=this;this.$active_$&&(this.$isScrollable_$&&$setStyle$$module$src$style$$(this.element,"webkitOverflowScrolling",""),this.getViewport().leaveLightboxMode(this.element).then(function(){$$jscomp$this$jscomp$598$$.collapse();-1!=$$jscomp$this$jscomp$598$$.$historyId_$&&$$jscomp$this$jscomp$598$$.$getHistory_$().pop($$jscomp$this$jscomp$598$$.$historyId_$);$$jscomp$this$jscomp$598$$.win.document.documentElement.removeEventListener("keydown",
$$jscomp$this$jscomp$598$$.$boundCloseOnEscape_$);$$jscomp$this$jscomp$598$$.element.removeEventListener("transitionend",$$jscomp$this$jscomp$598$$.$boundReschedule_$);$$jscomp$this$jscomp$598$$.element.removeEventListener("animationend",$$jscomp$this$jscomp$598$$.$boundReschedule_$);$$jscomp$this$jscomp$598$$.$boundCloseOnEscape_$=null;$$jscomp$this$jscomp$598$$.schedulePause($$jscomp$this$jscomp$598$$.$container_$);$$jscomp$this$jscomp$598$$.$active_$=!1;$$jscomp$this$jscomp$598$$.$triggerEvent_$("lightboxClose")}))};
$JSCompiler_prototypeAlias$$.$scrollHandler_$=function(){var $currentScrollTop$$=this.element.scrollTop||1;this.$pos_$=this.element.scrollTop=$currentScrollTop$$;null===this.$scrollTimerId_$&&this.$waitForScroll_$($currentScrollTop$$)};
$JSCompiler_prototypeAlias$$.$waitForScroll_$=function($startingScrollTop$$){var $$jscomp$this$jscomp$599$$=this;this.$scrollTimerId_$=$Services$$module$src$services$timerFor$$(this.win).delay(function(){30>Math.abs($startingScrollTop$$-$$jscomp$this$jscomp$599$$.$pos_$)?($$jscomp$this$jscomp$599$$.$scrollTimerId_$=null,$$jscomp$this$jscomp$599$$.$update_$($$jscomp$this$jscomp$599$$.$pos_$)):$$jscomp$this$jscomp$599$$.$waitForScroll_$($$jscomp$this$jscomp$599$$.$pos_$)},100)};
$JSCompiler_prototypeAlias$$.$update_$=function($pos$jscomp$22$$){$JSCompiler_StaticMethods_updateChildrenInViewport_$$(this,$pos$jscomp$22$$,this.$oldPos_$);this.$pos_$=this.$oldPos_$=$pos$jscomp$22$$};
function $JSCompiler_StaticMethods_updateChildrenInViewport_$$($JSCompiler_StaticMethods_updateChildrenInViewport_$self$$,$newPos$jscomp$4$$,$oldPos$jscomp$3$$){var $seen$jscomp$4$$=[];$JSCompiler_StaticMethods_forEachVisibleChild_$$($JSCompiler_StaticMethods_updateChildrenInViewport_$self$$,$newPos$jscomp$4$$,function($newPos$jscomp$4$$){$seen$jscomp$4$$.push($newPos$jscomp$4$$);$JSCompiler_StaticMethods_updateChildrenInViewport_$self$$.updateInViewport($newPos$jscomp$4$$,!0);$JSCompiler_StaticMethods_updateChildrenInViewport_$self$$.scheduleLayout($newPos$jscomp$4$$)});
$oldPos$jscomp$3$$!=$newPos$jscomp$4$$&&$JSCompiler_StaticMethods_forEachVisibleChild_$$($JSCompiler_StaticMethods_updateChildrenInViewport_$self$$,$oldPos$jscomp$3$$,function($newPos$jscomp$4$$){$seen$jscomp$4$$.includes($newPos$jscomp$4$$)||$JSCompiler_StaticMethods_updateChildrenInViewport_$self$$.updateInViewport($newPos$jscomp$4$$,!1)})}
function $JSCompiler_StaticMethods_forEachVisibleChild_$$($JSCompiler_StaticMethods_forEachVisibleChild_$self$$,$pos$jscomp$23$$,$callback$jscomp$132$$){$JSCompiler_StaticMethods_forEachVisibleChild_$self$$.$size_$||($JSCompiler_StaticMethods_forEachVisibleChild_$self$$.$size_$={width:$JSCompiler_StaticMethods_forEachVisibleChild_$self$$.element.clientWidth,height:$JSCompiler_StaticMethods_forEachVisibleChild_$self$$.element.clientHeight});for(var $containerHeight$$=$JSCompiler_StaticMethods_forEachVisibleChild_$self$$.$size_$.height,
$descendants$$=$JSCompiler_StaticMethods_getComponentDescendants_$$($JSCompiler_StaticMethods_forEachVisibleChild_$self$$),$i$jscomp$297$$=0;$i$jscomp$297$$<$descendants$$.length;$i$jscomp$297$$++){for(var $descendant$jscomp$1$$=$descendants$$[$i$jscomp$297$$],$offsetTop$jscomp$2$$=0,$n$jscomp$37$$=$descendant$jscomp$1$$;$n$jscomp$37$$&&$JSCompiler_StaticMethods_forEachVisibleChild_$self$$.element.contains($n$jscomp$37$$);$n$jscomp$37$$=$n$jscomp$37$$.offsetParent)$offsetTop$jscomp$2$$+=$n$jscomp$37$$.offsetTop;
var $visibilityMargin$$=2*$containerHeight$$;$offsetTop$jscomp$2$$+$descendant$jscomp$1$$.offsetHeight>=$pos$jscomp$23$$-$visibilityMargin$$&&$offsetTop$jscomp$2$$<=$pos$jscomp$23$$+$visibilityMargin$$&&$callback$jscomp$132$$($descendant$jscomp$1$$)}}$JSCompiler_prototypeAlias$$.$getHistory_$=function(){return $Services$$module$src$services$historyForDoc$$(this.getAmpDoc())};
$JSCompiler_prototypeAlias$$.$triggerEvent_$=function($name$jscomp$201$$){var $event$jscomp$119$$=$createCustomEvent$$module$src$event_helper$$(this.win,"amp-lightbox."+$name$jscomp$201$$,{});this.$action_$.trigger(this.element,$name$jscomp$201$$,$event$jscomp$119$$,100)};
function $setTransparentBody$$module$extensions$amp_lightbox$0_1$amp_lightbox$$($win$jscomp$310$$,$body$jscomp$18$$){$Services$$module$src$services$vsyncFor$$($win$jscomp$310$$).run({measure:function($state$jscomp$66$$){$state$jscomp$66$$.alreadyTransparent="rgba(0, 0, 0, 0)"==$computedStyle$$module$src$style$$($win$jscomp$310$$,$body$jscomp$18$$)["background-color"]},mutate:function($win$jscomp$310$$){$win$jscomp$310$$.alreadyTransparent||$user$$module$src$log$$().warn("amp-lightbox","The background of the <body> element has been forced to transparent. If you need to set background, use an intermediate container.");
$setImportantStyles$$module$src$style$$($body$jscomp$18$$,{background:"transparent"})}},{})}"inabox"==$getMode$$module$src$mode$$().runtime&&$setTransparentBody$$module$extensions$amp_lightbox$0_1$amp_lightbox$$(window,document.body);(function($AMP$jscomp$63$$){$AMP$jscomp$63$$.registerElement("amp-lightbox",$AmpLightbox$$module$extensions$amp_lightbox$0_1$amp_lightbox$$,"amp-lightbox{display:none;position:fixed!important;z-index:1000;top:0!important;left:0!important;bottom:0!important;right:0!important}amp-lightbox[scrollable]{overflow-y:auto!important;overflow-x:hidden!important}\n/*# sourceURL=/extensions/amp-lightbox/0.1/amp-lightbox.css*/")})(self.AMP);})});
//# sourceMappingURL=extensions-amp-lightbox-0.1-amp-lightbox.js.map

