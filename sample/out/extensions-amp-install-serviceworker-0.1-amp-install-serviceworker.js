(self.AMP=self.AMP||[]).push({n:"extensions-amp-install-serviceworker-0.1-amp-install-serviceworker.js", v:"erwin", f:(function(){function $AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($$jscomp$super$this$jscomp$53_element$jscomp$352$$){$$jscomp$super$this$jscomp$53_element$jscomp$352$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$53_element$jscomp$352$$)||this;$$jscomp$super$this$jscomp$53_element$jscomp$352$$.$iframeSrc_$=null;$$jscomp$super$this$jscomp$53_element$jscomp$352$$.$urlRewriter_$=null;return $$jscomp$super$this$jscomp$53_element$jscomp$352$$}
$$jscomp$inherits$$($AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$,AMP.BaseElement);
$AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$.prototype.buildCallback=function(){var $$jscomp$this$jscomp$560$$=this,$iframeSrc$jscomp$2_win$jscomp$303$$=this.win;if("serviceWorker"in $iframeSrc$jscomp$2_win$jscomp$303$$.navigator){var $src$jscomp$45$$=this.element.getAttribute("src");$assertHttpsUrl$$module$src$url$$($src$jscomp$45$$,this.element);if($isProxyOrigin$$module$src$url$$($src$jscomp$45$$)||$isProxyOrigin$$module$src$url$$($iframeSrc$jscomp$2_win$jscomp$303$$.location.href)){if($iframeSrc$jscomp$2_win$jscomp$303$$=
this.element.getAttribute("data-iframe-src")){$assertHttpsUrl$$module$src$url$$($iframeSrc$jscomp$2_win$jscomp$303$$,this.element);var $origin$jscomp$24$$=$parseUrlDeprecated$$module$src$url$$($iframeSrc$jscomp$2_win$jscomp$303$$).origin,$canonicalUrl$jscomp$6_docInfo$jscomp$6$$=$Services$$module$src$services$documentInfoForDoc$$(this.element),$sourceUrl$jscomp$1$$=$parseUrlDeprecated$$module$src$url$$($canonicalUrl$jscomp$6_docInfo$jscomp$6$$.sourceUrl),$canonicalUrl$jscomp$6_docInfo$jscomp$6$$=
$parseUrlDeprecated$$module$src$url$$($canonicalUrl$jscomp$6_docInfo$jscomp$6$$.canonicalUrl);$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($origin$jscomp$24$$==$sourceUrl$jscomp$1$$.origin||$origin$jscomp$24$$==$canonicalUrl$jscomp$6_docInfo$jscomp$6$$.origin,"data-iframe-src (%s) should be a URL on the same origin as the source (%s) or canonical URL (%s) of the AMP-document.",$origin$jscomp$24$$,$sourceUrl$jscomp$1$$.origin,$canonicalUrl$jscomp$6_docInfo$jscomp$6$$.origin);this.$iframeSrc_$=
$iframeSrc$jscomp$2_win$jscomp$303$$;$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$(this).then(function(){return $JSCompiler_StaticMethods_insertIframe_$$($$jscomp$this$jscomp$560$$)})}}else $parseUrlDeprecated$$module$src$url$$($iframeSrc$jscomp$2_win$jscomp$303$$.location.href).origin==$parseUrlDeprecated$$module$src$url$$($src$jscomp$45$$).origin?$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$(this).then(function(){return $install$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($$jscomp$this$jscomp$560$$.win,
$src$jscomp$45$$)}):this.user().error("amp-install-serviceworker","Did not install ServiceWorker because it does not match the current origin: "+$src$jscomp$45$$)}else $JSCompiler_StaticMethods_maybeInstallUrlRewrite_$$(this)};
function $JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$){return Promise.all([$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.loadPromise($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.win),$Services$$module$src$services$viewerForDoc$$($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.getAmpDoc()).whenFirstVisible()])}
function $JSCompiler_StaticMethods_insertIframe_$$($JSCompiler_StaticMethods_insertIframe_$self$$){return $JSCompiler_StaticMethods_insertIframe_$self$$.mutateElement(function(){$setStyle$$module$src$style$$($JSCompiler_StaticMethods_insertIframe_$self$$.element,"display","none");var $iframe$jscomp$52$$=$JSCompiler_StaticMethods_insertIframe_$self$$.win.document.createElement("iframe");$iframe$jscomp$52$$.setAttribute("sandbox","allow-same-origin allow-scripts");$iframe$jscomp$52$$.src=$JSCompiler_StaticMethods_insertIframe_$self$$.$iframeSrc_$;
$JSCompiler_StaticMethods_insertIframe_$self$$.element.appendChild($iframe$jscomp$52$$)})}
function $JSCompiler_StaticMethods_maybeInstallUrlRewrite_$$($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$){if($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.getAmpDoc().isSingleDoc()){var $ampdoc$jscomp$155$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.getAmpDoc(),$winUrl$$=$parseUrlDeprecated$$module$src$url$$($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.win.location.href),$urlMatch$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element.getAttribute("data-no-service-worker-fallback-url-match"),
$shellUrl$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element.getAttribute("data-no-service-worker-fallback-shell-url");if($urlMatch$$||$shellUrl$$){$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($urlMatch$$&&$shellUrl$$,'Both, "%s" and "%s" must be specified for url-rewrite',"data-no-service-worker-fallback-url-match","data-no-service-worker-fallback-shell-url");var $shellUrl$$=$removeFragment$$module$src$url$$($shellUrl$$),$urlMatchExpr$$;try{$urlMatchExpr$$=new RegExp($urlMatch$$)}catch($e$jscomp$248$$){throw $user$$module$src$log$$().createError('Invalid "data-no-service-worker-fallback-url-match" expression',
$e$jscomp$248$$);}$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($getSourceOrigin$$module$src$url$$($winUrl$$)==$parseUrlDeprecated$$module$src$url$$($shellUrl$$).origin,'Shell source origin "%s" must be the same as source origin "%s"',$shellUrl$$,$winUrl$$.href);$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.$urlRewriter_$=new $UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($ampdoc$jscomp$155$$,$urlMatchExpr$$,$shellUrl$$);$isSecureUrl$$module$src$url$$($shellUrl$$)&&
$JSCompiler_StaticMethods_waitToPreloadShell_$$($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$,$shellUrl$$)}}}
function $JSCompiler_StaticMethods_waitToPreloadShell_$$($JSCompiler_StaticMethods_waitToPreloadShell_$self$$,$shellUrl$jscomp$1$$){$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$($JSCompiler_StaticMethods_waitToPreloadShell_$self$$).then(function(){$JSCompiler_StaticMethods_waitToPreloadShell_$self$$.mutateElement(function(){return $JSCompiler_StaticMethods_preloadShell_$$($JSCompiler_StaticMethods_waitToPreloadShell_$self$$,$shellUrl$jscomp$1$$)})})}
function $JSCompiler_StaticMethods_preloadShell_$$($JSCompiler_StaticMethods_preloadShell_$self$$,$shellUrl$jscomp$2$$){var $iframe$jscomp$53$$=$JSCompiler_StaticMethods_preloadShell_$self$$.win.document.createElement("iframe");$iframe$jscomp$53$$.id="i-amphtml-shell-preload";$iframe$jscomp$53$$.setAttribute("src",$shellUrl$jscomp$2$$+"#preload");$toggle$$module$src$style$$($iframe$jscomp$53$$,!1);$iframe$jscomp$53$$.setAttribute("sandbox","allow-scripts allow-same-origin");$JSCompiler_StaticMethods_preloadShell_$self$$.loadPromise($iframe$jscomp$53$$).then(function(){$removeElement$$module$src$dom$$($iframe$jscomp$53$$)});
$JSCompiler_StaticMethods_preloadShell_$self$$.element.appendChild($iframe$jscomp$53$$)}
function $UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($ampdoc$jscomp$156$$,$urlMatchExpr$jscomp$1$$,$shellUrl$jscomp$3$$){this.win=$ampdoc$jscomp$156$$.win;this.F=$urlMatchExpr$jscomp$1$$;this.D=$shellUrl$jscomp$3$$;this.B=$parseUrlDeprecated$$module$src$url$$($shellUrl$jscomp$3$$);$listen$$module$src$event_helper$$($ampdoc$jscomp$156$$.getRootNode(),"click",this.C.bind(this))}
$UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$.prototype.C=function($event$jscomp$110_target$jscomp$142$$){if(!$event$jscomp$110_target$jscomp$142$$.defaultPrevented&&($event$jscomp$110_target$jscomp$142$$=$closestByTag$$module$src$dom$$($event$jscomp$110_target$jscomp$142$$.target,"A"))&&$event$jscomp$110_target$jscomp$142$$.href){var $tgtLoc$jscomp$1$$=$parseUrlDeprecated$$module$src$url$$($event$jscomp$110_target$jscomp$142$$.href);if($tgtLoc$jscomp$1$$.origin==
this.B.origin&&$tgtLoc$jscomp$1$$.pathname!=this.B.pathname&&this.F.test($tgtLoc$jscomp$1$$.href)&&!$event$jscomp$110_target$jscomp$142$$.getAttribute("i-amphtml-orig-href")){var $win$jscomp$306$$=this.win;$removeFragment$$module$src$url$$($tgtLoc$jscomp$1$$.href)!=$removeFragment$$module$src$url$$($win$jscomp$306$$.location.href)&&($event$jscomp$110_target$jscomp$142$$.setAttribute("i-amphtml-orig-href",$event$jscomp$110_target$jscomp$142$$.href),$event$jscomp$110_target$jscomp$142$$.href=this.D+
"#href="+encodeURIComponent(""+$tgtLoc$jscomp$1$$.pathname+$tgtLoc$jscomp$1$$.search+$tgtLoc$jscomp$1$$.hash))}}};
function $install$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($win$jscomp$307$$,$src$jscomp$46$$){return $win$jscomp$307$$.navigator.serviceWorker.register($src$jscomp$46$$).then(function($win$jscomp$307$$){$getMode$$module$src$mode$$().development&&$user$$module$src$log$$().$Log$$module$src$log_prototype$info$("amp-install-serviceworker","ServiceWorker registration successful with scope: ",$win$jscomp$307$$.scope);return $win$jscomp$307$$},function($win$jscomp$307$$){$user$$module$src$log$$().error("amp-install-serviceworker",
"ServiceWorker registration failed:",$win$jscomp$307$$)})}(function($AMP$jscomp$58$$){$AMP$jscomp$58$$.registerElement("amp-install-serviceworker",$AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$)})(self.AMP);})});
//# sourceMappingURL=extensions-amp-install-serviceworker-0.1-amp-install-serviceworker.js.map

