(self.AMP=self.AMP||[]).push({n:"extensions-amp-vk-0.1-amp-vk.js", v:"erwin", f:(function(){var $EmbedType$$module$extensions$amp_vk$0_1$amp_vk$$={POST:"post",POLL:"poll"};
function $AmpVk$$module$extensions$amp_vk$0_1$amp_vk$$($$jscomp$super$this$jscomp$90_element$jscomp$464$$){$$jscomp$super$this$jscomp$90_element$jscomp$464$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$90_element$jscomp$464$$)||this;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$iframe_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$widgetHeight_$=0;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$unlistenMessage_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$embedType_$=
null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$ownerId_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$postId_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$hash_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$apiId_$=null;$$jscomp$super$this$jscomp$90_element$jscomp$464$$.$pollId_$=null;return $$jscomp$super$this$jscomp$90_element$jscomp$464$$}$$jscomp$inherits$$($AmpVk$$module$extensions$amp_vk$0_1$amp_vk$$,AMP.BaseElement);
$JSCompiler_prototypeAlias$$=$AmpVk$$module$extensions$amp_vk$0_1$amp_vk$$.prototype;$JSCompiler_prototypeAlias$$.preconnectCallback=function($opt_onLayout$jscomp$27$$){this.preconnect.url("https://vk.com",$opt_onLayout$jscomp$27$$)};
function $JSCompiler_StaticMethods_getIFrameSrc_$$($JSCompiler_StaticMethods_getIFrameSrc_$self$$){var $createdTime$jscomp$2$$=Date.now().toString(16),$iframeSrcPromise$$;"post"===$JSCompiler_StaticMethods_getIFrameSrc_$self$$.$embedType_$?$iframeSrcPromise$$=$JSCompiler_StaticMethods_getVkPostIFrameSrc_$$($JSCompiler_StaticMethods_getIFrameSrc_$self$$):"poll"===$JSCompiler_StaticMethods_getIFrameSrc_$self$$.$embedType_$&&($iframeSrcPromise$$=$JSCompiler_StaticMethods_getVkPollIFrameSrc_$$($JSCompiler_StaticMethods_getIFrameSrc_$self$$));
return $iframeSrcPromise$$.then(function($JSCompiler_StaticMethods_getIFrameSrc_$self$$){return $appendEncodedParamStringToUrl$$module$src$url$$($JSCompiler_StaticMethods_getIFrameSrc_$self$$,$createdTime$jscomp$2$$)})}
function $JSCompiler_StaticMethods_getVkPostIFrameSrc_$$($JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$){return $Services$$module$src$services$viewerForDoc$$($JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.element).getReferrerUrl().then(function($queryParams$jscomp$5_ref$jscomp$3$$){var $startWidth$$=$JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.element.offsetWidth,$pageUrl$jscomp$2$$=$JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.getAmpDoc().getUrl(),$iframeUrl$$="https://vk.com/widget_post.php";
$queryParams$jscomp$5_ref$jscomp$3$$=$dict$$module$src$utils$object$$({app:"0",width:"100%",_ver:"1",owner_id:$JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.$ownerId_$,post_id:$JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.$postId_$,hash:$JSCompiler_StaticMethods_getVkPostIFrameSrc_$self$$.$hash_$,amp:"1",startWidth:$startWidth$$,url:$pageUrl$jscomp$2$$,referrer:$queryParams$jscomp$5_ref$jscomp$3$$,title:"AMP Post"});return $addParamsToUrl$$module$src$url$$($iframeUrl$$,$queryParams$jscomp$5_ref$jscomp$3$$)})}
function $JSCompiler_StaticMethods_getVkPollIFrameSrc_$$($JSCompiler_StaticMethods_getVkPollIFrameSrc_$self$$){return $Services$$module$src$services$viewerForDoc$$($JSCompiler_StaticMethods_getVkPollIFrameSrc_$self$$.element).getReferrerUrl().then(function($queryParams$jscomp$6_ref$jscomp$4$$){var $pageUrl$jscomp$3$$=$JSCompiler_StaticMethods_getVkPollIFrameSrc_$self$$.getAmpDoc().getUrl();$queryParams$jscomp$6_ref$jscomp$4$$=$dict$$module$src$utils$object$$({app:$JSCompiler_StaticMethods_getVkPollIFrameSrc_$self$$.$apiId_$,
width:"100%",_ver:"1",poll_id:$JSCompiler_StaticMethods_getVkPollIFrameSrc_$self$$.$pollId_$,amp:"1",url:$pageUrl$jscomp$3$$,title:"AMP Poll",description:"",referrer:$queryParams$jscomp$6_ref$jscomp$4$$});return $addParamsToUrl$$module$src$url$$("https://vk.com/al_widget_poll.php",$queryParams$jscomp$6_ref$jscomp$4$$)})}
$JSCompiler_prototypeAlias$$.buildCallback=function(){this.$embedType_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-embedtype"),"The data-embedtype attribute is required for <amp-vk> %s",this.element);$user$$module$src$log$$().assertEnumValue($EmbedType$$module$extensions$amp_vk$0_1$amp_vk$$,this.$embedType_$,"data-embedtype");"post"===this.$embedType_$?(this.$ownerId_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-owner-id"),
"The data-owner-id attribute is required for <amp-vk> Post %s",this.element),this.$postId_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-post-id"),"The data-post-id attribute is required for <amp-vk> Post %s",this.element),this.$hash_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-hash"),"The data-hash attribute is required for <amp-vk> Post %s",this.element)):"poll"===this.$embedType_$&&(this.$apiId_$=
$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-api-id"),"The data-api-id attribute is required for <amp-vk> Poll %s",this.element),this.$pollId_$=$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.element.getAttribute("data-poll-id"),"The data-poll-id attribute is required for <amp-vk> Poll %s",this.element))};
$JSCompiler_prototypeAlias$$.layoutCallback=function(){var $$jscomp$this$jscomp$833$$=this,$iframe$jscomp$70$$=this.element.ownerDocument.createElement("iframe");this.$iframe_$=$iframe$jscomp$70$$;this.$unlistenMessage_$=$listen$$module$src$event_helper$$(this.win,"message",this.$handleVkIframeMessage_$.bind(this));return $JSCompiler_StaticMethods_getIFrameSrc_$$(this).then(function($src$jscomp$65$$){$iframe$jscomp$70$$.src=$src$jscomp$65$$;$iframe$jscomp$70$$.setAttribute("name","fXD");$iframe$jscomp$70$$.setAttribute("scrolling",
"no");$iframe$jscomp$70$$.setAttribute("frameborder","0");$iframe$jscomp$70$$.setAttribute("allowfullscreen","true");$$jscomp$this$jscomp$833$$.applyFillContent($iframe$jscomp$70$$);$$jscomp$this$jscomp$833$$.element.appendChild($iframe$jscomp$70$$);return $$jscomp$this$jscomp$833$$.loadPromise($iframe$jscomp$70$$)})};
$JSCompiler_prototypeAlias$$.$handleVkIframeMessage_$=function($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$){if("https://vk.com"===$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$.origin&&$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$.source===this.$iframe_$.contentWindow&&($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$=$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$.data)){var $regExp$$=
/\[\"resize",\[(\d+)\]]/;($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$=$regExp$$.exec($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$))&&$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$[1]&&($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$=parseInt($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$[1],10),this.$widgetHeight_$!==$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$&&
(this.$widgetHeight_$=$e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$,this.changeHeight($e$jscomp$289_eventData$jscomp$14_matches$jscomp$12_newHeight$jscomp$14$$)))}};$JSCompiler_prototypeAlias$$.isLayoutSupported=function($layout$jscomp$88$$){return"responsive"===$layout$jscomp$88$$||"flex-item"===$layout$jscomp$88$$||"fixed"===$layout$jscomp$88$$};$JSCompiler_prototypeAlias$$.unlayoutOnPause=function(){return!0};
$JSCompiler_prototypeAlias$$.unlayoutCallback=function(){this.$iframe_$&&($removeElement$$module$src$dom$$(this.$iframe_$),this.$iframe_$=null);this.$unlistenMessage_$&&this.$unlistenMessage_$();return!0};(function($AMP$jscomp$96$$){$AMP$jscomp$96$$.registerElement("amp-vk",$AmpVk$$module$extensions$amp_vk$0_1$amp_vk$$)})(self.AMP);})});
//# sourceMappingURL=extensions-amp-vk-0.1-amp-vk.js.map

