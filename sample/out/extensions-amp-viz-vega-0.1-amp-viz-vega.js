(self.AMP=self.AMP||[]).push({n:"extensions-amp-viz-vega-0.1-amp-viz-vega.js", v:"erwin", f:(function(){function $AmpVizVega$$module$extensions$amp_viz_vega$0_1$amp_viz_vega$$($$jscomp$super$this$jscomp$89_element$jscomp$463$$){$$jscomp$super$this$jscomp$89_element$jscomp$463$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$89_element$jscomp$463$$)||this;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$data_$=null;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$inlineData_$=null;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$src_$=null;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$useDataWidth_$=
!1;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$useDataHeight_$=!1;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$measuredWidth_$=0;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$measuredHeight_$=0;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$vega_$=null;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$container_$=null;$$jscomp$super$this$jscomp$89_element$jscomp$463$$.$chart_$=null;return $$jscomp$super$this$jscomp$89_element$jscomp$463$$}
$$jscomp$inherits$$($AmpVizVega$$module$extensions$amp_viz_vega$0_1$amp_viz_vega$$,AMP.BaseElement);$JSCompiler_prototypeAlias$$=$AmpVizVega$$module$extensions$amp_viz_vega$0_1$amp_viz_vega$$.prototype;$JSCompiler_prototypeAlias$$.isLayoutSupported=function($layout$jscomp$87$$){return $isLayoutSizeDefined$$module$src$layout$$($layout$jscomp$87$$)};
$JSCompiler_prototypeAlias$$.buildCallback=function(){$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($isExperimentOn$$module$src$experiments$$(this.win,"amp-viz-vega"),"Experiment amp-viz-vega disabled");this.$vega_$=this.win.vg;var $JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$;$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$=$childElementsByTag$$module$src$dom$$(this.element,
"SCRIPT");$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$.length?($user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(1==$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$.length,"%s: more than one <script> tags found. Only one allowed.",this.$getName_$()),$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$=
$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$[0],$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$($isJsonScriptTag$$module$src$dom$$($JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$),'%s: data should be put in a <script type="application/json"> tag.',this.$getName_$()),$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$=
$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$.textContent):$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$=void 0;this.$inlineData_$=$JSCompiler_child$jscomp$inline_2557_JSCompiler_inline_result$jscomp$541_JSCompiler_scripts$jscomp$inline_2556$$;this.$src_$=this.element.getAttribute("src");this.$useDataWidth_$=this.element.hasAttribute("use-data-width");this.$useDataHeight_$=
this.element.hasAttribute("use-data-height");$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(this.$inlineData_$||this.$src_$,'%s: neither `src` attribute nor a valid <script type="application/json"> child was found for Vega data.',this.$getName_$());$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(!(this.$inlineData_$&&this.$src_$),'%s: both `src` attribute and a valid <script type="application/json"> child were found for Vega data. Only one way of specifying the data is allowed.',
this.$getName_$());this.$src_$&&$assertHttpsUrl$$module$src$url$$(this.$src_$,this.element,this.$getName_$())};$JSCompiler_prototypeAlias$$.layoutCallback=function(){var $$jscomp$this$jscomp$828$$=this;this.$initialize_$();return $JSCompiler_StaticMethods_loadData_$$(this).then(function(){return $JSCompiler_StaticMethods_renderGraph_$$($$jscomp$this$jscomp$828$$)})};
$JSCompiler_prototypeAlias$$.onLayoutMeasure=function(){var $box$jscomp$19$$=this.getLayoutBox();if(this.$measuredWidth_$!=$box$jscomp$19$$.width||this.$measuredHeight_$!=$box$jscomp$19$$.height)this.$measuredWidth_$=$box$jscomp$19$$.width,this.$measuredHeight_$=$box$jscomp$19$$.height,this.$chart_$&&$JSCompiler_StaticMethods_renderGraph_$$(this)};
$JSCompiler_prototypeAlias$$.$initialize_$=function(){this.$container_$=this.element.ownerDocument.createElement("div");this.applyFillContent(this.$container_$,!0);this.element.appendChild(this.$container_$)};
function $JSCompiler_StaticMethods_loadData_$$($JSCompiler_StaticMethods_loadData_$self$$){return $JSCompiler_StaticMethods_loadData_$self$$.$inlineData_$?($JSCompiler_StaticMethods_loadData_$self$$.$data_$=$tryParseJson$$module$src$json$$($JSCompiler_StaticMethods_loadData_$self$$.$inlineData_$,function($JSCompiler_StaticMethods_loadData_$self$$){$user$$module$src$log$$().$Log$$module$src$log_prototype$assert$(!$JSCompiler_StaticMethods_loadData_$self$$,"data could not be parsed. Is it in a valid JSON format?: %s",
$JSCompiler_StaticMethods_loadData_$self$$)}),Promise.resolve()):$Services$$module$src$services$xhrFor$$($JSCompiler_StaticMethods_loadData_$self$$.win).fetchJson($JSCompiler_StaticMethods_loadData_$self$$.$src_$,{requireAmpResponseSourceOrigin:!1}).then(function($JSCompiler_StaticMethods_loadData_$self$$){return $JSCompiler_StaticMethods_loadData_$self$$.json()}).then(function($data$jscomp$134$$){$JSCompiler_StaticMethods_loadData_$self$$.$data_$=$data$jscomp$134$$})}
function $JSCompiler_StaticMethods_renderGraph_$$($JSCompiler_StaticMethods_renderGraph_$self$$){var $parsePromise$$=new Promise(function($parsePromise$$,$reject$jscomp$25$$){$JSCompiler_StaticMethods_renderGraph_$self$$.$vega_$.parse.spec($JSCompiler_StaticMethods_renderGraph_$self$$.$data_$,function($JSCompiler_StaticMethods_renderGraph_$self$$,$resolve$jscomp$66$$){$JSCompiler_StaticMethods_renderGraph_$self$$&&$reject$jscomp$25$$($JSCompiler_StaticMethods_renderGraph_$self$$);$parsePromise$$($resolve$jscomp$66$$)})});
return $parsePromise$$.then(function($parsePromise$$){return $Services$$module$src$services$vsyncFor$$($JSCompiler_StaticMethods_renderGraph_$self$$.win).mutatePromise(function(){$removeChildren$$module$src$dom$$($JSCompiler_StaticMethods_renderGraph_$self$$.$container_$);$JSCompiler_StaticMethods_renderGraph_$self$$.$chart_$=$parsePromise$$({el:$JSCompiler_StaticMethods_renderGraph_$self$$.$container_$});if(!$JSCompiler_StaticMethods_renderGraph_$self$$.$useDataWidth_$){var $chartFactory$jscomp$1$$=
$JSCompiler_StaticMethods_renderGraph_$self$$.$measuredWidth_$-$JSCompiler_StaticMethods_getDataPadding_$$($JSCompiler_StaticMethods_renderGraph_$self$$,"width");$JSCompiler_StaticMethods_renderGraph_$self$$.$chart_$.width($chartFactory$jscomp$1$$)}$JSCompiler_StaticMethods_renderGraph_$self$$.$useDataHeight_$||($chartFactory$jscomp$1$$=$JSCompiler_StaticMethods_renderGraph_$self$$.$measuredHeight_$-$JSCompiler_StaticMethods_getDataPadding_$$($JSCompiler_StaticMethods_renderGraph_$self$$,"height"),
$JSCompiler_StaticMethods_renderGraph_$self$$.$chart_$.height($chartFactory$jscomp$1$$));$JSCompiler_StaticMethods_renderGraph_$self$$.$chart_$.viewport([$JSCompiler_StaticMethods_renderGraph_$self$$.$measuredWidth_$,$JSCompiler_StaticMethods_renderGraph_$self$$.$measuredHeight_$]);$JSCompiler_StaticMethods_renderGraph_$self$$.$chart_$.update()})})}
function $JSCompiler_StaticMethods_getDataPadding_$$($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$,$widthOrHeight$jscomp$1$$){$JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$=$JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$.$data_$.padding;if(!$JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$)return 0;if($isFiniteNumber$$module$src$types$$($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$))return $JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$;
if($isObject$$module$src$types$$($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$)){if("width"==$widthOrHeight$jscomp$1$$)return($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$.left||0)+($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$.right||0);if("height"==$widthOrHeight$jscomp$1$$)return($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$.top||0)+($JSCompiler_StaticMethods_getDataPadding_$self_p$jscomp$36$$.bottom||0)}return 0}
$JSCompiler_prototypeAlias$$.$getName_$=function(){return"amp-viz-vega "+(this.element.getAttribute("id")||"<unknown id>")};(function($AMP$jscomp$95$$){$AMP$jscomp$95$$.registerElement("amp-viz-vega",$AmpVizVega$$module$extensions$amp_viz_vega$0_1$amp_viz_vega$$,"amp-viz-vega canvas{display:block}\n/*# sourceURL=/extensions/amp-viz-vega/0.1/amp-viz-vega.css*/")})(self.AMP);})});
//# sourceMappingURL=extensions-amp-viz-vega-0.1-amp-viz-vega.js.map

