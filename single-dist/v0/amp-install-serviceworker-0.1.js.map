{"version":3,"sources":["/extensions/amp-install-serviceworker/0.1/amp-install-serviceworker.js","/src/service/viewer-impl.js","/src/service/url-impl.js"],"names":["constructor","element","iframeSrc_","urlRewriter_","isSafari_","isSafari","Services$$module$src$services.platformFor","win","whenLoadedAndVisiblePromise_","Promise","all","loadPromise","Services$$module$src$services.viewerForDoc","whenFirstVisible","getAmpDoc","whenFirstVisiblePromise_","insertIframe_","mutateElement","toggle","iframe","document","createElement","setAttribute","src","appendChild","maybeInstallUrlRewrite_","isSingleDoc","ampdoc","urlService","Services$$module$src$services.urlForDoc","getUrlService_","parse","location","href","urlMatch","getAttribute","shellUrl","removeFragment","urlMatchExpr","RegExp","e","user","createError","UrlRewriter_","isSecure","waitToPreloadShell_","then","preloadShell_","id","loaded","removeElement","urlMatchExpr_","shellUrl_","urlService_","shellLoc_","listen","getRootNode","handle_","bind","install","options","hasAttribute","scope","navigator","serviceWorker","register","registration","getMode","development","info","TAG","installingSw","installing","addEventListener","evt","target","state","performServiceWorkerOptimizations","active","error","sendAmpScriptToSwOnFirstVisit","prefetchOutgoingLinks","ampScriptsUsed","performance","getEntriesByType","filter","item","initiatorType","startsWith","name","urls","cdn","map","script","activeSW","postMessage","JSON","stringify","dict","links","call","querySelectorAll","link","supportsPrefetch","forEach","linkTag","head","doc","fakeLink","relList","supports","$jscomp.inherits","BaseElement","AmpInstallServiceWorker","AMP","buildCallback","isProxyOrigin","origin","iframeSrc","docInfo","Services$$module$src$services.documentInfoForDoc","sourceUrl","canonicalUrl","event","defaultPrevented","closestAncestorElementBySelector","tgtLoc","pathname","test","encodeURIComponent","search","hash","registerElement"],"mappings":"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","file":"amp-install-serviceworker-0.1.js","sourcesContent":[]}