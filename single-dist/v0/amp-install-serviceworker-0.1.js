(self.AMP=self.AMP||[]).push({n:"amp-install-serviceworker",i:["_base_i","_base_misc"],v:"1904281823091",f:(function(AMP,_){
var $AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=function($$jscomp$super$this$jscomp$67_element$jscomp$515$$){$$jscomp$super$this$jscomp$67_element$jscomp$515$$=AMP.BaseElement.call(this,$$jscomp$super$this$jscomp$67_element$jscomp$515$$)||this;$$jscomp$super$this$jscomp$67_element$jscomp$515$$.$D$=null;$$jscomp$super$this$jscomp$67_element$jscomp$515$$.$G$=null;$$jscomp$super$this$jscomp$67_element$jscomp$515$$.$F$=_.$JSCompiler_StaticMethods_isSafari$$(_.$Services$$module$src$services$platformFor$$($$jscomp$super$this$jscomp$67_element$jscomp$515$$.$win$));
return $$jscomp$super$this$jscomp$67_element$jscomp$515$$},$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$=function($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$){return Promise.all([$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.$loadPromise$($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.$win$),_.$Services$$module$src$services$viewerForDoc$$($JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$self$$.$getAmpDoc$()).$D$])},$JSCompiler_StaticMethods_insertIframe_$$=
function($JSCompiler_StaticMethods_insertIframe_$self$$){return $JSCompiler_StaticMethods_insertIframe_$self$$.$mutateElement$(function(){_.$toggle$$module$src$style$$($JSCompiler_StaticMethods_insertIframe_$self$$.element,!1);var $iframe$jscomp$65$$=$JSCompiler_StaticMethods_insertIframe_$self$$.$win$.document.createElement("iframe");$iframe$jscomp$65$$.setAttribute("sandbox","allow-same-origin allow-scripts");$iframe$jscomp$65$$.src=$JSCompiler_StaticMethods_insertIframe_$self$$.$D$;$JSCompiler_StaticMethods_insertIframe_$self$$.element.appendChild($iframe$jscomp$65$$)})},
$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$$=function($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$){if($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.$getAmpDoc$().$isSingleDoc$()){var $ampdoc$jscomp$209$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.$getAmpDoc$(),$urlMatch_win$jscomp$366$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.$win$,$urlService$jscomp$8$$=_.$Services$$module$src$services$urlForDoc$$($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element);
$urlService$jscomp$8$$.parse($urlMatch_win$jscomp$366$$.location.href);$urlMatch_win$jscomp$366$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element.getAttribute("data-no-service-worker-fallback-url-match");var $shellUrl$$=$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element.getAttribute("data-no-service-worker-fallback-shell-url");if($urlMatch_win$jscomp$366$$||$shellUrl$$){$shellUrl$$=_.$removeFragment$$module$src$url$$($shellUrl$$);try{var $urlMatchExpr$$=new RegExp($urlMatch_win$jscomp$366$$)}catch($e$294$$){throw _.$user$$module$src$log$$().$createError$('Invalid "data-no-service-worker-fallback-url-match" expression',
$e$294$$);}$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.$G$=new $UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($ampdoc$jscomp$209$$,$urlMatchExpr$$,$shellUrl$$,$JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$.element);_.$JSCompiler_StaticMethods_isSecure$$($urlService$jscomp$8$$,$shellUrl$$)&&$JSCompiler_StaticMethods_waitToPreloadShell_$$($JSCompiler_StaticMethods_maybeInstallUrlRewrite_$self$$,$shellUrl$$)}}},$JSCompiler_StaticMethods_waitToPreloadShell_$$=
function($JSCompiler_StaticMethods_waitToPreloadShell_$self$$,$shellUrl$jscomp$1$$){$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$($JSCompiler_StaticMethods_waitToPreloadShell_$self$$).then(function(){$JSCompiler_StaticMethods_waitToPreloadShell_$self$$.$mutateElement$(function(){return $JSCompiler_StaticMethods_preloadShell_$$($JSCompiler_StaticMethods_waitToPreloadShell_$self$$,$shellUrl$jscomp$1$$)})})},$JSCompiler_StaticMethods_preloadShell_$$=function($JSCompiler_StaticMethods_preloadShell_$self$$,
$shellUrl$jscomp$2$$){var $iframe$jscomp$66$$=$JSCompiler_StaticMethods_preloadShell_$self$$.$win$.document.createElement("iframe");$iframe$jscomp$66$$.id="i-amphtml-shell-preload";$iframe$jscomp$66$$.setAttribute("src",$shellUrl$jscomp$2$$+"#preload");_.$toggle$$module$src$style$$($iframe$jscomp$66$$,!1);$iframe$jscomp$66$$.setAttribute("sandbox","allow-scripts allow-same-origin");$JSCompiler_StaticMethods_preloadShell_$self$$.$loadPromise$($iframe$jscomp$66$$).then(function(){_.$removeElement$$module$src$dom$$($iframe$jscomp$66$$)});
$JSCompiler_StaticMethods_preloadShell_$self$$.element.appendChild($iframe$jscomp$66$$)},$UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=function($ampdoc$jscomp$210$$,$urlMatchExpr$jscomp$1$$,$shellUrl$jscomp$3$$,$element$jscomp$516$$){this.$win$=$ampdoc$jscomp$210$$.$win$;this.$I$=$urlMatchExpr$jscomp$1$$;this.$H$=$shellUrl$jscomp$3$$;this.$D$=_.$Services$$module$src$services$urlForDoc$$($element$jscomp$516$$);this.$F$=this.$D$.parse($shellUrl$jscomp$3$$);
_.$listen$$module$src$event_helper$$($ampdoc$jscomp$210$$.getRootNode(),"click",this.$G$.bind(this))},$install$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=function($win$jscomp$369$$,$src$jscomp$50$$,$element$jscomp$517$$){var $options$jscomp$47$$={};$element$jscomp$517$$.hasAttribute("data-scope")&&($options$jscomp$47$$.scope=$element$jscomp$517$$.getAttribute("data-scope"));return $win$jscomp$369$$.navigator.serviceWorker.register($src$jscomp$50$$,$options$jscomp$47$$).then(function($src$jscomp$50$$){_.$getMode$$module$src$mode$$().$development$&&
_.$user$$module$src$log$$().$Log$$module$src$log_prototype$info$("amp-install-serviceworker","ServiceWorker registration successful with scope: ",$src$jscomp$50$$.scope);var $options$jscomp$47$$=$src$jscomp$50$$.installing;$options$jscomp$47$$?$options$jscomp$47$$.addEventListener("statechange",function($options$jscomp$47$$){"activated"===$options$jscomp$47$$.target.state&&$performServiceWorkerOptimizations$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($src$jscomp$50$$,
$win$jscomp$369$$,$element$jscomp$517$$)}):$src$jscomp$50$$.active&&$performServiceWorkerOptimizations$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($src$jscomp$50$$,$win$jscomp$369$$,$element$jscomp$517$$);return $src$jscomp$50$$},function($win$jscomp$369$$){_.$user$$module$src$log$$().error("amp-install-serviceworker","ServiceWorker registration failed:",$win$jscomp$369$$)})},$performServiceWorkerOptimizations$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=
function($registration$jscomp$1$$,$win$jscomp$370$$,$element$jscomp$518$$){$sendAmpScriptToSwOnFirstVisit$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($win$jscomp$370$$,$registration$jscomp$1$$);$element$jscomp$518$$.hasAttribute("data-prefetch")&&$prefetchOutgoingLinks$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($registration$jscomp$1$$,$win$jscomp$370$$)},$sendAmpScriptToSwOnFirstVisit$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=
function($ampScriptsUsed_win$jscomp$371$$,$activeSW_registration$jscomp$2$$){"performance"in $ampScriptsUsed_win$jscomp$371$$&&($ampScriptsUsed_win$jscomp$371$$=$ampScriptsUsed_win$jscomp$371$$.performance.getEntriesByType("resource").filter(function($ampScriptsUsed_win$jscomp$371$$){return"script"===$ampScriptsUsed_win$jscomp$371$$.initiatorType&&_.$startsWith$$module$src$string$$($ampScriptsUsed_win$jscomp$371$$.name,_.$urls$$module$src$config$$.cdn)}).map(function($ampScriptsUsed_win$jscomp$371$$){return $ampScriptsUsed_win$jscomp$371$$.name}),
$activeSW_registration$jscomp$2$$=$activeSW_registration$jscomp$2$$.active,$activeSW_registration$jscomp$2$$.postMessage&&$activeSW_registration$jscomp$2$$.postMessage(JSON.stringify(_.$dict$$module$src$utils$object$$({type:"AMP__FIRST-VISIT-CACHING",payload:$ampScriptsUsed_win$jscomp$371$$}))))},$prefetchOutgoingLinks$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=function($activeSW$jscomp$1_registration$jscomp$3$$,$links$jscomp$2_win$jscomp$372$$){var $document$jscomp$12$$=
$links$jscomp$2_win$jscomp$372$$.document;$links$jscomp$2_win$jscomp$372$$=[].map.call($document$jscomp$12$$.querySelectorAll("a[data-rel=prefetch]"),function($activeSW$jscomp$1_registration$jscomp$3$$){return $activeSW$jscomp$1_registration$jscomp$3$$.href});$supportsPrefetch$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($document$jscomp$12$$)?$links$jscomp$2_win$jscomp$372$$.forEach(function($activeSW$jscomp$1_registration$jscomp$3$$){var $links$jscomp$2_win$jscomp$372$$=
$document$jscomp$12$$.createElement("link");$links$jscomp$2_win$jscomp$372$$.setAttribute("rel","prefetch");$links$jscomp$2_win$jscomp$372$$.setAttribute("href",$activeSW$jscomp$1_registration$jscomp$3$$);$document$jscomp$12$$.head.appendChild($links$jscomp$2_win$jscomp$372$$)}):($activeSW$jscomp$1_registration$jscomp$3$$=$activeSW$jscomp$1_registration$jscomp$3$$.active,$activeSW$jscomp$1_registration$jscomp$3$$.postMessage&&$activeSW$jscomp$1_registration$jscomp$3$$.postMessage(JSON.stringify(_.$dict$$module$src$utils$object$$({type:"AMP__LINK-PREFETCH",
payload:$links$jscomp$2_win$jscomp$372$$}))))},$supportsPrefetch$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$=function($doc$jscomp$96_fakeLink$$){$doc$jscomp$96_fakeLink$$=$doc$jscomp$96_fakeLink$$.createElement("link");return $doc$jscomp$96_fakeLink$$.$relList$&&$doc$jscomp$96_fakeLink$$.$relList$.supports?$doc$jscomp$96_fakeLink$$.$relList$.supports("prefetch"):!1};
_.$$jscomp$inherits$$($AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$,AMP.BaseElement);
$AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$.prototype.$buildCallback$=function(){var $$jscomp$this$jscomp$733$$=this,$win$jscomp$365$$=this.$win$;if("serviceWorker"in $win$jscomp$365$$.navigator){var $urlService$jscomp$7$$=_.$Services$$module$src$services$urlForDoc$$(this.element),$src$jscomp$49$$=this.element.getAttribute("src");if(!_.$isProxyOrigin$$module$src$url$$($src$jscomp$49$$)&&!_.$isProxyOrigin$$module$src$url$$($win$jscomp$365$$.location.href)||
this.$F$)$urlService$jscomp$7$$.parse($win$jscomp$365$$.location.href).origin==$urlService$jscomp$7$$.parse($src$jscomp$49$$).origin?$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$(this).then(function(){return $install$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$($$jscomp$this$jscomp$733$$.$win$,$src$jscomp$49$$,$$jscomp$this$jscomp$733$$.element)}):this.$user$().error("amp-install-serviceworker","Did not install ServiceWorker because it does not match the current origin: "+
$src$jscomp$49$$);else{var $iframeSrc$jscomp$2$$=this.element.getAttribute("data-iframe-src");if($iframeSrc$jscomp$2$$){$urlService$jscomp$7$$.parse($iframeSrc$jscomp$2$$);var $docInfo$jscomp$6$$=_.$Services$$module$src$services$documentInfoForDoc$$(this.element);$urlService$jscomp$7$$.parse($docInfo$jscomp$6$$.sourceUrl);$urlService$jscomp$7$$.parse($docInfo$jscomp$6$$.canonicalUrl);this.$D$=$iframeSrc$jscomp$2$$;$JSCompiler_StaticMethods_whenLoadedAndVisiblePromise_$$(this).then(function(){return $JSCompiler_StaticMethods_insertIframe_$$($$jscomp$this$jscomp$733$$)})}}(_.$isProxyOrigin$$module$src$url$$($src$jscomp$49$$)||
_.$isProxyOrigin$$module$src$url$$($win$jscomp$365$$.location.href))&&this.$F$&&this.$user$().error("amp-install-serviceworker","Did not install ServiceWorker because of safari double keyring caching as it will not have any effect")}else $JSCompiler_StaticMethods_maybeInstallUrlRewrite_$$(this)};
$UrlRewriter_$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$.prototype.$G$=function($event$jscomp$149_target$jscomp$177$$){if(!$event$jscomp$149_target$jscomp$177$$.defaultPrevented&&($event$jscomp$149_target$jscomp$177$$=_.$closestAncestorElementBySelector$$module$src$dom$$($event$jscomp$149_target$jscomp$177$$.target,"A"))&&$event$jscomp$149_target$jscomp$177$$.href){var $tgtLoc$jscomp$1$$=this.$D$.parse($event$jscomp$149_target$jscomp$177$$.href);$tgtLoc$jscomp$1$$.origin==
this.$F$.origin&&$tgtLoc$jscomp$1$$.pathname!=this.$F$.pathname&&this.$I$.test($tgtLoc$jscomp$1$$.href)&&!$event$jscomp$149_target$jscomp$177$$.getAttribute("i-amphtml-orig-href")&&_.$removeFragment$$module$src$url$$($tgtLoc$jscomp$1$$.href)!=_.$removeFragment$$module$src$url$$(this.$win$.location.href)&&($event$jscomp$149_target$jscomp$177$$.setAttribute("i-amphtml-orig-href",$event$jscomp$149_target$jscomp$177$$.href),$event$jscomp$149_target$jscomp$177$$.href=this.$H$+"#href="+encodeURIComponent($tgtLoc$jscomp$1$$.pathname+
$tgtLoc$jscomp$1$$.search+$tgtLoc$jscomp$1$$.hash))}};self.AMP.registerElement("amp-install-serviceworker",$AmpInstallServiceWorker$$module$extensions$amp_install_serviceworker$0_1$amp_install_serviceworker$$);
})});

//# sourceMappingURL=amp-install-serviceworker-0.1.js.map
