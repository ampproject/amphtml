(self.AMP=self.AMP||[]).push({n:"amp-web-push",i:["_base_i","_base_misc"],v:"1904281823091",f:(function(AMP,_){
var $WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$=function($element$jscomp$773$$){return AMP.BaseElement.call(this,$element$jscomp$773$$)||this},$JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$$=function($JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$self$$){if("amp-web-push"!==$JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$self$$.element.getAttribute("id"))throw _.$user$$module$src$log$$().$createError$("<amp-web-push> must have an id attribute with value 'amp-web-push'.");
if(1<$JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$self$$.$getAmpDoc$().getRootNode().querySelectorAll("#"+_.$cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push")).length)throw _.$user$$module$src$log$$().$createError$("Only one <amp-web-push> element may exist on a page.");var $config$jscomp$107$$={"helper-iframe-url":null,"permission-dialog-url":null,"service-worker-url":null,"service-worker-scope":null},$attribute$jscomp$13$$;
for($attribute$jscomp$13$$ in $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$){var $value$jscomp$294$$=$WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$[$attribute$jscomp$13$$];$config$jscomp$107$$[$value$jscomp$294$$]=$JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$self$$.element.getAttribute($value$jscomp$294$$)}if(!$JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$($config$jscomp$107$$["helper-iframe-url"]))throw _.$user$$module$src$log$$().$createError$("<amp-web-push> must have a valid helper-iframe-url attribute. It should begin with the https:// protocol and point to the provided lightweight template page provided for AMP messaging.");
if(!$JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$($config$jscomp$107$$["permission-dialog-url"]))throw _.$user$$module$src$log$$().$createError$("<amp-web-push> must have a valid permission-dialog-url attribute. It should begin with the https:// protocol and point to the provided template page for showing the permission prompt.");if("https:"!==_.$parseUrlDeprecated$$module$src$url$$($config$jscomp$107$$["service-worker-url"]).protocol)throw _.$user$$module$src$log$$().$createError$("<amp-web-push> must have a valid service-worker-url attribute. It should begin with the https:// protocol and point to the service worker JavaScript file to be installed.");
if(_.$parseUrlDeprecated$$module$src$url$$($config$jscomp$107$$["service-worker-url"]).origin!==_.$parseUrlDeprecated$$module$src$url$$($config$jscomp$107$$["permission-dialog-url"]).origin||_.$parseUrlDeprecated$$module$src$url$$($config$jscomp$107$$["permission-dialog-url"]).origin!==_.$parseUrlDeprecated$$module$src$url$$($config$jscomp$107$$["helper-iframe-url"]).origin)throw _.$user$$module$src$log$$().$createError$("<amp-web-push> URL attributes service-worker-url, permission-dialog-url, and helper-iframe-url must all share the same origin.");
},$JSCompiler_StaticMethods_parseConfig$$=function($JSCompiler_StaticMethods_parseConfig$self$$){var $config$jscomp$108$$={},$attribute$jscomp$14$$;for($attribute$jscomp$14$$ in $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$){var $value$jscomp$295$$=$WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$[$attribute$jscomp$14$$];$config$jscomp$108$$[$value$jscomp$295$$]=$JSCompiler_StaticMethods_parseConfig$self$$.element.getAttribute($value$jscomp$295$$)}return $config$jscomp$108$$},
$JSCompiler_StaticMethods_isValidHelperOrPermissionDialogUrl_$$=function($url$jscomp$255$$){try{var $parsedUrl$jscomp$4$$=_.$parseUrlDeprecated$$module$src$url$$($url$jscomp$255$$),$isNotRootUrl$$=1<$parsedUrl$jscomp$4$$.pathname.length;return"https:"===$parsedUrl$jscomp$4$$.protocol&&$isNotRootUrl$$}catch($e$417$$){return!1}},$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$=function($element$jscomp$774$$){return AMP.BaseElement.call(this,$element$jscomp$774$$)||this},$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$=
function($ampdoc$jscomp$267$$,$url$jscomp$256$$){this.$ampdoc_$=$ampdoc$jscomp$267$$;this.$G$=$url$jscomp$256$$;this.$D$=null;this.$F$=new Promise(function(){})},$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$=function($options$jscomp$73$$){$options$jscomp$73$$||($options$jscomp$73$$={debug:!1,$windowContext$:window});this.$G$={};this.$I$={};this.$F$=$options$jscomp$73$$.debug;this.$H$=!1;this.$J$=this.$M$=this.$O$=this.$D$=this.$K$=null;this.$P$=$options$jscomp$73$$.$windowContext$||
window},$JSCompiler_StaticMethods_listen$$=function($JSCompiler_StaticMethods_listen$self$$,$allowedOrigins$$){(new Promise(function($resolve$jscomp$118$$,$reject$jscomp$42$$){$JSCompiler_StaticMethods_listen$self$$.$H$?$reject$jscomp$42$$(Error("Already connected.")):Array.isArray($allowedOrigins$$)?($JSCompiler_StaticMethods_listen$self$$.$O$=$JSCompiler_StaticMethods_listen$self$$.$V$.bind($JSCompiler_StaticMethods_listen$self$$,$allowedOrigins$$,$resolve$jscomp$118$$,$reject$jscomp$42$$),$JSCompiler_StaticMethods_listen$self$$.$P$.addEventListener("message",
$JSCompiler_StaticMethods_listen$self$$.$O$),$JSCompiler_StaticMethods_listen$self$$.$F$&&"amp-web-push"):$reject$jscomp$42$$(Error("allowedOrigins should be a string array of allowed origins to accept messages from. Got:",$allowedOrigins$$))})).then(function(){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$($JSCompiler_StaticMethods_listen$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$CONNECT_HANDSHAKE$,
null);$JSCompiler_StaticMethods_listen$self$$.$H$=!0})},$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$$=function($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$,$remoteWindowContext$$,$expectedRemoteOrigin$$){return new Promise(function($resolve$jscomp$119$$,$reject$jscomp$43$$){$remoteWindowContext$$||$reject$jscomp$43$$(Error("Provide a valid Window context to connect to."));
$expectedRemoteOrigin$$||$reject$jscomp$43$$(Error("Provide an expected origin for the remote Window or provide the wildcard *."));$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$H$?$reject$jscomp$43$$(Error("Already connected.")):($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$K$=new MessageChannel,$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$D$=
$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$K$.port1,$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$M$=$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$U$.bind($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$,
$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$D$,$expectedRemoteOrigin$$,$resolve$jscomp$119$$),$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$D$.addEventListener("message",$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$M$),$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$D$.start(),
$remoteWindowContext$$.postMessage({$topic$:$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$CONNECT_HANDSHAKE$},"*"===$expectedRemoteOrigin$$?"*":_.$parseUrlDeprecated$$module$src$url$$($expectedRemoteOrigin$$).origin,[$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$self$$.$K$.port2]),"amp-web-push")})},$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$$=
function($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$,$callback$jscomp$179$$){var $topic$$=$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$NOTIFICATION_PERMISSION_STATE$;$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.$I$[$topic$$]?$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.$I$[$topic$$].push($callback$jscomp$179$$):
$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$self$$.$I$[$topic$$]=[$callback$jscomp$179$$]},$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$=function($JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$,$topic$jscomp$3$$,$data$jscomp$261$$){var $payload$jscomp$42$$={id:crypto.getRandomValues(new Uint8Array(10)).join(""),
$topic$:$topic$jscomp$3$$,data:$data$jscomp$261$$};$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$.$F$&&"amp-web-push";$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$.$D$.postMessage($payload$jscomp$42$$);return new Promise(function($resolve$jscomp$121$$){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$self$$.$G$[$payload$jscomp$42$$.id]=
{message:$data$jscomp$261$$,$topic$:$topic$jscomp$3$$,$promiseResolver$:$resolve$jscomp$121$$}})},$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$=function($ampdoc$jscomp$268$$){this.ampdoc=$ampdoc$jscomp$268$$;_.$installStylesForDoc$$module$src$style_installer$$($ampdoc$jscomp$268$$,"amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/",function(){},!1,"amp-web-push");this.$D$={"helper-iframe-url":null,"permission-dialog-url":null,
"service-worker-url":null,debug:null};this.$H$=_.$getMode$$module$src$mode$$().$development$;this.$J$=this.$F$=null;this.$I$=new $WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$({debug:this.$H$});this.$G$=null},$JSCompiler_StaticMethods_removePermissionPopupUrlFragmentFromUrl$$=function($url$jscomp$257_urlWithoutFragment$$){$url$jscomp$257_urlWithoutFragment$$=$url$jscomp$257_urlWithoutFragment$$.replace("?"+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.$D$,
"");return $url$jscomp$257_urlWithoutFragment$$=$url$jscomp$257_urlWithoutFragment$$.replace("&"+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.$D$,"")},$JSCompiler_StaticMethods_queryHelperFrame_$$=function($JSCompiler_StaticMethods_queryHelperFrame_$self$$,$messageTopic$$,$message$jscomp$85$$){return $JSCompiler_StaticMethods_queryHelperFrame_$self$$.$F$.$whenReady$().then(function(){return $JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$send$$($JSCompiler_StaticMethods_queryHelperFrame_$self$$.$I$,
$messageTopic$$,$message$jscomp$85$$)}).then(function($JSCompiler_StaticMethods_queryHelperFrame_$self$$){$JSCompiler_StaticMethods_queryHelperFrame_$self$$=$JSCompiler_StaticMethods_queryHelperFrame_$self$$[0];if($JSCompiler_StaticMethods_queryHelperFrame_$self$$.$success$)return $JSCompiler_StaticMethods_queryHelperFrame_$self$$.result;throw Error("AMP page helper iframe query topic "+$messageTopic$$+" "+("and message "+$message$jscomp$85$$+" failed with: "+$JSCompiler_StaticMethods_queryHelperFrame_$self$$.error));
})},$JSCompiler_StaticMethods_queryServiceWorker_$$=function($JSCompiler_StaticMethods_queryServiceWorker_$self$$,$messageTopic$jscomp$1$$){return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_queryServiceWorker_$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$SERVICE_WORKER_QUERY$,{$topic$:$messageTopic$jscomp$1$$,$payload$:null})},$JSCompiler_StaticMethods_registerServiceWorker$$=function($JSCompiler_StaticMethods_registerServiceWorker$self$$){var $swScope$$=
$JSCompiler_StaticMethods_registerServiceWorker$self$$.$D$["service-worker-scope"];return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_registerServiceWorker$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$SERVICE_WORKER_REGISTRATION$,{$workerUrl$:$JSCompiler_StaticMethods_registerServiceWorker$self$$.$D$["service-worker-url"],$registrationOptions$:$swScope$$?{scope:$swScope$$}:{}})},$JSCompiler_StaticMethods_isServiceWorkerActivated$$=
function($JSCompiler_StaticMethods_isServiceWorkerActivated$self$$){return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_isServiceWorkerActivated$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$SERVICE_WORKER_STATE$,null).then(function($serviceWorkerActivated_serviceWorkerState$$){var $isControllingFrame$$=!0===$serviceWorkerActivated_serviceWorkerState$$.$isControllingFrame$;a:{var $urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$=
$JSCompiler_StaticMethods_isServiceWorkerActivated$self$$.$D$["service-worker-url"];var $JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$=_.$parseUrlDeprecated$$module$src$url$$($serviceWorkerActivated_serviceWorkerState$$.url);var $originalUrlQueryParams$jscomp$inline_5783$$=_.$parseQueryString_$$module$src$url_parse_query_string$$($JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$.search);$urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$=
_.$parseUrlDeprecated$$module$src$url$$($urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$);var $urlToTestQueryParams$jscomp$inline_5785$$=_.$parseQueryString_$$module$src$url_parse_query_string$$($urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$.search),$originalKey$jscomp$inline_5786$$;for($originalKey$jscomp$inline_5786$$ in $originalUrlQueryParams$jscomp$inline_5783$$)if($urlToTestQueryParams$jscomp$inline_5785$$[$originalKey$jscomp$inline_5786$$]!==$originalUrlQueryParams$jscomp$inline_5783$$[$originalKey$jscomp$inline_5786$$]){$JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$=
!1;break a}$JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$=$JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$.origin===$urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$.origin&&$JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$.pathname===$urlToTest$jscomp$inline_5784_urlToTestString$jscomp$inline_5781$$.pathname}$serviceWorkerActivated_serviceWorkerState$$="activated"===$serviceWorkerActivated_serviceWorkerState$$.state;
return $isControllingFrame$$&&$JSCompiler_inline_result$jscomp$1145_originalUrl$jscomp$inline_5782$$&&$serviceWorkerActivated_serviceWorkerState$$})},$JSCompiler_StaticMethods_setWidgetVisibilities$$=function($JSCompiler_StaticMethods_setWidgetVisibilities$self_widgetDomElements$$,$i$420_widgetCategoryName$$,$isVisible$jscomp$7$$){$JSCompiler_StaticMethods_setWidgetVisibilities$self_widgetDomElements$$=$JSCompiler_StaticMethods_setWidgetVisibilities$self_widgetDomElements$$.ampdoc.getRootNode().querySelectorAll(_.$cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push-widget")+
"[visibility="+_.$cssEscape$$module$third_party$css_escape$css_escape$$($i$420_widgetCategoryName$$)+"]");for($i$420_widgetCategoryName$$=0;$i$420_widgetCategoryName$$<$JSCompiler_StaticMethods_setWidgetVisibilities$self_widgetDomElements$$.length;$i$420_widgetCategoryName$$++){var $widgetDomElement$$=$JSCompiler_StaticMethods_setWidgetVisibilities$self_widgetDomElements$$[$i$420_widgetCategoryName$$];$isVisible$jscomp$7$$?$widgetDomElement$$.classList.remove("amp-invisible"):$widgetDomElement$$.classList.add("amp-invisible")}},
$JSCompiler_StaticMethods_storeLastKnownPermission_$$=function($JSCompiler_StaticMethods_storeLastKnownPermission_$self$$){return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_storeLastKnownPermission_$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$NOTIFICATION_PERMISSION_STATE$,null).then(function($permission$jscomp$2$$){$JSCompiler_StaticMethods_storeLastKnownPermission_$self$$.$J$=$permission$jscomp$2$$})},$JSCompiler_StaticMethods_updateWidgetVisibilities$$=
function($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$){return $JSCompiler_StaticMethods_storeLastKnownPermission_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$).then(function(){return $JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$NOTIFICATION_PERMISSION_STATE$,{$isQueryTopicSupported$:$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$STORAGE_GET$})}).then(function($response$jscomp$91$$){var $JSCompiler_temp$jscomp$1150$$;
!0===$response$jscomp$91$$?$JSCompiler_temp$jscomp$1150$$=$JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$STORAGE_GET$,{key:"amp-web-push-notification-permission"}):$JSCompiler_temp$jscomp$1150$$=Promise.resolve("default");return $JSCompiler_temp$jscomp$1150$$}).then(function($canonicalNotificationPermission$$){if("denied"===$canonicalNotificationPermission$$)0<$JSCompiler_StaticMethods_updateWidgetVisibilities$self$$.ampdoc.getRootNode().querySelectorAll(_.$cssEscape$$module$third_party$css_escape$css_escape$$("amp-web-push-widget")+
"[visibility="+_.$cssEscape$$module$third_party$css_escape$css_escape$$("blocked")+"]").length?($JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$,"unsubscribed",!1),$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$,"subscribed",!1),$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$,"blocked",!0)):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$);
else return $JSCompiler_StaticMethods_isServiceWorkerActivated$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$).then(function($canonicalNotificationPermission$$){$canonicalNotificationPermission$$?$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($JSCompiler_StaticMethods_updateWidgetVisibilities$self$$)})})},$JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$$=
function($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$){_.$JSCompiler_StaticMethods_timeoutPromise$$(_.$Services$$module$src$services$timerFor$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$.ampdoc.$win$),5E3,$JSCompiler_StaticMethods_queryServiceWorker_$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$,"amp-web-push-subscription-state").then(function($reply$$){switch("boolean"===typeof $reply$$?
1:void 0){case $WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.$F$:$reply$$?($JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$,"unsubscribed",!1),$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$,"subscribed",!0),$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$,
"blocked",!1)):$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesServiceWorkerActivated_$self$$);break;default:throw _.$user$$module$src$log$$().$createError$("The controlling service worker replied to amp-web-push with an unexpected value.");}}),"The controlling service worker does not support amp-web-push.")},$JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$$=function($JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$){$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$,
"unsubscribed",!0);$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$,"subscribed",!1);$JSCompiler_StaticMethods_setWidgetVisibilities$$($JSCompiler_StaticMethods_updateWidgetVisibilitiesUnsubscribed_$self$$,"blocked",!1)},$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$$=function($JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$,$permissionDialogWindow$jscomp$1$$,$onPopupClosed$jscomp$1$$){if($permissionDialogWindow$jscomp$1$$&&
!$permissionDialogWindow$jscomp$1$$.closed)var $interval$jscomp$11$$=$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$.ampdoc.$win$.setInterval(function(){$permissionDialogWindow$jscomp$1$$.closed&&($onPopupClosed$jscomp$1$$(),$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$self$$.ampdoc.$win$.clearInterval($interval$jscomp$11$$))},500)},$JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$=function($JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$){return $JSCompiler_StaticMethods_queryServiceWorker_$$($JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$,
"amp-web-push-subscribe").then(function(){return $JSCompiler_StaticMethods_updateWidgetVisibilities$$($JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$self$$)})},$JSCompiler_StaticMethods_onPermissionDialogInteracted$$=function($JSCompiler_StaticMethods_onPermissionDialogInteracted$self$$){return new Promise(function($resolve$jscomp$123$$){$JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$on$$($JSCompiler_StaticMethods_onPermissionDialogInteracted$self$$.$G$,
function($JSCompiler_StaticMethods_onPermissionDialogInteracted$self$$,$replyToFrame$$){$resolve$jscomp$123$$([$JSCompiler_StaticMethods_onPermissionDialogInteracted$self$$,$replyToFrame$$])})})},$JSCompiler_StaticMethods_openPopupOrRedirect$$=function($JSCompiler_StaticMethods_openPopupOrRedirect$self$$){var $openingPopupUrl$$=$JSCompiler_StaticMethods_openPopupOrRedirect$self$$.$D$["permission-dialog-url"]+(-1!==$JSCompiler_StaticMethods_openPopupOrRedirect$self$$.$D$["permission-dialog-url"].indexOf("?")?
"&":"?")+("return="+encodeURIComponent($JSCompiler_StaticMethods_openPopupOrRedirect$self$$.ampdoc.$win$.location.href+(-1!==$JSCompiler_StaticMethods_openPopupOrRedirect$self$$.ampdoc.$win$.location.href.indexOf("?")?"&":"?")+$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.$D$)),$w$jscomp$inline_5804$$=Math.floor(Math.min(700,.9*screen.width)),$h$jscomp$inline_5805$$=Math.floor(Math.min(450,.9*screen.height));return _.$openWindowDialog$$module$src$dom$$($JSCompiler_StaticMethods_openPopupOrRedirect$self$$.ampdoc.$win$,
$openingPopupUrl$$,"_blank","height="+$h$jscomp$inline_5805$$+",width="+$w$jscomp$inline_5804$$+",left="+Math.floor((screen.width-$w$jscomp$inline_5804$$)/2)+",top="+Math.floor((screen.height-$h$jscomp$inline_5805$$)/2)+",resizable=yes,scrollbars=yes")},$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$$=function($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$){$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.ampdoc.$win$.history.replaceState(null,
"",$JSCompiler_StaticMethods_removePermissionPopupUrlFragmentFromUrl$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$.ampdoc.$win$.location.href));$JSCompiler_StaticMethods_queryHelperFrame_$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$,$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$NOTIFICATION_PERMISSION_STATE$,null).then(function($permission$jscomp$4$$){switch($permission$jscomp$4$$){case "denied":case "default":return $JSCompiler_StaticMethods_updateWidgetVisibilities$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$);
case "granted":$JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$self$$);break;default:throw Error("Unexpected permission value",$permission$jscomp$4$$);}})};var $WebPushConfigAttributes$$module$extensions$amp_web_push$0_1$amp_web_push_config$$={$HELPER_FRAME_URL$:"helper-iframe-url",$PERMISSION_DIALOG_URL$:"permission-dialog-url",$SERVICE_WORKER_URL$:"service-worker-url",$SERVICE_WORKER_SCOPE$:"service-worker-scope"};_.$$jscomp$inherits$$($WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$,AMP.BaseElement);
$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$.prototype.$buildCallback$=function(){$JSCompiler_StaticMethods_WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config_prototype$validate$$(this);var $config$jscomp$109$$=$JSCompiler_StaticMethods_parseConfig$$(this);_.$getServiceForDoc$$module$src$service$$(this.$getAmpDoc$(),"amp-web-push-service").start($config$jscomp$109$$).catch(function(){});_.$JSCompiler_StaticMethods_registerAction$$(this,"subscribe",this.$D$.bind(this));
_.$JSCompiler_StaticMethods_registerAction$$(this,"unsubscribe",this.$F$.bind(this))};$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$.prototype.$D$=function($invocation$jscomp$51$$){var $widget$jscomp$1$$=$invocation$jscomp$51$$.event.target;$widget$jscomp$1$$.disabled=!0;_.$getServiceForDoc$$module$src$service$$(this.$getAmpDoc$(),"amp-web-push-service").subscribe(function(){$widget$jscomp$1$$.disabled=!1}).then(function(){$widget$jscomp$1$$.disabled=!1})};
$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$.prototype.$F$=function($invocation$jscomp$52$$){var $widget$jscomp$3$$=$invocation$jscomp$52$$.event.target;$widget$jscomp$3$$.disabled=!0;_.$getServiceForDoc$$module$src$service$$(this.$getAmpDoc$(),"amp-web-push-service").unsubscribe().then(function(){$widget$jscomp$3$$.disabled=!1})};_.$$jscomp$inherits$$($WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$,AMP.BaseElement);$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$.prototype.$isLayoutSupported$=function($layout$jscomp$123$$){return"fixed"==$layout$jscomp$123$$};$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$.prototype.$buildCallback$=function(){this.element.classList.add("amp-invisible")};$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$.prototype.load=function(){var $$jscomp$this$jscomp$1424$$=this;return this.$ampdoc_$.$whenReady$().then(function(){$$jscomp$this$jscomp$1424$$.$D$=$$jscomp$this$jscomp$1424$$.$ampdoc_$.$win$.document.createElement("iframe");_.$toggle$$module$src$style$$($$jscomp$this$jscomp$1424$$.$D$,!1);$$jscomp$this$jscomp$1424$$.$D$.sandbox="allow-same-origin allow-scripts";$$jscomp$this$jscomp$1424$$.$D$.src=$$jscomp$this$jscomp$1424$$.$G$;$$jscomp$this$jscomp$1424$$.$ampdoc_$.$getBody$().appendChild($$jscomp$this$jscomp$1424$$.$D$);
$$jscomp$this$jscomp$1424$$.$F$=_.$loadPromise$$module$src$event_helper$$($$jscomp$this$jscomp$1424$$.$D$);return $$jscomp$this$jscomp$1424$$.$whenReady$()})};$IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$.prototype.$whenReady$=function(){return this.$F$};$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.prototype.$V$=function($JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$,$resolvePromise$$,$message$jscomp$83_rejectPromise$$,$messageChannelEvent_messagePorts$$){$message$jscomp$83_rejectPromise$$=$messageChannelEvent_messagePorts$$.data;var $normalizedOrigin$jscomp$inline_5771_origin$jscomp$49$$=$messageChannelEvent_messagePorts$$.origin;$messageChannelEvent_messagePorts$$=$messageChannelEvent_messagePorts$$.ports;
this.$F$&&"amp-web-push";a:{$normalizedOrigin$jscomp$inline_5771_origin$jscomp$49$$=_.$parseUrlDeprecated$$module$src$url$$($normalizedOrigin$jscomp$inline_5771_origin$jscomp$49$$).origin;for(var $i$418$jscomp$inline_5772$$=0;$i$418$jscomp$inline_5772$$<$JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$.length;$i$418$jscomp$inline_5772$$++)if(_.$parseUrlDeprecated$$module$src$url$$($JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$[$i$418$jscomp$inline_5772$$]).origin===
$normalizedOrigin$jscomp$inline_5771_origin$jscomp$49$$){$JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$=!0;break a}$JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$=!1}$JSCompiler_inline_result$jscomp$1143_allowedOrigins$jscomp$2$$?$message$jscomp$83_rejectPromise$$&&$message$jscomp$83_rejectPromise$$.topic===$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.$D$.$CONNECT_HANDSHAKE$?("amp-web-push",this.$P$.removeEventListener("message",this.$O$),
this.$D$=$messageChannelEvent_messagePorts$$[0],this.$J$=this.$R$.bind(this),this.$D$.addEventListener("message",this.$J$,!1),this.$D$.start(),$resolvePromise$$()):"amp-web-push":"amp-web-push"};
$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.prototype.$U$=function($messagePort$$,$expectedRemoteOrigin$jscomp$1$$,$resolvePromise$jscomp$1$$){this.$H$=!0;this.$F$&&"amp-web-push";$messagePort$$.removeEventListener("message",this.$M$);this.$J$=this.$R$.bind(this);$messagePort$$.addEventListener("message",this.$J$,!1);$resolvePromise$jscomp$1$$()};
$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.prototype.$R$=function($event$jscomp$266_message$jscomp$84$$){$event$jscomp$266_message$jscomp$84$$=$event$jscomp$266_message$jscomp$84$$.data;if(this.$G$[$event$jscomp$266_message$jscomp$84$$.id]&&$event$jscomp$266_message$jscomp$84$$.isReply){var $existingMessage_listeners$jscomp$1$$=this.$G$[$event$jscomp$266_message$jscomp$84$$.id];delete this.$G$[$event$jscomp$266_message$jscomp$84$$.id];var $i$419_promiseResolver$$=$existingMessage_listeners$jscomp$1$$.$promiseResolver$;
$existingMessage_listeners$jscomp$1$$.message=$event$jscomp$266_message$jscomp$84$$.data;this.$F$&&"amp-web-push";$i$419_promiseResolver$$([$event$jscomp$266_message$jscomp$84$$.data,this.$S$.bind(this,$event$jscomp$266_message$jscomp$84$$.id,$existingMessage_listeners$jscomp$1$$.topic)])}else if($existingMessage_listeners$jscomp$1$$=this.$I$[$event$jscomp$266_message$jscomp$84$$.topic])for(this.$F$&&"amp-web-push",$i$419_promiseResolver$$=0;$i$419_promiseResolver$$<$existingMessage_listeners$jscomp$1$$.length;$i$419_promiseResolver$$++)(0,$existingMessage_listeners$jscomp$1$$[$i$419_promiseResolver$$])($event$jscomp$266_message$jscomp$84$$.data,
this.$S$.bind(this,$event$jscomp$266_message$jscomp$84$$.id,$event$jscomp$266_message$jscomp$84$$.topic))};
$WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$.prototype.$S$=function($id$jscomp$117$$,$topic$jscomp$2$$,$data$jscomp$260$$){var $$jscomp$this$jscomp$1427$$=this,$payload$jscomp$41$$={id:$id$jscomp$117$$,$topic$:$topic$jscomp$2$$,data:$data$jscomp$260$$,$isReply$:!0};this.$D$.postMessage($payload$jscomp$41$$);return new Promise(function($id$jscomp$117$$){$$jscomp$this$jscomp$1427$$.$G$[$payload$jscomp$41$$.id]={message:$data$jscomp$260$$,$topic$:$topic$jscomp$2$$,$promiseResolver$:$id$jscomp$117$$}})};
_.$$jscomp$global$$.Object.defineProperties($WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$,{$D$:{configurable:!0,enumerable:!0,get:function(){return{$CONNECT_HANDSHAKE$:"topic-connect-handshake",$NOTIFICATION_PERMISSION_STATE$:"topic-notification-permission-state",$SERVICE_WORKER_STATE$:"topic-service-worker-state",$SERVICE_WORKER_REGISTRATION$:"topic-service-worker-registration",$SERVICE_WORKER_QUERY$:"topic-service-worker-query",$STORAGE_GET$:"topic-storage-get"}}}});$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.prototype.start=function($JSCompiler_inline_result$jscomp$1144_configJson$jscomp$15$$){var $$jscomp$this$jscomp$1429$$=this;"amp-web-push";if(void 0===this.ampdoc.$win$.Notification||void 0===this.ampdoc.$win$.navigator.serviceWorker||void 0===this.ampdoc.$win$.PushManager||"https:"!==this.ampdoc.$win$.location.protocol&&"localhost"!==this.ampdoc.$win$.location.hostname&&"127.0.0.1"!==this.ampdoc.$win$.location.hostname&&!_.$getMode$$module$src$mode$$().$development$&&
!_.$getMode$$module$src$mode$$().test)return _.$user$$module$src$log$$().$Log$$module$src$log_prototype$warn$("amp-web-push","Web push is not supported."),Promise.reject("Web push is not supported");this.$D$=$JSCompiler_inline_result$jscomp$1144_configJson$jscomp$15$$;this.$F$=new $IFrameHost$$module$extensions$amp_web_push$0_1$iframehost$$(this.ampdoc,""+this.$D$["helper-iframe-url"]+(-1!==this.$D$["helper-iframe-url"].indexOf("?")?"&":"?")+("parentOrigin="+this.ampdoc.$win$.location.origin));$JSCompiler_inline_result$jscomp$1144_configJson$jscomp$15$$=
this.$F$.load();$JSCompiler_inline_result$jscomp$1144_configJson$jscomp$15$$.then(function(){"amp-web-push";return $JSCompiler_StaticMethods_WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger_prototype$connect$$($$jscomp$this$jscomp$1429$$.$I$,$$jscomp$this$jscomp$1429$$.$F$.$D$.contentWindow,_.$parseUrlDeprecated$$module$src$url$$($$jscomp$this$jscomp$1429$$.$D$["helper-iframe-url"]).origin)}).then(function(){if(-1!==($$jscomp$this$jscomp$1429$$.ampdoc.$win$.$testLocation$||$$jscomp$this$jscomp$1429$$.ampdoc.$win$.location).search.indexOf($WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.$D$))$JSCompiler_StaticMethods_resumeSubscribingForPushNotifications_$$($$jscomp$this$jscomp$1429$$);
else return $JSCompiler_StaticMethods_updateWidgetVisibilities$$($$jscomp$this$jscomp$1429$$)});return $JSCompiler_inline_result$jscomp$1144_configJson$jscomp$15$$};
$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.prototype.subscribe=function($onPopupClosed$$){var $$jscomp$this$jscomp$1435$$=this,$promises$jscomp$29$$=[];$promises$jscomp$29$$.push($JSCompiler_StaticMethods_registerServiceWorker$$(this));$promises$jscomp$29$$.push(new Promise(function($promises$jscomp$29$$){switch($$jscomp$this$jscomp$1435$$.$J$){case "granted":return $JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($$jscomp$this$jscomp$1435$$).then(function(){$promises$jscomp$29$$()});default:var $resolve$jscomp$122$$=
$JSCompiler_StaticMethods_openPopupOrRedirect$$($$jscomp$this$jscomp$1435$$);$JSCompiler_StaticMethods_checkPermissionDialogClosedInterval_$$($$jscomp$this$jscomp$1435$$,$resolve$jscomp$122$$,$onPopupClosed$$);$$jscomp$this$jscomp$1435$$.$G$=new $WindowMessenger$$module$extensions$amp_web_push$0_1$window_messenger$$({debug:$$jscomp$this$jscomp$1435$$.$H$});$JSCompiler_StaticMethods_listen$$($$jscomp$this$jscomp$1435$$.$G$,[$$jscomp$this$jscomp$1435$$.$D$["permission-dialog-url"]]);$JSCompiler_StaticMethods_onPermissionDialogInteracted$$($$jscomp$this$jscomp$1435$$).then(function($onPopupClosed$$){a:{var $promises$jscomp$29$$=
$onPopupClosed$$[0];$onPopupClosed$$=$onPopupClosed$$[1];switch($promises$jscomp$29$$){case "denied":case "default":$onPopupClosed$$({$closeFrame$:!0});$promises$jscomp$29$$=$JSCompiler_StaticMethods_updateWidgetVisibilities$$($$jscomp$this$jscomp$1435$$);break a;case "granted":$onPopupClosed$$({$closeFrame$:!0});$JSCompiler_StaticMethods_onPermissionGrantedSubscribe_$$($$jscomp$this$jscomp$1435$$);break;default:throw Error("Unexpected permission value:",$promises$jscomp$29$$);}$promises$jscomp$29$$=
void 0}return $promises$jscomp$29$$}).then(function(){$promises$jscomp$29$$()})}}));return Promise.all($promises$jscomp$29$$)};$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$.prototype.unsubscribe=function(){var $$jscomp$this$jscomp$1438$$=this;return $JSCompiler_StaticMethods_queryServiceWorker_$$(this,"amp-web-push-unsubscribe").then(function(){return $JSCompiler_StaticMethods_updateWidgetVisibilities$$($$jscomp$this$jscomp$1438$$)})};
_.$$jscomp$global$$.Object.defineProperties($WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$,{$D$:{configurable:!0,enumerable:!0,get:function(){return"amp-web-push-subscribing=yes"}},$F$:{configurable:!0,enumerable:!0,get:function(){return 1}}});var $AMP$jscomp$inline_5807$$=self.AMP;$AMP$jscomp$inline_5807$$.registerServiceForDoc("amp-web-push-service",$WebPushService$$module$extensions$amp_web_push$0_1$web_push_service$$);$AMP$jscomp$inline_5807$$.registerElement("amp-web-push",$WebPushConfig$$module$extensions$amp_web_push$0_1$amp_web_push_config$$);$AMP$jscomp$inline_5807$$.registerElement("amp-web-push-widget",$WebPushWidget$$module$extensions$amp_web_push$0_1$amp_web_push_widget$$,"amp-web-push-widget.amp-invisible{visibility:hidden}\n/*# sourceURL=/extensions/amp-web-push/0.1/amp-web-push.css*/");
})});

//# sourceMappingURL=amp-web-push-0.1.js.map
