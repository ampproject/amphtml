(self.AMP=self.AMP||[]).push({n:"amp-access-scroll",i:["_base_i","_base_misc"],v:"1904281823091",f:(function(AMP,_){
var $ReadDepthTracker$$module$extensions$amp_access_scroll$0_1$read_depth_tracker$$=function($ampdoc$jscomp$114$$,$accessSource$jscomp$3$$,$connectHostname$$){var $$jscomp$this$jscomp$266$$=this;this.$ampdoc_$=$ampdoc$jscomp$114$$;this.$G$=null;this.$H$=$accessSource$jscomp$3$$;this.$I$=$connectHostname$$;var $debouncedFindTopParagraph_$$=_.$debounce$$module$src$utils$rate_limit$$($ampdoc$jscomp$114$$.$win$,this.$J$.bind(this),1E3);this.$F$=_.$Services$$module$src$services$viewportForDoc$$($ampdoc$jscomp$114$$);
this.$D$=[];$ampdoc$jscomp$114$$.$whenReady$().then(function(){_.$JSCompiler_StaticMethods_onChanged$$($$jscomp$this$jscomp$266$$.$F$,$debouncedFindTopParagraph_$$);$$jscomp$this$jscomp$266$$.$D$=$ampdoc$jscomp$114$$.$getBody$().getElementsByTagName("p")})},$JSCompiler_StaticMethods_updateLastRead_$$=function($JSCompiler_StaticMethods_updateLastRead_$self$$,$snippet$$){$JSCompiler_StaticMethods_updateLastRead_$self$$.$H$.$buildUrl$($JSCompiler_StaticMethods_updateLastRead_$self$$.$I$+"/amp/updatedepth?rid=READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL&rd="+
encodeURIComponent($snippet$$),!1).then(function($snippet$$){_.$Services$$module$src$services$xhrFor$$($JSCompiler_StaticMethods_updateLastRead_$self$$.$ampdoc_$.$win$).fetch($snippet$$)})},$accessConfig$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($connectHostname$jscomp$1$$){return{authorization:$connectHostname$jscomp$1$$+"/amp/access?rid=READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL&x=QUERY_PARAM(scrollx)",pingback:$connectHostname$jscomp$1$$+"/amp/pingback?rid=READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER&x=QUERY_PARAM(scrollx)&d=AUTHDATA(scroll)&v=AUTHDATA(visitId)",
namespace:"scroll"}},$devEtld$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($config$jscomp$16$$){return _.$getMode$$module$src$mode$$().$development$&&$config$jscomp$16$$.etld?$config$jscomp$16$$.etld:""},$connectHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($config$jscomp$17$$){return"https://connect"+($devEtld$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($config$jscomp$17$$)||".scroll.com")},$scrollHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=
function($config$jscomp$18_devScrollEtld$$){return($config$jscomp$18_devScrollEtld$$=$devEtld$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($config$jscomp$18_devScrollEtld$$))?"https://scroll"+$config$jscomp$18_devScrollEtld$$:"https://scroll.com"},$ScrollAccessVendor$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($ampdoc$jscomp$115$$,$accessSource$jscomp$4$$){_.$AccessClientAdapter$$module$extensions$amp_access$0_1$amp_access_client$$.call(this,$ampdoc$jscomp$115$$,$accessConfig$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($connectHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($accessSource$jscomp$4$$.$getAdapterConfig$())),
{$buildUrl$:$accessSource$jscomp$4$$.$buildUrl$.bind($accessSource$jscomp$4$$),$collectUrlVars$:$accessSource$jscomp$4$$.$collectUrlVars$.bind($accessSource$jscomp$4$$)});this.$F$=$accessSource$jscomp$4$$},$ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($ampdoc$jscomp$116$$,$accessSource$jscomp$5$$){this.$ampdoc_$=$ampdoc$jscomp$116$$;this.$D$=$accessSource$jscomp$5$$},$JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$$=
function($JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$){_.$JSCompiler_StaticMethods_fetchJson$$(_.$Services$$module$src$services$xhrFor$$($JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$.$ampdoc_$.$win$),"https://block.scroll.com/check.json").then(function(){return!1},function($JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$){return 0===
$JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$.message.indexOf("XHR Failed fetching (https://block.scroll.com/...): Resource blocked by content blocker")}).then(function($blockedByScrollApp$$){!0===$blockedByScrollApp$$&&$JSCompiler_StaticMethods_addActivateButton$$(new $ScrollElement$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$.$ampdoc_$),
$JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$.$D$,$JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$self$$.$D$.$getAdapterConfig$())})},$ScrollElement$$module$extensions$amp_access_scroll$0_1$scroll_impl$$=function($ampdoc$jscomp$118$$){_.$installStylesForDoc$$module$src$style_installer$$($ampdoc$jscomp$118$$,".amp-access-scroll-bar{height:44px;position:fixed;left:0;width:100%;background:transparent;z-index:2147483647;bottom:0}.amp-access-scroll-placeholder{padding-top:5px;padding-left:16px;background-color:#fff;border-top:1px solid #eee;border-bottom:1px solid #eee;box-sizing:border-box}\n/*# sourceURL=/extensions/amp-access-scroll/0.1/amp-access-scroll.css*/",
function(){},!1,"amp-access-scroll-elt");this.$ampdoc_$=$ampdoc$jscomp$118$$;this.$F$=document.createElement("div");this.$F$.classList.add("amp-access-scroll-bar");this.$D$=document.createElement("iframe");this.$D$.setAttribute("scrolling","no");this.$D$.setAttribute("frameborder","0");this.$D$.setAttribute("allowtransparency","true");this.$D$.setAttribute("title","Scroll");this.$D$.setAttribute("width","100%");this.$D$.setAttribute("height","100%");this.$D$.setAttribute("sandbox","allow-scripts allow-same-origin allow-top-navigation allow-popups allow-popups-to-escape-sandbox");
this.$F$.appendChild(this.$D$);$ampdoc$jscomp$118$$.$getBody$().appendChild(this.$F$);_.$JSCompiler_StaticMethods_addToFixedLayer$$(_.$Services$$module$src$services$viewportForDoc$$($ampdoc$jscomp$118$$),this.$F$)},$JSCompiler_StaticMethods_handleScrollUser$$=function($JSCompiler_StaticMethods_handleScrollUser$self$$,$accessSource$jscomp$6$$,$vendorConfig$$){var $placeholder$jscomp$6$$=document.createElement("div");$placeholder$jscomp$6$$.classList.add("amp-access-scroll-bar");$placeholder$jscomp$6$$.classList.add("amp-access-scroll-placeholder");
var $img$jscomp$4$$=document.createElement("img");$img$jscomp$4$$.setAttribute("src","https://static.scroll.com/assets/icn-scroll-logo32-9f4ceef399905139bbd26b87bfe94542.svg");$img$jscomp$4$$.setAttribute("layout","fixed");$img$jscomp$4$$.setAttribute("width",32);$img$jscomp$4$$.setAttribute("height",32);$placeholder$jscomp$6$$.appendChild($img$jscomp$4$$);$JSCompiler_StaticMethods_handleScrollUser$self$$.$ampdoc_$.$getBody$().appendChild($placeholder$jscomp$6$$);$accessSource$jscomp$6$$.$buildUrl$($connectHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($vendorConfig$$)+
"/amp/scrollbar?rid=READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL",!1).then(function($accessSource$jscomp$6$$){$JSCompiler_StaticMethods_handleScrollUser$self$$.$D$.onload=function(){$JSCompiler_StaticMethods_handleScrollUser$self$$.$ampdoc_$.$getBody$().removeChild($placeholder$jscomp$6$$)};$JSCompiler_StaticMethods_handleScrollUser$self$$.$D$.setAttribute("src",$accessSource$jscomp$6$$)})},$JSCompiler_StaticMethods_addActivateButton$$=function($JSCompiler_StaticMethods_addActivateButton$self$$,
$accessSource$jscomp$7$$,$vendorConfig$jscomp$1$$){$accessSource$jscomp$7$$.$buildUrl$($scrollHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($vendorConfig$jscomp$1$$)+"/activateamp?rid=READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL&x=QUERY_PARAM(scrollx)",!1).then(function($accessSource$jscomp$7$$){$JSCompiler_StaticMethods_addActivateButton$self$$.$D$.setAttribute("src",$accessSource$jscomp$7$$)})};
$ReadDepthTracker$$module$extensions$amp_access_scroll$0_1$read_depth_tracker$$.prototype.$J$=function(){var $$jscomp$this$jscomp$267$$=this;return Promise.all([].slice.call(this.$D$).map(function($p$jscomp$14$$){return _.$JSCompiler_StaticMethods_getClientRectAsync$$($$jscomp$this$jscomp$267$$.$F$,$p$jscomp$14$$)})).then(function($paragraphIdx$jscomp$inline_2233_rects$$){for(var $lastIdxAboveViewport$$=null,$lastPosition$$=null,$i$jscomp$176$$=$paragraphIdx$jscomp$inline_2233_rects$$.length-1;0<=
$i$jscomp$176$$;$i$jscomp$176$$--){var $bottomPosition$$=$paragraphIdx$jscomp$inline_2233_rects$$[$i$jscomp$176$$].bottom;0>=$bottomPosition$$&&(null===$lastPosition$$||$lastPosition$$<$bottomPosition$$)&&($lastIdxAboveViewport$$=$i$jscomp$176$$,$lastPosition$$=$bottomPosition$$)}null!==$lastIdxAboveViewport$$&&($paragraphIdx$jscomp$inline_2233_rects$$=$lastIdxAboveViewport$$,$$jscomp$this$jscomp$267$$.$G$!==$paragraphIdx$jscomp$inline_2233_rects$$&&($$jscomp$this$jscomp$267$$.$G$=$paragraphIdx$jscomp$inline_2233_rects$$,
$JSCompiler_StaticMethods_updateLastRead_$$($$jscomp$this$jscomp$267$$,$$jscomp$this$jscomp$267$$.$D$[$paragraphIdx$jscomp$inline_2233_rects$$].innerText.substring(0,50))))})};_.$$jscomp$inherits$$($ScrollAccessVendor$$module$extensions$amp_access_scroll$0_1$scroll_impl$$,_.$AccessClientAdapter$$module$extensions$amp_access$0_1$amp_access_client$$);
$ScrollAccessVendor$$module$extensions$amp_access_scroll$0_1$scroll_impl$$.prototype.$authorize$=function(){var $$jscomp$this$jscomp$269$$=this;return _.$AccessClientAdapter$$module$extensions$amp_access$0_1$amp_access_client$$.prototype.$authorize$.call(this).then(function($response$jscomp$32$$){var $config$jscomp$19_isStory$$=$$jscomp$this$jscomp$269$$.ampdoc.getRootNode().querySelector("amp-story[standalone]");if($response$jscomp$32$$&&$response$jscomp$32$$.scroll){if(!$config$jscomp$19_isStory$$){$config$jscomp$19_isStory$$=
$$jscomp$this$jscomp$269$$.$F$.$getAdapterConfig$();$JSCompiler_StaticMethods_handleScrollUser$$(new $ScrollElement$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($$jscomp$this$jscomp$269$$.ampdoc),$$jscomp$this$jscomp$269$$.$F$,$config$jscomp$19_isStory$$);var $ampdoc$jscomp$inline_2235$$=$$jscomp$this$jscomp$269$$.ampdoc;if(!$config$jscomp$19_isStory$$.disableAnalytics){var $doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$=$ampdoc$jscomp$inline_2235$$.$win$.document,$analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$=
_.$dict$$module$src$utils$object$$({trigger:"immediate"});$config$jscomp$19_isStory$$.dataConsentId&&($analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$["data-block-on-consent"]="");$analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$=_.$createElementWithAttributes$$module$src$dom$$($doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$,"amp-analytics",$analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$);$doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$=
_.$createElementWithAttributes$$module$src$dom$$($doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$,"script",_.$dict$$module$src$utils$object$$({type:"application/json"}));var $ANALYTICS_CONFIG$jscomp$inline_2241$$={requests:{scroll:$connectHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($config$jscomp$19_isStory$$)+"/amp/analytics?rid=ACCESS_READER_ID&cid=CLIENT_ID(scroll1)&c=CANONICAL_URL&o=AMPDOC_URL&r=DOCUMENT_REFERRER&x=QUERY_PARAM(scrollx)&d=AUTHDATA(scroll.scroll)&v=AUTHDATA(scroll.visitId)&h=SOURCE_HOSTNAME&s=${totalEngagedTime}"},
triggers:{trackInterval:{on:"timer",timerSpec:{interval:15,maxTimerLength:7200},request:"scroll"}}};$doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$.textContent=JSON.stringify($ANALYTICS_CONFIG$jscomp$inline_2241$$);$analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$.appendChild($doc$jscomp$inline_2237_scriptElem$jscomp$inline_2240$$);$analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$.$CONFIG$=$ANALYTICS_CONFIG$jscomp$inline_2241$$;_.$JSCompiler_StaticMethods_installExtensionForDoc$$(_.$Services$$module$src$services$extensionsFor$$($ampdoc$jscomp$inline_2235$$.$win$),
$ampdoc$jscomp$inline_2235$$,"amp-analytics");$ampdoc$jscomp$inline_2235$$.$getBody$().appendChild($analyticsElem$jscomp$inline_2239_attributes$jscomp$inline_2238$$)}$response$jscomp$32$$.features&&$response$jscomp$32$$.features.readDepth&&new $ReadDepthTracker$$module$extensions$amp_access_scroll$0_1$read_depth_tracker$$($$jscomp$this$jscomp$269$$.ampdoc,$$jscomp$this$jscomp$269$$.$F$,$connectHostname$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($config$jscomp$19_isStory$$))}}else $response$jscomp$32$$&&
$response$jscomp$32$$.blocker&&!_.$parseQueryString_$$module$src$url_parse_query_string$$($$jscomp$this$jscomp$269$$.ampdoc.$win$.location.search).scrollnoblockerrefresh&&$JSCompiler_StaticMethods_ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl_prototype$check$$(new $ScrollContentBlocker$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($$jscomp$this$jscomp$269$$.ampdoc,$$jscomp$this$jscomp$269$$.$F$));return $response$jscomp$32$$})};(function($AMP$jscomp$6$$){$AMP$jscomp$6$$.registerServiceForDoc("scroll",function($AMP$jscomp$6$$){return _.$Services$$module$src$services$accessServiceForDoc$$($AMP$jscomp$6$$.$getHeadNode$()).then(function($ampdoc$jscomp$120$$){$ampdoc$jscomp$120$$=$ampdoc$jscomp$120$$.$getVendorSource$("scroll");var $accessService$jscomp$8_source$jscomp$29$$=new $ScrollAccessVendor$$module$extensions$amp_access_scroll$0_1$scroll_impl$$($AMP$jscomp$6$$,$ampdoc$jscomp$120$$);$ampdoc$jscomp$120$$.$D$.$registerVendor$($accessService$jscomp$8_source$jscomp$29$$);
return $accessService$jscomp$8_source$jscomp$29$$})})})(self.AMP);
})});

//# sourceMappingURL=amp-access-scroll-0.1.js.map
