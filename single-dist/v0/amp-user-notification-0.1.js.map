{"version":3,"sources":["/extensions/amp-user-notification/0.1/amp-user-notification.js","/extensions/amp-geo/0.1/amp-geo-in-group.js","/src/service/cid-impl.js","/src/service/viewer-impl.js","/src/service/notification-ui-manager.js","/build/amp-user-notification-0.1.css.js"],"names":["constructor","element","ampUserId_","elementId_","deferred","Deferred","dialogPromise_","promise","dialogResolve_","resolve","dismissHref_","persistDismissal_","showIfGeo_","showIfNotGeo_","geoPromise_","showIfHref_","storageKey_","storagePromise_","urlReplacements_","isNotificationRequiredGeo_","geoGroup","includeGeos","Services$$module$src$services.geoForDocOrNull","then","geo","matchedGeos","split","filter","group","IN","isInCountryGroup","length","buildGetHref_","ampUserId","expandUrlAsync","href","addParamsToUrl","data","postDismissEnpoint_","enctype","getAttribute","fetchJson","Services$$module$src$services.xhrFor","win","method","credentials","requireAmpResponseSourceOrigin","body","dict","headers","optoutOfCid_","Services$$module$src$services.cidForDoc","getCidService_","cid","optOutOfCid","ampdoc","dismiss","reason","dev","error","TAG","getAsyncCid_","get","scope","createCookieIfNotPresent","Promise","shouldShow","isDismissed","dismissed","shouldShowViaXhr_","getShowEndpoint_","bind","onGetShowEndpointSuccess_","forceNoPersist","classList","remove","add","removeFromFixedLayer","getViewport","storage","set","registry_","Object","create","deferRegistry_","viewer_","Services$$module$src$services.viewerForDoc","documentReadyPromise_","whenReady","managerReadyPromise_","all","whenFirstVisiblePromise_","notificationUiManagerPromise_","getServicePromiseForDoc","NOTIFICATION_UI_MANAGER","registerUserNotification","id","userNotification","getOrCreateDeferById_","manager","registerUI","show","catch","rethrowAsync","$jscomp.inherits","BaseElement","AmpUserNotification","AMP","isAlwaysFixed","?.prototype","buildCallback","getAmpDoc","Services$$module$src$services.urlReplacementsForDoc","Services$$module$src$services.storageForDoc","roleAttribute","setAttribute","persistDismissal","registerDefaultAction","registerAction","userNotificationManagerPromise","SERVICE_ID","getReq","res","json","toggle","addToFixedLayer","persistedValue","getElementById","user","warn","getNotification","registerServiceForDoc","UserNotificationManager","NotificationUiManager","registerElement","CSS"],"mappings":"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","file":"amp-user-notification-0.1.js","sourcesContent":[]}