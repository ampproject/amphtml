{"version":3,"sources":["/extensions/amp-position-observer/0.1/amp-position-observer.js","/src/action-constants.js","/src/layout.js","/src/service/viewer-impl.js","/src/service/position-observer/position-observer-worker.js","/src/layout-rect.js"],"names":["constructor","element","action_","positionObserver_","viewport_","isVisible_","topRatio_","bottomRatio_","topMarginExpr_","bottomMarginExpr_","resolvedTopMargin_","resolvedBottomMargin_","viewportRect_","targetId_","initialViewportHeight_","scrollProgress_","remainingScrollToExit_","runOnce_","firstIterationComplete_","triggerScroll_","scrolltop","getScrollTop","event","createCustomEvent","win","dict","positionObserverData","trigger","name","LOW","parseAttributes_","ratios","getAttribute","topBottom","trim","split","parseFloat","num","val","margins","validateAndResolveMargin_","parseLength","length","match","m","getLengthNumeral","unit","height","$jscomp.inherits","BaseElement","AmpVisibilityObserver","AMP","buildCallback","Services$$module$src$services.viewerForDoc","viewer","getAmpDoc","whenFirstVisiblePromise_","then","init_","bind","hasAttribute","Services$$module$src$services.actionServiceForDoc","Services$$module$src$services.viewportForDoc","maybeInstallPositionObserver_","installPositionObserverServiceForDoc","getServiceForDoc","whenReady","scene","discoverScene_","assertElement","user","getElementById","parentNode","getBody","document","documentElement","observe","HIGH","positionChanged_","entry","wasVisible","prevViewportHeight","adjustForSmallViewportResize_","viewportRect","viewportHeightChangeDelta","resizeOffset","RESIZE_THRESHOLD","Math","abs","layoutRectLtwh","left","top","width","recalculateMargins_","rect","applyMargins_","positionRect","relPos","layoutRectsRelativePos","adjViewportRect","INSIDE","relativePos","updateVisibility_","offset","TOP","ratioToUse","BOTTOM","bottom","triggerExit_","triggerEnter_","totalProgress","updateScrollProgress_","topOffset","registerElement","TAG"],"mappings":"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","file":"amp-position-observer-0.1.js","sourcesContent":[]}