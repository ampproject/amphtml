(self.AMP=self.AMP||[]).push({n:"amp-experiment",i:["_base_i","_base_misc"],v:"1904281823091",f:(function(AMP,_){
var $OriginExperiments$$module$src$service$origin_experiments_impl$$=function($ampdoc$jscomp$183$$){this.$ampdoc_$=$ampdoc$jscomp$183$$;this.$F$=_.$Services$$module$src$services$cryptoFor$$($ampdoc$jscomp$183$$.$win$);this.$G$=_.$Services$$module$src$services$urlForDoc$$($ampdoc$jscomp$183$$.$getHeadNode$());this.$H$=new $TokenMaster$$module$src$service$origin_experiments_impl$$(this.$F$,this.$G$);this.$D$=null},$JSCompiler_StaticMethods_getExperiments$$=function($JSCompiler_StaticMethods_getExperiments$self$$){var $opt_rescan$$=
void 0===$opt_rescan$$?!1:$opt_rescan$$;var $publicJwk$$=void 0===$publicJwk$$?$PUBLIC_JWK$$module$src$service$origin_experiments_impl$$:$publicJwk$$;if(!_.$JSCompiler_StaticMethods_isPkcsAvailable$$($JSCompiler_StaticMethods_getExperiments$self$$.$F$))return _.$user$$module$src$log$$().error("OriginExperiments","Crypto is unavailable."),Promise.resolve([]);if(!$JSCompiler_StaticMethods_getExperiments$self$$.$D$||$opt_rescan$$)$JSCompiler_StaticMethods_getExperiments$self$$.$D$=$JSCompiler_StaticMethods_scanForTokens_$$($JSCompiler_StaticMethods_getExperiments$self$$,
$publicJwk$$);return $JSCompiler_StaticMethods_getExperiments$self$$.$D$},$JSCompiler_StaticMethods_scanForTokens_$$=function($JSCompiler_StaticMethods_scanForTokens_$self$$,$publicJwk$jscomp$1$$){var $metas$jscomp$1$$=$JSCompiler_StaticMethods_scanForTokens_$self$$.$ampdoc_$.$getHeadNode$().querySelectorAll('meta[name="amp-experiment-token"]');if(0==$metas$jscomp$1$$.length)return Promise.resolve();var $win$jscomp$355$$=$JSCompiler_StaticMethods_scanForTokens_$self$$.$ampdoc_$.$win$;return _.$JSCompiler_StaticMethods_importPkcsKey$$(_.$Services$$module$src$services$cryptoFor$$($win$jscomp$355$$),
$publicJwk$jscomp$1$$).then(function($publicJwk$jscomp$1$$){for(var $publicKey$$=[],$i$jscomp$318$$=0;$i$jscomp$318$$<$metas$jscomp$1$$.length;$i$jscomp$318$$++){var $meta$jscomp$10_p$jscomp$31$$=$metas$jscomp$1$$[$i$jscomp$318$$],$token$jscomp$33$$=$meta$jscomp$10_p$jscomp$31$$.getAttribute("content");$token$jscomp$33$$?($meta$jscomp$10_p$jscomp$31$$=$JSCompiler_StaticMethods_verifyToken$$($JSCompiler_StaticMethods_scanForTokens_$self$$.$H$,$token$jscomp$33$$,$win$jscomp$355$$.location,$publicJwk$jscomp$1$$).catch(function($JSCompiler_StaticMethods_scanForTokens_$self$$){_.$user$$module$src$log$$().error("OriginExperiments",
"Failed to verify experiment token:",$JSCompiler_StaticMethods_scanForTokens_$self$$)}),$publicKey$$.push($meta$jscomp$10_p$jscomp$31$$)):_.$user$$module$src$log$$().error("OriginExperiments","Missing content for experiment token: ",$meta$jscomp$10_p$jscomp$31$$)}return Promise.all($publicKey$$)})},$TokenMaster$$module$src$service$origin_experiments_impl$$=function($crypto$jscomp$3$$,$url$jscomp$188$$){this.$D$=$crypto$jscomp$3$$;this.$F$=$url$jscomp$188$$},$JSCompiler_StaticMethods_verifyToken$$=
function($JSCompiler_StaticMethods_verifyToken$self$$,$token$jscomp$34$$,$location$jscomp$54$$,$publicKey$jscomp$1$$){return new Promise(function($resolve$jscomp$64$$){var $i$jscomp$319$$=0,$bytes$jscomp$15$$=_.$stringToBytes$$module$src$utils$bytes$$(atob($token$jscomp$34$$)),$length$jscomp$41_version$jscomp$11$$=$bytes$jscomp$15$$[$i$jscomp$319$$];if(0!==$length$jscomp$41_version$jscomp$11$$)throw Error("Unrecognized token version: "+$length$jscomp$41_version$jscomp$11$$);$i$jscomp$319$$+=1;$length$jscomp$41_version$jscomp$11$$=
(new DataView($bytes$jscomp$15$$.buffer)).getUint32($i$jscomp$319$$);$i$jscomp$319$$+=4;if($length$jscomp$41_version$jscomp$11$$>$bytes$jscomp$15$$.length-$i$jscomp$319$$)throw Error("Unexpected config length: "+$length$jscomp$41_version$jscomp$11$$);var $configBytes$$=$bytes$jscomp$15$$.subarray($i$jscomp$319$$,$i$jscomp$319$$+$length$jscomp$41_version$jscomp$11$$);$i$jscomp$319$$+=$length$jscomp$41_version$jscomp$11$$;$resolve$jscomp$64$$(_.$JSCompiler_StaticMethods_verifyPkcs$$($JSCompiler_StaticMethods_verifyToken$self$$.$D$,
$publicKey$jscomp$1$$,$bytes$jscomp$15$$.subarray($i$jscomp$319$$),$bytes$jscomp$15$$.subarray(0,$i$jscomp$319$$)).then(function($token$jscomp$34$$){if(!$token$jscomp$34$$)throw Error("Failed to verify token signature.");$token$jscomp$34$$=_.$bytesToString$$module$src$utils$bytes$$($configBytes$$);$token$jscomp$34$$=_.$parseJson$$module$src$json$$($token$jscomp$34$$);var $publicKey$jscomp$1$$=$JSCompiler_StaticMethods_verifyToken$self$$.$F$.parse($token$jscomp$34$$.origin).origin,$resolve$jscomp$64$$=
_.$getSourceOrigin$$module$src$url$$($location$jscomp$54$$);if($publicKey$jscomp$1$$!==$resolve$jscomp$64$$)throw Error("Config origin ("+$publicKey$jscomp$1$$+") does not match "+("window ("+$resolve$jscomp$64$$+")."));$publicKey$jscomp$1$$=$token$jscomp$34$$.experiment;if($token$jscomp$34$$.expiration>=Date.now())return $publicKey$jscomp$1$$;throw Error('Experiment "'+$publicKey$jscomp$1$$+'" has expired.');}))})},$parseMutation$$module$extensions$amp_experiment$1_0$mutation_parser$$=function($mutation$jscomp$1$$,
$document$jscomp$10$$){JSON.stringify($mutation$jscomp$1$$);$mutation$jscomp$1$$.targetElement=$document$jscomp$10$$.querySelector($mutation$jscomp$1$$.target);if("attributes"===$mutation$jscomp$1$$.type)return Object.keys($SUPPORTED_ATTRIBUTES$$module$extensions$amp_experiment$1_0$mutation_parser$$),function(){$mutation$jscomp$1$$.targetElement.setAttribute($mutation$jscomp$1$$.attributeName,$mutation$jscomp$1$$.value)};if("characterData"===$mutation$jscomp$1$$.type)return function(){$mutation$jscomp$1$$.targetElement.textContent=
$mutation$jscomp$1$$.value};_.$user$$module$src$log$$().error("amp-experiment mutation-parser","childList mutations not supported in the current experiment state.");return function(){}},$Variants$$module$extensions$amp_experiment$1_0$variant$$=function($ampdoc$jscomp$185$$){this.ampdoc=$ampdoc$jscomp$185$$;this.$D$=new _.$Deferred$$module$src$utils$promise$$},$allocateVariant$$module$extensions$amp_experiment$1_0$variant$$=function($ampdoc$jscomp$186$$,$experimentName$jscomp$6$$,$experimentObject$$){$validateExperiment$$module$extensions$amp_experiment$1_0$variant$$($experimentObject$$);
var $hasConsentPromise$jscomp$1_override$jscomp$2$$=_.$JSCompiler_StaticMethods_getParam$$(_.$Services$$module$src$services$viewerForDoc$$($ampdoc$jscomp$186$$),"amp-x-"+$experimentName$jscomp$6$$);if($hasConsentPromise$jscomp$1_override$jscomp$2$$&&_.$hasOwn$$module$src$utils$object$$($experimentObject$$.variants,$hasConsentPromise$jscomp$1_override$jscomp$2$$))return Promise.resolve($hasConsentPromise$jscomp$1_override$jscomp$2$$);var $sticky$jscomp$1$$=!1!==$experimentObject$$.sticky,$cidScope$jscomp$1$$=
$experimentObject$$.cidScope||"amp-experiment";$hasConsentPromise$jscomp$1_override$jscomp$2$$=Promise.resolve(!0);$sticky$jscomp$1$$&&$experimentObject$$.consentNotificationId&&($hasConsentPromise$jscomp$1_override$jscomp$2$$=_.$Services$$module$src$services$userNotificationManagerForDoc$$($ampdoc$jscomp$186$$.$getHeadNode$()).then(function($ampdoc$jscomp$186$$){return $ampdoc$jscomp$186$$.$H$($experimentObject$$.consentNotificationId)}).then(function($ampdoc$jscomp$186$$){return $ampdoc$jscomp$186$$.$isDismissed$()}));
return $hasConsentPromise$jscomp$1_override$jscomp$2$$.then(function($hasConsentPromise$jscomp$1_override$jscomp$2$$){return $hasConsentPromise$jscomp$1_override$jscomp$2$$?$getBucketTicket$$module$extensions$amp_experiment$1_0$variant$$($ampdoc$jscomp$186$$,$experimentObject$$.group||$experimentName$jscomp$6$$,$sticky$jscomp$1$$?$cidScope$jscomp$1$$:null).then(function($ampdoc$jscomp$186$$){for(var $experimentName$jscomp$6$$=0,$hasConsentPromise$jscomp$1_override$jscomp$2$$=$experimentObject$$.variants,
$sticky$jscomp$1$$=Object.keys($hasConsentPromise$jscomp$1_override$jscomp$2$$).sort(),$cidScope$jscomp$1$$=0;$cidScope$jscomp$1$$<$sticky$jscomp$1$$.length;$cidScope$jscomp$1$$++)if($experimentName$jscomp$6$$+=$hasConsentPromise$jscomp$1_override$jscomp$2$$[$sticky$jscomp$1$$[$cidScope$jscomp$1$$]].weight,$ampdoc$jscomp$186$$<$experimentName$jscomp$6$$)return $sticky$jscomp$1$$[$cidScope$jscomp$1$$];return null}):null})},$validateExperiment$$module$extensions$amp_experiment$1_0$variant$$=function($experimentObject$jscomp$1_variants$jscomp$8$$){$experimentObject$jscomp$1_variants$jscomp$8$$=
$experimentObject$jscomp$1_variants$jscomp$8$$.variants;for(var $variantName$jscomp$2$$ in $experimentObject$jscomp$1_variants$jscomp$8$$)_.$hasOwn$$module$src$utils$object$$($experimentObject$jscomp$1_variants$jscomp$8$$,$variantName$jscomp$2$$)},$getBucketTicket$$module$extensions$amp_experiment$1_0$variant$$=function($ampdoc$jscomp$187$$,$group$jscomp$4$$,$opt_cidScope$jscomp$1$$){if(!$opt_cidScope$jscomp$1$$)return Promise.resolve(100*$ampdoc$jscomp$187$$.$win$.Math.random());var $cidPromise$jscomp$4$$=
_.$Services$$module$src$services$cidForDoc$$($ampdoc$jscomp$187$$).then(function($ampdoc$jscomp$187$$){return $ampdoc$jscomp$187$$.get({scope:$opt_cidScope$jscomp$1$$,createCookieIfNotPresent:!0},Promise.resolve())});return Promise.all([$cidPromise$jscomp$4$$,_.$Services$$module$src$services$cryptoFor$$($ampdoc$jscomp$187$$.$win$)]).then(function($ampdoc$jscomp$187$$){return _.$JSCompiler_StaticMethods_uniform$$($ampdoc$jscomp$187$$[1],$group$jscomp$4$$+":"+$ampdoc$jscomp$187$$[0])}).then(function($ampdoc$jscomp$187$$){return 100*
$ampdoc$jscomp$187$$})},$AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$=function($var_args$jscomp$73$$){return AMP.BaseElement.apply(this,arguments)||this},$JSCompiler_StaticMethods_applyMutations_$$=function($JSCompiler_StaticMethods_applyMutations_$self$$,$variantObject$jscomp$1$$){return $JSCompiler_StaticMethods_applyMutations_$self$$.$getAmpDoc$().$whenBodyAvailable$().then(function(){$variantObject$jscomp$1$$.mutations.map(function($variantObject$jscomp$1$$){return $parseMutation$$module$extensions$amp_experiment$1_0$mutation_parser$$($variantObject$jscomp$1$$,
$JSCompiler_StaticMethods_applyMutations_$self$$.$win$.document)}).forEach(function($JSCompiler_StaticMethods_applyMutations_$self$$){return $JSCompiler_StaticMethods_applyMutations_$self$$()})})},$JSCompiler_StaticMethods_isExperimentEnabled_$$=function($JSCompiler_StaticMethods_isExperimentEnabled_$self$$){if(_.$isExperimentOn$$module$src$experiments$$($JSCompiler_StaticMethods_isExperimentEnabled_$self$$.$win$,"amp-experiment-1.0"))return Promise.resolve(!0);_.$registerServiceBuilderForDoc$$module$src$service$$($JSCompiler_StaticMethods_isExperimentEnabled_$self$$.$getAmpDoc$(),
"origin-experiments",$OriginExperiments$$module$src$service$origin_experiments_impl$$);return $JSCompiler_StaticMethods_getExperiments$$(_.$getServiceForDoc$$module$src$service$$($JSCompiler_StaticMethods_isExperimentEnabled_$self$$.element,"origin-experiments")).then(function($JSCompiler_StaticMethods_isExperimentEnabled_$self$$){return $JSCompiler_StaticMethods_isExperimentEnabled_$self$$&&$JSCompiler_StaticMethods_isExperimentEnabled_$self$$.includes("amp-experiment-1.0")})},$PUBLIC_JWK$$module$src$service$origin_experiments_impl$$=
{alg:"RS256",e:"AQAB",ext:!0,key_ops:["verify"],kty:"RSA",n:"uAGSMYKze8Fit508UaGHz1eZowfX4YsA0lmyi-65xQfjF7nMo61c4Iz4erdqgRp-ov662yVPquhPmTxgB-nzNcTPrj15Jo05Js78Q9hS2hrPIjKMlzcKSYQN_08QieWKOSmVbLSv_-4n9Ms5ta8nRs4pwc_2nX5n7m5B5GH4VerGbqIWIn9FRNYMShBRQ9TCHpb6BIUTwUn6iwmJLenq0A1xhGrQ9rswGC1QJhjotkeReKXZDLLWaFr0uRw-IyvRa5RiiEGntgOvcbvamM5TnbKavc2rxvg2TWTCNQnb7lWSAzldJA_yAOYet_MjnHMyj2srUdbQSDCk8kPWWuafiQ"};var $SUPPORTED_ATTRIBUTES$$module$extensions$amp_experiment$1_0$mutation_parser$$={style:function($value$jscomp$237$$){return $value$jscomp$237$$.match(/(!\s*important|\x3c!--)/)?!1:$value$jscomp$237$$.match(/^color:\s*#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3});?$/)||$value$jscomp$237$$.match(/^background-color:\s*#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3});?$/)?!0:!1},src:function($value$jscomp$238$$){return $value$jscomp$238$$},href:function($value$jscomp$239$$){return $value$jscomp$239$$}};$Variants$$module$extensions$amp_experiment$1_0$variant$$.prototype.init=function($variants$jscomp$6$$){var $$jscomp$this$jscomp$625$$=this;$variants$jscomp$6$$.then(function($variants$jscomp$6$$){return $$jscomp$this$jscomp$625$$.$D$.resolve($variants$jscomp$6$$)})};$Variants$$module$extensions$amp_experiment$1_0$variant$$.prototype.$whenReady$=function(){return this.$D$.$promise$};_.$$jscomp$inherits$$($AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$,AMP.BaseElement);$AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$.prototype.$isLayoutSupported$=function($layout$jscomp$62$$){return"nodisplay"==$layout$jscomp$62$$||"container"==$layout$jscomp$62$$};
$AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$.prototype.$buildCallback$=function(){var $$jscomp$this$jscomp$626$$=this,$buildCallbackPromises$$=[_.$getServicePromiseForDoc$$module$src$service$$(this.$getAmpDoc$(),"variant"),$JSCompiler_StaticMethods_isExperimentEnabled_$$(this)];return Promise.all($buildCallbackPromises$$).then(function($buildCallbackPromises$$){var $responses$jscomp$4$$=$buildCallbackPromises$$[0];if(!$buildCallbackPromises$$[1])return _.$user$$module$src$log$$().error("amp-experiment",
"Experiment amp-experiment-1.0 is not enabled."),$responses$jscomp$4$$.init(Promise.resolve({})),Promise.reject("Experiment amp-experiment-1.0 is not enabled.");try{var $config$jscomp$71$$=_.$parseJson$$module$src$json$$($$jscomp$this$jscomp$626$$.element.children[0].textContent),$results$jscomp$23$$=Object.create(null),$variants$jscomp$9$$=Object.keys($config$jscomp$71$$).map(function($buildCallbackPromises$$){return $allocateVariant$$module$extensions$amp_experiment$1_0$variant$$($$jscomp$this$jscomp$626$$.$getAmpDoc$(),
$buildCallbackPromises$$,$config$jscomp$71$$[$buildCallbackPromises$$]).then(function($$jscomp$this$jscomp$626$$){$results$jscomp$23$$[$buildCallbackPromises$$]=$$jscomp$this$jscomp$626$$})}),$experimentVariants$jscomp$1$$=Promise.all($variants$jscomp$9$$).then(function(){return $results$jscomp$23$$}).then($$jscomp$this$jscomp$626$$.$D$.bind($$jscomp$this$jscomp$626$$,$config$jscomp$71$$));$responses$jscomp$4$$.init($experimentVariants$jscomp$1$$)}catch($e$284$$){throw $responses$jscomp$4$$.init(Promise.resolve({})),
$e$284$$;}})};$AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$.prototype.$D$=function($config$jscomp$72$$,$experimentToVariant$$){var $appliedExperimentToVariantPromises$$=[],$experimentName$jscomp$10$$;for($experimentName$jscomp$10$$ in $experimentToVariant$$){var $variantName$jscomp$5$$=$experimentToVariant$$[$experimentName$jscomp$10$$];$variantName$jscomp$5$$&&$appliedExperimentToVariantPromises$$.push($JSCompiler_StaticMethods_applyMutations_$$(this,$config$jscomp$72$$[$experimentName$jscomp$10$$].variants[$variantName$jscomp$5$$]))}return Promise.all($appliedExperimentToVariantPromises$$).then(function(){return $experimentToVariant$$})};
var $AMP$jscomp$inline_3395$$=self.AMP;$AMP$jscomp$inline_3395$$.registerServiceForDoc("variant",$Variants$$module$extensions$amp_experiment$1_0$variant$$);$AMP$jscomp$inline_3395$$.registerElement("amp-experiment",$AmpExperiment$$module$extensions$amp_experiment$1_0$amp_experiment$$);
})});

//# sourceMappingURL=amp-experiment-1.0.js.map
