language: node_js
sudo: required  # See http://docs.travis-ci.com/user/trusty-ci-environment/
dist: trusty
node_js:
  - "stable"
python:
  - "2.7"
notifications:
  webhooks:
    - http://savage.nonblocking.io:8080/savage/travis
addons:
  sauce_connect: true
  hosts:
    - ads.localhost
    - iframe.localhost
    # Requested by some tests because they need a valid font host,
    # but should not resolve in tests.
    - fonts.googleapis.com
  apt:
    packages:
    - protobuf-compiler
    - python-protobuf
before_install:
  - export CHROME_BIN=google-chrome
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb
before_script:
  - pip install --user protobuf
script: node build-system/pr-check.js
branches:
  only:
    - master
    - release
    - canary
    - /^amp-release-.*$/
env:
  global:
    - NPM_CONFIG_PROGRESS="false"
    - secure: qhLs/sSgSj9isEaPkPbHtgBw5WgQfnP8WmeuTTFswAe8aAWY5mKtwvDBnLErwuFRQpGS43dG6k/Jf6mO/gR6v5/L+kmQoXclHApMCtNjV+oYlKMSnyl7o3RYtRW+OsKdWV5uRSn2e6j9YfOXjBS9XKG5EVrNx3i5MRimy5VuvLEeIP21LVUVhegnnYSnaIi5DIyScv8STQQYykIiK29GWjV/R0yMv1cIquclIUXM4if1OwgQ5vHHyER/RlXm+g/U0Z1NlfzWWvNWxZ35kqvs+BYT+SN5kmgotc/lIYg/iq+JrWO0QtO+Y6uLHYV3Fo+R2p7/VgAerfsn09odmS1mxzPi5jBBkIOy27cla0eqoJ5MDO094ih1tmdgniKcOFNZEer0BsRwRXaFT9puwJKKot9osqSuy1HY5A2YIItGnr79NqymO89vZx+OrAixSiy9TXvCfs/EPsWhOPLZ4URJ33q7XLAre2jQ2zxd0rQrL8UCqZ0YAENtawh5arVXDpRWTI2g8OuZ1Tpcpz2WNYW7bF/qbR3yyDFPbDHzQL+23/Zqb/BwzR2CCmSpFUYAlgiObd+o1tpMFdiXDDEgxdPOqmd2YCMLkxKi50vQH6Xl/SlewYb5nqZthg+5pRg1e6yYS4kjOGMtRnN4U5GZKC76cYlzgP3rO0vGmlcTZ4mkjM4=
    - secure: gs4BW2C0niWVMSKY7RIVFqBeRik/dPZ7pACN8juVDXL+oMtygis6Pfu+xvSyELH6xAzE7l5sbsa/PUWcigpVLnOesf5HF9TStj21rqi8VVpOlKziXOenG5mkR02oEPaojNduV2RlpD5rQJrv0Bb4gPnr/JSrDwZqpQuaZOhbVfmtZ+A5PrqODgYnWoWibCHvoDqlUi9nKdbQj/pT+aAZRczEHxN3zWzKAODYJkV0yThiAa7xtQ1Xr7X4d8JwBHjKVk1+Sh5NLElF1D41mYdATN7uB9DGR+DRBtZCcDbTm+uiMWIpALJx4eIPSGUXFjilI3DlffnEGYfuv35oxwu0SjoCIDf5vldp+CIJ2LCb4jhy5wW42jM7e55JgmKzmva5hJgUEEHoMtJZiqosf5LGPlvKK8mmYSDjc0nBi5LpO7A7kV6nj9KZzlkq2MiSpDjkY9Gwomdb+MJLhZ7JQl8kGjc0OqsU1Ic0f36uXO7CAC48sYFZ4lMWcoMsqfrTQqxnZKiooh4PWAKFfZdA/HR3mdQmWmetxQYlYPdCW/3I6E1UpWlKfqTTuKYBwXDMBgpJCCEgb3VoEnyOIQZUoKBK1g41X2YsoLzsZZNpc7LjiaywMPDgHEyk1jbnNUf8lUM1AresyWveO5Y36CeFwH7VCzznDUs7Ng4LyweboG/eK6k=
cache:
  yarn: true
  directories:
  - node_modules
