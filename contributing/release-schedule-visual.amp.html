<!doctype html>
<html lang="en" ⚡>
  <head>
    <meta charset="utf-8">
    <script async src="https://cdn.ampproject.org/v0.js"></script>
    <script async custom-element="amp-script" src="https://cdn.ampproject.org/v0/amp-script-0.1.js"></script>
    <title>AMP release schedule visualization</title>
    <link rel="canonical" href="release-schedule-visual.amp.html">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Mono|Noto+Sans|Poppins">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <meta name="amp-script-src" content="sha384-0ZxBLqhOncK0XJia6kZgtaPz6ZciY64IGaC6N174VoC6Jo6mew8Gkrgsb7rYrgW3">
    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <style amp-custom>
      body {
        font-family: "Noto Sans", sans-serif;
        padding: 1em;
      }
      body .touch-only {
        display: none;
      }
      body.amp-mode-touch .touch-only {
        display: unset;
      }
      body.amp-mode-touch .no-touch-only {
        display: none;
      }
      #calendar {
        display: grid;
        gap: 10px;
        grid-template-columns: 5em repeat(7, 7.5em);
        grid-auto-flow: dense;
        grid-template-rows: auto 150px auto auto 150px 150px 150px auto auto 150px;
        transition: all .2s ease-in-out;
      }
      @-webkit-keyframes background-flash {
        0% {
          background-color: inherit;
        }
        25% {
          background-color: #ffff00;
        }
        75% {
          background-color: #ffff00;
        }
        100% {
          background-color: inherit;
        }
      }
      [data-direction="top"] .top,
      [data-direction="bottom"] .bottom {
        animation: background-flash .5s linear;
      }
      [data-direction="top"] .bottom,
      [data-direction="initialized"] .bottom,
      [data-direction="bottom"] .top {
        display: none;
      }
      .box {
        border-radius: .25em;
        color: #000000;
        padding: 1em;
        text-align: center;
      }
      .instructions {
        background-image: linear-gradient(225deg, #00dcc0 0%, #1db395 75%);
        border-radius: .5em;
        grid-column: 1 / 9;
        padding: .5em;
      }
      .header {
        grid-row: 1 / 2;
      }
      .week-1 {
        grid-row: 2 / 3;
      }
      .week-1-instructions {
        grid-row: 3 / 4;
      }
      .ellipsis-top {
        grid-row: 4 / 5;
      }
      .week-2 {
        grid-row: 5 / 6;
      }
      .week-3 {
        grid-row: 6 / 7;
      }
      .week-4 {
        grid-row: 7 / 8;
      }
      .ellipsis-bottom {
        grid-row: 8 / 9;
      }
      .week-5-instructions {
        grid-row: 9 / 10;
      }
      .week-5 {
        grid-row: 10 / 11;
      }
      .sidebar {
        font-size: small;
        grid-column: 1 / 2;
      }
      .ellipsis {
        font-size: x-small;
        height: 1em;
        overflow: hidden;
        transition: all .4s ease-in-out;
      }
      [data-direction="initialized"] .ellipsis-top,
      [data-direction="top"] .ellipsis-top,
      [data-direction="bottom"] .ellipsis-bottom {
        height: 0;
        opacity: 0;
        padding: 0;
      }
      .header,
      .sidebar,
      .ellipsis {
        font-weight: bold;
        color: #005af0;
        font-family: "Poppins", sans-serif;
      }
      .content {
        border: 1px dotted #cccccc;
        font-size: small;
      }
      .content.week-1,
      .content.week-5 {
        border-style: solid;
      }
      .content.week-1:hover,
      .content.week-5:hover {
        background-image: linear-gradient(225deg, #ff52e1 0%, #eb49e1 75%);
        cursor: pointer;
      }
      .nightly {
        background-image: linear-gradient(225deg, #21c1fa 0%, #25b4ed 75%);
      }
      .opt-in {
        background-image: linear-gradient(225deg, #25b4ed 0%, #27a6e0 75%);
      }
      .beta {
        background-image: linear-gradient(225deg, #27a6e0 0%, #2899d3 75%);
      }
      .opt-in-beta {
        background-image: linear-gradient(225deg, #25b4ed 0%, #2899d3 75%);
      }
      .stable {
        background-image: linear-gradient(225deg, #2899d3 0%, #298dc6 75%);
      }
      .lts {
        background-image: linear-gradient(225deg, #298dc6 0%, #2980b9 75%);
      }
      code {
        font-family: "Fira Mono", monospace;
        font-weight: medium;
      }
      @media (max-width: 1023px) {
        #calendar {
          gap: 5px;
          grid-template-columns: 4em repeat(7, 1fr);
          grid-template-rows: auto 100px auto auto 100px 100px 100px auto auto 100px;
        }
        .box {
          font-size: x-small;
          padding: 4px;
        }
      }
      @media (max-width: 757px) {
        #calendar {
          gap: 2px;
          grid-template-rows: auto 75px auto auto 75px 75px 75px auto auto 75px;
        }
        .box {
          font-size: xx-small;
        }
        .content span {
          font-size: 0;
          hyphens: auto;
          margin-top: 3px;
          word-break: break-word;
          writing-mode: vertical-rl;
        }
        .content span code {
          font-size: xx-small;
        }
        .header {
          font-size: 0;
        }
        .header::first-letter {
          font-size: small;
        }
      }
    </style>
  </head>
  <body>
    <amp-script layout="intrinsic" width="1050" height="0" script="calendar-script">
      <div id="calendar" data-direction="initialized">
        <div class="box header">Week</div>
        <div class="box header day-sunday">Sunday</div>
        <div class="box header day-monday">Monday</div>
        <div class="box header day-tuesday">Tuesday</div>
        <div class="box header day-wednesday">Wednesday</div>
        <div class="box header day-thursday">Thursday</div>
        <div class="box header day-friday">Friday</div>
        <div class="box header day-saturday">Saturday</div>

        <div class="box instructions week-1-instructions" data-week="1"><span class="touch-only">Tap</span><span class="no-touch-only">Hover</span> on days above to see when the code merged on that day will be available on each release channel</div>
        <div class="box instructions week-5-instructions" data-week="5"><span class="touch-only">Tap</span><span class="no-touch-only">Hover</span> on days below to see when the latest code merge occurred so as to be included in each release channel</div>

        <div class="box sidebar week-1" data-week="1">
          <span class="top">N</span>
          <span class="bottom">2<sup>nd</sup> Monday of the month, before <code>stable</code></span>
        </div>
        <div class="box sidebar week-2" data-week="2">
          <span class="top">N+1</span>
          <span class="bottom">N-3</span>
        </div>
        <div class="box sidebar week-3" data-week="3">
          <span class="top">N+2</span>
          <span class="bottom">N-2</span>
        </div>
        <div class="box sidebar week-4" data-week="4">
          <span class="top">N+3</span>
          <span class="bottom">N-1</span>
        </div>
        <div class="box sidebar week-5" data-week="5">
          <span class="top">2<sup>nd</sup> Monday next month</span>
          <span class="bottom">N</span>
        </div>

        <div class="box sidebar ellipsis ellipsis-top">⋮</div>

        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>
        <div class="box ellipsis ellipsis-top">⋮</div>

        <div class="box sidebar ellipsis ellipsis-bottom">⋮</div>

        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>
        <div class="box ellipsis ellipsis-bottom">⋮</div>

        <div class="box content week-1 day-sunday" data-week="1" data-day="sunday"></div>
        <div class="box content week-1 day-monday" data-week="1" data-day="monday"></div>
        <div class="box content week-1 day-tuesday" data-week="1" data-day="tuesday"></div>
        <div class="box content week-1 day-wednesday" data-week="1" data-day="wednesday"></div>
        <div class="box content week-1 day-thursday" data-week="1" data-day="thursday"></div>
        <div class="box content week-1 day-friday" data-week="1" data-day="friday"></div>
        <div class="box content week-1 day-saturday" data-week="1" data-day="saturday"></div>

        <div class="box content week-2 day-sunday" data-week="2" data-day="sunday"></div>
        <div class="box content week-2 day-monday" data-week="2" data-day="monday"></div>
        <div class="box content week-2 day-tuesday" data-week="2" data-day="tuesday"></div>
        <div class="box content week-2 day-wednesday" data-week="2" data-day="wednesday"></div>
        <div class="box content week-2 day-thursday" data-week="2" data-day="thursday"></div>
        <div class="box content week-2 day-friday" data-week="2" data-day="friday"></div>
        <div class="box content week-2 day-saturday" data-week="2" data-day="saturday"></div>

        <div class="box content week-3 day-sunday" data-week="3" data-day="sunday"></div>
        <div class="box content week-3 day-monday" data-week="3" data-day="monday"></div>
        <div class="box content week-3 day-tuesday" data-week="3" data-day="tuesday"></div>
        <div class="box content week-3 day-wednesday" data-week="3" data-day="wednesday"></div>
        <div class="box content week-3 day-thursday" data-week="3" data-day="thursday"></div>
        <div class="box content week-3 day-friday" data-week="3" data-day="friday"></div>
        <div class="box content week-3 day-saturday" data-week="3" data-day="saturday"></div>

        <div class="box content week-4 day-sunday" data-week="4" data-day="sunday"></div>
        <div class="box content week-4 day-monday" data-week="4" data-day="monday"></div>
        <div class="box content week-4 day-tuesday" data-week="4" data-day="tuesday"></div>
        <div class="box content week-4 day-wednesday" data-week="4" data-day="wednesday"></div>
        <div class="box content week-4 day-thursday" data-week="4" data-day="thursday"></div>
        <div class="box content week-4 day-friday" data-week="4" data-day="friday"></div>
        <div class="box content week-4 day-saturday" data-week="4" data-day="saturday"></div>

        <div class="box content week-5 day-sunday" data-week="5" data-day="sunday"></div>
        <div class="box content week-5 day-monday" data-week="5" data-day="monday"></div>
        <div class="box content week-5 day-tuesday" data-week="5" data-day="tuesday"></div>
        <div class="box content week-5 day-wednesday" data-week="5" data-day="wednesday"></div>
        <div class="box content week-5 day-thursday" data-week="5" data-day="thursday"></div>
        <div class="box content week-5 day-friday" data-week="5" data-day="friday"></div>
        <div class="box content week-5 day-saturday" data-week="5" data-day="saturday"></div>
      </div>
    </amp-script>

    <script id="calendar-script" type="text/plain" target="amp-script">
      const channels = {
        '1': {
          'sunday': {
            'nightly': ['1', 'monday'],
            'opt-in': ['2', 'tuesday'],
            'beta': ['2', 'wednesday'],
            'stable': ['3', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'monday': {
            'nightly': ['1', 'tuesday'],
            'opt-in': ['2', 'tuesday'],
            'beta': ['2', 'wednesday'],
            'stable': ['3', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'tuesday': {
            'nightly': ['1', 'wednesday'],
            'opt-in': ['2', 'tuesday'],
            'beta': ['2', 'wednesday'],
            'stable': ['3', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'wednesday': {
            'nightly': ['1', 'thursday'],
            'opt-in': ['2', 'tuesday'],
            'beta': ['2', 'wednesday'],
            'stable': ['3', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'thursday': {
            'nightly': ['1', 'friday'],
            'opt-in': ['2', 'tuesday'],
            'beta': ['2', 'wednesday'],
            'stable': ['3', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'friday': {
            'nightly': ['2', 'monday'],
            'opt-in': ['3', 'tuesday'],
            'beta': ['3', 'wednesday'],
            'stable': ['4', 'tuesday'],
            'lts': ['5', 'monday'],
          },
          'saturday': {
            'nightly': ['2', 'monday'],
            'opt-in': ['3', 'tuesday'],
            'beta': ['3', 'wednesday'],
            'stable': ['4', 'tuesday'],
            'lts': ['5', 'monday'],
          },
        },
        '5': {
          'sunday': {
            'lts': ['1', 'thursday'],
            'stable': ['2', 'thursday'],
            'opt-in-beta': ['3', 'thursday'],
            'nightly': ['4', 'thursday'],
          },
          'monday': {
            'lts': ['1', 'thursday'],
            'stable': ['2', 'thursday'],
            'opt-in-beta': ['3', 'thursday'],
            'nightly': ['5', 'sunday'],
          },
          'tuesday': {
            'lts': ['1', 'thursday'],
            'stable': ['2', 'thursday'],
            'beta': ['3', 'thursday'],
            'opt-in': ['4', 'thursday'],
            'nightly': ['5', 'monday'],
          },
          'wednesday': {
            'lts': ['1', 'thursday'],
            'stable': ['3', 'thursday'],
            'opt-in-beta': ['4', 'thursday'],
            'nightly': ['5', 'tuesday'],
          },
          'thursday': {
            'lts': ['1', 'thursday'],
            'stable': ['3', 'thursday'],
            'opt-in-beta': ['4', 'thursday'],
            'nightly': ['5', 'wednesday'],
          },
          'friday': {
            'lts': ['1', 'thursday'],
            'stable': ['3', 'thursday'],
            'opt-in-beta': ['4', 'thursday'],
            'nightly': ['5', 'thursday'],
          },
          'saturday': {
            'lts': ['1', 'thursday'],
            'stable': ['3', 'thursday'],
            'opt-in-beta': ['4', 'thursday'],
            'nightly': ['5', 'thursday'],
          },
        },
      };

      const descriptions = {
        '1': {
          'selected': 'Code merged on this day…',
          'nightly': {
            prefix: '…is available on the',
            suffix: 'on this day,',
          },
          'opt-in': {
            prefix: 'for',
            suffix: 'to experimental / beta on this day,',
          },
          'beta': {
            prefix: 'on 1% traffic experimental / ',
            suffix: 'on this day,',
          },
          'stable': {
            prefix: 'on',
            suffix: 'on this day,',
          },
          'lts': {
            prefix: 'and as',
            suffix: 'on this day.',
          },
        },
        '5': {
          'selected': '…on the selected day',
          'lts': {
            prefix: 'code merged on this day is available as',
            suffix: '…'
          },
          'stable': {
            prefix: 'code merged on this day is available as',
            suffix: '…'
          },
          'beta': {
            prefix: 'code merged on this day is available as experimental /',
            suffix: '…'
          },
          'opt-in-beta': {
            prefix: 'code merged on this day is available for both',
            suffix: '…'
          },
          'opt-in': {
            prefix: 'code merged on this day is available as',
            suffix: '…'
          },
          'nightly': {
            prefix: 'code merged on this day is available as',
            suffix: '…'
          },
        }
      }

      function createSpan(prefix, channel, suffix) {
        const span = document.createElement('span');
        const prefixElm = document.createTextNode(`${prefix} `);
        const channelElm = document.createElement('code');
        channelElm.textContent = channel;
        const suffixElm = document.createTextNode(` ${suffix}`);
        [prefixElm, channelElm, suffixElm].forEach(elm => {
          span.appendChild(elm)
        });
        return span;
      };

      document.querySelectorAll('.content')
      .filter(elm => elm.classList.contains('week-1') || elm.classList.contains('week-5'))
      .forEach(elm => {
        elm.addEventListener('mouseenter', event => {
          const selectedWeek = elm.getAttribute('data-week');
          const selectedDay = elm.getAttribute('data-day');
          document.querySelector('#calendar')
            .setAttribute('data-direction', selectedWeek == '1' ? 'top' : 'bottom');

          event.currentTarget.textContent = descriptions[selectedWeek].selected;
          for (let [channel, [channelWeek, channelDay]] of Object.entries(channels[selectedWeek][selectedDay])) {
            const channelElm = document.querySelectorAll('.content')
              .filter(
                  elm => elm.getAttribute('data-week') === channelWeek
                  && elm.getAttribute('data-day') === channelDay
              )[0];

            while (channelElm.firstChild) {
              channelElm.firstChild.remove();
            }

            const {prefix, suffix} = descriptions[selectedWeek][channel];
            channelElm.appendChild(createSpan(prefix, channel, suffix));
            channelElm.classList.add(channel);
          }
        });

        elm.addEventListener('mouseleave', event => {
          event.currentTarget.textContent = '';
          for (const channel of ['nightly', 'opt-in', 'beta', 'opt-in-beta', 'stable', 'lts']) {
            document.querySelectorAll(`.${channel}`).forEach(elm => {
              elm.classList.remove(channel);
              while (elm.firstChild) {
                elm.firstChild.remove();
              }
            });
          }
        });
      });
    </script>
  </body>
</html>
